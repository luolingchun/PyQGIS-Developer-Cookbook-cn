
<!doctype html>
<html lang="zh" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="本项目是PyQGIS开发者手册的中文翻译。">
      
      
        <meta name="author" content="llc">
      
      
        <link rel="canonical" href="https://luolingchun.github.io/PyQGIS-Developer-Cookbook-cn/16-%E5%BC%80%E5%8F%91Python%E6%8F%92%E4%BB%B6/">
      
      
        <link rel="prev" href="../15-%E4%BB%BB%E5%8A%A1%E2%80%94%E2%80%94%E5%9C%A8%E5%90%8E%E5%8F%B0%E5%81%9A%E7%B9%81%E9%87%8D%E7%9A%84%E5%B7%A5%E4%BD%9C/">
      
      
        <link rel="next" href="../17-%E7%BC%96%E5%86%99%E5%A4%84%E7%90%86%E6%8F%92%E4%BB%B6/">
      
      
      <link rel="icon" href="../images/logo-blue.svg">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.19">
    
    
      
        <title>16-开发Python插件 - PyQGIS开发者手册</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.7e37652d.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../css/img.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#16-python" class="md-skip">
          跳转至
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="页眉">
    <a href=".." title="PyQGIS开发者手册" class="md-header__button md-logo" aria-label="PyQGIS开发者手册" data-md-component="logo">
      
  <img src="../images/logo.svg" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            PyQGIS开发者手册
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              16-开发Python插件
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="黑"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="黑" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5s-1.65.15-2.39.42zM3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29zm.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14zM20.65 7l-1.77 3.79a7.02 7.02 0 0 0-2.38-4.15zm-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29zM12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="亮"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="亮" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3zm3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95zm-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="搜索" placeholder="搜索" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="查找">
        
          <a href="javascript:void(0)" class="md-search__icon md-icon" title="分享" aria-label="分享" data-clipboard data-clipboard-text="" data-md-component="search-share" tabindex="-1">
            
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91s2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08"/></svg>
          </a>
        
        <button type="reset" class="md-search__icon md-icon" title="清空当前内容" aria-label="清空当前内容" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            正在初始化搜索引擎
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/luolingchun/PyQGIS-Developer-Cookbook-cn" title="前往仓库" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    Github
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="导航栏" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="PyQGIS开发者手册" class="md-nav__button md-logo" aria-label="PyQGIS开发者手册" data-md-component="logo">
      
  <img src="../images/logo.svg" alt="logo">

    </a>
    PyQGIS开发者手册
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/luolingchun/PyQGIS-Developer-Cookbook-cn" title="前往仓库" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    Github
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    主页
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../1-%E5%BC%95%E8%A8%80/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    1-引言
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../2-%E5%8A%A0%E8%BD%BD%E9%A1%B9%E7%9B%AE/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    2-加载项目
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../3-%E5%8A%A0%E8%BD%BD%E5%9B%BE%E5%B1%82/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    3-加载图层
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../4-%E8%AE%BF%E9%97%AE%E5%9B%BE%E5%B1%82%E7%9B%AE%E5%BD%95%E6%A0%91/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    4-访问图层目录树
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../5-%E4%BD%BF%E7%94%A8%E6%A0%85%E6%A0%BC%E5%9B%BE%E5%B1%82/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    5-使用栅格图层
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../6-%E4%BD%BF%E7%94%A8%E7%9F%A2%E9%87%8F%E5%9B%BE%E5%B1%82/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    6-使用矢量图层
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../7-%E5%87%A0%E4%BD%95%E5%A4%84%E7%90%86/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    7-几何处理
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../8-%E6%8A%95%E5%BD%B1%E6%94%AF%E6%8C%81/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    8-投影支持
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../9-%E4%BD%BF%E7%94%A8%E5%9C%B0%E5%9B%BE%E7%94%BB%E5%B8%83/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    9-使用地图画布
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../10-%E5%9C%B0%E5%9B%BE%E6%B8%B2%E6%9F%93%E5%92%8C%E6%89%93%E5%8D%B0/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    10-地图渲染和打印
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../11-%E8%A1%A8%E8%BE%BE%E5%BC%8F%EF%BC%8C%E8%BF%87%E6%BB%A4%E5%92%8C%E8%AE%A1%E7%AE%97%E5%80%BC/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    11-表达式，过滤和计算值
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../12-%E8%AF%BB%E5%8F%96%E5%92%8C%E5%AD%98%E5%82%A8%E8%AE%BE%E7%BD%AE/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    12-读取和存储设置
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../13-%E4%B8%8E%E7%94%A8%E6%88%B7%E9%80%9A%E4%BF%A1/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    13-与用户通信
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../14-%E8%AE%A4%E8%AF%81%E5%9F%BA%E7%A1%80/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    14-认证基础
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../15-%E4%BB%BB%E5%8A%A1%E2%80%94%E2%80%94%E5%9C%A8%E5%90%8E%E5%8F%B0%E5%81%9A%E7%B9%81%E9%87%8D%E7%9A%84%E5%B7%A5%E4%BD%9C/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    15-任务 - 在后台做繁重的工作
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    16-开发Python插件
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    16-开发Python插件
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="目录">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      目录
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#161-python" class="md-nav__link">
    <span class="md-ellipsis">
      16.1 构建Python插件
    </span>
  </a>
  
    <nav class="md-nav" aria-label="16.1 构建Python插件">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1611" class="md-nav__link">
    <span class="md-ellipsis">
      16.1.1 准备开始
    </span>
  </a>
  
    <nav class="md-nav" aria-label="16.1.1 准备开始">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#16111" class="md-nav__link">
    <span class="md-ellipsis">
      16.1.1.1 插件文件结构
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1612" class="md-nav__link">
    <span class="md-ellipsis">
      16.1.2 编写插件代码
    </span>
  </a>
  
    <nav class="md-nav" aria-label="16.1.2 编写插件代码">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#16121-metadatatxt" class="md-nav__link">
    <span class="md-ellipsis">
      16.1.2.1 metadata.txt
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#16122-__init__py" class="md-nav__link">
    <span class="md-ellipsis">
      16.1.2.2 __init__.py
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#16123-mainpluginpy" class="md-nav__link">
    <span class="md-ellipsis">
      16.1.2.3 mainPlugin.py
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1613" class="md-nav__link">
    <span class="md-ellipsis">
      16.1.3 文档
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1614" class="md-nav__link">
    <span class="md-ellipsis">
      16.1.4 翻译
    </span>
  </a>
  
    <nav class="md-nav" aria-label="16.1.4 翻译">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#16141" class="md-nav__link">
    <span class="md-ellipsis">
      16.1.4.1 软件要求
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#16142" class="md-nav__link">
    <span class="md-ellipsis">
      16.1.4.2 文件和目录
    </span>
  </a>
  
    <nav class="md-nav" aria-label="16.1.4.2 文件和目录">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#161421-pro" class="md-nav__link">
    <span class="md-ellipsis">
      16.1.4.2.1 .pro文件
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#161422-ts" class="md-nav__link">
    <span class="md-ellipsis">
      16.1.4.2.2 .ts文件
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#161423-qm" class="md-nav__link">
    <span class="md-ellipsis">
      16.1.4.2.3 .qm文件
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#16143-makefile" class="md-nav__link">
    <span class="md-ellipsis">
      16.1.4.3 使用MakeFile进行翻译
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#16144" class="md-nav__link">
    <span class="md-ellipsis">
      16.1.4.4 加载插件
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1615" class="md-nav__link">
    <span class="md-ellipsis">
      16.1.5 提示和技巧
    </span>
  </a>
  
    <nav class="md-nav" aria-label="16.1.5 提示和技巧">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#16151" class="md-nav__link">
    <span class="md-ellipsis">
      16.1.5.1 插件重载
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#16152-qgis-plugin-ci" class="md-nav__link">
    <span class="md-ellipsis">
      16.1.5.2 使用 qgis-plugin-ci自动打包、发布和翻译
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#16153" class="md-nav__link">
    <span class="md-ellipsis">
      16.1.5.3 访问插件
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#16154" class="md-nav__link">
    <span class="md-ellipsis">
      16.1.5.4 日志消息
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#16155" class="md-nav__link">
    <span class="md-ellipsis">
      16.1.5.5 分享你的插件
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1616" class="md-nav__link">
    <span class="md-ellipsis">
      16.1.6 提示和技巧
    </span>
  </a>
  
    <nav class="md-nav" aria-label="16.1.6 提示和技巧">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#16161" class="md-nav__link">
    <span class="md-ellipsis">
      16.1.6.1 插件重新加载程序
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#16162-qgisci" class="md-nav__link">
    <span class="md-ellipsis">
      16.1.6.2 使用qgis插件ci自动打包、发布和翻译
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#16163" class="md-nav__link">
    <span class="md-ellipsis">
      16.1.6.3 访问插件
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#16164" class="md-nav__link">
    <span class="md-ellipsis">
      16.1.6.4 日志信息
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#16165" class="md-nav__link">
    <span class="md-ellipsis">
      16.1.6.5 资源文件
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#162" class="md-nav__link">
    <span class="md-ellipsis">
      16.2 代码片段
    </span>
  </a>
  
    <nav class="md-nav" aria-label="16.2 代码片段">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1621" class="md-nav__link">
    <span class="md-ellipsis">
      16.2.1 如何通过快捷键调用方法
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1622-qgis" class="md-nav__link">
    <span class="md-ellipsis">
      16.2.2 如何重用QGIS图标
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1623" class="md-nav__link">
    <span class="md-ellipsis">
      16.2.3 选项对话框中的插件接口
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1624" class="md-nav__link">
    <span class="md-ellipsis">
      16.2.4 在图层树中嵌入图层的自定义小组件
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#163-ide" class="md-nav__link">
    <span class="md-ellipsis">
      16.3 编写和调试插件的IDE设置
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#164" class="md-nav__link">
    <span class="md-ellipsis">
      16.4 发布你的插件
    </span>
  </a>
  
    <nav class="md-nav" aria-label="16.4 发布你的插件">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1641" class="md-nav__link">
    <span class="md-ellipsis">
      16.4.1 元数据和名称
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1642" class="md-nav__link">
    <span class="md-ellipsis">
      16.4.2 代码和帮助
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1643-python" class="md-nav__link">
    <span class="md-ellipsis">
      16.4.3 官方python插件仓库
    </span>
  </a>
  
    <nav class="md-nav" aria-label="16.4.3 官方python插件仓库">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#16431" class="md-nav__link">
    <span class="md-ellipsis">
      16.4.3.1 权限
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#16432" class="md-nav__link">
    <span class="md-ellipsis">
      16.4.3.2 信任管理
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#16433" class="md-nav__link">
    <span class="md-ellipsis">
      16.4.3.3 验证
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#16434" class="md-nav__link">
    <span class="md-ellipsis">
      16.4.3.4 插件结构
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../17-%E7%BC%96%E5%86%99%E5%A4%84%E7%90%86%E6%8F%92%E4%BB%B6/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    17-编写处理插件
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../18-%E4%BD%BF%E7%94%A8%E6%8F%92%E4%BB%B6%E5%9B%BE%E5%B1%82/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    18-使用插件图层
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../19-%E7%BD%91%E7%BB%9C%E5%88%86%E6%9E%90%E5%BA%93/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    19-网络分析库
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../20-QGIS%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%92%8CPython/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    20-QGIS服务器和Python
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../21-PyQGIS%E9%80%9F%E6%9F%A5%E8%A1%A8/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    21-PyQGIS速查表
    
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="目录">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      目录
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#161-python" class="md-nav__link">
    <span class="md-ellipsis">
      16.1 构建Python插件
    </span>
  </a>
  
    <nav class="md-nav" aria-label="16.1 构建Python插件">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1611" class="md-nav__link">
    <span class="md-ellipsis">
      16.1.1 准备开始
    </span>
  </a>
  
    <nav class="md-nav" aria-label="16.1.1 准备开始">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#16111" class="md-nav__link">
    <span class="md-ellipsis">
      16.1.1.1 插件文件结构
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1612" class="md-nav__link">
    <span class="md-ellipsis">
      16.1.2 编写插件代码
    </span>
  </a>
  
    <nav class="md-nav" aria-label="16.1.2 编写插件代码">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#16121-metadatatxt" class="md-nav__link">
    <span class="md-ellipsis">
      16.1.2.1 metadata.txt
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#16122-__init__py" class="md-nav__link">
    <span class="md-ellipsis">
      16.1.2.2 __init__.py
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#16123-mainpluginpy" class="md-nav__link">
    <span class="md-ellipsis">
      16.1.2.3 mainPlugin.py
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1613" class="md-nav__link">
    <span class="md-ellipsis">
      16.1.3 文档
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1614" class="md-nav__link">
    <span class="md-ellipsis">
      16.1.4 翻译
    </span>
  </a>
  
    <nav class="md-nav" aria-label="16.1.4 翻译">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#16141" class="md-nav__link">
    <span class="md-ellipsis">
      16.1.4.1 软件要求
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#16142" class="md-nav__link">
    <span class="md-ellipsis">
      16.1.4.2 文件和目录
    </span>
  </a>
  
    <nav class="md-nav" aria-label="16.1.4.2 文件和目录">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#161421-pro" class="md-nav__link">
    <span class="md-ellipsis">
      16.1.4.2.1 .pro文件
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#161422-ts" class="md-nav__link">
    <span class="md-ellipsis">
      16.1.4.2.2 .ts文件
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#161423-qm" class="md-nav__link">
    <span class="md-ellipsis">
      16.1.4.2.3 .qm文件
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#16143-makefile" class="md-nav__link">
    <span class="md-ellipsis">
      16.1.4.3 使用MakeFile进行翻译
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#16144" class="md-nav__link">
    <span class="md-ellipsis">
      16.1.4.4 加载插件
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1615" class="md-nav__link">
    <span class="md-ellipsis">
      16.1.5 提示和技巧
    </span>
  </a>
  
    <nav class="md-nav" aria-label="16.1.5 提示和技巧">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#16151" class="md-nav__link">
    <span class="md-ellipsis">
      16.1.5.1 插件重载
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#16152-qgis-plugin-ci" class="md-nav__link">
    <span class="md-ellipsis">
      16.1.5.2 使用 qgis-plugin-ci自动打包、发布和翻译
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#16153" class="md-nav__link">
    <span class="md-ellipsis">
      16.1.5.3 访问插件
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#16154" class="md-nav__link">
    <span class="md-ellipsis">
      16.1.5.4 日志消息
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#16155" class="md-nav__link">
    <span class="md-ellipsis">
      16.1.5.5 分享你的插件
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1616" class="md-nav__link">
    <span class="md-ellipsis">
      16.1.6 提示和技巧
    </span>
  </a>
  
    <nav class="md-nav" aria-label="16.1.6 提示和技巧">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#16161" class="md-nav__link">
    <span class="md-ellipsis">
      16.1.6.1 插件重新加载程序
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#16162-qgisci" class="md-nav__link">
    <span class="md-ellipsis">
      16.1.6.2 使用qgis插件ci自动打包、发布和翻译
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#16163" class="md-nav__link">
    <span class="md-ellipsis">
      16.1.6.3 访问插件
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#16164" class="md-nav__link">
    <span class="md-ellipsis">
      16.1.6.4 日志信息
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#16165" class="md-nav__link">
    <span class="md-ellipsis">
      16.1.6.5 资源文件
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#162" class="md-nav__link">
    <span class="md-ellipsis">
      16.2 代码片段
    </span>
  </a>
  
    <nav class="md-nav" aria-label="16.2 代码片段">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1621" class="md-nav__link">
    <span class="md-ellipsis">
      16.2.1 如何通过快捷键调用方法
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1622-qgis" class="md-nav__link">
    <span class="md-ellipsis">
      16.2.2 如何重用QGIS图标
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1623" class="md-nav__link">
    <span class="md-ellipsis">
      16.2.3 选项对话框中的插件接口
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1624" class="md-nav__link">
    <span class="md-ellipsis">
      16.2.4 在图层树中嵌入图层的自定义小组件
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#163-ide" class="md-nav__link">
    <span class="md-ellipsis">
      16.3 编写和调试插件的IDE设置
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#164" class="md-nav__link">
    <span class="md-ellipsis">
      16.4 发布你的插件
    </span>
  </a>
  
    <nav class="md-nav" aria-label="16.4 发布你的插件">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1641" class="md-nav__link">
    <span class="md-ellipsis">
      16.4.1 元数据和名称
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1642" class="md-nav__link">
    <span class="md-ellipsis">
      16.4.2 代码和帮助
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1643-python" class="md-nav__link">
    <span class="md-ellipsis">
      16.4.3 官方python插件仓库
    </span>
  </a>
  
    <nav class="md-nav" aria-label="16.4.3 官方python插件仓库">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#16431" class="md-nav__link">
    <span class="md-ellipsis">
      16.4.3.1 权限
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#16432" class="md-nav__link">
    <span class="md-ellipsis">
      16.4.3.2 信任管理
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#16433" class="md-nav__link">
    <span class="md-ellipsis">
      16.4.3.3 验证
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#16434" class="md-nav__link">
    <span class="md-ellipsis">
      16.4.3.4 插件结构
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  
    <a href="https://github.com/luolingchun/PyQGIS-Developer-Cookbook-cn/edit/master/docs/16-开发Python插件.md" title="编辑此页" class="md-content__button md-icon" rel="edit">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M10 20H6V4h7v5h5v3.1l2-2V8l-6-6H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h4zm10.2-7c.1 0 .3.1.4.2l1.3 1.3c.2.2.2.6 0 .8l-1 1-2.1-2.1 1-1c.1-.1.2-.2.4-.2m0 3.9L14.1 23H12v-2.1l6.1-6.1z"/></svg>
    </a>
  
  
    
      
    
    <a href="https://github.com/luolingchun/PyQGIS-Developer-Cookbook-cn/raw/master/docs/16-开发Python插件.md" title="查看本页的源代码" class="md-content__button md-icon">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 18c.56 0 1 .44 1 1s-.44 1-1 1-1-.44-1-1 .44-1 1-1m0-3c-2.73 0-5.06 1.66-6 4 .94 2.34 3.27 4 6 4s5.06-1.66 6-4c-.94-2.34-3.27-4-6-4m0 6.5a2.5 2.5 0 0 1-2.5-2.5 2.5 2.5 0 0 1 2.5-2.5 2.5 2.5 0 0 1 2.5 2.5 2.5 2.5 0 0 1-2.5 2.5M9.27 20H6V4h7v5h5v4.07c.7.08 1.36.25 2 .49V8l-6-6H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h4.5a8.2 8.2 0 0 1-1.23-2"/></svg>
    </a>
  


<h1 id="16-python">16 开发Python插件<a class="headerlink" href="#16-python" title="Permanent link">⚓︎</a></h1>
<p>可以用Python编程语言创建插件。与用C ++编写插件相比，由于Python语言的动态特性，这些插件应该更容易编写，理解，维护和分发。</p>
<p>Python插件与QGIS插件管理器中的C ++插件一起列出。他们在<code>~/(UserProfile)/python/plugins</code>和以下路径中搜索：</p>
<ul>
<li>UNIX / Mac上： <code>(qgis_prefix)/share/qgis/python/plugins</code></li>
<li>Windows： <code>(qgis_prefix)/python/plugins</code></li>
</ul>
<p>有关<code>~</code>和<code>(UserProfile)</code>的定义,请查看<a href="https://docs.qgis.org/latest/en/docs/user_manual/plugins/plugins.html#core-and-external-plugins">Core和External插件</a>。</p>
<div class="admonition 提示">
<p class="admonition-title">提示</p>
<p>将QGIS_PLUGINPATH设置为一个存在的目录路径，可以将此路径添加到插件的搜索路径列表中。</p>
</div>
<h2 id="161-python">16.1 构建Python插件<a class="headerlink" href="#161-python" title="Permanent link">⚓︎</a></h2>
<p>创建插件，需要以下步骤：</p>
<ol>
<li><em>想法</em>：你想要使用新的QGIS插件做什么。你为什么要这么做？你想解决什么问题？这个问题已经有另一个插件吗？</li>
<li><em>创建文件</em>：一些必要文件（查看<a href="#16111">插件文件</a>）</li>
<li><em>编写代码</em>：在恰当的文件中写代码</li>
<li>文档：编写插件文档 </li>
<li>可选：翻译：将插件翻译成不同的语言</li>
<li><em>测试</em>：如果准备就绪，<a href="#1615">重新加载插件</a></li>
<li><em>发布</em>：在QGIS仓库中发布你的插件或将你自己的仓库作为个人“GIS武器”的“武器库”。</li>
</ol>
<h3 id="1611">16.1.1 准备开始<a class="headerlink" href="#1611" title="Permanent link">⚓︎</a></h3>
<p>在开始编写新的插件之前，先看看<a href="https://docs.qgis.org/testing/en/docs/pyqgis_developer_cookbook/plugins/releasing.html#official-pyqgis-repository">Python官方插件库</a>。现有插件的源代码可以帮助你了解更多编程知识。你也可能会发现类似的插件已经存在，你可以扩展它，或者至少在它的基础上开发自己的插件。</p>
<h4 id="16111">16.1.1.1 插件文件结构<a class="headerlink" href="#16111" title="Permanent link">⚓︎</a></h4>
<p>开始使用一个新的插件，我们需要设置必要的插件文件。</p>
<p>有两种插件模板资源可以帮助你入门：</p>
<ul>
<li>为了教育目的或者在需要采用极简主义方法时，<a href="https://github.com/wonder-sk/qgis-minimal-plugin">最小化插件模板</a>提供了创建有效的QGIS Python插件所需的基本文件（框架）。</li>
<li>更加完整的插件模板，<a href="https://plugins.qgis.org/plugins/pluginbuilder3/">插件构建器</a>可以创建多种不同类型的插件模板，包括本地化（翻译）和测试等功能。</li>
</ul>
<p>典型的插件目录包括以下文件：</p>
<ul>
<li><code>metadata.txt</code> - <em>必须</em> - 包含插件网站和插件基础结构使用的常规信息，版本、名称和一些其他元数据。</li>
<li><code>__init__.py</code> - <em>必须</em> - 插件的入口。它必须具有 <code>classFactory()</code>方法，还可以具有任何其他初始化代码。</li>
<li><code>mainPlugin.py</code> - <em>核心代码</em> - 插件的主要工作代码。包含有关插件操作和主要代码的所有信息。</li>
<li><code>form.ui</code> - <em>插件自定义UI</em> - Qt设计师创建的GUI。</li>
<li><code>form.py</code> - <em>编译的GUI</em> - 将上面描述的form.ui转换为Python代码。</li>
<li><code>resources.qrc</code> - <em>可选</em> - Qt设计师创建的xml文档。包含表单资源的相对路径。</li>
<li><code>resources.py</code> - <em>编译的资源文件，可选</em> - 将上述.qrc文件转换为Python代码。</li>
</ul>
<div class="admonition warning 警告">
<p class="admonition-title">Warning</p>
<p>如果您打算将插件上传到<a href="https://docs.qgis.org/testing/en/docs/pyqgis_developer_cookbook/plugins/releasing.html#official-pyqgis-repository">Python官方插件库</a>，则必须检查插件是否遵循插件<a href="https://docs.qgis.org/testing/en/docs/pyqgis_developer_cookbook/plugins/releasing.html#official-pyqgis-repository-validation">验证</a>所必需的一些附加规则</p>
</div>
<h3 id="1612">16.1.2 编写插件代码<a class="headerlink" href="#1612" title="Permanent link">⚓︎</a></h3>
<p>以下部分显示了应该在上面介绍的每个文件中添加哪些内容。</p>
<h4 id="16121-metadatatxt">16.1.2.1 metadata.txt<a class="headerlink" href="#16121-metadatatxt" title="Permanent link">⚓︎</a></h4>
<p>首先，插件管理器需要检索有关插件的一些基本信息，例如其名称、描述等。文件<code>metadata.txt</code>存储此信息。</p>
<div class="admonition 提示">
<p class="admonition-title">提示</p>
<p>所有元数据必须采用UTF-8编码。</p>
</div>
<table>
<thead>
<tr>
<th style="text-align: left;">元数据名称</th>
<th style="text-align: center;">是否必需</th>
<th style="text-align: left;">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;">name</td>
<td style="text-align: center;">是</td>
<td style="text-align: left;">插件名称，短字符串</td>
</tr>
<tr>
<td style="text-align: left;">qgisMinimumVersion</td>
<td style="text-align: center;">是</td>
<td style="text-align: left;">最小QGIS版本</td>
</tr>
<tr>
<td style="text-align: left;">qgisMaximumVersion</td>
<td style="text-align: center;">否</td>
<td style="text-align: left;">最大QGIS版本</td>
</tr>
<tr>
<td style="text-align: left;">description</td>
<td style="text-align: center;">是</td>
<td style="text-align: left;">描述插件的简短文本，不支持HTML</td>
</tr>
<tr>
<td style="text-align: left;">about</td>
<td style="text-align: center;">是</td>
<td style="text-align: left;">较长的文本，详细描述插件，不支持HTML</td>
</tr>
<tr>
<td style="text-align: left;">version</td>
<td style="text-align: center;">是</td>
<td style="text-align: left;">版本</td>
</tr>
<tr>
<td style="text-align: left;">author</td>
<td style="text-align: center;">是</td>
<td style="text-align: left;">作者姓名</td>
</tr>
<tr>
<td style="text-align: left;">email</td>
<td style="text-align: center;">是</td>
<td style="text-align: left;">作者的电子邮件，在网站上仅显示给登录的用户，但在插件安装后可在插件管理器中看到</td>
</tr>
<tr>
<td style="text-align: left;">changelog</td>
<td style="text-align: center;">否</td>
<td style="text-align: left;">字符串，可以是多行，不支持HTML</td>
</tr>
<tr>
<td style="text-align: left;">experimental</td>
<td style="text-align: center;">否</td>
<td style="text-align: left;">实验性，布尔值，True或False</td>
</tr>
<tr>
<td style="text-align: left;">deprecated</td>
<td style="text-align: center;">否</td>
<td style="text-align: left;">弃用，boolean值，True或False，适用于整个插件，而不仅仅适用于上传的版本</td>
</tr>
<tr>
<td style="text-align: left;">tags</td>
<td style="text-align: center;">否</td>
<td style="text-align: left;">以逗号分隔的列表，允许在单个标记内使用空格</td>
</tr>
<tr>
<td style="text-align: left;">homepage</td>
<td style="text-align: center;">否</td>
<td style="text-align: left;">指向插件主页的有效网址</td>
</tr>
<tr>
<td style="text-align: left;">repository</td>
<td style="text-align: center;">是</td>
<td style="text-align: left;">源代码存储库的有效URL</td>
</tr>
<tr>
<td style="text-align: left;">tracker</td>
<td style="text-align: center;">否</td>
<td style="text-align: left;">故障和错误报告的有效URL</td>
</tr>
<tr>
<td style="text-align: left;">icon</td>
<td style="text-align: center;">否</td>
<td style="text-align: left;">对于web友好的图像（PNG，JPEG）文件名或相对路径（相对于插件压缩包的文件夹）</td>
</tr>
<tr>
<td style="text-align: left;">category</td>
<td style="text-align: center;">否</td>
<td style="text-align: left;"><code>Raster</code>, <code>Vector</code>, <code>Database</code>, <code>Mesh</code> and <code>Web</code>（栅格、矢量、数据库和网络）</td>
</tr>
<tr>
<td style="text-align: left;">plugin_dependencies</td>
<td style="text-align: center;">否</td>
<td style="text-align: left;">类似于PIP的逗号分隔的其他插件列表，使用来自元数据名称字段的插件名称</td>
</tr>
<tr>
<td style="text-align: left;">server</td>
<td style="text-align: center;">否</td>
<td style="text-align: left;">布尔值，True或False，确定插件是否具有服务器接口</td>
</tr>
<tr>
<td style="text-align: left;">hasProcessingProvider</td>
<td style="text-align: center;">否</td>
<td style="text-align: left;">布尔值，True或False，确定插件是否提供处理算法</td>
</tr>
</tbody>
</table>
<p>默认情况下，插件放在 <strong>Plugins</strong> 菜单中（我们将在下一节中看到如何为插件添加菜单项），但也可以将它们放入 <strong>Raster</strong> ， <strong>Vector</strong> ， <strong>Database</strong> ，<strong>Mesh</strong> 和 <strong>Web</strong> 菜单中。</p>
<p>输入指定的“category”元数据，可以相应地对插件进行分类。此元数据用于提示用户，并告诉他们可以在哪里（在哪个菜单中）找到该插件。“category”的允许值为：Vector, Raster, Database或者Web。例如，如果你的插件可以从Raster菜单中找到，请将其添加到<code>metadata.txt</code>中</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="na">category</span><span class="o">=</span><span class="s">Raster</span>
</code></pre></div></td></tr></table></div>
<div class="admonition 提示">
<p class="admonition-title">提示</p>
<p>如果qgisMaximumVersion为空，则在上传到<a href="#1643-python">官方Python插件库</a>时，它将自动设置为主要版本加上.99（例如：3.99）。</p>
</div>
<p>metadata.txt示例：</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="c1">; 以下是强制性的</span>

<span class="k">[general]</span>
<span class="na">name</span><span class="o">=</span><span class="s">HelloWorld</span>
<span class="na">email</span><span class="o">=</span><span class="s">me@example.com</span>
<span class="na">author</span><span class="o">=</span><span class="s">Just Me</span>
<span class="na">qgisMinimumVersion</span><span class="o">=</span><span class="s">3.0</span>
<span class="na">description</span><span class="o">=</span><span class="s">This is an example plugin for greeting the world.</span>\
<span class="w">    </span><span class="s">Multiline is allowed:</span>\
<span class="w">    </span><span class="s">lines starting with spaces belong to the same</span>\
<span class="w">    </span><span class="s">field, in this case to the &quot;description&quot; field.</span>\
<span class="w">    </span><span class="s">HTML formatting is not allowed.</span>
<span class="na">about</span><span class="o">=</span><span class="s">This paragraph can contain a detailed description</span>\
<span class="w">    </span><span class="s">of the plugin. Multiline is allowed, HTML is not.</span>
<span class="na">version</span><span class="o">=</span><span class="s">version 1.2</span>
<span class="na">tracker</span><span class="o">=</span><span class="s">http://bugs.itopen.it</span>
<span class="na">repository</span><span class="o">=</span><span class="s">http://www.itopen.it/repo</span>
<span class="c1">; 结束强制</span>

<span class="c1">; 以下是可选的</span>
<span class="na">category</span><span class="o">=</span><span class="s">Raster</span>
<span class="na">changelog</span><span class="o">=</span><span class="s">The changelog lists the plugin versions</span>\
<span class="w">    </span><span class="s">and their changes as in the example below:</span>\
<span class="w">    </span><span class="s">1.0 - First stable release</span>\
<span class="w">    </span><span class="s">0.9 - All features implemented</span>\
<span class="w">    </span><span class="s">0.8 - First testing release</span>

<span class="c1">; 标签采用逗号分隔，标签名称允许使用空格</span>
<span class="c1">; 标签应该是英文的，在创建之前请检查现有标签和同义词</span>
<span class="na">tags</span><span class="o">=</span><span class="s">wkt,raster,hello world</span>

<span class="c1">; 这些元数据可以为空，最终将成为强制性的。</span>
<span class="na">homepage</span><span class="o">=</span><span class="s">https://www.itopen.it</span>
<span class="na">icon</span><span class="o">=</span><span class="s">icon.png</span>

<span class="c1">; 实验标志（适用于单一版本）</span>
<span class="na">experimental</span><span class="o">=</span><span class="s">True</span>

<span class="c1">; 弃用标志 （适用于整个插件，不仅适用于上传的版本）</span>
<span class="na">deprecated</span><span class="o">=</span><span class="s">False</span>

<span class="c1">; 如果为空，它将自动设置为主要版本+.99</span>
<span class="na">qgisMaximumVersion</span><span class="o">=</span><span class="s">3.99</span>

<span class="c1">; 从 QGIS 3.8开始，可以指定以逗号分隔指定要安装（或更新）的插件列表</span>
<span class="c1">; 下面示例安装或更新版本1.12的“MyOtherPlugin”和任何版本的“YetAnotherPlugin”</span>
<span class="na">plugin_dependencies</span><span class="o">=</span><span class="s">MyOtherPlugin==1.12,YetAnotherPlugin</span>
</code></pre></div></td></tr></table></div>
<h4 id="16122-__init__py">16.1.2.2 __init__.py<a class="headerlink" href="#16122-__init__py" title="Permanent link">⚓︎</a></h4>
<p>Python包需要此文件。此外，QGIS要求此文件包含一个<code>classFactory()</code>函数，该函数在插件被加载到QGIS时调用。它接收<a href="https://qgis.org/pyqgis/master/gui/QgisInterface.html#qgis.gui.QgisInterface"><code>QgisInterface</code></a>实例， 并且必须返回<code>mainplugin.py</code>中插件类的对象——在我们的例子中它被命名为<code>TestPlugin</code>（见下文）。<code>__init__.py</code>应该是这样的：</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">classFactory</span><span class="p">(</span><span class="n">iface</span><span class="p">):</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">.mainPlugin</span><span class="w"> </span><span class="kn">import</span> <span class="n">TestPlugin</span>
    <span class="k">return</span> <span class="n">TestPlugin</span><span class="p">(</span><span class="n">iface</span><span class="p">)</span>

<span class="c1"># 任何其他初始化</span>
</code></pre></div></td></tr></table></div>
<h4 id="16123-mainpluginpy">16.1.2.3 mainPlugin.py<a class="headerlink" href="#16123-mainpluginpy" title="Permanent link">⚓︎</a></h4>
<p>这就是魔法发生的地方，下面就是魔法的例子:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">qgis.PyQt.QtGui</span><span class="w"> </span><span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">qgis.PyQt.QtWidgets</span><span class="w"> </span><span class="kn">import</span> <span class="o">*</span>

<span class="c1"># 从文件resources.py初始化Qt的资源</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">.</span><span class="w"> </span><span class="kn">import</span> <span class="n">resources</span>


<span class="k">class</span><span class="w"> </span><span class="nc">TestPlugin</span><span class="p">:</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">iface</span><span class="p">):</span>
        <span class="c1"># 保存QGIS interface引用</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">iface</span> <span class="o">=</span> <span class="n">iface</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">initGui</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># 创建操作，它将启动插件配置</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">action</span> <span class="o">=</span> <span class="n">QAction</span><span class="p">(</span><span class="n">QIcon</span><span class="p">(</span><span class="s2">&quot;:/plugins/testplug/icon.png&quot;</span><span class="p">),</span> <span class="s2">&quot;Test plugin&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">iface</span><span class="o">.</span><span class="n">mainWindow</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">action</span><span class="o">.</span><span class="n">setObjectName</span><span class="p">(</span><span class="s2">&quot;testAction&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">action</span><span class="o">.</span><span class="n">setWhatsThis</span><span class="p">(</span><span class="s2">&quot;Configuration for test plugin&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">action</span><span class="o">.</span><span class="n">setStatusTip</span><span class="p">(</span><span class="s2">&quot;This is status tip&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">action</span><span class="o">.</span><span class="n">triggered</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">run</span><span class="p">)</span>

        <span class="c1"># 添加工具栏按钮和菜单项</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">iface</span><span class="o">.</span><span class="n">addToolBarIcon</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">action</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">iface</span><span class="o">.</span><span class="n">addPluginToMenu</span><span class="p">(</span><span class="s2">&quot;&amp;Test plugins&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">action</span><span class="p">)</span>

        <span class="c1"># 连接信号renderComplete——画布渲染完成后发送的信号</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">iface</span><span class="o">.</span><span class="n">mapCanvas</span><span class="p">()</span><span class="o">.</span><span class="n">renderComplete</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">renderTest</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">unload</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># 删除插件菜单项和图标</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">iface</span><span class="o">.</span><span class="n">removePluginMenu</span><span class="p">(</span><span class="s2">&quot;&amp;Test plugins&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">action</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">iface</span><span class="o">.</span><span class="n">removeToolBarIcon</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">action</span><span class="p">)</span>

        <span class="c1"># 断开信号</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">iface</span><span class="o">.</span><span class="n">mapCanvas</span><span class="p">()</span><span class="o">.</span><span class="n">renderComplete</span><span class="o">.</span><span class="n">disconnect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">renderTest</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># 创建并显示一个配置对话框或类似的事情</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;TestPlugin: run called!&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">renderTest</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">painter</span><span class="p">):</span>

        <span class="c1"># 使用painter绘制地图画布</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;TestPlugin: renderTest called!&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
<p>主插件源文件中（例如 <code>mainPlugin.py</code>）必须存在的插件函数是：</p>
<ul>
<li><code>__init__</code> - &gt;可以访问QGIS界面</li>
<li><code>initGui()</code> - &gt;加载插件时调用</li>
<li><code>unload()</code> - &gt;卸载插件时调用</li>
</ul>
<p>在上面的例子中，<a href="https://qgis.org/pyqgis/master/gui/QgisInterface.html#qgis.gui.QgisInterface.addPluginToMenu"><code>addPluginToMenu()</code></a>被使用。这会将相应的菜单操作添加到 <strong>Plugins</strong> 菜单中。存在额外的方法将操作（action）添加到不同菜单。以下是这些方法的列表：</p>
<ul>
<li><a href="https://qgis.org/pyqgis/master/gui/QgisInterface.html#qgis.gui.QgisInterface.addPluginToRasterMenu"><code>addPluginToRasterMenu()</code></a></li>
<li><a href="https://qgis.org/pyqgis/master/gui/QgisInterface.html#qgis.gui.QgisInterface.addPluginToVectorMenu"><code>addPluginToVectorMenu()</code></a></li>
<li><a href="https://qgis.org/pyqgis/master/gui/QgisInterface.html#qgis.gui.QgisInterface.addPluginToDatabaseMenu"><code>addPluginToDatabaseMenu()</code></a></li>
<li><a href="https://qgis.org/pyqgis/master/gui/QgisInterface.html#qgis.gui.QgisInterface.addPluginToWebMenu"><code>addPluginToWebMenu()</code></a></li>
</ul>
<p>它们都具有与<a href="https://qgis.org/pyqgis/master/gui/QgisInterface.html#qgis.gui.QgisInterface.addPluginToMenu"><code>addPluginToMenu()</code></a>方法相同的语法 。</p>
<p>建议将插件菜单添加到其中一个预定义方法，以保持插件条目组织方式的一致性。但是，你可以将自定义菜单组直接添加到菜单栏，如下面示例所示：</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">initGui</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">menu</span> <span class="o">=</span> <span class="n">QMenu</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">iface</span><span class="o">.</span><span class="n">mainWindow</span><span class="p">())</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">menu</span><span class="o">.</span><span class="n">setObjectName</span><span class="p">(</span><span class="s2">&quot;testMenu&quot;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">menu</span><span class="o">.</span><span class="n">setTitle</span><span class="p">(</span><span class="s2">&quot;MyMenu&quot;</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">action</span> <span class="o">=</span> <span class="n">QAction</span><span class="p">(</span><span class="n">QIcon</span><span class="p">(</span><span class="s2">&quot;:/plugins/testplug/icon.png&quot;</span><span class="p">),</span> <span class="s2">&quot;Test plugin&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">iface</span><span class="o">.</span><span class="n">mainWindow</span><span class="p">())</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">action</span><span class="o">.</span><span class="n">setObjectName</span><span class="p">(</span><span class="s2">&quot;testAction&quot;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">action</span><span class="o">.</span><span class="n">setWhatsThis</span><span class="p">(</span><span class="s2">&quot;Configuration for test plugin&quot;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">action</span><span class="o">.</span><span class="n">setStatusTip</span><span class="p">(</span><span class="s2">&quot;This is status tip&quot;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">action</span><span class="o">.</span><span class="n">triggered</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">run</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">menu</span><span class="o">.</span><span class="n">addAction</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">action</span><span class="p">)</span>

    <span class="n">menuBar</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">iface</span><span class="o">.</span><span class="n">mainWindow</span><span class="p">()</span><span class="o">.</span><span class="n">menuBar</span><span class="p">()</span>
    <span class="n">menuBar</span><span class="o">.</span><span class="n">insertMenu</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">iface</span><span class="o">.</span><span class="n">firstRightStandardMenu</span><span class="p">()</span><span class="o">.</span><span class="n">menuAction</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">menu</span><span class="p">)</span>

<span class="k">def</span><span class="w"> </span><span class="nf">unload</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">menu</span><span class="o">.</span><span class="n">deleteLater</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
<p>不要忘记设置<code>QAction</code>和<code>QMenu</code> <code>objectName</code>插件的特定名称，以便可以自定义。</p>
<p>虽然帮助和关于操作也可以添加到你的自定义菜单中，但QGIS主 <strong>帮助</strong> ► <strong>插件</strong> 菜单中有一个简便的地方。这是使用<a href="https://qgis.org/pyqgis/master/gui/QgisInterface.html#qgis.gui.QgisInterface.pluginHelpMenu"><code>pluginHelpMenu()</code></a>方法完成的。</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">initGui</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">help_action</span> <span class="o">=</span> <span class="n">QAction</span><span class="p">(</span>
        <span class="n">QIcon</span><span class="p">(</span><span class="s2">&quot;:/plugins/testplug/icon.png&quot;</span><span class="p">),</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tr</span><span class="p">(</span><span class="s2">&quot;Test Plugin...&quot;</span><span class="p">),</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">iface</span><span class="o">.</span><span class="n">mainWindow</span><span class="p">()</span>
    <span class="p">)</span>
    <span class="c1"># 添加操作到帮助菜单</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">iface</span><span class="o">.</span><span class="n">pluginHelpMenu</span><span class="p">()</span><span class="o">.</span><span class="n">addAction</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">help_action</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">help_action</span><span class="o">.</span><span class="n">triggered</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">show_help</span><span class="p">)</span>

<span class="nd">@staticmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">show_help</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;打开在线帮助&quot;&quot;&quot;</span>
    <span class="n">QDesktopServices</span><span class="o">.</span><span class="n">openUrl</span><span class="p">(</span><span class="n">QUrl</span><span class="p">(</span><span class="s1">&#39;https://docs.qgis.org&#39;</span><span class="p">))</span>

<span class="k">def</span><span class="w"> </span><span class="nf">unload</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">iface</span><span class="o">.</span><span class="n">pluginHelpMenu</span><span class="p">()</span><span class="o">.</span><span class="n">removeAction</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">help_action</span><span class="p">)</span>
    <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">help_action</span>
</code></pre></div></td></tr></table></div>
<h3 id="1613">16.1.3 文档<a class="headerlink" href="#1613" title="Permanent link">⚓︎</a></h3>
<p>该插件的文档可以编写为HTML帮助文档。<code>qgis.utils</code>模块提供了一个函数，<code>showPluginHelp()</code>将打开帮助文档浏览器，与其他QGIS帮助文档的方式相同。</p>
<p><code>showPluginHelp()</code>函数在与调用模块相同的目录中查找帮助文档。它会寻找<code>index-ll_cc.html</code>，<code>index-ll.html</code>，<code>index-en.html</code>，<code>index-en_us.html</code>和<code>index.html</code>，显示它找到的第一个文档。这<code>ll_cc</code>是QGIS语言环境，这允许文档有多个翻译。</p>
<p><code>showPluginHelp()</code>函数还可以使用参数<code>packageName</code>——它显示指定插件的帮助文档，<code>filename</code>——可以替换被搜索的文件名中的“index”，section——它是html锚标记的名称，浏览器将定位到该位置。</p>
<h3 id="1614">16.1.4 翻译<a class="headerlink" href="#1614" title="Permanent link">⚓︎</a></h3>
<p>通过几个步骤，你可以设置插件本地化的环境，以便根据计算机的区域，插件将以不同语言加载。</p>
<h4 id="16141">16.1.4.1 软件要求<a class="headerlink" href="#16141" title="Permanent link">⚓︎</a></h4>
<p>创建和管理所有翻译文件的最简单方法是安装 <a href="https://doc.qt.io/qt-5/qtlinguist-index.html">Qt Linguist</a>。在基于Debian的GNU / Linux环境中，你可以这样安装它：</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span></pre></div></td><td class="code"><div><pre><span></span><code>sudo<span class="w"> </span>apt-get<span class="w"> </span>install<span class="w"> </span>qttools5-dev-tools
</code></pre></div></td></tr></table></div>
<h4 id="16142">16.1.4.2 文件和目录<a class="headerlink" href="#16142" title="Permanent link">⚓︎</a></h4>
<p>创建插件时，你将在主插件目录中找到该文件夹<code>i18n</code>。</p>
<p><strong>所有翻译文件都必须放在此目录中。</strong></p>
<h5 id="161421-pro">16.1.4.2.1 .pro文件<a class="headerlink" href="#161421-pro" title="Permanent link">⚓︎</a></h5>
<p>首先，你应该创建一个<code>.pro</code>文件，这是一个可以由 <strong>Qt Linguist</strong> 管理的 <em>项目</em> 文件。</p>
<p>在此<code>.pro</code>文件中，你必须指定要翻译的所有文件和窗体（.ui文件）。此文件用于设置本地化文件和变量。下面是一个项目文件，匹配我们的<a href="#16111">示例插件</a>的结构 ：</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="na">FORMS</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">../form.ui</span>
<span class="na">SOURCES</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">../your_plugin.py</span>
<span class="na">TRANSLATIONS</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">your_plugin_it.ts</span>
</code></pre></div></td></tr></table></div>
<p>你的插件可能有更复杂的结构，并且可能分布在多个文件中。如果是这种情况，请记住，使用<code>pylupdate5</code>读取<code>.pro</code>文件并更新可翻译字符串，这不会扩展通配符，因此你需要将每个文件显式放在<code>.pro</code>文件中。你的项目文件可能看起来像这样：</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="na">FORMS</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">../ui/about.ui ../ui/feedback.ui </span>\
<span class="w">        </span><span class="s">../ui/main_dialog.ui</span>
<span class="na">SOURCES</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">../your_plugin.py ../computation.py </span>\
<span class="w">          </span><span class="s">../utils.py</span>
</code></pre></div></td></tr></table></div>
<p>此外，<code>your_plugin.py</code>文件是<em>调用</em> QGIS工具栏中插件的所有菜单和子菜单的文件，你希望将它们全部翻译。</p>
<p>最后，使用<em>TRANSLATIONS</em>变量，你可以指定所需的翻译语言。</p>
<div class="admonition 警告 warning">
<p class="admonition-title">警告</p>
<p>确保<code>ts</code>文件名称为<code>your_plugin_</code> + <code>language</code> + <code>.ts</code>，否则语言将加载失败。使用两个字母的语言缩写（it对应Italian，de对应German，等等）</p>
</div>
<h5 id="161422-ts">16.1.4.2.2 .ts文件<a class="headerlink" href="#161422-ts" title="Permanent link">⚓︎</a></h5>
<p>创建<code>.pro</code>完成后，你就可以为插件的语言生成<code>.ts</code>文件了。</p>
<p>打开终端，转到<code>your_plugin/i18n</code>目录并输入：</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span></pre></div></td><td class="code"><div><pre><span></span><code>pylupdate5<span class="w"> </span>your_plugin.pro
</code></pre></div></td></tr></table></div>
<p>你应该可以看到<code>your_plugin_language.ts</code>文件。</p>
<p>用 <strong>Qt Linguist</strong> 打开<code>.ts</code>文件并开始翻译。</p>
<h5 id="161423-qm">16.1.4.2.3 .qm文件<a class="headerlink" href="#161423-qm" title="Permanent link">⚓︎</a></h5>
<p>当你完成插件翻译时（如果某些字符串未完成，将使用这些字符串的源语言），你必须创建<code>.qm</code> 文件（将被QGIS使用的<code>.ts</code>编译文件）。</p>
<p>只需在<code>your_plugin/i18n</code>目录中打开终端cd 并输入：</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span></pre></div></td><td class="code"><div><pre><span></span><code>lrelease<span class="w"> </span>your_plugin.ts
</code></pre></div></td></tr></table></div>
<p>现在，在<code>i18n</code>目录中你将看到<code>your_plugin.qm</code>文件。</p>
<h4 id="16143-makefile">16.1.4.3 使用MakeFile进行翻译<a class="headerlink" href="#16143-makefile" title="Permanent link">⚓︎</a></h4>
<p>或者，如果你使用Plugin Builder创建了插件，则可以使用makefile从python代码和Qt对话框中提取消息。在Makefile的开头有一个LOCALES变量：</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="na">LOCALES</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">en</span>
</code></pre></div></td></tr></table></div>
<p>将该语言的缩写添加到此变量中，例如匈牙利语：</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="na">LOCALES</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">en hu</span>
</code></pre></div></td></tr></table></div>
<p>现在，你可以通过以下方式从源生成或更新<code>hu.ts</code>文件（以及其中的<code>en.ts</code>）：</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span></pre></div></td><td class="code"><div><pre><span></span><code>make<span class="w"> </span>transup
</code></pre></div></td></tr></table></div>
<p>在此之后，你已在LOCALES变量中更新<code>.ts</code>了所有语言的文件。使用 <strong>Qt Linguist</strong> 翻译程序消息。完成翻译后，<code>.qm</code>可以通过<code>transcompile</code>创建：</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span></pre></div></td><td class="code"><div><pre><span></span><code>make<span class="w"> </span>transcompile
</code></pre></div></td></tr></table></div>
<p>你必须在你的插件中分发<code>.ts</code>文件。</p>
<h4 id="16144">16.1.4.4 加载插件<a class="headerlink" href="#16144" title="Permanent link">⚓︎</a></h4>
<p>要查看插件的翻译，只需打开QGIS，更改语言（ <strong>设置</strong> ‣ <strong>选项</strong> ‣ <strong>通用</strong> ）并重新启动QGIS。</p>
<p>你应该看到你的插件使用正确的语言。</p>
<div class="admonition 警告 warning">
<p class="admonition-title">警告</p>
<p>如果你改变了一些东西（新的UI，新的菜单，等等），你必须重新生成<code>.ts</code>和<code>.qm</code>文件，因此需要再一次执行以上命令。</p>
</div>
<h3 id="1615">16.1.5 提示和技巧<a class="headerlink" href="#1615" title="Permanent link">⚓︎</a></h3>
<h4 id="16151">16.1.5.1 插件重载<a class="headerlink" href="#16151" title="Permanent link">⚓︎</a></h4>
<p>在开发插件期间，你经常需要在QGIS中重新加载它以进行测试。使用 <strong>Plugin Reloader</strong> 插件非常容易。你可以在<a href="https://docs.qgis.org/testing/en/docs/user_manual/plugins/plugins.html#plugins">插件管理器</a>中找到它。</p>
<h4 id="16152-qgis-plugin-ci">16.1.5.2 使用 qgis-plugin-ci自动打包、发布和翻译<a class="headerlink" href="#16152-qgis-plugin-ci" title="Permanent link">⚓︎</a></h4>
<p><a href="https://opengisch.github.io/qgis-plugin-ci/">qgis-plugin-ci</a>提供了一个命令行界面，用于在你的计算机上执行 QGIS 插件的自动打包和部署，或使用持续集成（如 <a href="https://docs.github.com/en/actions/using-workflows">GitHub 工作流</a>或 <a href="https://docs.gitlab.com/ee/ci/">Gitlab-CI</a> 以及 <a href="https://www.transifex.com/">Transifex</a> 进行翻译）。</p>
<h4 id="16153">16.1.5.3 访问插件<a class="headerlink" href="#16153" title="Permanent link">⚓︎</a></h4>
<p>你可以使用python从QGIS中访问所有已安装插件类，这可以方便调试：</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="n">my_plugin</span> <span class="o">=</span> <span class="n">qgis</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">plugins</span><span class="p">[</span><span class="s1">&#39;My Plugin&#39;</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
<h4 id="16154">16.1.5.4 日志消息<a class="headerlink" href="#16154" title="Permanent link">⚓︎</a></h4>
<p>插件在<a href="https://docs.qgis.org/latest/en/docs/user_manual/introduction/general_tools.html#log-message-panel">日志消息面板中</a>有自己的选项卡。</p>
<h4 id="16155">16.1.5.5 分享你的插件<a class="headerlink" href="#16155" title="Permanent link">⚓︎</a></h4>
<p>QGIS在插件仓库中托管了数百个插件。考虑分享你的插件！它将扩展QGIS，人们将能够从你的代码中学习。可以使用插件管理器在QGIS中找到并安装所有托管的插件。</p>
<p>信息和要求：<a href="https://plugins.qgis.org/">plugins.qgis.org</a>。</p>
<h3 id="1616">16.1.6 提示和技巧<a class="headerlink" href="#1616" title="Permanent link">⚓︎</a></h3>
<h4 id="16161">16.1.6.1 插件重新加载程序<a class="headerlink" href="#16161" title="Permanent link">⚓︎</a></h4>
<p>在开发插件过程中，你经常需要重新加载它以进行测试。使用<strong>Plugin Reloader</strong>插件非常容易。你可以在<a href="https://docs.qgis.org/testing/en/docs/user_manual/plugins/plugins.html#plugins">插件管理器</a>中找到它。</p>
<h4 id="16162-qgisci">16.1.6.2 使用qgis插件ci自动打包、发布和翻译<a class="headerlink" href="#16162-qgisci" title="Permanent link">⚓︎</a></h4>
<p><a href="https://opengisch.github.io/qgis-plugin-ci/">qgis-plugin-ci</a> 提供了一个命令行界面，可以在你的计算机上或使用持续集成工具（如 <a href="https://docs.github.com/en/actions/using-workflows">GitHub 工作流</a>或 <a href="https://docs.gitlab.com/ee/ci/">Gitlab-CI</a>）以及 <a href="https://www.transifex.com/">Transifex</a> 进行自动打包和部署 QGIS 插件。它允许通过 CLI 或在 CI 操作中发布、翻译、发布或生成 XML 插件存储库文件。</p>
<h4 id="16163">16.1.6.3 访问插件<a class="headerlink" href="#16163" title="Permanent link">⚓︎</a></h4>
<p>你可以使用Python在QGIS中访问所有已安装插件的类，这对于调试很有用。</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="n">my_plugin</span> <span class="o">=</span> <span class="n">qgis</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">plugins</span><span class="p">[</span><span class="s1">&#39;My Plugin&#39;</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
<h4 id="16164">16.1.6.4 日志信息<a class="headerlink" href="#16164" title="Permanent link">⚓︎</a></h4>
<p>插件在<a href="https://docs.qgis.org/testing/en/docs/user_manual/introduction/general_tools.html#log-message-panel">日志消息面板</a>中有自己的选项卡。</p>
<h4 id="16165">16.1.6.5 资源文件<a class="headerlink" href="#16165" title="Permanent link">⚓︎</a></h4>
<p>你可以看到在<code>initGui()</code>中我们使用了资源文件中的图标（在我们的案例中是<code>resources.qrc</code>）</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nt">&lt;RCC&gt;</span>
<span class="w">  </span><span class="nt">&lt;qresource</span><span class="w"> </span><span class="na">prefix=</span><span class="s">&quot;/plugins/testplug&quot;</span><span class="w"> </span><span class="nt">&gt;</span>
<span class="w">     </span><span class="nt">&lt;file&gt;</span>icon.png<span class="nt">&lt;/file&gt;</span>
<span class="w">  </span><span class="nt">&lt;/qresource&gt;</span>
<span class="nt">&lt;/RCC&gt;</span>
</code></pre></div></td></tr></table></div>
<p>最好使用不会与其他插件或QGIS的任何部分发生冲突的前缀，否则你可能会得到你不想要的资源。现在你只需要生成一个包含资源的Python文件。它是用 <strong>pyrcc5</strong> 命令完成的：</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span></pre></div></td><td class="code"><div><pre><span></span><code>pyrcc5<span class="w"> </span>-o<span class="w"> </span>resources.py<span class="w"> </span>resources.qrc
</code></pre></div></td></tr></table></div>
<div class="admonition 提示">
<p class="admonition-title">提示</p>
<p>在Windows环境中，尝试从CMD或Powershell运行pyrcc5可能会导致错误“Windows无法访问指定的设备，路径，或文件[...]”。最简单的解决方案可能是使用osgeo4wshell，但如果你愿意修改PATH环境变量或显式指定可执行文件的路径，你应该可以在<code>&lt;Your QGIS Install Directory&gt;\bin\pyrcc5.exe</code>找到它</p>
</div>
<p>就这些……没什么复杂的:)</p>
<p>如果你已正确完成所有操作，则应该能够在插件管理器中查找并加载插件，在点击工具栏图标或相应的菜单项时，可以在控制台中查看到消息。</p>
<p>在处理真正的插件时，最好将插件写入另一个（工作）目录并创建一个makefile，它将生成UI和资源文件并将插件安装到QGIS安装中。</p>
<h2 id="162">16.2 代码片段<a class="headerlink" href="#162" title="Permanent link">⚓︎</a></h2>
<p>本节以代码片段为例，讲解插件开发</p>
<h3 id="1621">16.2.1 如何通过快捷键调用方法<a class="headerlink" href="#1621" title="Permanent link">⚓︎</a></h3>
<p>在<code>initGui()</code>中添加：</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="bp">self</span><span class="o">.</span><span class="n">key_action</span> <span class="o">=</span> <span class="n">QAction</span><span class="p">(</span><span class="s2">&quot;Test Plugin&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">iface</span><span class="o">.</span><span class="n">mainWindow</span><span class="p">())</span>
<span class="bp">self</span><span class="o">.</span><span class="n">iface</span><span class="o">.</span><span class="n">registerMainWindowAction</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">key_action</span><span class="p">,</span> <span class="s2">&quot;Ctrl+I&quot;</span><span class="p">)</span>  <span class="c1"># 操作被Ctrl+I触发</span>
<span class="bp">self</span><span class="o">.</span><span class="n">iface</span><span class="o">.</span><span class="n">addPluginToMenu</span><span class="p">(</span><span class="s2">&quot;&amp;Test plugins&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">key_action</span><span class="p">)</span>
<span class="bp">self</span><span class="o">.</span><span class="n">key_action</span><span class="o">.</span><span class="n">triggered</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">key_action_triggered</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
<p>在<code>unload()</code>中添加：</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="bp">self</span><span class="o">.</span><span class="n">iface</span><span class="o">.</span><span class="n">unregisterMainWindowAction</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">keyAction</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
<p>按下<code>CTRL+I</code>时调用方法：</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">key_action_triggered</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="n">QMessageBox</span><span class="o">.</span><span class="n">information</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">iface</span><span class="o">.</span><span class="n">mainWindow</span><span class="p">(),</span><span class="s2">&quot;Ok&quot;</span><span class="p">,</span> <span class="s2">&quot;You pressed Ctrl+I&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
<p>还可以允许用户为提供的操作自定义快捷键。这是通过添加以下内容来完成的：</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="c1"># 在 initGui() 方法中</span>
<span class="n">QgsGui</span><span class="o">.</span><span class="n">shortcutsManager</span><span class="p">()</span><span class="o">.</span><span class="n">registerAction</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">key_action</span><span class="p">)</span>

<span class="c1"># 在 unload() 方法中</span>
<span class="n">QgsGui</span><span class="o">.</span><span class="n">shortcutsManager</span><span class="p">()</span><span class="o">.</span><span class="n">unregisterAction</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">key_action</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
<h3 id="1622-qgis">16.2.2 如何重用QGIS图标<a class="headerlink" href="#1622-qgis" title="Permanent link">⚓︎</a></h3>
<p>因为它们是众所周知的，并且向用户传达了明确的信息，所以有时你可能希望在插件中重用QGIS图标，而不是绘制和设置新图标。使用<a href="https://qgis.org/pyqgis/master/core/QgsApplication.html#qgis.core.QgsApplication.getThemeIcon"><code>getThemeIcon()</code></a>方法。</p>
<p>例如，重用 QGIS 代码存储库中可用的 <a href="https://github.com/qgis/QGIS/blob/master/images/themes/default/mActionFileOpen.svg">mActionFileOpen.svg</a> 图标：</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span>
<span class="normal">7</span></pre></div></td><td class="code"><div><pre><span></span><code># 例如：在初始化GUI时
self.file_open_action = QAction(
    QgsApplication.getThemeIcon(&quot;/mActionFileOpen.svg&quot;),
    self.tr(&quot;Select a File...&quot;),
    self.iface.mainWindow()
)
self.iface.addPluginToMenu(&quot;MyPlugin&quot;, self.file_open_action)
</code></pre></div></td></tr></table></div>
<p><a href="https://qgis.org/pyqgis/master/core/QgsApplication.html#qgis.core.QgsApplication.iconPath"><code>iconPath()</code></a>是调用 QGIS 图标的另一种方法。有关调用主题图标的示例，请访问<a href="https://static.geotribu.fr/toc_nav_ignored/qgis_resources_preview_table/">QGIS嵌入式图像—速查表</a>。</p>
<h3 id="1623">16.2.3 选项对话框中的插件接口<a class="headerlink" href="#1623" title="Permanent link">⚓︎</a></h3>
<p>你可以在 <strong>设置</strong> ‣ <strong>选项</strong> 中添加一个自定义插件选项标签。这比为你的插件选项添加一个特定的主菜单条目更可取，因为它将所有的QGIS应用程序设置和插件设置保存在一个单一的地方，便于用户发现和导航。</p>
<p>下面的代码片段将为插件的设置添加一个新的空白选项卡，为你填充所有选项和你的插件特定设置做好准备。你可以将下面的类拆分成不同的文件。在这个例子中，我们在mainPlugin.py文件中添加了两个类。</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">MyPluginOptionsFactory</span><span class="p">(</span><span class="n">QgsOptionsWidgetFactory</span><span class="p">):</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">icon</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">QIcon</span><span class="p">(</span><span class="s1">&#39;icons/my_plugin_icon.svg&#39;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">createWidget</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">ConfigOptionsPage</span><span class="p">(</span><span class="n">parent</span><span class="p">)</span>


<span class="k">class</span><span class="w"> </span><span class="nc">ConfigOptionsPage</span><span class="p">(</span><span class="n">QgsOptionsPageWidget</span><span class="p">):</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">parent</span><span class="p">)</span>
        <span class="n">layout</span> <span class="o">=</span> <span class="n">QHBoxLayout</span><span class="p">()</span>
        <span class="n">layout</span><span class="o">.</span><span class="n">setContentsMargins</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setLayout</span><span class="p">(</span><span class="n">layout</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
<p>最后我们添加导入和修改<code>__init__</code>函数：</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">qgis.gui</span><span class="w"> </span><span class="kn">import</span> <span class="n">QgsOptionsWidgetFactory</span><span class="p">,</span> <span class="n">QgsOptionsPageWidget</span>


<span class="k">class</span><span class="w"> </span><span class="nc">MyPlugin</span><span class="p">:</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">iface</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;构造函数.</span>

<span class="sd">        :param iface: 将传递给该类的接口实例它提供了一个钩子，你可以通过它来操作QGIS运行时应用程序。</span>
<span class="sd">        :type iface: QgsInterface</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># 保存引用</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">iface</span> <span class="o">=</span> <span class="n">iface</span>


    <span class="k">def</span><span class="w"> </span><span class="nf">initGui</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">options_factory</span> <span class="o">=</span> <span class="n">MyPluginOptionsFactory</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">options_factory</span><span class="o">.</span><span class="n">setTitle</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tr</span><span class="p">(</span><span class="s1">&#39;My Plugin&#39;</span><span class="p">))</span>
        <span class="n">iface</span><span class="o">.</span><span class="n">registerOptionsWidgetFactory</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">options_factory</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">unload</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">iface</span><span class="o">.</span><span class="n">unregisterOptionsWidgetFactory</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">options_factory</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
<div class="admonition 提示">
<p class="admonition-title">提示</p>
<p><strong>将自定义选项卡添加到图层属性对话框</strong> </p>
<p>你可以应用类似的逻辑，使用<a href="https://qgis.org/pyqgis/master/gui/QgsMapLayerConfigWidgetFactory.html#qgis.gui.QgsMapLayerConfigWidgetFactory">QgsMapLayerConfigWidgetFactory</a>和<a href="https://qgis.org/pyqgis/master/gui/QgsMapLayerConfigWidget.html#qgis.gui.QgsMapLayerConfigWidget">QgsMapLayerConfigWidget</a>类将插件自定义选项添加到图层属性对话框中。</p>
</div>
<h3 id="1624">16.2.4 在图层树中嵌入图层的自定义小组件<a class="headerlink" href="#1624" title="Permanent link">⚓︎</a></h3>
<p>除了在图层面板中常见的图层符号元素之外，你还可以添加自己的小部件，以便快速访问一些经常与图层一起使用的操作（设置过滤、选择、样式、使用按钮小部件刷新图层、创建基于时间轴的图层或仅在标签中显示额外的图层信息等）。这些所谓的图层树嵌入式小部件通过图层的属性图例选项卡为各个图层提供。</p>
<p>以下代码片段在图例中创建一个下拉菜单，显示图层可用的图层样式，允许快速在不同的图层样式之间切换。</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">LayerStyleComboBox</span><span class="p">(</span><span class="n">QComboBox</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">layer</span><span class="p">):</span>
        <span class="n">QComboBox</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">layer</span> <span class="o">=</span> <span class="n">layer</span>
        <span class="k">for</span> <span class="n">style_name</span> <span class="ow">in</span> <span class="n">layer</span><span class="o">.</span><span class="n">styleManager</span><span class="p">()</span><span class="o">.</span><span class="n">styles</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">addItem</span><span class="p">(</span><span class="n">style_name</span><span class="p">)</span>

        <span class="n">idx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">findText</span><span class="p">(</span><span class="n">layer</span><span class="o">.</span><span class="n">styleManager</span><span class="p">()</span><span class="o">.</span><span class="n">currentStyle</span><span class="p">())</span>
        <span class="k">if</span> <span class="n">idx</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
          <span class="bp">self</span><span class="o">.</span><span class="n">setCurrentIndex</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">currentIndexChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">on_current_changed</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">on_current_changed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">layer</span><span class="o">.</span><span class="n">styleManager</span><span class="p">()</span><span class="o">.</span><span class="n">setCurrentStyle</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">itemText</span><span class="p">(</span><span class="n">index</span><span class="p">))</span>

<span class="k">class</span><span class="w"> </span><span class="nc">LayerStyleWidgetProvider</span><span class="p">(</span><span class="n">QgsLayerTreeEmbeddedWidgetProvider</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">QgsLayerTreeEmbeddedWidgetProvider</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">id</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;style&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;Layer style chooser&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">createWidget</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">layer</span><span class="p">,</span> <span class="n">widgetIndex</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">LayerStyleComboBox</span><span class="p">(</span><span class="n">layer</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">supportsLayer</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">layer</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">True</span>   <span class="c1"># any layer is fine</span>

<span class="n">provider</span> <span class="o">=</span> <span class="n">LayerStyleWidgetProvider</span><span class="p">()</span>
<span class="n">QgsGui</span><span class="o">.</span><span class="n">layerTreeEmbeddedWidgetRegistry</span><span class="p">()</span><span class="o">.</span><span class="n">addProvider</span><span class="p">(</span><span class="n">provider</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
<p>从给定图层的图例属性选项卡中，将“图层样式选择器”从“可用小部件”拖动到“已用小部件”，以在图层树中启用小部件。嵌入式小部件始终显示在其相关图层节点子项的顶部。</p>
<p>如果你想从插件中使用小部件，可以按以下方法添加它们：</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span>
<span class="normal">7</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="n">layer</span> <span class="o">=</span> <span class="n">iface</span><span class="o">.</span><span class="n">activeLayer</span><span class="p">()</span>
<span class="n">counter</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">layer</span><span class="o">.</span><span class="n">customProperty</span><span class="p">(</span><span class="s2">&quot;embeddedWidgets/count&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
<span class="n">layer</span><span class="o">.</span><span class="n">setCustomProperty</span><span class="p">(</span><span class="s2">&quot;embeddedWidgets/count&quot;</span><span class="p">,</span> <span class="n">counter</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
<span class="n">layer</span><span class="o">.</span><span class="n">setCustomProperty</span><span class="p">(</span><span class="s2">&quot;embeddedWidgets/</span><span class="si">{}</span><span class="s2">/id&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">counter</span><span class="p">),</span> <span class="s2">&quot;style&quot;</span><span class="p">)</span>
<span class="n">view</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">iface</span><span class="o">.</span><span class="n">layerTreeView</span><span class="p">()</span>
<span class="n">view</span><span class="o">.</span><span class="n">layerTreeModel</span><span class="p">()</span><span class="o">.</span><span class="n">refreshLayerLegend</span><span class="p">(</span><span class="n">view</span><span class="o">.</span><span class="n">currentLegendNode</span><span class="p">())</span>
<span class="n">view</span><span class="o">.</span><span class="n">currentNode</span><span class="p">()</span><span class="o">.</span><span class="n">setExpanded</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
<h2 id="163-ide">16.3 编写和调试插件的IDE设置<a class="headerlink" href="#163-ide" title="Permanent link">⚓︎</a></h2>
<p><strong>TODO</strong></p>
<h2 id="164">16.4 发布你的插件<a class="headerlink" href="#164" title="Permanent link">⚓︎</a></h2>
<p>一旦你的插件准备好了，并且你认为这个插件可能对某些人有帮助，不要犹豫，把它上传到<a href="https://docs.qgis.org/testing/en/docs/pyqgis_developer_cookbook/plugins/releasing.html#official-pyqgis-repository">官方Python插件仓库</a>。在该页面上，你还可以找到关于如何准备插件以与插件安装程序良好配合的打包指南。或者，如果你想建立自己的插件库，可以创建一个简单的XML文件，列出插件及其元数据。</p>
<p>请特别注意一下建议：</p>
<h3 id="1641">16.4.1 元数据和名称<a class="headerlink" href="#1641" title="Permanent link">⚓︎</a></h3>
<ul>
<li>避免使用与现有插件过于相似的名称</li>
<li>如果你的插件与现有的插件有类似的功能，请在 "关于 "一栏中解释其区别，这样用户就会知道使用哪一个，而不需要安装和测试。</li>
<li>避免在插件本身的名称中重复使用"plugin"。</li>
<li>使用元数据中的描述字段进行单行描述，使用关于字段进行更详细的说明</li>
<li>包括一个代码库、一个错误跟踪器和一个主页；这将极大地提高合作的可能性，并且可以通过现有的网络基础设施（GitHub、GitLab、Bitbucket等）非常容易地完成。</li>
<li>谨慎选择标签：避免不具参考价值的标签（如vector），最好选择已经被他人使用的标签（见插件网站）。</li>
<li>添加一个合适的图标，不要使用默认的图标；参见QGIS界面，了解要使用的风格建议</li>
</ul>
<h3 id="1642">16.4.2 代码和帮助<a class="headerlink" href="#1642" title="Permanent link">⚓︎</a></h3>
<ul>
<li>
<p>不要把生成的文件（ui_*.py, resources_rc.py, 生成的帮助文件...）和无用的东西（如.gitignore）包括在版本库中</p>
</li>
<li>
<p>将插件添加到适当的菜单中（Vector, Raster, Web, Database）。</p>
</li>
<li>
<p>在适当的时候（执行分析的插件），考虑将插件添加为Processing框架的子插件：这将允许用户批量运行它，将它集成到更复杂的工作流中，并将你从设计界面的负担中解放出来</p>
</li>
<li>
<p>至少包括最基本的文档，如果对测试和理解有用的话，还包括样本数据。</p>
</li>
</ul>
<h3 id="1643-python">16.4.3 官方python插件仓库<a class="headerlink" href="#1643-python" title="Permanent link">⚓︎</a></h3>
<p>你可以找到官方python插件仓库：<a href="https://plugins.qgis.org/">https://plugins.qgis.org/</a>。</p>
<p>为了使用官方python插件仓库，你必须从<a href="https://www.osgeo.org/community/getting-started-osgeo/osgeo_userid/">OSGEO web portal</a>获得OSGEO ID。</p>
<p>一旦你上传了你的插件，它将得到一个工作人员的批准，你会得到通知。</p>
<h4 id="16431">16.4.3.1 权限<a class="headerlink" href="#16431" title="Permanent link">⚓︎</a></h4>
<p>这些规则已经在官方插件库中实现：</p>
<ul>
<li>
<p>每个注册用户都可以添加一个新的插件</p>
</li>
<li>
<p>员工用户可以批准或不批准所有的插件版本</p>
</li>
<li>
<p>拥有特殊权限<code>plugins.can_approve</code>的用户可以自动批准他们上传的版本</p>
</li>
<li>
<p>拥有特殊权限<code>plugins.can_approve</code>的用户可以批准其他人上传的版本，只要他们在插件所有者的列表中。</p>
</li>
<li>
<p>一个特定的插件只能由员工用户和插件所有者删除和编辑。</p>
</li>
<li>
<p>如果一个没有<code>plugins.can_approve</code>权限的用户上传了一个新的版本，该插件的版本会自动取消审批。</p>
</li>
</ul>
<h4 id="16432">16.4.3.2 信任管理<a class="headerlink" href="#16432" title="Permanent link">⚓︎</a></h4>
<p>工作人员可以通过前端应用程序设置<code>plugins.can_approve</code>权限，向选定的插件创建者授予信任。</p>
<p>插件详情视图提供了直接链接，以授予对插件创建者或插件所有者的信任。</p>
<h4 id="16433">16.4.3.3 验证<a class="headerlink" href="#16433" title="Permanent link">⚓︎</a></h4>
<p>在上传插件时，插件的元数据会自动从压缩包中导入并进行验证。</p>
<p>这里有一些验证规则，当你想在官方仓库上传一个插件时，你应该注意：</p>
<ol>
<li>包含插件的主文件夹的名称必须只包含ASCII字符（A-Z和a-z）、数字和下划线（_）和减号（-），而且不能以数字开头。</li>
<li><code>metadata.txt</code>是必需的</li>
<li>元数据表中列出的所有必需的元数据都必须存在</li>
<li>元数据<code>version</code>字段必须是唯一的</li>
</ol>
<h4 id="16434">16.4.3.4 插件结构<a class="headerlink" href="#16434" title="Permanent link">⚓︎</a></h4>
<p>按照验证规则，你的插件的压缩包（.zip）必须有一个特定的结构，才能作为一个功能性插件进行验证。由于该插件将被解压在用户的plugins文件夹内，它必须在.zip文件内有自己的目录，以不干扰其他插件。必需的文件有：<code>metadata.txt</code> 和 <code>__init__.py</code>。但如果能有一个README，当然还有一个代表该插件的图标（resources.qrc），那就更好了。以下是一个plugin.zip的例子，它应该是这样的。</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span></pre></div></td><td class="code"><div><pre><span></span><code>plugin.zip
  pluginfolder/
  |-- i18n
  |   |-- translation_file_de.ts
  |-- img
  |   |-- icon.png
  |   `-- iconsource.svg
  |-- __init__.py
  |-- Makefile
  |-- metadata.txt
  |-- more_code.py
  |-- main_code.py
  |-- README
  |-- resources.qrc
  |-- resources_rc.py
  `-- ui_Qt_user_interface_file.ui
</code></pre></div></td></tr></table></div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  回到页面顶部
</button>
        
      </main>
      
        <footer class="md-footer">
  
    
      
      <nav class="md-footer__inner md-grid" aria-label="页脚" >
        
          
          <a href="../15-%E4%BB%BB%E5%8A%A1%E2%80%94%E2%80%94%E5%9C%A8%E5%90%8E%E5%8F%B0%E5%81%9A%E7%B9%81%E9%87%8D%E7%9A%84%E5%B7%A5%E4%BD%9C/" class="md-footer__link md-footer__link--prev" aria-label="上一页: 15-任务 - 在后台做繁重的工作">
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
            </div>
            <div class="md-footer__title">
              <span class="md-footer__direction">
                上一页
              </span>
              <div class="md-ellipsis">
                15-任务 - 在后台做繁重的工作
              </div>
            </div>
          </a>
        
        
          
          <a href="../17-%E7%BC%96%E5%86%99%E5%A4%84%E7%90%86%E6%8F%92%E4%BB%B6/" class="md-footer__link md-footer__link--next" aria-label="下一页: 17-编写处理插件">
            <div class="md-footer__title">
              <span class="md-footer__direction">
                下一页
              </span>
              <div class="md-ellipsis">
                17-编写处理插件
              </div>
            </div>
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11z"/></svg>
            </div>
          </a>
        
      </nav>
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "..", "features": ["navigation.tracking", "navigation.footer", "navigation.top", "search.suggest", "search.highlight", "search.share", "content.code.copy", "content.action.edit", "content.action.view", "toc.follow"], "search": "../assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "\u5df2\u590d\u5236", "clipboard.copy": "\u590d\u5236", "search.result.more.one": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.more.other": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 # \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.none": "\u6ca1\u6709\u627e\u5230\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.one": "\u627e\u5230 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.other": "# \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.placeholder": "\u952e\u5165\u4ee5\u5f00\u59cb\u641c\u7d22", "search.result.term.missing": "\u7f3a\u5c11", "select.version": "\u9009\u62e9\u5f53\u524d\u7248\u672c"}, "version": null}</script>
    
    
      <script src="../assets/javascripts/bundle.92b07e13.min.js"></script>
      
    
  </body>
</html>