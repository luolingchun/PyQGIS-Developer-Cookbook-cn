{"config":{"lang":["en"],"separator":"[\\s\\u200b\\u3000\\-\u3001\u3002\uff0c\uff0e\uff1f\uff01\uff1b]+","pipeline":["stemmer"]},"docs":[{"location":"","title":"PyQGIS\u200b\u5f00\u53d1\u8005\u200b\u624b\u518c","text":"<p>\u200b\u672c\u200b\u9879\u76ee\u200b\u662f\u200bPyQGIS\u200b\u5f00\u53d1\u8005\u200b\u624b\u518c\u200b\u7684\u200b\u4e2d\u6587\u7ffb\u8bd1\u200b\u3002</p> <p>\u200b\u5982\u679c\u200b\u60a8\u200b\u5728\u200b\u9605\u8bfb\u200b\u8fc7\u7a0b\u200b\u4e2d\u200b\u53d1\u73b0\u200b\u4efb\u4f55\u200b\u95ee\u9898\u200b\uff0c\u200b\u6b22\u8fce\u200b\u6307\u6b63\u200b\u3002</p>"},{"location":"1-%E5%BC%95%E8%A8%80/","title":"1 \u200b\u5f15\u8a00","text":"<p>\u200b\u672c\u200b\u6587\u6863\u200b\u65e2\u200b\u53ef\u200b\u4f5c\u4e3a\u200b\u6559\u7a0b\u200b\uff0c\u200b\u4e5f\u200b\u53ef\u200b\u4f5c\u4e3a\u200b\u53c2\u8003\u200b\u6307\u5357\u200b\u3002\u200b\u867d\u7136\u200b\u6ca1\u6709\u200b\u5217\u4e3e\u200b\u6240\u6709\u200b\u53ef\u80fd\u200b\u7684\u200b\u6848\u4f8b\u200b\uff0c\u200b\u4f46\u662f\u200b\u5bf9\u200b\u4e3b\u8981\u200b\u529f\u80fd\u200b\u6709\u200b\u4e00\u4e2a\u200b\u5f88\u200b\u597d\u200b\u7684\u200b\u6982\u8ff0\u200b\u3002</p> <p>\u200b\u6839\u636e\u200bGNU\u200b\u514d\u8d39\u200b\u6587\u6863\u200b\u8bb8\u53ef\u8bc1\u200b\u3001\u200b\u7248\u672c\u200b1.3\u200b\u6216\u200b\u81ea\u7531\u8f6f\u4ef6\u200b\u57fa\u91d1\u4f1a\u200b\u53d1\u5e03\u200b\u7684\u200b\u4efb\u4f55\u200b\u540e\u7eed\u200b\u7248\u672c\u200b\u7684\u200b\u6761\u6b3e\u200b\uff0c\u200b\u5141\u8bb8\u200b\u590d\u5236\u200b\u3001\u200b\u5206\u53d1\u200b\u548c\u200b/\u200b\u6216\u200b\u4fee\u6539\u200b\u8be5\u200b\u6587\u6863\u200b\uff1b\u200b\u6ca1\u6709\u200b\u56fa\u5b9a\u200b\u7ae0\u8282\u200b\uff0c\u200b\u6ca1\u6709\u200b\u5c01\u9762\u200b\u6587\u672c\u200b\uff0c\u200b\u4e5f\u200b\u6ca1\u6709\u200b\u5c01\u5e95\u200b\u6587\u672c\u200b\u3002</p> <p>GNU\u200b\u514d\u8d39\u200b\u6587\u6863\u200b\u8bb8\u53ef\u8bc1\u200b\u4e00\u8282\u200b\u4e2d\u200b\u5305\u542b\u200b\u4e86\u200b\u8be5\u200b\u8bb8\u53ef\u8bc1\u200b\u7684\u200b\u526f\u672c\u200b\u3002</p> <p>\u200b\u672c\u200b\u8bb8\u53ef\u8bc1\u200b\u4e5f\u200b\u9002\u7528\u200b\u4e8e\u672c\u200b\u6587\u6863\u200b\u4e2d\u200b\u7684\u200b\u6240\u6709\u200b\u4ee3\u7801\u6bb5\u200b\u3002</p> <p>\u200b\u5bf9\u4e8e\u200bPython\u200b\u7684\u200b\u652f\u6301\u200b\u6700\u521d\u200b\u662f\u200b\u5728\u200bQGIS 0.9\u200b\u4e2d\u200b\u5f15\u5165\u200b\u7684\u200b\u3002 \u200b\u76ee\u524d\u200b\uff0c\u200b\u5728\u200bQGIS\u200b\u684c\u9762\u7248\u200b\u4e2d\u6709\u200b\u51e0\u79cd\u200b\u65b9\u6cd5\u200b\u53ef\u4ee5\u200b\u4f7f\u7528\u200bPython\uff0c\u200b\u5982\u4e0b\u200b\uff1a</p> <ul> <li>\u200b\u5728\u200bQGIS\u200b\u7684\u200bPython\u200b\u63a7\u5236\u53f0\u200b\u4e2d\u200b</li> <li>\u200b\u521b\u5efa\u200b\u5e76\u200b\u4f7f\u7528\u200b\u63d2\u4ef6\u200b</li> <li>QGIS\u200b\u542f\u52a8\u200b\u65f6\u200b\u81ea\u52a8\u200b\u8fd0\u884c\u200bPython\u200b\u4ee3\u7801\u200b</li> <li>\u200b\u521b\u5efa\u200b\u5904\u7406\u200b\u7b97\u6cd5\u200b</li> <li>\u200b\u5728\u200bQGIS\u200b\u4e2d\u4e3a\u200b\u8868\u8fbe\u5f0f\u200b\u521b\u5efa\u200b\u51fd\u6570\u200b</li> <li>\u200b\u57fa\u4e8e\u200bQGIS API\u200b\u521b\u5efa\u200b\u81ea\u5b9a\u4e49\u200b\u5e94\u7528\u7a0b\u5e8f\u200b</li> </ul> <p>Python\u200b\u652f\u6301\u200b\u5728\u200bQGIS 0.9\u200b\u4e2d\u200b\u9996\u6b21\u200b\u5f15\u5165\u200b\u3002\u200b\u8fd9\u91cc\u200b\u6709\u200b\u51e0\u79cd\u200b\u65b9\u6cd5\u200b\u53ef\u4ee5\u200b\u5728\u200bQGIS\u200b\u684c\u9762\u200b\u8f6f\u4ef6\u200b\u4e2d\u200b\u4f7f\u7528\u200bPython\uff08\u200b\u6db5\u76d6\u200b\u4e00\u4e0b\u200b\u90e8\u5206\u200b\uff09\uff1a</p> <ul> <li>\u200b\u5728\u200bQGIS\u200b\u4e2d\u200b\u7684\u200bPython\u200b\u63a7\u5236\u53f0\u200b\u4e2d\u200b\u4f7f\u7528\u200b\u547d\u4ee4\u200b</li> <li>\u200b\u521b\u5efa\u200b\u5e76\u200b\u4f7f\u7528\u200b\u63d2\u4ef6\u200b</li> <li>\u200b\u5f53\u200bQGIS\u200b\u542f\u52a8\u200b\u65f6\u200b\u81ea\u52a8\u200b\u8fd0\u884c\u200bPython\u200b\u4ee3\u7801\u200b</li> <li>\u200b\u521b\u5efa\u200b\u5904\u7406\u200b\u7b97\u6cd5\u200b</li> <li>\u200b\u5728\u200bQGIS\u200b\u4e2d\u200b\u521b\u5efa\u200b\u51fd\u6570\u200b\u8868\u8fbe\u5f0f\u200b</li> <li>\u200b\u57fa\u4e8e\u200bQGIS API\u200b\u521b\u5efa\u200b\u81ea\u5b9a\u4e49\u200b\u5e94\u7528\u200b</li> </ul> <p>Python\u200b\u7ed1\u5b9a\u200b\u4e5f\u200b\u53ef\u200b\u7528\u4e8e\u200bQGIS\u200b\u670d\u52a1\u200b\uff0c\u200b\u5305\u62ec\u200bPython\u200b\u63d2\u4ef6\u200b\uff08\u200b\u8bf7\u53c2\u9605\u200b20-QGIS\u200b\u670d\u52a1\u5668\u200b\u548c\u200bPython\uff09\u200b\u548c\u200bPython\u200b\u7ed1\u5b9a\u200b\uff0c\u200b\u53ef\u200b\u7528\u4e8e\u200b\u5c06\u200bQGIS\u200b\u670d\u52a1\u200b\u5d4c\u5165\u200b\u5230\u200bPython\u200b\u5e94\u7528\u7a0b\u5e8f\u200b\u4e2d\u200b\u3002 \u200b\u8fd9\u91cc\u200b\u6709\u200b\u4e00\u4e2a\u200b\u5b8c\u6574\u200b\u7684\u200bQGIS C++ API\u200b\u53c2\u8003\u200b\u2014\u2014\u200b\u7528\u4e8e\u200b\u8bb0\u5f55\u200bQGIS\u200b\u5e93\u4e2d\u200b\u7684\u200b\u7c7b\u200b\u3002 Pythonic QGIS API\uff08pyqgis\uff09\u200b\u51e0\u4e4e\u200b\u4e0e\u200bC ++ API\u200b\u76f8\u540c\u200b\u3002 \u200b\u5b66\u4e60\u200b\u6267\u884c\u200b\u5e38\u89c1\u200b\u4efb\u52a1\u200b\u7684\u200b\u53e6\u200b\u4e00\u4e2a\u200b\u597d\u200b\u529e\u6cd5\u200b\u662f\u4ece\u200b\u63d2\u4ef6\u200b\u4ed3\u5e93\u200b\u4e0b\u8f7d\u200b\u73b0\u6709\u200b\u63d2\u4ef6\u200b\u5e76\u200b\u5b66\u4e60\u200b\u5b83\u4eec\u200b\u7684\u200b\u4ee3\u7801\u200b\u3002</p>"},{"location":"1-%E5%BC%95%E8%A8%80/#11-python","title":"1.1 \u200b\u5728\u200bPython\u200b\u63a7\u5236\u53f0\u200b\u4e2d\u200b\u7f16\u5199\u200b\u811a\u672c","text":"<p>QGIS\u200b\u4e3a\u200b\u811a\u672c\u200b\u7f16\u5199\u200b\u63d0\u4f9b\u200b\u4e86\u200b\u4e00\u4e2a\u200b\u96c6\u6210\u200b\u7684\u200bpython\u200b\u63a7\u5236\u53f0\u200b\u3002\u200b\u53ef\u4ee5\u200b\u4ece\u200b\u63d2\u4ef6\u200b\u2192python\u200b\u63a7\u5236\u53f0\u200b\u83dc\u5355\u200b\u4e2d\u200b\u6253\u5f00\u200b\uff1a</p> <p></p> <p>\u200b\u4e0a\u9762\u200b\u7684\u200b\u622a\u56fe\u200b\u8bf4\u660e\u200b\u4e86\u200b\u5982\u4f55\u200b\u83b7\u53d6\u200b\u56fe\u5c42\u200b\u5217\u8868\u200b\u4e2d\u200b\u5f53\u524d\u200b\u9009\u5b9a\u200b\u7684\u200b\u56fe\u5c42\u200b\uff0c\u200b\u5e76\u200b\u663e\u793a\u200b\u5176\u200bID\uff0c\u200b\u5982\u679c\u200b\u662f\u200b\u77e2\u91cf\u56fe\u200b\u5c42\u200b\uff0c\u200b\u8fd8\u200b\u53ef\u4ee5\u200b\u663e\u793a\u200b\u8981\u7d20\u200b\u4e2a\u6570\u200b\u3002\u200b\u5bf9\u4e8e\u200b\u4e0e\u200bQGIS\u200b\u4ea4\u4e92\u200b\u73af\u5883\u200b\uff0c\u200b\u6709\u200b\u4e00\u4e2a\u200b<code>iface</code>\u200b\u53d8\u91cf\u200b\uff0c\u200b\u5b83\u200b\u662f\u200bQgisInterface\u200b\u7684\u200b\u4e00\u4e2a\u200b\u5b9e\u4f8b\u200b\u3002\u200b\u6b64\u200b\u63a5\u53e3\u200b\u5141\u8bb8\u200b\u8bbf\u95ee\u200b\u5730\u56fe\u200b\u753b\u5e03\u200b\u3001\u200b\u83dc\u5355\u200b\u3001\u200b\u5de5\u5177\u680f\u200b\u548c\u200bQGIS\u200b\u5e94\u7528\u7a0b\u5e8f\u200b\u7684\u200b\u5176\u4ed6\u200b\u90e8\u5206\u200b\u3002</p> <p>\u200b\u4e3a\u4e86\u200b\u65b9\u4fbf\u200b\u7528\u6237\u200b\uff0c\u200b\u5728\u200b\u542f\u52a8\u200b\u63a7\u5236\u53f0\u200b\u65f6\u200b\u5c06\u200b\u4f1a\u200b\u6267\u884c\u200b\u4ee5\u4e0b\u200b\u8bed\u53e5\u200b\uff08\u200b\u5c06\u6765\u200b\u53ef\u4ee5\u200b\u8bbe\u7f6e\u200b\u66f4\u200b\u591a\u200b\u7684\u200b\u521d\u59cb\u200b\u547d\u4ee4\u200b\uff09</p> <pre><code>from qgis.core import *\nimport qgis.utils\n</code></pre> <p>\u200b\u5bf9\u4e8e\u200b\u7ecf\u5e38\u200b\u4f7f\u7528\u200b\u63a7\u5236\u53f0\u200b\u7684\u200b\u7528\u6237\u200b\uff0c\u200b\u8bbe\u7f6e\u200b\u6253\u5f00\u200b\u63a7\u5236\u53f0\u200b\u7684\u200b\u5feb\u6377\u952e\u200b\u53ef\u80fd\u200b\u5f88\u200b\u6709\u7528\u200b\uff08\u200b\u5728\u200b\u8bbe\u7f6e\u200b\u2192\u200b\u952e\u76d8\u200b\u5feb\u6377\u952e\u200b\u4e2d\u200b...\uff09</p>"},{"location":"1-%E5%BC%95%E8%A8%80/#12-python","title":"1.2 Python\u200b\u63d2\u4ef6","text":"<p>\u200b\u53ef\u4ee5\u200b\u4f7f\u7528\u200b\u63d2\u4ef6\u200b\u6765\u200b\u6269\u5c55\u200bQGIS\u200b\u7684\u200b\u529f\u80fd\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u4f7f\u7528\u200bPython\u200b\u7f16\u5199\u200b\u63d2\u4ef6\u200b\u3002\u200b\u4e0e\u200bC ++\u200b\u63d2\u4ef6\u200b\u76f8\u6bd4\u200b\uff0c\u200b\u4e3b\u8981\u200b\u4f18\u70b9\u200b\u662f\u200b\u5206\u53d1\u200b\u7b80\u5355\u200b\uff08\u200b\u4e0d\u200b\u5bf9\u200b\u6bcf\u4e2a\u200b\u5e73\u53f0\u200b\u8fdb\u884c\u200b\u7f16\u8bd1\u200b\uff09\u3001\u200b\u66f4\u200b\u5bb9\u6613\u200b\u7684\u200b\u5f00\u53d1\u200b\u3002</p> <p>\u200b\u81ea\u4ece\u200b\u5f15\u5165\u200b\u5bf9\u200bPython\u200b\u7684\u200b\u652f\u6301\u200b\u4ee5\u6765\u200b\uff0c\u200b\u5df2\u7ecf\u200b\u7f16\u5199\u200b\u4e86\u200b\u8bb8\u591a\u200b\u6db5\u76d6\u200b\u5404\u79cd\u200b\u529f\u80fd\u200b\u7684\u200b\u63d2\u4ef6\u200b\u3002\u200b\u63d2\u4ef6\u200b\u5b89\u88c5\u7a0b\u5e8f\u200b\u5141\u8bb8\u200b\u7528\u6237\u200b\u5f88\u200b\u5bb9\u6613\u200b\u83b7\u53d6\u200b\u3001\u200b\u5347\u7ea7\u200b\u548c\u200b\u5220\u9664\u200bPython\u200b\u63d2\u4ef6\u200b\u3002\u200b\u6709\u5173\u200b\u63d2\u4ef6\u200b\u548c\u200b\u63d2\u4ef6\u200b\u5f00\u53d1\u200b\u7684\u200b\u66f4\u200b\u591a\u200b\u4fe1\u606f\u200b\uff0c\u200b\u8bf7\u53c2\u9605\u200bPython\u200b\u63d2\u4ef6\u200b\u9875\u9762\u200b\u3002</p> <p>\u200b\u4f7f\u7528\u200bPython\u200b\u521b\u5efa\u200b\u63d2\u4ef6\u200b\u5f88\u200b\u7b80\u5355\u200b\uff0c\u200b\u8be6\u7ec6\u200b\u8bf4\u660e\u200b\u8bf7\u53c2\u9605\u200b16-\u200b\u5f00\u53d1\u200bPython\u200b\u63d2\u4ef6\u200b\u3002</p> <p>\u200b\u63d0\u793a\u200b</p> <p>Python\u200b\u63d2\u4ef6\u200b\u4e5f\u200b\u53ef\u200b\u7528\u4e8e\u200bQGIS\u200b\u670d\u52a1\u200b\uff0c\u200b\u66f4\u200b\u591a\u200b\u4fe1\u606f\u200b\uff0c\u200b\u8bf7\u53c2\u9605\u200b20-QGIS\u200b\u670d\u52a1\u5668\u200b\u548c\u200bPython\u3002</p>"},{"location":"1-%E5%BC%95%E8%A8%80/#121","title":"1.2.1 \u200b\u5904\u7406\u200b\u63d2\u4ef6","text":"<p>\u200b\u5904\u7406\u200b\u63d2\u4ef6\u200b\u53ef\u200b\u88ab\u200b\u7528\u4e8e\u200b\u5904\u7406\u200b\u6570\u636e\u200b\u3002\u200b\u5b83\u4eec\u200b\u6bd4\u200bPython\u200b\u63d2\u4ef6\u200b\u66f4\u200b\u5bb9\u6613\u200b\u5f00\u53d1\u200b\u3001\u200b\u66f4\u200b\u5177\u4f53\u200b\u3001\u200b\u66f4\u200b\u8f7b\u91cf\u200b\u300217-\u200b\u7f16\u5199\u200b\u5904\u7406\u200b\u63d2\u4ef6\u200b\u9610\u8ff0\u200b\u4e86\u200b\u4ec0\u4e48\u200b\u65f6\u5019\u200b\u8be5\u200b\u4f7f\u7528\u200b\u5904\u7406\u200b\u7b97\u6cd5\u200b\uff0c\u200b\u5e76\u4e14\u200b\u600e\u4e48\u200b\u5f00\u53d1\u200b\u5b83\u4eec\u200b\u3002</p>"},{"location":"1-%E5%BC%95%E8%A8%80/#13-qgispython","title":"1.3 QGIS\u200b\u542f\u52a8\u200b\u65f6\u200b\u8fd0\u884c\u200bPython\u200b\u4ee3\u7801","text":"<p>\u200b\u6bcf\u6b21\u200bQGIS\u200b\u542f\u52a8\u200b\u65f6\u200b\uff0c\u200b\u90fd\u200b\u6709\u200b\u4e0d\u540c\u200b\u7684\u200b\u65b9\u6cd5\u200b\u6765\u200b\u8fd0\u884c\u200bPython\u200b\u4ee3\u7801\u200b\u3002</p> <ol> <li>\u200b\u521b\u5efa\u200bstartup.py\u200b\u811a\u672c\u200b</li> <li>\u200b\u5c06\u200b<code>PYQGIS_STARTUP</code>\u200b\u73af\u5883\u53d8\u91cf\u200b\u8bbe\u7f6e\u200b\u4e3a\u200b\u73b0\u6709\u200bPython\u200b\u6587\u4ef6\u200b</li> <li>\u200b\u4f7f\u7528\u200b <code>--code init_qgis.py</code> \u200b\u53c2\u6570\u200b\u6307\u5b9a\u200b\u542f\u52a8\u200b\u811a\u672c\u200b</li> </ol>"},{"location":"1-%E5%BC%95%E8%A8%80/#131-startuppy","title":"1.3.1 startup.py\u200b\u6587\u4ef6","text":"<p>\u200b\u6bcf\u6b21\u200bQGIS\u200b\u542f\u52a8\u200b\u65f6\u200b\uff0c\u200b\u90fd\u200b\u4f1a\u200b\u5728\u200b\u7528\u6237\u200b\u7684\u200bPython\u200b\u4e3b\u76ee\u5f55\u200b\u548c\u200b\u7cfb\u7edf\u200b\u8def\u5f84\u200b\u5217\u8868\u200b\u4e2d\u200b\u641c\u7d22\u200b\u540d\u4e3a\u200b<code>startup.py</code>\u200b\u7684\u200b\u6587\u4ef6\u200b\u3002 \u200b\u5982\u679c\u200b\u8be5\u200b\u6587\u4ef6\u200b\u5b58\u5728\u200b\uff0c\u200b\u5219\u200b\u7531\u200b\u5d4c\u5165\u5f0f\u200bPython\u200b\u89e3\u91ca\u5668\u200b\u6267\u884c\u200b\u3002</p> <p>\u200b\u7528\u6237\u200b\u4e3b\u76ee\u5f55\u200b\u4e2d\u200b\u7684\u200b\u8def\u5f84\u200b\u901a\u5e38\u200b\u4f4d\u4e8e\u200b\uff1a</p> <ul> <li>Linux\uff1a <code>.local/share/QGIS/QGIS3</code></li> <li>Windows\uff1a <code>AppData\\Roaming\\QGIS\\QGIS3</code></li> <li>macOS\uff1a <code>Library/Application Support/QGIS/QGIS3</code></li> </ul> <p>\u200b\u9ed8\u8ba4\u200b\u7cfb\u7edf\u200b\u8def\u5f84\u200b\u53d6\u51b3\u4e8e\u200b\u64cd\u4f5c\u7cfb\u7edf\u200b\u3002\u200b\u8981\u200b\u67e5\u627e\u200b\u9002\u5408\u200b\u60a8\u200b\u7684\u200b\u8def\u5f84\u200b\uff0c\u200b\u8bf7\u200b\u6253\u5f00\u200b Python \u200b\u63a7\u5236\u53f0\u200b\u5e76\u200b\u8fd0\u884c\u200b <code>QStandardPaths.standardLocations\uff08QStandardPaths.AppDataLocation\uff09</code>\u200b\u4ee5\u200b\u67e5\u770b\u200b\u9ed8\u8ba4\u200b\u76ee\u5f55\u200b\u5217\u8868\u200b\u3002</p> <p><code>startup.py</code>\u200b\u811a\u672c\u200b\u5728\u200bQGIS\u200b\u4e2d\u200b\u521d\u59cb\u5316\u200bpython\u200b\u65f6\u200b\u7acb\u5373\u200b\u6267\u884c\u200b\uff0c\u200b\u5728\u200b\u5e94\u7528\u7a0b\u5e8f\u200b\u542f\u52a8\u200b\u7684\u200b\u65e9\u671f\u200b\u3002</p>"},{"location":"1-%E5%BC%95%E8%A8%80/#132-pyqgis_startup","title":"1.3.2 PYQGIS_STARTUP\u200b\u73af\u5883\u53d8\u91cf","text":"<p>\u200b\u4f60\u200b\u53ef\u4ee5\u200b\u5728\u200bQGIS\u200b\u521d\u59cb\u5316\u200b\u5b8c\u6210\u200b\u4e4b\u524d\u200b\u5c06\u200b<code>PYQGIS_STARTUP</code>\u200b\u73af\u5883\u53d8\u91cf\u200b\u8bbe\u7f6e\u200b\u4e3a\u200b\u73b0\u6709\u200bPython\u200b\u6587\u4ef6\u200b\u7684\u200b\u8def\u5f84\u200b\u6765\u200b\u8fd0\u884c\u200bPython\u200b\u4ee3\u7801\u200b\u3002</p> <p>\u200b\u6b64\u200b\u4ee3\u7801\u200b\u5c06\u200b\u5728\u200bQGIS\u200b\u521d\u59cb\u5316\u200b\u5b8c\u6210\u200b\u4e4b\u524d\u200b\u8fd0\u884c\u200b\u3002\u200b\u6b64\u200b\u65b9\u6cd5\u200b\u5bf9\u4e8e\u200b\u6e05\u7406\u200bsys.path\u200b\u975e\u5e38\u200b\u6709\u7528\u200b\u2014\u2014\u200b\u53ef\u80fd\u200b\u5b58\u5728\u200b\u4e0d\u200b\u9700\u8981\u200b\u7684\u200b\u8def\u5f84\u200b\uff0c\u200b\u6216\u200b\u7528\u4e8e\u200b\u9694\u79bb\u200b/\u200b\u52a0\u8f7d\u200b\u521d\u59cb\u200b\u73af\u5883\u200b\u2014\u2014\u200b\u65e0\u9700\u200b\u865a\u62df\u73af\u5883\u200b\uff0c\u200b\u4f8b\u5982\u200b\u5728\u200bMac\u200b\u4e0a\u200b\u4f7f\u7528\u200bhomebrew\u200b\u6216\u200bMacPorts\u3002</p>"},{"location":"1-%E5%BC%95%E8%A8%80/#133-code","title":"1.3.3 <code>--code</code>\u200b\u53c2\u6570","text":"<p>\u200b\u4f60\u200b\u53ef\u4ee5\u200b\u63d0\u4f9b\u200b\u81ea\u5b9a\u4e49\u200b\u4ee3\u7801\u200b\u4f5c\u4e3a\u200b QGIS \u200b\u7684\u200b\u542f\u52a8\u200b\u53c2\u6570\u200b\u6267\u884c\u200b\u3002\u200b\u4e3a\u6b64\u200b\uff0c\u200b\u8bf7\u200b\u521b\u5efa\u200b\u4e00\u4e2a\u200b python \u200b\u6587\u4ef6\u200b\uff0c\u200b\u4f8b\u5982\u200b <code>qgis_init.py</code>\uff0c\u200b\u4f7f\u7528\u200b <code>qgis --code qgis_init.py</code>\u200b\u4ece\u200b\u547d\u4ee4\u884c\u200b\u6267\u884c\u200b\u548c\u200b\u542f\u52a8\u200b QGIS\u3002</p> <p>\u200b\u901a\u8fc7\u200b <code>--code</code> \u200b\u63d0\u4f9b\u200b\u7684\u200b\u4ee3\u7801\u200b\u5728\u200b QGIS \u200b\u521d\u59cb\u5316\u200b\u9636\u6bb5\u200b\u7684\u200b\u540e\u671f\u200b\uff0c\u200b\u5728\u200b\u52a0\u8f7d\u200b\u5e94\u7528\u7a0b\u5e8f\u200b\u7ec4\u4ef6\u200b\u4e4b\u540e\u200b\u6267\u884c\u200b\u3002</p>"},{"location":"1-%E5%BC%95%E8%A8%80/#134-python","title":"1.3.4 Python \u200b\u7684\u200b\u5176\u4ed6\u200b\u53c2\u6570","text":"<p>\u200b\u8981\u200b\u4e3a\u200b <code>--code</code> \u200b\u811a\u672c\u200b\u6216\u200b\u6267\u884c\u200b\u7684\u200b\u5176\u4ed6\u200b python \u200b\u4ee3\u7801\u200b\u63d0\u4f9b\u200b\u5176\u4ed6\u200b\u53c2\u6570\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u4f7f\u7528\u200b <code>--py-args</code> \u200b\u53c2\u6570\u200b\u3002\u200b\u5728\u200b <code>--py-args</code> \u200b\u4e4b\u540e\u200b\u548c\u200b <code>-- arg</code>\uff08\u200b\u5982\u679c\u200b\u5b58\u5728\u200b\uff09\u200b\u4e4b\u524d\u200b\u7684\u200b\u4efb\u4f55\u200b\u53c2\u6570\u200b\u90fd\u200b\u5c06\u200b\u4f20\u9012\u200b\u7ed9\u200b Python\uff0c\u200b\u4f46\u200b\u88ab\u200b QGIS \u200b\u5e94\u7528\u7a0b\u5e8f\u200b\u672c\u8eab\u200b\u5ffd\u7565\u200b\u3002</p> <p>\u200b\u5728\u200b\u4e0b\u9762\u200b\u7684\u200b\u4f8b\u5b50\u200b\u4e2d\u200b\uff0c<code>myfile.tif</code> \u200b\u5c06\u200b\u901a\u8fc7\u200b Python \u200b\u4e2d\u200b\u7684\u200b <code>sys.argv</code> \u200b\u63d0\u4f9b\u200b\uff0c\u200b\u4f46\u200b\u4e0d\u4f1a\u200b\u7531\u200b QGIS \u200b\u52a0\u8f7d\u200b\u3002\u200b\u800c\u200b<code>otherfile.tif</code>\u200b\u5c06\u200b\u7531\u200bQGIS\u200b\u52a0\u8f7d\u200b\uff0c\u200b\u4f46\u200b\u4e0d\u200b\u5b58\u5728\u200b\u4e8e\u200b<code>sys.argv</code>\u200b\u4e2d\u200b\u3002</p> <pre><code>qgis --code qgis_init.py --py-args myfile.tif -- otherfile.tif\n</code></pre> <p>\u200b\u5982\u679c\u200b\u4f60\u200b\u60f3\u200b\u4ece\u200bPython\u200b\u4e2d\u200b\u8bbf\u95ee\u200b\u6bcf\u4e2a\u200b\u547d\u4ee4\u884c\u200b\u53c2\u6570\u200b\uff0c\u200b\u4f60\u200b\u53ef\u4ee5\u200b\u4f7f\u7528\u200b<code>QCoreApplication.arguments()</code></p> <pre><code>QgsApplication.instance().arguments()\n</code></pre>"},{"location":"1-%E5%BC%95%E8%A8%80/#14-python","title":"1.4 Python\u200b\u5e94\u7528\u7a0b\u5e8f","text":"<p>\u200b\u4e3a\u200b\u81ea\u52a8\u5316\u200b\u6d41\u7a0b\u200b\u521b\u5efa\u200b\u811a\u672c\u200b\u901a\u5e38\u200b\u5f88\u200b\u65b9\u4fbf\u200b\u3002\u200b\u4f7f\u7528\u200bPyQGIS\uff0c\u200b\u8fd9\u662f\u200b\u5b8c\u5168\u200b\u53ef\u80fd\u200b\u7684\u200b\u2014\u2014\u200b\u5bfc\u5165\u200b<code>qgis.core</code>\u200b\u6a21\u5757\u200b\uff0c\u200b\u521d\u59cb\u5316\u200b\u5b83\u200b\uff0c\u200b\u4f60\u200b\u5c31\u200b\u53ef\u4ee5\u200b\u8fdb\u884c\u200b\u5904\u7406\u200b\u4e86\u200b\u3002</p> <p>\u200b\u6216\u8005\u200b\u4f60\u200b\u53ef\u80fd\u200b\u60f3\u8981\u200b\u521b\u5efa\u200b\u4e00\u4e2a\u200b\u4f7f\u7528\u200bGIS\u200b\u529f\u80fd\u200b\u7684\u200b\u4ea4\u4e92\u5f0f\u200b\u5e94\u7528\u7a0b\u5e8f\u200b\u2014\u2014\u200b\u6267\u884c\u200b\u6d4b\u91cf\u200b\u3001\u200b\u5c06\u200b\u5730\u56fe\u200b\u5bfc\u51fa\u200b\u4e3a\u200bPDF\u200b\u6216\u200b\u4efb\u4f55\u200b\u5176\u4ed6\u200b\u529f\u80fd\u200b\u3002<code>qgis.gui</code>\u200b\u6a21\u5757\u200b\u63d0\u4f9b\u200b\u4e86\u200b\u5404\u79cd\u200bGUI\u200b\u90e8\u4ef6\u200b\uff0c\u200b\u6700\u200b\u503c\u5f97\u6ce8\u610f\u200b\u7684\u200b\u662f\u200b\u53ef\u4ee5\u200b\u5408\u5e76\u200b\u5230\u200b\u5e94\u7528\u7a0b\u5e8f\u200b\u4e2d\u200b\u7684\u200b\u5730\u56fe\u200b\u753b\u5e03\u200b\u63a7\u4ef6\u200b\u2014\u2014\u200b\u652f\u6301\u200b\u7f29\u653e\u200b\uff0c\u200b\u5e73\u79fb\u200b\u548c\u200b\u4efb\u4f55\u200b\u5176\u4ed6\u200b\u81ea\u5b9a\u4e49\u200b\u5730\u56fe\u200b\u5de5\u5177\u200b\u3002</p> <p>\u200b\u5fc5\u987b\u200b\u914d\u7f6e\u200bPyQGIS\u200b\u81ea\u5b9a\u4e49\u200b\u5e94\u7528\u7a0b\u5e8f\u200b\u6216\u200b\u72ec\u7acb\u200b\u811a\u672c\u200b\u4ee5\u200b\u5b9a\u4f4d\u200bQGIS\u200b\u8d44\u6e90\u200b\uff0c\u200b\u4f8b\u5982\u200b\u6295\u5f71\u200b\u4fe1\u606f\u200b\uff0c\u200b\u7528\u4e8e\u200b\u8bfb\u53d6\u200b\u77e2\u91cf\u200b\u548c\u200b\u6805\u683c\u200b\u56fe\u5c42\u200b\u7684\u200b\u6570\u636e\u200b\u63d0\u4f9b\u8005\u200b\u7b49\u200b\u3002QGIS\u200b\u8d44\u6e90\u200b\u901a\u8fc7\u200b\u5728\u200b\u5e94\u7528\u7a0b\u5e8f\u200b\u6216\u200b\u811a\u672c\u200b\u7684\u200b\u5f00\u5934\u200b\u6dfb\u52a0\u200b\u51e0\u884c\u200b\uff08\u200b\u4ee3\u7801\u200b\uff09\u200b\u6765\u200b\u521d\u59cb\u5316\u200b\u3002\u200b\u81ea\u5b9a\u4e49\u200b\u5e94\u7528\u7a0b\u5e8f\u200b\u548c\u200b\u72ec\u7acb\u200b\u811a\u672c\u200b\u521d\u59cb\u5316\u200bQGIS\u200b\u7684\u200b\u4ee3\u7801\u200b\u7c7b\u4f3c\u200b\u3002\u200b\u4ee5\u4e0b\u200b\u63d0\u4f9b\u200b\u5404\u81ea\u200b\u7684\u200b\u5b9e\u4f8b\u200b\u3002</p> <p>\u200b\u63d0\u793a\u200b</p> <p>\u200b\u5343\u4e07\u200b\u4e0d\u80fd\u200b\u4f7f\u7528\u200b<code>qgis.py</code>\u200b\u4f5c\u4e3a\u200b\u4f60\u200b\u7684\u200b\u6d4b\u8bd5\u200b\u811a\u672c\u200b\u7684\u200b\u540d\u79f0\u200b\uff0c\u200b\u5426\u5219\u200bPython\u200b\u5c06\u200b\u65e0\u6cd5\u200b\u5bfc\u5165\u200b\u7ed1\u5b9a\u200b\u3002</p>"},{"location":"1-%E5%BC%95%E8%A8%80/#141-pyqgis","title":"1.4.1 \u200b\u5728\u200b\u72ec\u7acb\u200b\u811a\u672c\u200b\u4e2d\u200b\u4f7f\u7528\u200bPyQGIS","text":"<p>\u200b\u542f\u52a8\u200b\u72ec\u7acb\u200b\u811a\u672c\u200b\uff0c\u200b\u5728\u200b\u811a\u672c\u200b\u5f00\u5934\u200b\u521d\u59cb\u5316\u200bQGIS\u200b\u8d44\u6e90\u200b\uff0c\u200b\u7c7b\u4f3c\u200b\u4e8e\u200b\u4ee5\u4e0b\u200b\u4ee3\u7801\u200b\uff1a</p> <pre><code>from qgis.core import *\n# \u200b\u63d0\u4f9b\u200bqgis\u200b\u5b89\u88c5\u200b\u4f4d\u7f6e\u200b\u7684\u200b\u8def\u5f84\u200b(windows\u200b\u9ed8\u8ba4\u200b\uff1aC:\\Program Files\\QGIS 3.x\\apps\\qgis-ltr)\nQgsApplication.setPrefixPath(\"/path/to/qgis/installation\", True)\n# \u200b\u521b\u5efa\u200b\u5bf9\u200bQgsApplication\u200b\u7684\u200b\u5f15\u7528\u200b\uff0c\u200b\u7b2c\u4e8c\u4e2a\u200b\u53c2\u6570\u8bbe\u7f6e\u200b\u4e3a\u200bFalse\u200b\u5c06\u200b\u7981\u7528\u200bGUI\nqgs = QgsApplication([], False)\n# \u200b\u52a0\u8f7d\u200b\u63d0\u4f9b\u8005\u200b\nqgs.initQgis()\n# \u200b\u5728\u200b\u8fd9\u91cc\u200b\u7f16\u5199\u200b\u4ee3\u7801\u200b\uff0c\u200b\u52a0\u8f7d\u200b\u4e00\u4e9b\u200b\u56fe\u5c42\u200b\uff0c\u200b\u4f7f\u7528\u200b\u5904\u7406\u200b\u7b97\u6cd5\u200b\u7b49\u200b\n# \u200b\u811a\u672c\u200b\u5b8c\u6210\u200b\u540e\u200b\uff0c\u200b\u8c03\u7528\u200bexitQgis\uff08\uff09\u200b\u4ece\u200b\u5185\u5b58\u200b\u4e2d\u200b\u5220\u9664\u200b\u63d0\u4f9b\u8005\u200b\u548c\u200b\u56fe\u5c42\u200b\u6ce8\u518c\u200b\nqgs.exitQgis()\n</code></pre> <p>\u200b\u6211\u4eec\u200b\u9996\u5148\u200b\u5bfc\u5165\u200b<code>qgis.core</code>\u200b\u6a21\u5757\u200b\uff0c\u200b\u7136\u540e\u200b\u914d\u7f6e\u200b\u524d\u7f00\u200b\u8def\u5f84\u200b\u3002\u200b\u524d\u7f00\u200b\u8def\u5f84\u200b\u662f\u200b\u5b89\u88c5\u200bQGIS\u200b\u7684\u200b\u8def\u5f84\u200b\u3002\u200b\u5b83\u200b\u901a\u8fc7\u200b\u8c03\u7528\u200b<code>setPrefixPath</code>\u200b\u65b9\u6cd5\u200b\u5728\u200b\u811a\u672c\u200b\u4e2d\u200b\u914d\u7f6e\u200b\u3002\u200b\u7b2c\u4e8c\u4e2a\u200b\u53c2\u6570\u8bbe\u7f6e\u200b\u4e3a\u200b<code>True</code>\uff0c\u200b\u5b83\u200b\u63a7\u5236\u200b\u662f\u5426\u200b\u4f7f\u7528\u200b\u9ed8\u8ba4\u200b\u8def\u5f84\u200b\u3002</p> <p>QGIS\u200b\u5b89\u88c5\u200b\u8def\u5f84\u200b\u56e0\u200b\u5e73\u53f0\u200b\u800c\u5f02\u200b\uff0c\u200b\u5728\u200b\u7cfb\u7edf\u200b\u4e2d\u200b\u627e\u5230\u200b\u5b83\u200b\u7684\u200b\u6700\u200b\u7b80\u5355\u200b\u65b9\u6cd5\u200b\u662f\u200b\u5728\u200bQGIS\u200b\u4e2d\u200b\u4f7f\u7528\u200b1.1 \u200b\u5728\u200bPython\u200b\u63a7\u5236\u53f0\u200b\u4e2d\u200b\u7f16\u5199\u200b\u811a\u672c\u200b\u8fd0\u884c\u200b <code>QgsApplication.prefixPath()</code>\u200b\u5e76\u200b\u67e5\u770b\u200b\u8f93\u51fa\u200b\u3002</p> <p>\u200b\u914d\u7f6e\u200b\u524d\u7f00\u200b\u8def\u5f84\u200b\u540e\u200b\uff0c\u200b\u6211\u4eec\u200b\u5728\u200b\u53d8\u91cf\u200b<code>qgs</code>\u200b\u4e2d\u200b\u4fdd\u5b58\u200b\u4e86\u200b\u4e00\u4e2a\u200b\u5bf9\u200b<code>QgsApplication</code>\u200b\u7684\u200b\u5f15\u7528\u200b\u3002\u200b\u7b2c\u4e8c\u4e2a\u200b\u53c2\u6570\u8bbe\u7f6e\u200b\u4e3a\u200b<code>False</code>\uff0c\u200b\u8868\u793a\u200b\u6211\u4eec\u200b\u4e0d\u200b\u6253\u7b97\u200b\u4f7f\u7528\u200bGUI\uff0c\u200b\u56e0\u4e3a\u200b\u6211\u4eec\u200b\u6b63\u5728\u200b\u7f16\u5199\u200b\u4e00\u4e2a\u200b\u72ec\u7acb\u200b\u7684\u200b\u811a\u672c\u200b\u3002\u200b\u914d\u7f6e\u200b<code>QgsApplication</code>\u200b\u540e\u200b \uff0c\u200b\u6211\u4eec\u200b\u901a\u8fc7\u200b\u8c03\u7528\u200b<code>qgs.initQgis()</code>\u200b\u65b9\u6cd5\u200b\u52a0\u8f7d\u200bQGIS\u200b\u6570\u636e\u200b\u63d0\u4f9b\u8005\u200b\u548c\u200b\u56fe\u5c42\u200b\u6ce8\u518c\u200b\u3002\u200b\u5728\u200bQGIS\u200b\u521d\u59cb\u5316\u200b\u540e\u200b\uff0c\u200b\u6211\u4eec\u200b\u51c6\u5907\u200b\u7f16\u5199\u200b\u811a\u672c\u200b\u7684\u200b\u5176\u4f59\u90e8\u5206\u200b\u3002\u200b\u6700\u540e\u200b\uff0c\u200b\u6211\u4eec\u200b\u901a\u8fc7\u200b\u8c03\u7528\u200b<code>qgs.exitQgis()</code>\u200b\u4ece\u200b\u5185\u5b58\u200b\u4e2d\u200b\u5220\u9664\u200b\u6570\u636e\u200b\u63d0\u4f9b\u8005\u200b\u548c\u200b\u56fe\u5c42\u200b\u6ce8\u518c\u200b\u3002</p>"},{"location":"1-%E5%BC%95%E8%A8%80/#142-pyqgis","title":"1.4.2 \u200b\u5728\u200b\u81ea\u5b9a\u4e49\u200b\u5e94\u7528\u7a0b\u5e8f\u200b\u4e2d\u200b\u4f7f\u7528\u200bPyQGIS","text":"<p>1.4.1 \u200b\u5728\u200b\u72ec\u7acb\u200b\u811a\u672c\u200b\u4e2d\u200b\u4f7f\u7528\u200bPyQGIS\u200b\u548c\u200b\u81ea\u5b9a\u4e49\u200bPyQGIS\u200b\u5e94\u7528\u7a0b\u5e8f\u200b\u4e4b\u95f4\u200b\u7684\u200b\u552f\u4e00\u200b\u7684\u200b\u533a\u522b\u200b\u662f\u200b\u5728\u200b\u5b9e\u4f8b\u200b\u5316\u200b<code>QgsApplication</code>\u200b\u65f6\u200b\u7684\u200b\u7b2c\u4e8c\u4e2a\u200b\u53c2\u6570\u200b\u3002\u200b\u4f20\u9012\u200b<code>True</code>\u200b\u800c\u200b\u4e0d\u662f\u200b<code>False</code>\uff0c\u200b\u8868\u793a\u200b\u6211\u4eec\u200b\u8ba1\u5212\u200b\u4f7f\u7528\u200bGUI\u3002</p> <pre><code>from qgis.core import *\n# \u200b\u63d0\u4f9b\u200bqgis\u200b\u5b89\u88c5\u200b\u4f4d\u7f6e\u200b\u7684\u200b\u8def\u5f84\u200b(windows\u200b\u9ed8\u8ba4\u200b\uff1aC:\\Program Files\\QGIS 3.x\\apps\\qgis-ltr)\nQgsApplication.setPrefixPath(\"/path/to/qgis/installation\", True)\n# \u200b\u521b\u5efa\u200b\u5bf9\u200bQgsApplication\u200b\u8bbe\u7f6e\u200b\u7684\u200b\u5f15\u7528\u200b\u7b2c\u4e8c\u4e2a\u200b\u53c2\u6570\u200b\u4e3a\u200bTrue\u200b\u542f\u7528\u200bGUI\uff0c\u200b\u6211\u4eec\u200b\u9700\u8981\u200b\u8fd9\u6837\u200b\u505a\u200b\uff0c\u200b\u56e0\u4e3a\u200b\u8fd9\u662f\u200b\u4e00\u4e2a\u200b\u81ea\u5b9a\u4e49\u200b\u5e94\u7528\u7a0b\u5e8f\u200b\nqgs = QgsApplication([], True)\n# \u200b\u52a0\u8f7d\u200b\u63d0\u4f9b\u8005\u200b\nqgs.initQgis()\n# \u200b\u5728\u200b\u8fd9\u91cc\u200b\u7f16\u5199\u200b\u4ee3\u7801\u200b\uff0c\u200b\u52a0\u8f7d\u200b\u4e00\u4e9b\u200b\u56fe\u5c42\u200b\uff0c\u200b\u4f7f\u7528\u200b\u5904\u7406\u200b\u7b97\u6cd5\u200b\u7b49\u200b\n# \u200b\u811a\u672c\u200b\u5b8c\u6210\u200b\u540e\u200b\uff0c\u200b\u8c03\u7528\u200bexitQgis\uff08\uff09\u200b\u4ece\u200b\u5185\u5b58\u200b\u4e2d\u200b\u5220\u9664\u200b\u63d0\u4f9b\u8005\u200b\u548c\u200b\u56fe\u5c42\u200b\u6ce8\u518c\u200b\nqgs.exitQgis()\n</code></pre> <p>\u200b\u73b0\u5728\u200b\uff0c\u200b\u4f60\u200b\u53ef\u4ee5\u200b\u4f7f\u7528\u200bQGIS API\u2014\u2014\u200b\u52a0\u8f7d\u200b\u56fe\u5c42\u200b\u5e76\u200b\u6267\u884c\u200b\u4e00\u4e9b\u200b\u5904\u7406\u200b\u6216\u200b\u4f7f\u7528\u200b\u5730\u56fe\u200b\u753b\u5e03\u200b\u542f\u52a8\u200bGUI\u3002\u200b\u53ef\u80fd\u6027\u200b\u662f\u200b\u65e0\u6b62\u5883\u200b\u7684\u200b:-)</p>"},{"location":"1-%E5%BC%95%E8%A8%80/#143","title":"1.4.3 \u200b\u8fd0\u884c\u200b\u81ea\u5b9a\u4e49\u200b\u5e94\u7528\u7a0b\u5e8f","text":"<p>\u200b\u5982\u679c\u200b\u5b83\u4eec\u200b\u4e0d\u200b\u5728\u200b\u4e00\u4e2a\u200b\u4f17\u6240\u5468\u77e5\u200b\u7684\u200b\u4f4d\u7f6e\u200b\uff0c\u200b\u4f60\u200b\u9700\u8981\u200b\u544a\u8bc9\u200b\u7cfb\u7edf\u200b\u5728\u200b\u54ea\u91cc\u200b\u641c\u7d22\u200bQGIS\u200b\u5e93\u200b\u548c\u200b\u5408\u9002\u200b\u7684\u200bPython\u200b\u6a21\u5757\u200b\u2014\u2014\u200b\u5426\u5219\u200bPython\u200b\u4f1a\u200b\u629b\u51fa\u200b\u5f02\u5e38\u200b\uff1a</p> <pre><code>&gt;&gt;&gt; import qgis.core\nImportError: No module named qgis.core\n</code></pre> <p>\u200b\u53ef\u4ee5\u200b\u901a\u8fc7\u200b\u8bbe\u7f6e\u200b<code>PYTHONPATH</code>\u200b\u73af\u5883\u53d8\u91cf\u200b\u6765\u200b\u4fee\u590d\u200b\u3002\u200b\u5728\u200b\u4ee5\u4e0b\u200b\u547d\u4ee4\u200b\u4e2d\u200b\uff0c<code>&lt;qgispath&gt;</code>\u200b\u5e94\u200b\u66ff\u6362\u200b\u4e3a\u200b\u4f60\u200b\u7684\u200b\u5b9e\u9645\u200bQGIS\u200b\u5b89\u88c5\u200b\u8def\u5f84\u200b\uff1a</p> <ul> <li>\u200b\u5728\u200bLinux\u200b\u4e0a\u200b\uff1aexport PYTHONPATH=/&lt;qgispath&gt;/share/qgis/python</li> <li>\u200b\u5728\u200bWindows\u200b\u4e0a\u200b\uff1aset PYTHONPATH=c:\\&lt;qgispath&gt;\\python</li> <li>\u200b\u5728\u200bmacOS\u200b\u4e0a\u200b\uff1aexport PYTHONPATH=/&lt;qgispath&gt;/Contents/Resources/python</li> </ul> <p>\u200b\u73b0\u5728\u200b\uff0cPyQGIS\u200b\u6a21\u5757\u200b\u7684\u200b\u8def\u5f84\u200b\u8bbe\u7f6e\u200b\u5b8c\u6210\u200b\uff0c\u200b\u4f46\u200b\u5b83\u4eec\u200b\u4f9d\u8d56\u4e8e\u200b<code>qgis_core</code>\u200b\u548c\u200b<code>qgis_gui</code>\u200b\u5e93\u200b\uff08\u200b\u4ec5\u4ec5\u200b\u4f5c\u4e3a\u200b\u5c01\u88c5\u200b\u7684\u200bPython\u200b\u6a21\u5757\u200b\uff09\u3002\u200b\u8fd9\u4e9b\u200b\u5e93\u200b\u7684\u200b\u8def\u5f84\u200b\u901a\u5e38\u200b\u662f\u200b\u64cd\u4f5c\u7cfb\u7edf\u200b\u672a\u77e5\u200b\u7684\u200b\uff0c\u200b\u56e0\u6b64\u200b\u518d\u6b21\u51fa\u73b0\u200b\u5bfc\u5165\u200b\u9519\u8bef\u200b\uff08\u200b\u9519\u8bef\u200b\u6d88\u606f\u200b\u53ef\u80fd\u200b\u56e0\u200b\u7cfb\u7edf\u200b\u800c\u5f02\u200b\uff09\uff1a</p> <pre><code>&gt;&gt;&gt; import qgis.core\nImportError: libqgis_core.so.3.2.0: cannot open shared object file:No such file or directory\n</code></pre> <p>\u200b\u901a\u8fc7\u200b\u5c06\u200bQGIS\u200b\u5e93\u200b\u6240\u5728\u200b\u7684\u200b\u76ee\u5f55\u200b\u6dfb\u52a0\u200b\u5230\u200b\u52a8\u6001\u200b\u94fe\u63a5\u200b\u5668\u200b\u7684\u200b\u641c\u7d22\u200b\u8def\u5f84\u200b\u6765\u200b\u89e3\u51b3\u200b\u6b64\u200b\u95ee\u9898\u200b\uff1a</p> <ul> <li>\u200b\u5728\u200bLinux\u200b\u4e0a\u200b\uff1aexport LD_LIBRARY_PATH=/qgispath/lib</li> <li>\u200b\u5728\u200bWindows\u200b\u4e0a\u200b\uff1aset PATH=C:\\qgispath\\BIN; C:\\qgispath\\APPS\\qgisrelease\\BIN;PATH\uff05 \uff0c\u200b\u5176\u4e2d\u200b<code>qgisrelease</code>\u200b\u5e94\u200b\u66ff\u6362\u6210\u200b\u4f60\u200b\u7684\u200b\u53d1\u5e03\u200b\u7c7b\u578b\u200b\uff08\u200b\u4f8b\u5982\u200b\uff0c<code>qgis-ltr</code>\uff0c<code>qgis</code>\uff0c<code>qgis-dev</code>\uff09</li> </ul> <p>\u200b\u8fd9\u4e9b\u200b\u547d\u4ee4\u200b\u53ef\u4ee5\u200b\u653e\u5165\u200b\u4e00\u4e2a\u200b\u5f15\u5bfc\u200b\u811a\u672c\u200b\uff0c\u200b\u8d1f\u8d23\u200b\u542f\u52a8\u200b\u3002\u200b\u4f7f\u7528\u200bPyQGIS\u200b\u90e8\u7f72\u200b\u81ea\u5b9a\u4e49\u200b\u5e94\u7528\u7a0b\u5e8f\u200b\u65f6\u200b\uff0c\u200b\u901a\u5e38\u200b\u6709\u200b\u4e24\u79cd\u200b\u53ef\u80fd\u200b\uff1a</p> <ul> <li>\u200b\u8981\u6c42\u200b\u7528\u6237\u200b\u5728\u200b\u5b89\u88c5\u200b\u5e94\u7528\u7a0b\u5e8f\u200b\u4e4b\u524d\u200b\u5728\u200b\u5176\u200b\u5e73\u53f0\u200b\u4e0a\u200b\u5b89\u88c5\u200bQGIS\u3002\u200b\u5e94\u7528\u7a0b\u5e8f\u200b\u5b89\u88c5\u7a0b\u5e8f\u200b\u5e94\u200b\u67e5\u627e\u200bQGIS\u200b\u5e93\u200b\u7684\u200b\u9ed8\u8ba4\u200b\u4f4d\u7f6e\u200b\uff0c\u200b\u5e76\u200b\u5141\u8bb8\u200b\u7528\u6237\u200b\u8bbe\u7f6e\u200b\u8def\u5f84\u200b\uff08\u200b\u5982\u679c\u200b\u672a\u627e\u5230\u200b\uff09\u3002\u200b\u8be5\u200b\u65b9\u6cd5\u200b\u66f4\u200b\u7b80\u5355\u200b\uff0c\u200b\u4f46\u662f\u200b\u5b83\u200b\u9700\u8981\u200b\u7528\u6237\u200b\u6267\u884c\u200b\u66f4\u200b\u591a\u200b\u6b65\u9aa4\u200b\u3002</li> <li>\u200b\u5c06\u200bQGIS\u200b\u4e0e\u200b\u4f60\u200b\u7684\u200b\u5e94\u7528\u7a0b\u5e8f\u200b\u4e00\u8d77\u200b\u6253\u5305\u200b\u3002\u200b\u53d1\u5e03\u200b\u5e94\u7528\u7a0b\u5e8f\u200b\u53ef\u80fd\u200b\u66f4\u5177\u200b\u6311\u6218\u6027\u200b\uff0c\u200b\u5e76\u4e14\u200b\u7a0b\u5e8f\u5305\u200b\u5c06\u200b\u66f4\u200b\u5927\u200b\uff0c\u200b\u4f46\u200b\u7528\u6237\u200b\u5c06\u200b\u514d\u4e8e\u200b\u4e0b\u8f7d\u200b\u548c\u200b\u5b89\u88c5\u200b\u5176\u4ed6\u8f6f\u4ef6\u200b\u7684\u200b\u8d1f\u62c5\u200b\u3002</li> </ul> <p>\u200b\u8fd9\u200b\u4e24\u79cd\u200b\u90e8\u7f72\u200b\u65b9\u5f0f\u200b\u53ef\u4ee5\u200b\u6df7\u5408\u200b\u4f7f\u7528\u200b\u2014\u2014\u200b\u5728\u200bWindows\u200b\u548c\u200bmacOS\u200b\u4e0a\u200b\u90e8\u7f72\u200b\u72ec\u7acb\u200b\u5e94\u7528\u7a0b\u5e8f\u200b\uff0c\u200b\u4f46\u662f\u200b\u5bf9\u4e8e\u200bLinux\uff0c\u200b\u5c06\u200bQGIS\u200b\u7684\u200b\u5b89\u88c5\u200b\u7559\u7ed9\u200b\u7528\u6237\u200b\u548c\u200b\u4ed6\u200b\u7684\u200b\u5305\u200b\u7ba1\u7406\u5668\u200b\u3002</p>"},{"location":"1-%E5%BC%95%E8%A8%80/#15-pyqtsip","title":"1.5 \u200b\u5173\u4e8e\u200bPyQt\u200b\u548c\u200bSIP\u200b\u7684\u200b\u6280\u672f\u200b\u8bf4\u660e","text":"<p>\u200b\u6211\u4eec\u200b\u51b3\u5b9a\u200b\u4f7f\u7528\u200bPython\uff0c\u200b\u56e0\u4e3a\u200b\u5b83\u200b\u662f\u200b\u6700\u200b\u53d7\u6b22\u8fce\u200b\u7684\u200b\u811a\u672c\u8bed\u8a00\u200b\u4e4b\u4e00\u200b\u3002QGIS3\u200b\u4e2d\u200b\u7684\u200bPyQGIS\u200b\u7ed1\u5b9a\u200b\u4f9d\u8d56\u4e8e\u200bSIP\u200b\u548c\u200bPyQt5\u3002\u200b\u4f7f\u7528\u200bSIP\u200b\u800c\u200b\u4e0d\u662f\u200b\u4f7f\u7528\u200b\u66f4\u200b\u5e7f\u6cdb\u200b\u4f7f\u7528\u200b\u7684\u200bSWIG\u200b\u7684\u200b\u539f\u56e0\u200b\u662f\u200bQGIS\u200b\u4ee3\u7801\u200b\u4f9d\u8d56\u4e8e\u200bQt\u200b\u5e93\u200b\u3002Qt\uff08PyQt\uff09\u200b\u7684\u200bPython\u200b\u7ed1\u5b9a\u200b\u4f7f\u7528\u200bSIP\u200b\u5b8c\u6210\u200b\uff0c\u200b\u8fd9\u200b\u5141\u8bb8\u200bPyQGIS\u200b\u4e0e\u200bPyQt\u200b\u65e0\u7f1d\u200b\u96c6\u6210\u200b\u3002</p>"},{"location":"10-%E5%9C%B0%E5%9B%BE%E6%B8%B2%E6%9F%93%E5%92%8C%E6%89%93%E5%8D%B0/","title":"10-\u200b\u5730\u56fe\u200b\u6e32\u67d3\u200b\u548c\u200b\u6253\u5370","text":"<p>\u200b\u672c\u200b\u8282\u200b\u4ee3\u7801\u200b\u7247\u6bb5\u200b\u9700\u8981\u200b\u5bfc\u5165\u200b\u4ee5\u4e0b\u200b\u6a21\u5757\u200b\uff1a</p> <pre><code>import os\n\nfrom qgis.core import (\n    QgsGeometry,\n    QgsMapSettings,\n    QgsPrintLayout,\n    QgsMapSettings,\n    QgsMapRendererParallelJob,\n    QgsLayoutItemLabel,\n    QgsLayoutItemLegend,\n    QgsLayoutItemMap,\n    QgsLayoutItemPolygon,\n    QgsLayoutItemScaleBar,\n    QgsLayoutExporter,\n    QgsLayoutItem,\n    QgsLayoutPoint,\n    QgsLayoutSize,\n    QgsUnitTypes,\n    QgsProject,\n    QgsFillSymbol,\n    QgsAbstractValidityCheck,\n    check,\n)\n\nfrom qgis.PyQt.QtGui import (\n    QPolygonF,\n    QColor,\n)\n\nfrom qgis.PyQt.QtCore import (\n    QPointF,\n    QRectF,\n    QSize,\n)\n</code></pre>"},{"location":"10-%E5%9C%B0%E5%9B%BE%E6%B8%B2%E6%9F%93%E5%92%8C%E6%89%93%E5%8D%B0/#10","title":"10 \u200b\u5730\u56fe\u200b\u6e32\u67d3\u200b\u548c\u200b\u6253\u5370","text":"<p>\u200b\u5f53\u200b\u8f93\u5165\u200b\u6570\u636e\u200b\u4f5c\u4e3a\u200b\u5730\u56fe\u200b\u5448\u73b0\u200b\u65f6\u200b\uff0c\u200b\u901a\u5e38\u200b\u6709\u200b\u4e24\u79cd\u200b\u65b9\u6cd5\u200b\uff1a\u200b\u4f7f\u7528\u200bQgsMapRendererJob\u200b\u5feb\u901f\u200b\u8fdb\u884c\u200b\uff0c\u200b\u6216\u8005\u200b\u4f7f\u7528\u200b<code>QgsLayout</code>\u200b\u7c7b\u200b\u7ec4\u5408\u200b\u5730\u56fe\u200b\u6765\u200b\u751f\u6210\u200b\u66f4\u200b\u7cbe\u7ec6\u200b\u7684\u200b\u8f93\u51fa\u200b\u3002</p>"},{"location":"10-%E5%9C%B0%E5%9B%BE%E6%B8%B2%E6%9F%93%E5%92%8C%E6%89%93%E5%8D%B0/#101","title":"10.1 \u200b\u7b80\u5355\u200b\u7684\u200b\u6e32\u67d3","text":"<p>\u200b\u6e32\u67d3\u200b\u5b8c\u6210\u200b\u540e\u200b\uff0c\u200b\u521b\u5efa\u200b\u4e00\u4e2a\u200b<code>QgsMapSettings</code>\u200b\u5bf9\u8c61\u200b\u6765\u200b\u5b9a\u4e49\u200b\u6e32\u67d3\u200b\u9009\u9879\u200b\uff0c\u200b\u7136\u540e\u200b\u4f7f\u7528\u200b\u8fd9\u4e9b\u200b\u9009\u9879\u200b\u6784\u5efa\u200b\u4e00\u4e2a\u200b<code>QgsMapRendererJob</code>\u200b\u7c7b\u200b\u3002\u200b\u7136\u540e\u200b\u4f7f\u7528\u200b\u540e\u8005\u200b\u6765\u200b\u521b\u5efa\u200b\u56fe\u50cf\u200b\u3002</p> <p>\u200b\u8fd9\u662f\u200b\u4e00\u4e2a\u200b\u4f8b\u5b50\u200b\uff1a</p> <pre><code>image_location = os.path.join(QgsProject.instance().homePath(), \"render.png\")\n\nvlayer = iface.activeLayer()\nsettings = QgsMapSettings()\nsettings.setLayers([vlayer])\nsettings.setBackgroundColor(QColor(255, 255, 255))\nsettings.setOutputSize(QSize(800, 600))\nsettings.setExtent(vlayer.extent())\n\nrender = QgsMapRendererParallelJob(options)\n\ndef finished():\n    img = render.renderedImage()\n    # \u200b\u4fdd\u5b58\u200b\u56fe\u50cf\u200b; e.g. img.save(\"/Users/myuser/render.png\",\"png\")\n    img.save(image_location, \"png\")\n\nrender.finished.connect(finished)\n\n# \u200b\u5f00\u59cb\u200b\u6e32\u67d3\u200b\nrender.start()\n\n# \u200b\u901a\u5e38\u200b\u4e0d\u200b\u9700\u8981\u200b\u5faa\u73af\u200b\uff0c\u200b\u56e0\u4e3a\u200b\u8fd9\u91cc\u200b\u662f\u200b\u5355\u72ec\u200b\u4f7f\u7528\u200b\nfrom qgis.PyQt.QtCore import QEventLoop\nloop = QEventLoop()\nrender.finished.connect(loop.quit)\nloop.exec_()\n</code></pre>"},{"location":"10-%E5%9C%B0%E5%9B%BE%E6%B8%B2%E6%9F%93%E5%92%8C%E6%89%93%E5%8D%B0/#102-crs","title":"10.2 \u200b\u4f7f\u7528\u200b\u4e0d\u540c\u200b\u7684\u200bCRS\u200b\u6e32\u67d3\u200b\u56fe\u5c42","text":"<p>\u200b\u5982\u679c\u200b\u4f60\u200b\u6709\u200b\u591a\u4e2a\u200b\u56fe\u5c42\u200b\u5e76\u4e14\u200b\u5b83\u4eec\u200b\u5177\u6709\u200b\u4e0d\u540c\u200b\u7684\u200bCRS\uff0c\u200b\u4e0a\u9762\u200b\u7684\u200b\u7b80\u5355\u200b\u793a\u4f8b\u200b\u53ef\u80fd\u200b\u4e0d\u8d77\u4f5c\u7528\u200b\uff1a\u200b\u4ece\u200b\u8303\u56f4\u200b\u8ba1\u7b97\u200b\u4e2d\u200b\u83b7\u53d6\u200b\u6b63\u786e\u200b\u7684\u200b\u503c\u200b\uff0c\u200b\u4f60\u200b\u5fc5\u987b\u200b\u663e\u5f0f\u200b\u8bbe\u7f6e\u200b\u76ee\u6807\u200bCRS</p> <pre><code>layers = [iface.activeLayer()]\nsettings = QgsMapSettings()\nsettings.setLayers(layers)\nrender.setDestinationCrs(layers[0].crs())\n</code></pre>"},{"location":"10-%E5%9C%B0%E5%9B%BE%E6%B8%B2%E6%9F%93%E5%92%8C%E6%89%93%E5%8D%B0/#103","title":"10.3 \u200b\u4f7f\u7528\u200b\u6253\u5370\u200b\u5e03\u5c40\u200b\u8f93\u51fa","text":"<p>\u200b\u5982\u679c\u200b\u4f60\u200b\u60f3\u8981\u200b\u6bd4\u200b\u4e0a\u9762\u200b\u663e\u793a\u200b\u7684\u200b\u7b80\u5355\u200b\u6e32\u67d3\u200b\u66f4\u200b\u590d\u6742\u200b\u7684\u200b\u8f93\u51fa\u200b\uff0c\u200b\u6253\u5370\u200b\u5e03\u5c40\u200b\u662f\u200b\u4e00\u4e2a\u200b\u975e\u5e38\u200b\u65b9\u4fbf\u200b\u7684\u200b\u5de5\u5177\u200b\u3002\u200b\u53ef\u4ee5\u200b\u521b\u5efa\u200b\u590d\u6742\u200b\u7684\u200b\u5730\u56fe\u200b\u5e03\u5c40\u200b\uff0c\u200b\u5305\u62ec\u200b\u5730\u56fe\u200b\u89c6\u56fe\u200b\uff0c\u200b\u6807\u7b7e\u200b\uff0c\u200b\u56fe\u4f8b\u200b\uff0c\u200b\u8868\u683c\u200b\u4ee5\u53ca\u200b\u901a\u5e38\u200b\u51fa\u73b0\u200b\u5728\u200b\u7eb8\u8d28\u200b\u5730\u56fe\u200b\u4e0a\u200b\u7684\u200b\u5176\u4ed6\u200b\u5143\u7d20\u200b\u3002\u200b\u7136\u540e\u200b\u53ef\u4ee5\u200b\u5c06\u200b\u5e03\u5c40\u200b\u5bfc\u51fa\u200b\u4e3a\u200bPDF\uff0cSVG\uff0c\u200b\u6805\u683c\u200b\u56fe\u50cf\u200b\u6216\u200b\u76f4\u63a5\u200b\u6253\u5370\u200b\u5728\u200b\u6253\u5370\u673a\u200b\u4e0a\u200b\u3002</p> <p>\u200b\u5e03\u5c40\u200b\u7531\u200b\u4e00\u5806\u200b\u7c7b\u200b\u7ec4\u6210\u200b\u3002\u200b\u5b83\u4eec\u200b\u90fd\u200b\u5c5e\u4e8e\u200b\u6838\u5fc3\u200b\u5e93\u200b\u3002QGIS\u200b\u5e94\u7528\u7a0b\u5e8f\u200b\u6709\u200b\u4e00\u4e2a\u200b\u65b9\u4fbf\u200b\u7684\u200bGUI\u200b\u5e03\u5c40\u200b\u5143\u7d20\u200b\uff0c\u200b\u867d\u7136\u200b\u5b83\u200b\u5728\u200bGUI\u200b\u5e93\u4e2d\u200b\u4e0d\u53ef\u200b\u7528\u200b\u3002\u200b\u5982\u679c\u200b\u4f60\u200b\u4e0d\u200b\u719f\u6089\u200b Qt Graphics View\u200b\u6846\u67b6\u200b\uff0c\u200b\u90a3\u4e48\u200b\u5efa\u8bae\u200b\u4f60\u200b\u67e5\u770b\u200b\u6587\u6863\u200b\uff0c\u200b\u56e0\u4e3a\u200b\u5e03\u5c40\u200b\u662f\u200b\u57fa\u4e8e\u200b\u5b83\u200b\u7684\u200b\u3002</p> <p>\u200b\u5e03\u5c40\u200b\u7684\u200b\u4e2d\u5fc3\u200b\u7c7b\u200b\u662f\u200b<code>QgsLayout</code> \u200b\u7c7b\u200b\uff0c\u200b\u5b83\u200b\u662f\u4ece\u200bQt QGraphicsScene \u200b\u7c7b\u200b\u6d3e\u751f\u200b\u7684\u200b\u3002\u200b\u8ba9\u200b\u6211\u4eec\u200b\u521b\u5efa\u200b\u4e00\u4e2a\u200b\u5b83\u200b\u7684\u200b\u5b9e\u4f8b\u200b\uff1a</p> <pre><code>project = QgsProject.instance()\nlayout = QgsPrintLayout(project)\nlayout.initializeDefaults()\n</code></pre> <p>\u200b\u8fd9\u200b\u5c06\u200b\u4f7f\u7528\u200b\u4e00\u4e9b\u200b\u9ed8\u8ba4\u8bbe\u7f6e\u200b\u521d\u59cb\u5316\u200b\u5e03\u5c40\u200b\uff0c\u200b\u5c06\u7a7a\u200b\u7684\u200bA4\u200b\u9875\u200b\u6dfb\u52a0\u200b\u5230\u200b\u5e03\u5c40\u200b\u4e2d\u200b\u3002\u200b\u4f60\u200b\u53ef\u4ee5\u200b\u5728\u200b\u4e0d\u200b\u8c03\u7528\u200b<code>initializeDefaults()</code>\u200b\u65b9\u6cd5\u200b\u7684\u200b\u60c5\u51b5\u200b\u4e0b\u200b\u521b\u5efa\u200b\u5e03\u5c40\u200b\uff0c\u200b\u4f46\u200b\u4f60\u200b\u9700\u8981\u200b\u81ea\u5df1\u200b\u5411\u200b\u5e03\u5c40\u200b\u4e2d\u200b\u6dfb\u52a0\u200b\u9875\u9762\u200b\u3002</p> <p>\u200b\u4e4b\u524d\u200b\u7684\u200b\u4ee3\u7801\u200b\u521b\u5efa\u200b\u4e86\u200b\u5728\u200bGUI\u200b\u4e2d\u200b\u4e0d\u200b\u53ef\u89c1\u200b\u7684\u200b\u201c\u200b\u4e34\u65f6\u200b\u201d\u200b\u5e03\u5c40\u200b\u3002\u200b\u5b83\u200b\u53ef\u4ee5\u200b\u65b9\u4fbf\u200b\u5feb\u901f\u200b\u5730\u200b\u6dfb\u52a0\u200b\u67d0\u4e9b\u200b\u9879\u200b\u5e76\u200b\u5bfc\u51fa\u200b\uff0c\u200b\u800c\u200b\u4e0d\u200b\u4fee\u6539\u200b\u9879\u200b\u672c\u8eab\u200b\uff0c\u200b\u4e5f\u200b\u4e0d\u4f1a\u200b\u5411\u6237\u200b\u516c\u5f00\u200b\u8fd9\u4e9b\u200b\u66f4\u6539\u200b\u3002\u200b\u5982\u679c\u200b\u4f60\u200b\u5e0c\u671b\u200b\u5c06\u200b\u5e03\u5c40\u200b\u4e0e\u200b\u9879\u76ee\u200b\u4e00\u8d77\u200b\u4fdd\u5b58\u200b\u6216\u200b\u6062\u590d\u200b\uff0c\u200b\u5e76\u200b\u4f7f\u200b\u5176\u200b\u5728\u200b\u5e03\u5c40\u200b\u7ba1\u7406\u5668\u200b\u4e2d\u200b\u53ef\u7528\u200b\uff0c\u200b\u6dfb\u52a0\u200b\uff1a</p> <pre><code>layout.setName(\"MyLayout\")\nproject.layoutManager().addLayout(layout)\n</code></pre> <p>\u200b\u73b0\u5728\u200b\u6211\u4eec\u200b\u53ef\u4ee5\u200b\u5728\u200b\u5e03\u5c40\u200b\u4e2d\u200b\u6dfb\u52a0\u200b\u5404\u79cd\u200b\u5143\u7d20\u200b\uff08map\uff0clabel\uff0c...\uff09\u3002\u200b\u6240\u6709\u200b\u8fd9\u4e9b\u200b\u5bf9\u8c61\u200b\u90fd\u200b\u7ee7\u627f\u200b\u81ea\u200b\u57fa\u7c7b\u200b<code>QgsLayoutItem</code>\u3002</p> <p>\u200b\u4ee5\u4e0b\u200b\u662f\u200b\u53ef\u4ee5\u200b\u6dfb\u52a0\u200b\u5230\u200b\u5e03\u5c40\u200b\u7684\u200b\u4e00\u4e9b\u200b\u4e3b\u8981\u200b\u5e03\u5c40\u200b\u9879\u200b\u7684\u200b\u8bf4\u660e\u200b\u3002</p> <ul> <li>\u200b\u5730\u56fe\u200b\u2014\u2014 \u200b\u5728\u200b\u8fd9\u91cc\u200b\uff0c\u200b\u6211\u4eec\u200b\u521b\u5efa\u200b\u4e00\u4e2a\u200b\u5730\u56fe\u200b\u5e76\u200b\u5c06\u200b\u5176\u200b\u62c9\u4f38\u200b\u5230\u200b\u6574\u4e2a\u200b\u7eb8\u5f20\u200b\u5927\u5c0f\u200b</li> </ul> <pre><code>map = QgsLayoutItemMap(layout)\n# \u200b\u8bbe\u7f6e\u200b\u5730\u56fe\u200b\u9879\u200b\u7684\u200b\u4f4d\u7f6e\u200b\u548c\u200b\u5927\u5c0f\u200b\uff08\u200b\u9ed8\u8ba4\u200b\u662f\u200b\u5bbd\u200b\u9ad8\u200b\u90fd\u200b\u662f\u200b0\uff0c\u200b\u4f4d\u7f6e\u200b\u5728\u200b0\uff0c0\uff09\nmap.attemptMove(QgsLayoutPoint(5,5, QgsUnitTypes.LayoutMillimeters))\nmap.attemptResize(QgsLayoutSize(200,200, QgsUnitTypes.LayoutMillimeters))\n# \u200b\u63d0\u4f9b\u200b\u6e32\u67d3\u200b\u8303\u56f4\u200b\nmap.zoomToExtent(iface.mapCanvas().extent())\nlayout.addItem(map)\n</code></pre> <ul> <li>\u200b\u6807\u7b7e\u200b\u2014\u2014\u200b\u5141\u8bb8\u200b\u663e\u793a\u200b\u6807\u7b7e\u200b\u3002\u200b\u53ef\u4ee5\u200b\u4fee\u6539\u200b\u5176\u200b\u5b57\u4f53\u200b\uff0c\u200b\u989c\u8272\u200b\uff0c\u200b\u5bf9\u9f50\u200b\u548c\u200b\u8fb9\u200b\u8ddd\u200b</li> </ul> <pre><code>label = QgsLayoutItemLabel(layout)\nlabel.setText(\"Hello world\")\nlabel.adjustSizeToText()\nlayout.addItem(label)\n</code></pre> <ul> <li>\u200b\u56fe\u4f8b\u200b</li> </ul> <pre><code>legend = QgsLayoutItemLegend(layout)\nlegend.setLinkedMap(map) # map\u200b\u662f\u200b\u4e00\u4e2a\u200bQgsLayoutItemMap\u200b\u5b9e\u4f8b\u200b\nlayout.addItem(legend)\n</code></pre> <ul> <li>\u200b\u6bd4\u4f8b\u5c3a\u200b</li> </ul> <pre><code>item = QgsLayoutItemScaleBar(layout)\nitem.setStyle('Numeric') # \u200b\u53ef\u200b\u9009\u62e9\u200b\u4fee\u6539\u200b\u6837\u5f0f\u200b\nitem.setLinkedMap(map)  # map\u200b\u662f\u200b\u4e00\u4e2a\u200bQgsLayoutItemMap\u200b\u5b9e\u4f8b\u200b\nitem.applyDefaultSize()\nlayout.addItem(item)\n</code></pre> <ul> <li> <p>\u200b\u7bad\u5934\u200b</p> </li> <li> <p>\u200b\u56fe\u7247\u200b</p> </li> <li> <p>\u200b\u57fa\u672c\u200b\u5f62\u72b6\u200b</p> </li> <li> <p>\u200b\u57fa\u4e8e\u200b\u8282\u70b9\u200b\u7684\u200b\u5f62\u72b6\u200b</p> </li> </ul> <pre><code>polygon = QPolygonF()\npolygon.append(QPointF(0.0, 0.0))\npolygon.append(QPointF(100.0, 0.0))\npolygon.append(QPointF(200.0, 100.0))\npolygon.append(QPointF(100.0, 200.0))\n\npolygonItem = QgsLayoutItemPolygon(polygon, layout)\nlayout.addItem(polygonItem)\n\nprops = {}\nprops[\"color\"] = \"green\"\nprops[\"style\"] = \"solid\"\nprops[\"style_border\"] = \"solid\"\nprops[\"color_border\"] = \"black\"\nprops[\"width_border\"] = \"10.0\"\nprops[\"joinstyle\"] = \"miter\"\n\nsymbol = QgsFillSymbol.createSimple(props)\npolygonItem.setSymbol(symbol)\n</code></pre> <ul> <li>\u200b\u8868\u683c\u200b</li> </ul> <p>\u200b\u5c06\u200b\u9879\u200b\u6dfb\u52a0\u200b\u5230\u200b\u5e03\u5c40\u200b\u540e\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u79fb\u52a8\u200b\u5e76\u200b\u8c03\u6574\u200b\u5176\u200b\u5927\u5c0f\u200b\uff1a</p> <pre><code>item.attemptMove(QgsLayoutPoint(1.4, 1.8, QgsUnitTypes.LayoutCentimeters))\nitem.attemptResize(QgsLayoutSize(2.8, 2.2, QgsUnitTypes.LayoutCentimeters))\n</code></pre> <p>\u200b\u9ed8\u8ba4\u200b\u60c5\u51b5\u200b\u4e0b\u200b\uff0c\u200b\u6bcf\u4e2a\u200b\u9879\u76ee\u200b\u5468\u56f4\u200b\u90fd\u200b\u4f1a\u200b\u7ed8\u5236\u200b\u4e00\u4e2a\u200b\u6846\u67b6\u200b\uff0c\u200b\u4f60\u200b\u53ef\u4ee5\u200b\u6309\u200b\u5982\u4e0b\u200b\u65b9\u5f0f\u200b\u5220\u9664\u200b\u5b83\u200b\uff1a</p> <pre><code>label.setFrameEnabled(False)\n</code></pre> <p>\u200b\u9664\u4e86\u200b\u624b\u52a8\u200b\u521b\u5efa\u200b\u5e03\u5c40\u200b\u9879\u5916\u200b\uff0cQGIS\u200b\u8fd8\u200b\u652f\u6301\u200b\u5e03\u5c40\u200b\u6a21\u677f\u200b\uff0c\u200b\u8fd9\u4e9b\u200b\u5e03\u5c40\u200b\u6a21\u677f\u200b\u672c\u8d28\u200b\u4e0a\u200b\u662f\u200b\u5c06\u200b\u6240\u6709\u200b\u9879\u200b\u4fdd\u5b58\u200b\u5230\u200b.qpt\u200b\u6587\u4ef6\u200b\u4e2d\u200b\uff08\u200b\u4f7f\u7528\u200bXML\u200b\u8bed\u6cd5\u200b\uff09\u3002</p> <p>\u200b\u4e00\u65e6\u200b\u7ec4\u5408\u200b\u51c6\u5907\u5c31\u7eea\u200b\uff08\u200b\u5e03\u5c40\u200b\u9879\u200b\u5df2\u7ecf\u200b\u521b\u5efa\u200b\u5e76\u200b\u6dfb\u52a0\u200b\u5230\u200b\u7ec4\u5408\u200b\u4e2d\u200b\uff09\uff0c\u200b\u6211\u4eec\u200b\u5c31\u200b\u53ef\u4ee5\u200b\u7ee7\u7eed\u200b\u751f\u6210\u200b\u6805\u683c\u200b\u6216\u8005\u200b\u77e2\u91cf\u200b\u8f93\u51fa\u200b\u3002</p>"},{"location":"10-%E5%9C%B0%E5%9B%BE%E6%B8%B2%E6%9F%93%E5%92%8C%E6%89%93%E5%8D%B0/#1031","title":"10.3.1 \u200b\u68c0\u67e5\u200b\u5e03\u5c40\u200b\u6709\u6548\u6027","text":"<p>\u200b\u5e03\u5c40\u200b\u662f\u200b\u7531\u200b\u4e00\u7ec4\u200b\u4e92\u8fde\u200b\u7684\u200b\u9879\u200b\u7ec4\u6210\u200b\u7684\u200b\uff0c\u200b\u5728\u200b\u4fee\u6539\u200b\u8fc7\u7a0b\u200b\u4e2d\u200b\u53ef\u80fd\u200b\u4f1a\u200b\u53d1\u751f\u200b\u8fd9\u4e9b\u200b\u8fde\u63a5\u200b\u65ad\u5f00\u200b\u7684\u200b\u60c5\u51b5\u200b\uff08\u200b\u56fe\u4f8b\u200b\u8fde\u63a5\u200b\u5230\u200b\u5df2\u200b\u5220\u9664\u200b\u7684\u200b\u5730\u56fe\u200b\u3001\u200b\u7f3a\u5c11\u200b\u6e90\u6587\u4ef6\u200b\u7684\u200b\u56fe\u50cf\u200b\u9879\u200b\u7b49\u200b\uff09\uff0c\u200b\u6216\u8005\u200b\u4f60\u200b\u53ef\u80fd\u200b\u5e0c\u671b\u200b\u5bf9\u200b\u5e03\u5c40\u200b\u9879\u200b\u5e94\u7528\u200b\u81ea\u5b9a\u4e49\u200b\u7ea6\u675f\u200b\u3002QgsAbstractValidatyCheck\u200b\u53ef\u200b\u5e2e\u52a9\u200b\u4f60\u200b\u5b9e\u73b0\u200b\u8fd9\u200b\u4e00\u70b9\u200b\u3002</p> <p>\u200b\u57fa\u672c\u200b\u68c0\u67e5\u200b\u5982\u4e0b\u200b\uff1a</p> <pre><code>@check.register(type=QgsAbstractValidityCheck.TypeLayoutCheck)\ndef my_layout_check(context, feedback):\n  results = ...\n  return results\n</code></pre> <p>\u200b\u8fd9\u91cc\u200b\u6709\u200b\u4e00\u4e2a\u200b\u68c0\u67e5\u200b\uff0c\u200b\u6bcf\u5f53\u200b\u5e03\u5c40\u200b\u5730\u56fe\u200b\u9879\u76ee\u200b\u8bbe\u7f6e\u200b\u4e3a\u200bWEB\u200b\u58a8\u5361\u6258\u200b\u6295\u5f71\u200b\u65f6\u200b\uff0c\u200b\u5c31\u200b\u4f1a\u200b\u53d1\u51fa\u200b\u8b66\u544a\u200b\uff1a</p> <pre><code>@check.register(type=QgsAbstractValidityCheck.TypeLayoutCheck)\ndef layout_map_crs_choice_check(context, feedback):\n  layout = context.layout\n  results = []\n  for i in layout.items():\n    if isinstance(i, QgsLayoutItemMap) and i.crs().authid() == 'EPSG:3857':\n      res = QgsValidityCheckResult()\n      res.type = QgsValidityCheckResult.Warning\n      res.title = 'Map projection is misleading'\n      res.detailedDescription = 'The projection for the map item {} is set to &lt;i&gt;Web Mercator (EPSG:3857)&lt;/i&gt; which misrepresents areas and shapes. Consider using an appropriate local projection instead.'.format(i.displayName())\n      results.append(res)\n\n  return results\n</code></pre> <p>\u200b\u8fd9\u91cc\u200b\u6709\u200b\u4e00\u4e2a\u200b\u66f4\u200b\u590d\u6742\u200b\u7684\u200b\u4f8b\u5b50\u200b\uff0c\u200b\u5982\u679c\u200b\u4efb\u4f55\u200b\u5e03\u5c40\u200b\u5730\u56fe\u200b\u9879\u200b\u88ab\u200b\u8bbe\u7f6e\u200b\u4e3a\u200bCRS\uff0c\u200b\u5219\u200b\u4f1a\u200b\u53d1\u51fa\u200b\u8b66\u544a\u200b\uff0c\u200b\u8be5\u200bCRS\u200b\u4ec5\u200b\u5728\u200b\u8be5\u200b\u5730\u56fe\u200b\u9879\u4e2d\u200b\u663e\u793a\u200b\u7684\u200b\u8303\u56f4\u200b\u4e4b\u5916\u200b\u6709\u6548\u200b\uff1a</p> <pre><code>@check.register(type=QgsAbstractValidityCheck.TypeLayoutCheck)\ndef layout_map_crs_area_check(context, feedback):\n    layout = context.layout\n    results = []\n    for i in layout.items():\n        if isinstance(i, QgsLayoutItemMap):\n            bounds = i.crs().bounds()\n            ct = QgsCoordinateTransform(QgsCoordinateReferenceSystem('EPSG:4326'), i.crs(), QgsProject.instance())\n            bounds_crs = ct.transformBoundingBox(bounds)\n\n            if not bounds_crs.contains(i.extent()):\n                res = QgsValidityCheckResult()\n                res.type = QgsValidityCheckResult.Warning\n                res.title = 'Map projection is incorrect'\n                res.detailedDescription = 'The projection for the map item {} is set to \\'{}\\', which is not valid for the area displayed within the map.'.format(i.displayName(), i.crs().authid())\n                results.append(res)\n\n    return results\n</code></pre>"},{"location":"10-%E5%9C%B0%E5%9B%BE%E6%B8%B2%E6%9F%93%E5%92%8C%E6%89%93%E5%8D%B0/#1032","title":"10.3.2 \u200b\u5bfc\u51fa\u200b\u5e03\u5c40","text":"<p>\u200b\u5bfc\u51fa\u200b\u5e03\u5c40\u200b\uff0c\u200b\u5fc5\u987b\u200b\u4f7f\u7528\u200b<code>QgsLayoutExporter</code>\u200b\u7c7b\u200b\u3002</p> <pre><code>pdf_path = os.path.join(QgsProject.instance().homePath(), \"output.pdf\")\n\nexporter = QgsLayoutExporter(layout)\nexporter.exportToPdf(pdf_path, QgsLayoutExporter.PdfExportSettings())\n</code></pre> <p>\u200b\u5982\u679c\u200b\u8981\u200b\u5206\u522b\u200b\u5bfc\u51fa\u200b\u5230\u200bSVG\u200b\u6216\u200b\u56fe\u50cf\u6587\u4ef6\u200b\uff0c\u200b\u8bf7\u200b\u4f7f\u7528\u200b<code>exportToSvg()</code>\u200b\u6216\u8005\u200b<code>exportToImage()</code>\u200b\u5bfc\u51fa\u200b\u56fe\u50cf\u200b\u3002</p>"},{"location":"10-%E5%9C%B0%E5%9B%BE%E6%B8%B2%E6%9F%93%E5%92%8C%E6%89%93%E5%8D%B0/#1033","title":"10.3.3 \u200b\u5bfc\u51fa\u200b\u5e03\u5c40\u200b\u56fe\u96c6","text":"<p>\u200b\u5982\u679c\u200b\u8981\u200b\u4ece\u200b\u5e03\u5c40\u200b\u4e2d\u200b\u5bfc\u51fa\u200b\u6240\u6709\u200b\u9875\u9762\u200b\uff08\u200b\u5728\u200b\u914d\u7f6e\u200b\u4e2d\u200b\u542f\u7528\u200b\u4e86\u200b\u56fe\u96c6\u200b\u9009\u9879\u200b\uff09\uff0c\u200b\u5219\u200b\u9700\u8981\u200b\u5728\u200b\u5bfc\u51fa\u200b\u5668\u200b\uff08QgsLayoutExporter\uff09\u200b\u4e2d\u200b\u4f7f\u7528\u200baltas()\u200b\u65b9\u6cd5\u200b\uff0c\u200b\u5e76\u200b\u8fdb\u884c\u200b\u5c11\u91cf\u200b\u8c03\u6574\u200b\u3002\u200b\u5728\u200b\u4ee5\u4e0b\u200b\u793a\u4f8b\u200b\u4e2d\u200b\uff0c\u200b\u9875\u9762\u200b\u5bfc\u51fa\u200b\u4e3a\u200bPNG\u200b\u56fe\u50cf\u200b\uff1a</p> <pre><code>exporter.exportToImage(layout.atlas(), base_path, 'png', QgsLayoutExporter.ImageExportSettings())\n</code></pre> <p>\u200b\u8bf7\u200b\u6ce8\u610f\u200b\uff0c\u200b\u8f93\u51fa\u200b\u4fdd\u5b58\u200b\u5728\u200b\u57fa\u672c\u200b\u8def\u5f84\u200b\u6587\u4ef6\u5939\u200b\u4e2d\u200b\uff0c\u200b\u4f7f\u7528\u200b\u56fe\u96c6\u200b\u4e0a\u200b\u914d\u7f6e\u200b\u7684\u200b\u8f93\u51fa\u200b\u6587\u4ef6\u540d\u200b\u8868\u8fbe\u5f0f\u200b\u3002</p>"},{"location":"11-%E8%A1%A8%E8%BE%BE%E5%BC%8F%EF%BC%8C%E8%BF%87%E6%BB%A4%E5%92%8C%E8%AE%A1%E7%AE%97%E5%80%BC/","title":"11 \u200b\u8868\u8fbe\u5f0f\u200b\uff0c\u200b\u8fc7\u6ee4\u200b\u548c\u200b\u8ba1\u7b97\u200b\u503c","text":"<p>\u200b\u6b64\u200b\u9875\u9762\u200b\u4e0a\u200b\u7684\u200b\u4ee3\u7801\u6bb5\u200b\u9700\u8981\u200b\u5bfc\u5165\u200b\u4ee5\u4e0b\u200b\u6a21\u5757\u200b\uff1a</p> <pre><code>from qgis.core import (\n    edit,\n    QgsExpression,\n    QgsExpressionContext,\n    QgsFeature,\n    QgsFeatureRequest,\n    QgsField,\n    QgsFields,\n    QgsVectorLayer,\n    QgsPointXY,\n    QgsGeometry,\n    QgsProject,\n    QgsExpressionContextUtils\n)\n</code></pre> <p>QGIS\u200b\u652f\u6301\u200b\u89e3\u6790\u200b\u7c7b\u4f3c\u200bSQL\u200b\u7684\u200b\u8868\u8fbe\u5f0f\u200b\u3002\u200b\u4ec5\u200b\u652f\u6301\u200b\u4e00\u5c0f\u90e8\u5206\u200bSQL\u200b\u8bed\u6cd5\u200b\u3002\u200b\u8868\u8fbe\u5f0f\u200b\u53ef\u4ee5\u200b\u4f5c\u4e3a\u200b\u5e03\u5c14\u503c\u200b\uff08\u200b\u8fd4\u56de\u200bTrue\u200b\u6216\u200bFalse\uff09\u200b\u6216\u200b\u4f5c\u4e3a\u200b\u51fd\u6570\u200b\uff08\u200b\u8fd4\u56de\u200b\u6807\u91cf\u200b\u503c\u200b\uff09\u200b\u6765\u200b\u8ba1\u7b97\u200b\u3002\u200b\u6709\u5173\u200b\u53ef\u7528\u200b\u529f\u80fd\u200b\u7684\u200b\u5b8c\u6574\u200b\u5217\u8868\u200b\uff0c\u200b\u8bf7\u53c2\u9605\u200b\u201c\u200b\u7528\u6237\u624b\u518c\u200b\u201d\u200b\u4e2d\u200b\u7684\u200b\u201c \u200b\u8868\u8fbe\u5f0f\u200b\u201d\u3002</p> <p>\u200b\u652f\u6301\u200b\u4e09\u79cd\u200b\u57fa\u672c\u200b\u7c7b\u578b\u200b\uff1a</p> <ul> <li>\u200b\u6570\u5b57\u200b\u2014\u2014\u200b\u6574\u6570\u200b\u548c\u200b\u5c0f\u6570\u200b\uff0c\u200b\u4f8b\u5982\u200b<code>123</code>\uff0c<code>3.14</code></li> <li>\u200b\u5b57\u7b26\u4e32\u200b\u2014\u2014\u200b\u5b83\u4eec\u200b\u5fc5\u987b\u200b\u7528\u200b\u5355\u5f15\u53f7\u200b\u62ec\u200b\u8d77\u6765\u200b\uff1a <code>'hello world'</code></li> <li>\u200b\u5217\u200b\u5f15\u7528\u200b\u2014\u2014\u200b\u5728\u200b\u8bc4\u4f30\u200b\u65f6\u200b\uff0c\u200b\u5f15\u7528\u200b\u5c06\u200b\u66ff\u6362\u200b\u4e3a\u200b\u5b57\u200b\u6bb5\u200b\u7684\u200b\u5b9e\u9645\u200b\u503c\u200b\u3002\u200b\u540d\u79f0\u200b\u4e0d\u4f1a\u200b\u88ab\u200b\u8f6c\u4e49\u200b\u3002</li> </ul> <p>\u200b\u53ef\u4ee5\u200b\u4f7f\u7528\u200b\u4ee5\u4e0b\u200b\u64cd\u4f5c\u200b\uff1a</p> <ul> <li>\u200b\u7b97\u672f\u200b\u8fd0\u7b97\u7b26\u200b\uff1a<code>+</code>\uff0c<code>-</code>\uff0c<code>*</code>\uff0c<code>/</code>\uff0c<code>^</code></li> <li>\u200b\u62ec\u53f7\u200b\uff1a\u200b\u7528\u4e8e\u200b\u5f3a\u5236\u200b\u8fd0\u7b97\u7b26\u200b\u4f18\u5148\u7ea7\u200b\uff1a <code>(1 + 1) * 3</code></li> <li>\u200b\u4e00\u5143\u200b\u52a0\u51cf\u200b\uff1a<code>-12</code>\uff0c<code>+5</code></li> <li>\u200b\u6570\u5b66\u200b\u51fd\u6570\u200b\uff1a<code>sqrt</code>\uff0c<code>sin</code>\uff0c<code>cos</code>\uff0c<code>tan</code>\uff0c<code>asin</code>\uff0c <code>acos</code>\uff0c<code>atan</code></li> <li>\u200b\u8f6c\u6362\u200b\u51fd\u6570\u200b\uff1a<code>to_int</code>\uff0c<code>to_real</code>\uff0c<code>to_string</code>\uff0c<code>to_date</code></li> <li>\u200b\u51e0\u4f55\u200b\u51fd\u6570\u200b\uff1a<code>$area</code>\uff0c<code>$length</code></li> <li>\u200b\u51e0\u4f55\u200b\u5904\u7406\u51fd\u6570\u200b\uff1a<code>$x</code>\uff0c<code>$y</code>\uff0c<code>$geometry</code>\uff0c<code>num_geometries</code>\uff0c<code>centroid</code></li> </ul> <p>\u200b\u652f\u6301\u200b\u4ee5\u4e0b\u200b\u8fd0\u7b97\u200b\uff1a</p> <ul> <li>\u200b\u6bd4\u8f83\u200b\uff1a<code>=</code>\uff0c<code>!=</code>\uff0c<code>&gt;</code>\uff0c<code>&gt;=</code>\uff0c<code>&lt;</code>\uff0c<code>&lt;=</code></li> <li>\u200b\u6a21\u5f0f\u5339\u914d\u200b\uff1a<code>LIKE</code>\uff08\u200b\u4f7f\u7528\u200b\uff05\u200b\u548c\u200b_\uff09\uff0c<code>~</code>\uff08\u200b\u6b63\u5219\u8868\u8fbe\u5f0f\u200b\uff09</li> <li>\u200b\u903b\u8f91\u200b\u8c13\u8bcd\u200b\uff1a<code>AND</code>\uff0c<code>OR</code>\uff0c<code>NOT</code></li> <li>NULL\u200b\u503c\u200b\u68c0\u67e5\u200b\uff1a\uff0c<code>IS NULL</code>\uff0c<code>IS NOT NULL</code></li> </ul> <p>\u200b\u793a\u4f8b\u200b\uff1a</p> <ul> <li><code>1 + 2 = 3</code></li> <li><code>sin(angle) &gt; 0</code></li> <li><code>'Hello' LIKE 'He%'</code></li> <li><code>(x &gt; 10 AND y &gt; 10) OR z = 0</code></li> </ul> <p>\u200b\u6807\u91cf\u200b\u8868\u8fbe\u5f0f\u200b\u7684\u200b\u793a\u4f8b\u200b\uff1a</p> <ul> <li><code>2 ^ 10</code></li> <li><code>sqrt(val)</code></li> <li><code>$length + 1</code></li> </ul>"},{"location":"11-%E8%A1%A8%E8%BE%BE%E5%BC%8F%EF%BC%8C%E8%BF%87%E6%BB%A4%E5%92%8C%E8%AE%A1%E7%AE%97%E5%80%BC/#111","title":"11.1 \u200b\u89e3\u6790\u200b\u8868\u8fbe\u5f0f","text":"<p>\u200b\u4e0b\u9762\u200b\u7684\u200b\u4f8b\u5b50\u200b\u5c55\u793a\u200b\u4e86\u200b\u5982\u4f55\u200b\u68c0\u67e5\u200b\u4e00\u4e2a\u200b\u8868\u8fbe\u5f0f\u200b\u662f\u5426\u200b\u80fd\u200b\u88ab\u200b\u6b63\u786e\u200b\u89e3\u6790\u200b\uff1a</p> <pre><code>exp = QgsExpression('1 + 1 = 2')\nassert(not exp.hasParserError())\n\nexp = QgsExpression('1 + 1 = ')\nassert(exp.hasParserError())\n\nassert(exp.parserErrorString() == '\\nsyntax error, unexpected end of file')\n</code></pre>"},{"location":"11-%E8%A1%A8%E8%BE%BE%E5%BC%8F%EF%BC%8C%E8%BF%87%E6%BB%A4%E5%92%8C%E8%AE%A1%E7%AE%97%E5%80%BC/#112","title":"11.2 \u200b\u8bc4\u4f30\u200b\u8868\u8fbe\u5f0f","text":"<p>\u200b\u8868\u8fbe\u5f0f\u200b\u53ef\u4ee5\u200b\u5728\u200b\u4e0d\u540c\u200b\u7684\u200b\u60c5\u51b5\u200b\u4e0b\u200b\u4f7f\u7528\u200b\uff0c\u200b\u4f8b\u5982\u200b\u8fc7\u6ee4\u200b\u8981\u7d20\u200b\u6216\u200b\u8ba1\u7b97\u200b\u65b0\u200b\u7684\u200b\u5b57\u200b\u6bb5\u503c\u200b\u3002\u200b\u5728\u200b\u4efb\u4f55\u200b\u60c5\u51b5\u200b\u4e0b\u200b\uff0c\u200b\u8868\u8fbe\u5f0f\u200b\u90fd\u200b\u5fc5\u987b\u200b\u88ab\u200b\u8bc4\u4f30\u200b\u3002\u200b\u8fd9\u200b\u610f\u5473\u7740\u200b\u5b83\u200b\u7684\u200b\u503c\u200b\u662f\u200b\u901a\u8fc7\u200b\u6267\u884c\u200b\u6307\u5b9a\u200b\u7684\u200b\u8ba1\u7b97\u200b\u6b65\u9aa4\u200b\u8ba1\u7b97\u51fa\u6765\u200b\u7684\u200b\uff0c\u200b\u8ba1\u7b97\u200b\u6b65\u9aa4\u200b\u53ef\u4ee5\u200b\u4ece\u200b\u7b80\u5355\u200b\u7684\u200b\u7b97\u672f\u200b\u5230\u200b\u96c6\u5408\u200b\u8868\u8fbe\u5f0f\u200b\u3002</p>"},{"location":"11-%E8%A1%A8%E8%BE%BE%E5%BC%8F%EF%BC%8C%E8%BF%87%E6%BB%A4%E5%92%8C%E8%AE%A1%E7%AE%97%E5%80%BC/#1121","title":"11.2.1 \u200b\u57fa\u672c\u200b\u8868\u8fbe\u5f0f","text":"<p>\u200b\u6b64\u200b\u57fa\u672c\u200b\u8868\u8fbe\u5f0f\u200b\u4ee3\u8868\u200b\u4e00\u4e2a\u200b\u7b80\u5355\u200b\u7684\u200b\u7b97\u672f\u200b\u8fd0\u7b97\u200b\uff1a</p> <pre><code>exp = QgsExpression('2 * 3')\nprint(exp)\nprint(exp.evaluate())\n\n# &lt;QgsExpression: '2 * 3'&gt;\n# 6\n</code></pre> <p>\u200b\u8868\u8fbe\u5f0f\u200b\u4e5f\u200b\u53ef\u200b\u7528\u4e8e\u200b\u6bd4\u8f83\u200b\uff0c1\u200b\u4e3a\u200b\u771f\u200b\uff0c0\u200b\u4e3a\u200b\u5047\u200b</p> <pre><code>exp = QgsExpression('1 + 1 = 2')\nexp.evaluate()\n\n# 1\n</code></pre>"},{"location":"11-%E8%A1%A8%E8%BE%BE%E5%BC%8F%EF%BC%8C%E8%BF%87%E6%BB%A4%E5%92%8C%E8%AE%A1%E7%AE%97%E5%80%BC/#1122","title":"11.2.2 \u200b\u8981\u7d20\u200b\u8868\u8fbe\u5f0f","text":"<p>\u200b\u8981\u200b\u5bf9\u200b\u4e00\u4e2a\u200b\u8981\u7d20\u200b\u8fdb\u884c\u200b\u8868\u8fbe\u5f0f\u200b\u8bc4\u4f30\u200b\uff0c\u200b\u5fc5\u987b\u200b\u521b\u5efa\u200b\u4e00\u4e2a\u200b<code>QgsExpressionContext</code>\u200b\u5bf9\u8c61\u200b\uff0c\u200b\u5e76\u200b\u5c06\u200b\u5176\u200b\u4f20\u9012\u200b\u7ed9\u200b<code>evaluation</code>\u200b\u51fd\u6570\u200b\uff0c\u200b\u4ee5\u200b\u5141\u8bb8\u200b\u8868\u8fbe\u5f0f\u200b\u8bbf\u95ee\u200b\u8be5\u200b\u8981\u7d20\u200b\u7684\u200b\u5b57\u200b\u6bb5\u503c\u200b\u3002</p> <p>\u200b\u4e0b\u9762\u200b\u7684\u200b\u793a\u4f8b\u200b\u5c55\u793a\u200b\u4e86\u200b\u5982\u4f55\u200b\u521b\u5efa\u200b\u4e00\u4e2a\u200b\u540d\u4e3a\u200b \"Column \"\u200b\u5b57\u6bb5\u200b\u7684\u200b\u8981\u7d20\u200b\uff0c\u200b\u4ee5\u53ca\u200b\u5982\u4f55\u200b\u5c06\u200b\u8be5\u200b\u8981\u7d20\u200b\u6dfb\u52a0\u200b\u5230\u200b\u8868\u8fbe\u5f0f\u200b\u4e0a\u4e0b\u6587\u200b\u4e2d\u200b\u3002</p> <pre><code>fields = QgsFields()\nfield = QgsField('Column')\nfields.append(field)\nfeature = QgsFeature()\nfeature.setFields(fields)\nfeature.setAttribute(0, 99)\n\nexp = QgsExpression('\"Column\"')\ncontext = QgsExpressionContext()\ncontext.setFeature(feature)\nexp.evaluate(context)\n# 99\n</code></pre> <p>\u200b\u4e0b\u9762\u200b\u662f\u200b\u4e00\u4e2a\u200b\u6bd4\u8f83\u200b\u5b8c\u6574\u200b\u7684\u200b\u4f8b\u5b50\u200b\uff0c\u200b\u8bf4\u660e\u200b\u5982\u4f55\u200b\u5728\u200b\u77e2\u91cf\u56fe\u200b\u5c42\u200b\u7684\u200b\u4e0a\u4e0b\u6587\u200b\u4e2d\u200b\u4f7f\u7528\u200b\u8868\u8fbe\u5f0f\u200b\uff0c\u200b\u4ee5\u200b\u8ba1\u7b97\u200b\u65b0\u200b\u7684\u200b\u5b57\u200b\u6bb5\u503c\u200b\uff1a</p> <pre><code>from qgis.PyQt.QtCore import QMetaType\n\n# \u200b\u521b\u5efa\u200b\u77e2\u91cf\u56fe\u200b\u5c42\u200b\nvl = QgsVectorLayer(\"Point\", \"Companies\", \"memory\")\npr = vl.dataProvider()\npr.addAttributes([QgsField(\"Name\", QMetaType.Type.QString),\n                  QgsField(\"Employees\",  QMetaType.Type.Int),\n                  QgsField(\"Revenue\", QMetaType.Type.Double),\n                  QgsField(\"Rev. per employee\", QMetaType.Type.Double),\n                  QgsField(\"Sum\", QMetaType.Type.Double),\n                  QgsField(\"Fun\", QMetaType.Type.Double)])\nvl.updateFields()\n\n# \u200b\u5c06\u200b\u6570\u636e\u200b\u6dfb\u52a0\u200b\u5230\u200b\u524d\u200b\u4e09\u4e2a\u200b\u5b57\u200b\u6bb5\u200b\nmy_data = [\n    {'x': 0, 'y': 0, 'name': 'ABC', 'emp': 10, 'rev': 100.1},\n    {'x': 1, 'y': 1, 'name': 'DEF', 'emp': 2, 'rev': 50.5},\n    {'x': 5, 'y': 5, 'name': 'GHI', 'emp': 100, 'rev': 725.9}]\n\nfor rec in my_data:\n    f = QgsFeature()\n    pt = QgsPointXY(rec['x'], rec['y'])\n    f.setGeometry(QgsGeometry.fromPointXY(pt))\n    f.setAttributes([rec['name'], rec['emp'], rec['rev']])\n    pr.addFeature(f)\n\nvl.updateExtents()\nQgsProject.instance().addMapLayer(vl)\n\n# \u200b\u7b2c\u4e00\u4e2a\u200b\u8868\u8fbe\u5f0f\u200b\u8ba1\u7b97\u200b\u6bcf\u4e2a\u200b\u5458\u5de5\u200b\u7684\u200b\u6536\u5165\u200b\n# \u200b\u7b2c\u4e8c\u4e2a\u200b\u8ba1\u7b97\u200b\u56fe\u5c42\u200b\u4e2d\u200b\u6240\u6709\u200b\u6536\u5165\u200b\u503c\u200b\u7684\u200b\u603b\u548c\u200b\u3002\n# \u200b\u7b2c\u4e09\u4e2a\u200b\u8868\u8fbe\u5f0f\u200b\u5e76\u200b\u6ca1\u6709\u200b\u4ec0\u4e48\u200b\u610f\u4e49\u200b\uff0c\u200b\u4f46\u662f\u200b\u8bf4\u660e\u200b\u4e86\u200b\u6211\u4eec\u200b\u53ef\u4ee5\u200b\u5728\u200b\u8868\u8fbe\u5f0f\u200b\u4e2d\u200b\u4f7f\u7528\u200b\u5404\u79cd\u200b\u8868\u8fbe\u5f0f\u200b\u51fd\u6570\u200b\uff08\u200b\u4f8b\u5982\u200barea\u200b\u548c\u200bbuffer\uff09\uff1a\nexpression1 = QgsExpression('\"Revenue\"/\"Employees\"')\nexpression2 = QgsExpression('sum(\"Revenue\")')\nexpression3 = QgsExpression('area(buffer($geometry,\"Employees\"))')\n\n# QgsExpressionContextUtils.globalProjectLayerScopes()\u200b\u662f\u200b\u4e00\u4e2a\u200b\u65b9\u4fbf\u200b\u51fd\u6570\u200b\uff0c\u200b\u53ef\u200b\u4e00\u6b21\u200b\u6dfb\u52a0\u200b\u5168\u5c40\u200b\uff0c\u200b\u9879\u76ee\u200b\u548c\u200b\u56fe\u5c42\u200b\u8303\u56f4\u200b\u3002\u200b\u53e6\u5916\u200b\uff0c\u200b\u8fd9\u4e9b\u200b\u8303\u56f4\u200b\u4e5f\u200b\u53ef\u4ee5\u200b\u624b\u52a8\u200b\u6dfb\u52a0\u200b\u3002\u200b\u65e0\u8bba\u5982\u4f55\u200b\uff0c\u200b\u91cd\u8981\u200b\u7684\u200b\u662f\u200b\u59cb\u7ec8\u200b\u4ece\u200b\u201c\u200b\u6700\u200b\u901a\u7528\u200b\u201d\u200b\u5230\u200b\u201c\u200b\u6700\u200b\u5177\u4f53\u200b\u201d\u200b\u7684\u200b\u8303\u56f4\u200b\uff0c\u200b\u5373\u200b\u4ece\u200b\u5168\u5c40\u200b\u5230\u200b\u9879\u76ee\u200b\u518d\u200b\u5230\u200b\u56fe\u5c42\u200b\ncontext = QgsExpressionContext()\ncontext.appendScopes(QgsExpressionContextUtils.globalProjectLayerScopes(vl))\n\nwith edit(vl):\n    for f in vl.getFeatures():\n        context.setFeature(f)\n        f['Rev. per employee'] = expression1.evaluate(context)\n        f['Sum'] = expression2.evaluate(context)\n        f['Fun'] = expression3.evaluate(context)\n        vl.updateFeature(f)\n\nprint( f['Sum'])\n\n# 876.5\n</code></pre>"},{"location":"11-%E8%A1%A8%E8%BE%BE%E5%BC%8F%EF%BC%8C%E8%BF%87%E6%BB%A4%E5%92%8C%E8%AE%A1%E7%AE%97%E5%80%BC/#1123","title":"11.2.3 \u200b\u8868\u8fbe\u5f0f\u200b\u8fc7\u6ee4\u200b\u56fe\u5c42","text":"<p>\u200b\u4ee5\u4e0b\u200b\u793a\u4f8b\u200b\u53ef\u200b\u7528\u4e8e\u200b\u8fc7\u6ee4\u200b\u56fe\u5c42\u200b\u5e76\u200b\u8fd4\u56de\u200b\u4e0e\u200b\u8c13\u8bcd\u200b\u5339\u914d\u200b\u7684\u200b\u6240\u6709\u200b\u8981\u7d20\u200b\uff1a</p> <pre><code>layer = QgsVectorLayer(\"Point?field=Test:integer\",\n                           \"addfeat\", \"memory\")\n\nlayer.startEditing()\n\nfor i in range(10):\n    feature = QgsFeature()\n    feature.setAttributes([i])\n    assert(layer.addFeature(feature))\nlayer.commitChanges()\n\nexpression = 'Test &gt;= 3'\nrequest = QgsFeatureRequest().setFilterExpression(expression)\n\nmatches = 0\nfor f in layer.getFeatures(request):\n   matches += 1\n\nprint(matches)\n\n# 7\n</code></pre>"},{"location":"11-%E8%A1%A8%E8%BE%BE%E5%BC%8F%EF%BC%8C%E8%BF%87%E6%BB%A4%E5%92%8C%E8%AE%A1%E7%AE%97%E5%80%BC/#113","title":"11.3 \u200b\u5904\u7406\u200b\u5f02\u5e38\u200b\u9519\u8bef","text":"<p>\u200b\u5728\u200b\u8868\u8fbe\u5f0f\u200b\u89e3\u6790\u200b\u6216\u200b\u8bc4\u4f30\u200b\u671f\u95f4\u200b\uff0c\u200b\u53ef\u80fd\u200b\u53d1\u751f\u200b\u8868\u8fbe\u200b\u76f8\u5173\u200b\u7684\u200b\u9519\u8bef\u200b\uff1a</p> <pre><code>exp = QgsExpression(\"1 + 1 = 2 \")\nif exp.hasParserError():\n   raise Exception(exp.parserErrorString())\n\nvalue = exp.evaluate()\nif exp.hasEvalError():\n   raise ValueError(exp.evalErrorString())\n</code></pre>"},{"location":"12-%E8%AF%BB%E5%8F%96%E5%92%8C%E5%AD%98%E5%82%A8%E8%AE%BE%E7%BD%AE/","title":"12 \u200b\u8bfb\u53d6\u200b\u548c\u200b\u5b58\u50a8\u200b\u8bbe\u7f6e","text":"<p>\u200b\u6b64\u9875\u200b\u4e0a\u200b\u7684\u200b\u4ee3\u7801\u6bb5\u200b\u9700\u8981\u200b\u5bfc\u5165\u200b\u4ee5\u4e0b\u200b\u6a21\u5757\u200b\uff1a</p> <pre><code>from qgis.core import (\n  QgsProject,\n  QgsSettings,\n  QgsVectorLayer\n)\n</code></pre> <p>\u200b\u5f88\u591a\u200b\u65f6\u5019\u200b\uff0c\u200b\u63d2\u4ef6\u200b\u4fdd\u5b58\u200b\u4e00\u4e9b\u200b\u53d8\u91cf\u200b\u975e\u5e38\u200b\u6709\u7528\u200b\uff0c\u200b\u8fd9\u6837\u200b\u7528\u6237\u200b\u4e0b\u6b21\u200b\u8fd0\u884c\u200b\u63d2\u4ef6\u200b\u65f6\u200b\u5c31\u200b\u4e0d\u5fc5\u200b\u518d\u200b\u8f93\u5165\u200b\u6216\u200b\u9009\u62e9\u200b\u5b83\u4eec\u200b\u3002</p> <p>\u200b\u501f\u52a9\u200bQt\u200b\u548c\u200bQGIS API\u200b\u53ef\u4ee5\u200b\u4fdd\u5b58\u200b\u548c\u200b\u68c0\u7d22\u200b\u8fd9\u4e9b\u200b\u53d8\u91cf\u200b\u3002\u200b\u5bf9\u4e8e\u200b\u6bcf\u4e2a\u200b\u53d8\u91cf\u200b\uff0c\u200b\u4f60\u200b\u5e94\u8be5\u200b\u9009\u62e9\u200b\u4e00\u4e2a\u200b\u7528\u4e8e\u200b\u8bbf\u95ee\u200b\u53d8\u91cf\u200b\u7684\u200b\u952e\u200b\u2014\u2014\u200b\u5bf9\u4e8e\u200b\u7528\u6237\u200b\u559c\u6b22\u200b\u7684\u200b\u989c\u8272\u200b\uff0c\u200b\u4f60\u200b\u53ef\u4ee5\u200b\u4f7f\u7528\u200b\u952e\u200b\u201cfavourite_color\u201d\u200b\u6216\u200b\u4efb\u4f55\u200b\u5176\u4ed6\u200b\u6709\u200b\u610f\u4e49\u200b\u7684\u200b\u5b57\u7b26\u4e32\u200b\u3002\u200b\u5efa\u8bae\u200b\u4e3a\u952e\u200b\u7684\u200b\u547d\u540d\u200b\u63d0\u4f9b\u200b\u4e00\u4e9b\u200b\u7ed3\u6784\u200b\u3002</p> <p>\u200b\u6211\u4eec\u200b\u53ef\u4ee5\u200b\u533a\u5206\u200b\u51e0\u79cd\u200b\u7c7b\u578b\u200b\u7684\u200b\u8bbe\u7f6e\u200b\uff1a</p> <ul> <li>\u200b\u5168\u5c40\u200b\u8bbe\u7f6e\u200b\uff1a \u200b\u5b83\u4eec\u200b\u7ed1\u5b9a\u200b\u5230\u200b\u7279\u5b9a\u200b\u8ba1\u7b97\u673a\u200b\u4e0a\u200b\u7684\u200b\u7528\u6237\u200b\u3002QGIS\u200b\u672c\u8eab\u200b\u5b58\u50a8\u200b\u4e86\u200b\u8bb8\u591a\u200b\u5168\u5c40\u200b\u8bbe\u7f6e\u200b\uff0c\u200b\u4f8b\u5982\u200b\uff0c\u200b\u4e3b\u200b\u7a97\u53e3\u200b\u5927\u5c0f\u200b\u6216\u200b\u9ed8\u8ba4\u200b\u6355\u6349\u200b\u5bb9\u5dee\u200b\u3002\u200b\u4f7f\u7528\u200b<code>QgsSettings</code>\u200b\u7c7b\u200b\u5904\u7406\u200b\u8bbe\u7f6e\u200b\uff0c\u200b\u8be5\u7c7b\u200b\u63d0\u4f9b\u200b<code>setValue()</code>\u200b\u548c\u200b<code>value()</code>\u200b\u65b9\u6cd5\u200b</li> </ul> <p>\u200b\u5728\u200b\u8fd9\u91cc\u200b\uff0c\u200b\u4f60\u200b\u53ef\u4ee5\u200b\u770b\u5230\u200b\u5982\u4f55\u200b\u4f7f\u7528\u200b\u8fd9\u4e9b\u200b\u65b9\u6cd5\u200b\u7684\u200b\u793a\u4f8b\u200b\uff1a</p> <pre><code>def store():\n    s = QgsSettings()\n    s.setValue(\"myplugin/mytext\", \"hello world\")\n    s.setValue(\"myplugin/myint\",  10)\n    s.setValue(\"myplugin/myreal\", 3.14)\n\ndef read():\n    s = QgsSettings()\n    mytext = s.value(\"myplugin/mytext\", \"default text\")\n    myint  = s.value(\"myplugin/myint\", 123)\n    myreal = s.value(\"myplugin/myreal\", 2.71)\n    nonexistent = s.value(\"myplugin/nonexistent\", None)\n    print(mytext)\n    print(myint)\n    print(myreal)\n    print(nonexistent)\n</code></pre> <p><code>value()</code>\u200b\u65b9\u6cd5\u200b\u7684\u200b\u7b2c\u4e8c\u4e2a\u200b\u53c2\u6570\u200b\u662f\u200b\u53ef\u9009\u200b\u7684\u200b\uff0c\u200b\u5982\u679c\u200b\u6ca1\u6709\u200b\uff0c\u200b\u5219\u200b\u8fd4\u56de\u200b\u9ed8\u8ba4\u503c\u200b\u3002</p> <p>\u200b\u901a\u8fc7\u200b<code>qgis_global_settings.ini</code>\u200b\u6587\u4ef6\u200b\u5728\u200b\u5168\u5c40\u200b\u8bbe\u7f6e\u200b\u4e2d\u9884\u200b\u914d\u7f6e\u200b\u9ed8\u8ba4\u503c\u200b\uff0c\u200b\u66f4\u200b\u591a\u200b\u8be6\u60c5\u200b\u67e5\u770b\u200bDeploying QGIS within an organization</p> <ul> <li>\u200b\u9879\u76ee\u200b\u8bbe\u7f6e\u200b\uff1a \u200b\u5728\u200b\u4e0d\u540c\u200b\u9879\u76ee\u200b\u4e4b\u95f4\u200b\u6709\u6240\u4e0d\u540c\u200b\uff0c\u200b\u56e0\u6b64\u200b\u5b83\u4eec\u200b\u4e0e\u200b\u9879\u76ee\u200b\u6587\u4ef6\u200b\u76f8\u5173\u8054\u200b\u3002\u200b\u4ee5\u200b\u5730\u56fe\u200b\u753b\u5e03\u200b\u80cc\u666f\u200b\u989c\u8272\u200b\u6216\u200b\u76ee\u6807\u200b\u5750\u6807\u200b\u53c2\u8003\u200b\u7cfb\u7edf\u200b\uff08CRS\uff09\u200b\u4f5c\u4e3a\u200b\u4f8b\u5b50\u200b\u2014\u2014\u200b\u767d\u8272\u200b\u80cc\u666f\u200b\u548c\u200bWGS84\u200b\u53ef\u80fd\u200b\u9002\u7528\u200b\u4e8e\u200b\u4e00\u4e2a\u200b\u9879\u76ee\u200b\uff0c\u200b\u800c\u200b\u9ec4\u8272\u200b\u80cc\u666f\u200b\u548c\u200bUTM\u200b\u6295\u5f71\u200b\u9002\u7528\u200b\u4e8e\u200b\u53e6\u200b\u4e00\u4e2a\u200b\u9879\u76ee\u200b\u3002</li> </ul> <p>\u200b\u4ee5\u4e0b\u200b\u662f\u200b\u4e00\u4e2a\u200b\u7528\u6cd5\u200b\u793a\u4f8b\u200b\uff1a</p> <p><pre><code>proj = QgsProject.instance()\n\n# \u200b\u5b58\u50a8\u200b\u503c\u200b\nproj.writeEntry(\"myplugin\", \"mytext\", \"hello world\")\nproj.writeEntry(\"myplugin\", \"myint\", 10)\nproj.writeEntry(\"myplugin\", \"mydouble\", 0.01)\nproj.writeEntry(\"myplugin\", \"mybool\", True)\n\n# \u200b\u8bfb\u200b\u53d6\u503c\u200b\uff08\u200b\u8fd4\u56de\u200b\u5177\u6709\u200b\u503c\u200b\u7684\u200b\u5143\u7ec4\u200b\uff0c\u200b\u548c\u200b\u4e00\u4e2a\u200b\u5e03\u5c14\u200b\u72b6\u6001\u200b\uff0c\u200b\u68c0\u7d22\u200b\u5230\u200b\u7684\u200b\u503c\u200b\u662f\u5426\u200b\u53ef\u4ee5\u200b\u8f6c\u6362\u200b\u5230\u200b\u5b83\u200b\u7684\u200b\u7c7b\u578b\u200b\uff0c string, an integer, a double and a boolean\uff09\nmytext, type_conversion_ok = proj.readEntry(\"myplugin\", \"mytext\", \"default text\")\nmyint, type_conversion_ok = proj.readNumEntry(\"myplugin\", \"myint\", 123)\nmydouble, type_conversion_ok = proj.readDoubleEntry(\"myplugin\", \"mydouble\", 123)\nmybool, type_conversion_ok = proj.readBoolEntry(\"myplugin\", \"mybool\", 123)\n</code></pre>   \u200b\u5982\u200b\u4f60\u200b\u6240\u89c1\u200b\uff0c<code>writeEntry()</code>\u200b\u65b9\u6cd5\u200b\u7528\u4e8e\u200b\u8bb8\u591a\u200b\u6570\u636e\u7c7b\u578b\u200b(integer, string, list)\uff0c\u200b\u4f46\u200b\u6709\u200b\u51e0\u79cd\u200b\u65b9\u6cd5\u200b\u53ef\u4ee5\u200b\u8bfb\u53d6\u200b\u8bbe\u7f6e\u200b\u503c\u200b\uff0c\u200b\u800c\u4e14\u200b\u5fc5\u987b\u200b\u4e3a\u200b\u6bcf\u79cd\u200b\u6570\u636e\u7c7b\u578b\u200b\u9009\u62e9\u200b\u76f8\u5e94\u200b\u7684\u200b\u4e00\u4e2a\u200b\u3002</p> <ul> <li>\u200b\u5730\u56fe\u200b\u56fe\u5c42\u200b\u8bbe\u7f6e\u200b\uff1a\u200b\u8fd9\u4e9b\u200b\u8bbe\u7f6e\u200b\u4e0e\u200b\u9879\u76ee\u200b\u7684\u200b\u56fe\u5c42\u200b\u5b9e\u4f8b\u200b\u76f8\u5173\u200b\u3002\u200b\u5b83\u4eec\u200b\u4e0d\u200b\u4e0e\u200b\u56fe\u5c42\u200b\u7684\u200b\u57fa\u7840\u200b\u6570\u636e\u6e90\u200b\u8fde\u63a5\u200b\uff0c\u200b\u56e0\u6b64\u200b\u5982\u679c\u200b\u4f60\u200b\u521b\u5efa\u200b\u4e24\u4e2a\u200bshapefile\u200b\u56fe\u5c42\u200b\u5b9e\u4f8b\u200b\uff0c\u200b\u5219\u200b\u5b83\u4eec\u200b\u4e0d\u4f1a\u200b\u5171\u4eab\u200b\u8bbe\u7f6e\u200b\u3002\u200b\u8bbe\u7f6e\u200b\u5b58\u50a8\u200b\u5728\u200b\u9879\u76ee\u200b\u6587\u4ef6\u200b\u4e2d\u200b\uff0c\u200b\u56e0\u6b64\u200b\u5982\u679c\u200b\u7528\u6237\u200b\u518d\u6b21\u200b\u6253\u5f00\u200b\u9879\u76ee\u200b\uff0c\u200b\u5219\u200b\u4e0e\u200b\u56fe\u5c42\u200b\u76f8\u5173\u200b\u7684\u200b\u8bbe\u7f6e\u200b\u5c06\u200b\u518d\u6b21\u200b\u5b58\u5728\u200b\u3002\u200b\u4f7f\u7528\u200b<code>customProperty()</code>\u200b\u65b9\u6cd5\u200b\u68c0\u7d22\u200b\u7ed9\u5b9a\u200b\u8bbe\u7f6e\u200b\u7684\u200b\u503c\u200b\uff0c\u200b\u5e76\u200b\u53ef\u200b\u4f7f\u7528\u200b<code>setCustomProperty()</code>\u200b\u8fdb\u884c\u200b\u8bbe\u7f6e\u200b\u3002</li> </ul> <pre><code>vlayer = QgsVectorLayer()\n# \u200b\u4fdd\u5b58\u200b\u503c\u200b\nvlayer.setCustomProperty(\"mytext\", \"hello world\")\n\n# \u200b\u518d\u6b21\u200b\u8bfb\u53d6\u200b\uff08\u200b\u5982\u679c\u200b\u6ca1\u6709\u200b\u627e\u5230\u200b\uff0c\u200b\u5219\u200b\u8fd4\u56de\u200b\u201cdefault text\u201d\uff09\nmytext = vlayer.customProperty(\"mytext\", \"default text\")\n</code></pre>"},{"location":"13-%E4%B8%8E%E7%94%A8%E6%88%B7%E9%80%9A%E4%BF%A1/","title":"13 \u200b\u4e0e\u200b\u7528\u6237\u200b\u901a\u4fe1","text":"<p>\u200b\u672c\u200b\u8282\u200b\u4ee3\u7801\u200b\u7247\u6bb5\u200b\u9700\u200b\u5bfc\u5165\u200b\u4ee5\u4e0b\u200b\u6a21\u5757\u200b\uff1a</p> <pre><code>from qgis.core import (\n    QgsMessageLog,\n    QgsGeometry,\n)\n\nfrom qgis.gui import (\n    QgsMessageBar,\n)\n\nfrom qgis.PyQt.QtWidgets import (\n    QSizePolicy,\n    QPushButton,\n    QDialog,\n    QGridLayout,\n    QDialogButtonBox,\n)\n</code></pre> <p>\u200b\u672c\u200b\u8282\u200b\u4ecb\u7ecd\u200b\u7528\u4e8e\u200b\u4e0e\u200b\u7528\u6237\u200b\u901a\u4fe1\u200b\u7684\u200b\u4e00\u4e9b\u200b\u65b9\u6cd5\u200b\u548c\u200b\u5143\u7d20\u200b\uff0c\u200b\u4ee5\u200b\u4fdd\u6301\u200b\u7528\u6237\u200b\u63a5\u53e3\u200b\u7684\u200b\u4e00\u81f4\u6027\u200b\u3002  </p>"},{"location":"13-%E4%B8%8E%E7%94%A8%E6%88%B7%E9%80%9A%E4%BF%A1/#131-qgsmessagebar","title":"13.1 \u200b\u663e\u793a\u200b\u6d88\u606f\u200b\u2014\u2014QgsMessageBar","text":"<p>\u200b\u4ece\u200b\u7528\u6237\u200b\u4f53\u9a8c\u200b\u7684\u200b\u89d2\u5ea6\u200b\u6765\u770b\u200b\uff0c\u200b\u4f7f\u7528\u200b\u6d88\u606f\u200b\u6846\u200b\u53ef\u80fd\u200b\u662f\u200b\u4e2a\u200b\u574f\u4e3b\u610f\u200b\u3002\u200b\u4e3a\u4e86\u200b\u663e\u793a\u200b\u4e00\u5c0f\u200b\u884c\u200b\u4fe1\u606f\u200b\u6216\u200b\u8b66\u544a\u200b/\u200b\u9519\u8bef\u200b\u6d88\u606f\u200b\uff0cQGIS\u200b\u6d88\u606f\u200b\u680f\u200b\u901a\u5e38\u200b\u662f\u200b\u66f4\u597d\u200b\u7684\u200b\u9009\u62e9\u200b\u3002</p> <p>\u200b\u4f7f\u7528\u200bQGIS\u200b\u63a5\u53e3\u200b\u5bf9\u8c61\u200b\u7684\u200b\u5f15\u7528\u200b\uff0c\u200b\u4f60\u200b\u53ef\u4ee5\u200b\u4f7f\u7528\u200b\u4ee5\u4e0b\u200b\u4ee3\u7801\u200b\u5728\u200b\u6d88\u606f\u200b\u680f\u4e2d\u200b\u663e\u793a\u200b\u6d88\u606f\u200b</p> <pre><code>from qgis.core import Qgis\niface.messageBar().pushMessage(\"Error\", \"I'm sorry Dave, I'm afraid I can't do that\", level=Qgis.Critical)\n</code></pre> <p></p> QGIS\u200b\u6d88\u606f\u200b\u680f\u200b <p>\u200b\u4f60\u200b\u53ef\u4ee5\u200b\u8bbe\u7f6e\u200b\u6301\u7eed\u65f6\u95f4\u200b\uff0c\u200b\u5728\u200b\u6709\u9650\u200b\u65f6\u95f4\u200b\u5185\u200b\u663e\u793a\u200b\u5b83\u200b</p> <pre><code>iface.messageBar().pushMessage(\"Ooops\", \"The plugin is not working as it should\", level=Qgis.Critical, duration=3)\n</code></pre> <p></p> \u200b\u5e26\u200b\u5b9a\u65f6\u5668\u200b\u7684\u200bQGIS\u200b\u6d88\u606f\u200b\u680f\u200b <p>\u200b\u4e0a\u9762\u200b\u7684\u200b\u793a\u4f8b\u200b\u663e\u793a\u200b\u4e86\u200b\u9519\u8bef\u200b\u680f\u200b\uff0c\u200b\u4f46\u200b<code>level</code>\u200b\u53c2\u6570\u200b\u53ef\u200b\u7528\u4e8e\u200b\u521b\u5efa\u200b\u8b66\u544a\u200b\u6d88\u606f\u200b\u6216\u200b\u6b63\u5e38\u200b\u6d88\u606f\u200b\u2014\u2014\u200b\u4f7f\u7528\u200b<code>Qgis.MessageLevel</code>\u200b\u679a\u4e3e\u200b\uff0c\u200b\u4f60\u200b\u6700\u200b\u591a\u200b\u53ef\u4ee5\u200b\u4f7f\u7528\u200b4\u200b\u4e2a\u200b\u4e0d\u540c\u200b\u7ea7\u522b\u200b\uff1a</p> <ol> <li> <p>Info</p> </li> <li> <p>Warning</p> </li> <li>Critical</li> <li>Success</li> </ol> <p></p> QGIS\u200b\u6d88\u606f\u200b\u680f\u200b\uff08info\uff09 <p>\u200b\u63a7\u4ef6\u200b\u53ef\u4ee5\u200b\u6dfb\u52a0\u200b\u5230\u200b\u6d88\u606f\u200b\u680f\u4e2d\u200b\uff0c\u200b\u4f8b\u5982\u200b\u7528\u4e8e\u200b\u663e\u793a\u200b\u66f4\u200b\u591a\u200b\u4fe1\u606f\u200b\u7684\u200b\u6309\u94ae\u200b</p> <pre><code>def showError():\n    pass\n\nwidget = iface.messageBar().createMessage(\"Missing Layers\", \"Show Me\")\nbutton = QPushButton(widget)\nbutton.setText(\"Show Me\")\nbutton.pressed.connect(showError)\nwidget.layout().addWidget(button)\niface.messageBar().pushWidget(widget, Qgis.Warning)\n</code></pre> <p></p> \u200b\u5e26\u6709\u200b\u6309\u94ae\u200b\u7684\u200bQGIS\u200b\u6d88\u606f\u200b\u680f\u200b <p>\u200b\u4f60\u200b\u751a\u81f3\u200b\u53ef\u4ee5\u200b\u5728\u200b\u81ea\u5df1\u200b\u7684\u200b\u5bf9\u8bdd\u6846\u200b\u4e2d\u200b\u4f7f\u7528\u200b\u6d88\u606f\u200b\u680f\u200b\uff0c\u200b\u8fd9\u6837\u200b\u5c31\u200b\u4e0d\u5fc5\u200b\u663e\u793a\u200b\u6d88\u606f\u200b\u6846\u200b\uff0c\u200b\u6216\u8005\u200b\u5728\u200b\u4e3b\u200bQGIS\u200b\u7a97\u53e3\u200b\u4e2d\u200b\u663e\u793a\u200b\u6d88\u606f\u200b\u65f6\u200b\u6ca1\u6709\u200b\u610f\u4e49\u200b</p> <pre><code>class MyDialog(QDialog):\n    def __init__(self):\n        QDialog.__init__(self)\n        self.bar = QgsMessageBar()\n        self.bar.setSizePolicy( QSizePolicy.Minimum, QSizePolicy.Fixed )\n        self.setLayout(QGridLayout())\n        self.layout().setContentsMargins(0, 0, 0, 0)\n        self.buttonbox = QDialogButtonBox(QDialogButtonBox.Ok)\n        self.buttonbox.accepted.connect(self.run)\n        self.layout().addWidget(self.buttonbox, 0, 0, 2, 1)\n        self.layout().addWidget(self.bar, 0, 0, 1, 1)\n    def run(self):\n        self.bar.pushMessage(\"Hello\", \"World\", level=Qgis.Info)\n\nmyDlg = MyDialog()\nmyDlg.show()\n</code></pre> <p></p> \u200b\u81ea\u5b9a\u4e49\u200b\u5bf9\u8bdd\u6846\u200b\u4e2d\u200b\u7684\u200bQGIS\u200b\u6d88\u606f\u200b\u680f"},{"location":"13-%E4%B8%8E%E7%94%A8%E6%88%B7%E9%80%9A%E4%BF%A1/#132","title":"13.2 \u200b\u663e\u793a\u200b\u8fdb\u5ea6\u6761","text":"<p>\u200b\u8fdb\u5ea6\u6761\u200b\u4e5f\u200b\u53ef\u4ee5\u200b\u653e\u5728\u200bQGIS\u200b\u6d88\u606f\u200b\u680f\u4e2d\u200b\uff0c\u200b\u6b63\u5982\u200b\u6211\u4eec\u200b\u6240\u200b\u89c1\u200b\uff0c\u200b\u5b83\u200b\u63a5\u53d7\u200b\u63a7\u4ef6\u200b\u3002\u200b\u4ee5\u4e0b\u200b\u662f\u200b\u4f60\u200b\u53ef\u4ee5\u200b\u5728\u200b\u63a7\u5236\u53f0\u200b\u4e2d\u200b\u5c1d\u8bd5\u200b\u7684\u200b\u793a\u4f8b\u200b\uff1a</p> <pre><code>import time\nfrom qgis.PyQt.QtWidgets import QProgressBar\nfrom qgis.PyQt.QtCore import *\nprogressMessageBar = iface.messageBar().createMessage(\"Doing something boring...\")\nprogress = QProgressBar()\nprogress.setMaximum(10)\nprogress.setAlignment(Qt.AlignLeft|Qt.AlignVCenter)\nprogressMessageBar.layout().addWidget(progress)\niface.messageBar().pushWidget(progressMessageBar, Qgis.Info)\n\nfor i in range(10):\n    time.sleep(1)\n    progress.setValue(i + 1)\n\niface.messageBar().clearWidgets()\n</code></pre> <p>\u200b\u6b64\u5916\u200b\uff0c\u200b\u4f60\u200b\u53ef\u4ee5\u200b\u4f7f\u7528\u200b\u5185\u7f6e\u200b\u72b6\u6001\u680f\u200b\u62a5\u544a\u200b\u8fdb\u5ea6\u200b\uff0c\u200b\u5982\u4e0b\u200b\u793a\u4f8b\u200b\u6240\u793a\u200b\uff1a</p> <pre><code>vlayer = iface.activeLayer()\n\ncount = vlayer.featureCount()\nfeatures = vlayer.getFeatures()\n\nfor i, feature in enumerate(features):\n    # \u200b\u505a\u200b\u4e00\u4e9b\u200b\u8017\u65f6\u200b\u4efb\u52a1\u200b\n    print('') # \u200b\u7ed9\u4e88\u200b\u8db3\u591f\u200b\u7684\u200b\u65f6\u95f4\u200b\u6765\u200b\u6253\u5370\u200b\u8fdb\u5ea6\u200b\n\n    percent = i / float(count) * 100\n    # iface.mainWindow().statusBar().showMessage(\"Processed {} %\".format(int(percent)))\n    iface.statusBarIface().showMessage(\"Processed {} %\".format(int(percent)))\n\niface.statusBarIface().clearMessage()\n</code></pre>"},{"location":"13-%E4%B8%8E%E7%94%A8%E6%88%B7%E9%80%9A%E4%BF%A1/#133","title":"13.3 \u200b\u65e5\u5fd7","text":"<p>QGIS\u200b\u6709\u200b\u4e09\u79cd\u200b\u4e0d\u540c\u200b\u7c7b\u578b\u200b\u7684\u200b\u65e5\u5fd7\u200b\u8bb0\u5f55\u200b\uff0c\u200b\u8bb0\u5f55\u200b\u548c\u200b\u4fdd\u5b58\u200b\u6709\u5173\u200b\u4ee3\u7801\u6267\u884c\u200b\u7684\u200b\u6240\u6709\u200b\u4fe1\u606f\u200b\u3002\u200b\u6bcf\u79cd\u200b\u7c7b\u578b\u200b\u90fd\u200b\u6709\u200b\u7279\u5b9a\u200b\u7684\u200b\u8f93\u51fa\u200b\u4f4d\u7f6e\u200b\u3002\u200b\u8bf7\u200b\u8003\u8651\u200b\u4f7f\u7528\u200b\u6b63\u786e\u200b\u7684\u200b\u65e5\u5fd7\u200b\u8bb0\u5f55\u200b\u65b9\u5f0f\u200b\uff1a</p> <ul> <li><code>QgsMessageLog</code> \u200b\u7528\u4e8e\u200b\u5411\u200b\u7528\u6237\u200b\u4f20\u8fbe\u200b\u95ee\u9898\u200b\u3002QgsMessageLog\u200b\u7684\u200b\u8f93\u51fa\u200b\u663e\u793a\u200b\u5728\u200b\u65e5\u5fd7\u200b\u6d88\u606f\u200b\u9762\u677f\u200b\u4e2d\u200b\u3002</li> <li>Python\u200b\u7684\u200b logging \u200b\u6a21\u5757\u200b\u7528\u4e8e\u200b\u8c03\u8bd5\u200bQGIS Python API\uff08PyQGIS\uff09\u3002\u200b\u5efa\u8bae\u200bPython\u200b\u5f00\u53d1\u4eba\u5458\u200b\u4f7f\u7528\u200b\u5176\u200b\u8c03\u8bd5\u200b\u4ee3\u7801\u200b\uff0c\u200b\u4f8b\u5982\u200b\uff0c\u200b\u8981\u7d20\u200b\u7684\u200bid\u200b\u6216\u8005\u200b\u51e0\u4f55\u200b\u3002</li> <li><code>QgsLogger</code> \u200b\u7528\u4e8e\u200bQGIS\u200b\u5185\u90e8\u200b\u8c03\u8bd5\u200b/\u200b\u5f00\u53d1\u200b\uff08\u200b\u4f8b\u5982\u200b\uff1a\u200b\u5f53\u200b\u4f60\u200b\u6000\u7591\u200b\u67d0\u4e9b\u200b\u5185\u5bb9\u200b\u5f15\u8d77\u200b\u4e86\u200b\u5d29\u6e83\u200b\uff09\u3002\u200b\u53ea\u6709\u200bQGIS\u200b\u7684\u200b\u5f00\u53d1\u8005\u200b\u7248\u672c\u200b\u53ef\u7528\u200b\u3002</li> </ul> <p>\u200b\u4e0d\u540c\u200b\u65e5\u5fd7\u200b\u8bb0\u5f55\u200b\u7c7b\u578b\u200b\u7684\u200b\u793a\u4f8b\u200b\u5982\u4e0b\u200b\u6240\u793a\u200b\u3002</p> <p>\u200b\u8b66\u544a\u200b</p> <p>\u200b\u5728\u200b\u591a\u7ebf\u7a0b\u200b\u7684\u200b\u4ee3\u7801\u200b\u4e2d\u200b\u4f7f\u7528\u200bPython <code>print</code>\u200b\u8bed\u53e5\u200b\u662f\u200b\u4e0d\u200b\u5b89\u5168\u200b\u7684\u200b\uff0c\u200b\u5e76\u4e14\u200b\u5f88\u5927\u200b\u7a0b\u5ea6\u200b\u964d\u4f4e\u200b\u7b97\u6cd5\u200b\u7684\u200b\u901f\u5ea6\u200b\u3002\u200b\u5305\u62ec\u200b\u51fd\u6570\u200b\u8868\u8fbe\u5f0f\u200b\uff0c\u200b\u6e32\u67d3\u5668\u200b\uff0c\u200b\u7b26\u53f7\u200b\u5c42\u200b\u548c\u200b\u5904\u7406\u200b\u7b97\u6cd5\u200b\uff08\u200b\u7b49\u7b49\u200b\uff09\u3002\u200b\u5728\u200b\u8fd9\u4e9b\u200b\u60c5\u51b5\u200b\u4e0b\u200b\uff0c\u200b\u4f60\u200b\u5e94\u8be5\u200b\u59cb\u7ec8\u200b\u4f7f\u7528\u200bPython logging \u200b\u6a21\u5757\u200b\u6216\u200b\u7ebf\u7a0b\u200b\u5b89\u5168\u7c7b\u200b\uff08<code>QgsLogger</code>\u200b\u6216\u200b<code>QgsMessageLog</code>\uff09\u3002</p>"},{"location":"13-%E4%B8%8E%E7%94%A8%E6%88%B7%E9%80%9A%E4%BF%A1/#1331-qgsmessagelog","title":"13.3.1 QgsMessageLog","text":"<pre><code># \u200b\u4f60\u200b\u53ef\u4ee5\u200b\u9009\u62e9\u200b\u4f20\u9012\u200b'tag'\u200b\u548c\u200b'level'\u200b\u53c2\u6570\u200b\nQgsMessageLog.logMessage(\"Your plugin code has been executed correctly\", 'MyPlugin', level=Qgis.Info)\nQgsMessageLog.logMessage(\"Your plugin code might have some problems\", level=Qgis.Warning)\nQgsMessageLog.logMessage(\"Your plugin code has crashed!\", level=Qgis.Critical)\n</code></pre> <p>\u200b\u63d0\u793a\u200b</p> <p>\u200b\u4f60\u200b\u53ef\u4ee5\u200b\u5728\u200b\u65e5\u5fd7\u200b\u6d88\u606f\u200b\u9762\u677f\u200b\u4e2d\u200b\u67e5\u770b\u200b<code>QgsMessageLog</code>\u200b\u8f93\u51fa\u200b\u7684\u200b\u65e5\u5fd7\u200b\u3002</p>"},{"location":"13-%E4%B8%8E%E7%94%A8%E6%88%B7%E9%80%9A%E4%BF%A1/#1332-python-logging","title":"13.3.2 python logging\u200b\u6a21\u5757","text":"<pre><code>import logging\nformatter = '%(asctime)s - %(name)s - %(levelname)s - %(message)s'\nlogfilename=r'c:\\temp\\example.log'\nlogging.basicConfig(filename=logfilename, level=logging.DEBUG, format=formatter)\nlogging.info(\"This logging info text goes into the file\")\nlogging.debug(\"This logging debug text goes into the file as well\")\n\n# 2020-10-08 13:14:42,998 - root - INFO - This logging text goes into the file\n# 2020-10-08 13:14:42,998 - root - DEBUG - This logging debug text goes into the file as well\n</code></pre> <p>basicConfig\u200b\u65b9\u6cd5\u200b\u914d\u7f6e\u200b\u65e5\u5fd7\u200b\u8bb0\u5f55\u200b\u7684\u200b\u57fa\u672c\u200b\u8bbe\u7f6e\u200b\u3002\u200b\u5728\u200b\u4e0a\u9762\u200b\u7684\u200b\u4ee3\u7801\u200b\u4e2d\u200b\uff0c\u200b\u5b9a\u4e49\u200b\u4e86\u200b\u6587\u4ef6\u540d\u200b\uff0c\u200b\u65e5\u5fd7\u200b\u8bb0\u5f55\u200b\u7ea7\u522b\u200b\u548c\u200b\u683c\u5f0f\u200b\u3002\u200b\u6587\u4ef6\u540d\u200b\u6307\u200b\u7684\u200b\u662f\u200b\u5c06\u200b\u65e5\u5fd7\u200b\u6587\u4ef6\u200b\u5199\u5165\u200b\u7684\u200b\u4f4d\u7f6e\u200b\uff0c\u200b\u65e5\u5fd7\u200b\u8bb0\u5f55\u200b\u7ea7\u522b\u200b\u5b9a\u4e49\u200b\u8f93\u51fa\u200b\u7684\u200b\u7ea7\u522b\u200b\uff0c\u200b\u683c\u5f0f\u200b\u5b9a\u4e49\u200b\u8f93\u51fa\u200b\u6bcf\u4e2a\u200b\u6d88\u606f\u200b\u7684\u200b\u683c\u5f0f\u200b\u3002</p> <p>\u200b\u5982\u679c\u200b\u4f60\u200b\u60f3\u8981\u200b\u6bcf\u6b21\u200b\u5728\u200b\u6267\u884c\u200b\u811a\u672c\u200b\u65f6\u200b\u5220\u9664\u200b\u65e5\u5fd7\u200b\u6587\u4ef6\u200b\uff0c\u200b\u4f60\u200b\u53ef\u4ee5\u200b\u6267\u884c\u200b\u4ee5\u4e0b\u200b\u64cd\u4f5c\u200b\uff1a</p> <pre><code>if os.path.isfile(logfilename):\n    with open(logfilename, 'w') as file:\n        pass\n</code></pre> <p>\u200b\u5982\u4f55\u200b\u4f7f\u7528\u200b\u5982\u4f55\u200b\u4f7f\u7528\u200bPython\u200b\u65e5\u5fd7\u200b\u8bb0\u5f55\u200b\u5de5\u5177\u200b\u7684\u200b\u66f4\u200b\u591a\u200b\u8d44\u6e90\u200b\uff1a</p> <ul> <li>https://docs.python.org/3/library/logging.html</li> <li>https://docs.python.org/3/howto/logging.html</li> <li>https://docs.python.org/3/howto/logging-cookbook.html</li> </ul> <p>\u200b\u8b66\u544a\u200b</p> <p>\u200b\u8bf7\u200b\u6ce8\u610f\u200b\uff0c\u200b\u5982\u679c\u200b\u4e0d\u200b\u8bbe\u7f6e\u200b\u65e5\u5fd7\u200b\u6587\u4ef6\u200b\uff0c\u200b\u65e5\u5fd7\u200b\u53ef\u80fd\u200b\u662f\u200b\u591a\u7ebf\u7a0b\u200b\u7684\u200b\uff0c\u200b\u8fd9\u4f1a\u200b\u4e25\u91cd\u200b\u51cf\u6162\u200b\u8f93\u51fa\u200b\u901f\u5ea6\u200b</p>"},{"location":"14-%E8%AE%A4%E8%AF%81%E5%9F%BA%E7%A1%80/","title":"14 \u200b\u8ba4\u8bc1\u200b\u57fa\u7840","text":"<p>\u200b\u672c\u8282\u200b\u7684\u200b\u4ee3\u7801\u200b\u7247\u6bb5\u200b\u9700\u8981\u200b\u5bfc\u5165\u200b\u4ee5\u4e0b\u200b\u6a21\u5757\u200b\uff1a</p> <pre><code>from qgis.core import (\n  QgsApplication,\n  QgsRasterLayer,\n  QgsAuthMethodConfig,\n  QgsDataSourceUri,\n  QgsPkiBundle,\n  QgsMessageLog,\n)\n\nfrom qgis.gui import (\n    QgsAuthAuthoritiesEditor,\n    QgsAuthConfigEditor,\n    QgsAuthConfigSelect,\n    QgsAuthSettingsWidget,\n)\n\nfrom qgis.PyQt.QtWidgets import (\n    QWidget,\n    QTabWidget,\n)\n\nfrom qgis.PyQt.QtNetwork import QSslCertificate\n</code></pre>"},{"location":"14-%E8%AE%A4%E8%AF%81%E5%9F%BA%E7%A1%80/#141","title":"14.1 \u200b\u4ecb\u7ecd","text":"<p>\u200b\u8ba4\u8bc1\u200b\u57fa\u7840\u200b\u7684\u200b\u7528\u6237\u200b\u53c2\u8003\u200b\u53ef\u4ee5\u200b\u5728\u200b\u7528\u6237\u624b\u518c\u200b\u7684\u200b\u201c\u200b\u8ba4\u8bc1\u200b\u7cfb\u7edf\u200b\u6982\u8ff0\u200b\u201d\u200b\u4e2d\u200b\u9605\u8bfb\u200b\u3002</p> <p>\u200b\u672c\u7ae0\u200b\u662f\u200b\u63cf\u8ff0\u200b\u4ece\u200b\u5f00\u53d1\u4eba\u5458\u200b\u89d2\u5ea6\u200b\u4f7f\u7528\u200b\u8ba4\u8bc1\u200b\u7cfb\u7edf\u200b\u7684\u200b\u6700\u4f73\u200b\u5b9e\u8df5\u200b\u3002</p> <p>\u200b\u5728\u200bQGIS\u200b\u684c\u9762\u200b\u4e2d\u200b\uff0c\u200b\u5f53\u200b\u9700\u8981\u200b\u51ed\u8bc1\u200b\u6765\u200b\u8bbf\u95ee\u200b\u7279\u5b9a\u200b\u8d44\u6e90\u200b\u65f6\u200b\uff0c\u200b\u4f8b\u5982\u200b\u5f53\u200b\u4e00\u4e2a\u200b\u56fe\u5c42\u200b\u5efa\u7acb\u200b\u5728\u200bPostgres\u200b\u6570\u636e\u5e93\u200b\u8fde\u63a5\u200b\u65f6\u200b\uff0c\u200b\u6570\u636e\u200b\u63d0\u4f9b\u8005\u200b\u5c31\u200b\u5e7f\u6cdb\u200b\u5730\u200b\u4f7f\u7528\u200b\u4e86\u200b\u8ba4\u8bc1\u200b\u7cfb\u7edf\u200b\u3002</p> <p>QGIS gui\u200b\u5e93\u4e2d\u200b\u8fd8\u6709\u200b\u4e00\u4e9b\u200b\u90e8\u4ef6\u200b\uff0c\u200b\u63d2\u4ef6\u200b\u5f00\u53d1\u4eba\u5458\u200b\u53ef\u4ee5\u200b\u4f7f\u7528\u200b\u5b83\u4eec\u200b\u8f7b\u677e\u200b\u5730\u200b\u5c06\u200b\u8ba4\u8bc1\u200b\u57fa\u7840\u200b\u96c6\u6210\u200b\u5230\u200b\u4ee3\u7801\u200b\u4e2d\u200b\uff1a</p> <ul> <li><code>QgsAuthConfigEditor</code></li> <li><code>QgsAuthConfigSelect</code></li> <li><code>QgsAuthSettingsWidget</code></li> </ul> <p>\u200b\u53ef\u4ee5\u200b\u4ece\u200b\u8ba4\u8bc1\u200b\u57fa\u7840\u200b\u6d4b\u8bd5\u4ee3\u7801\u200b\u4e2d\u200b\u5b66\u4e60\u200b\u826f\u597d\u200b\u7684\u200b\u4ee3\u7801\u200b\u5f15\u7528\u200b\u3002</p> <p>\u200b\u8b66\u544a\u200b</p> <p>\u200b\u7531\u4e8e\u200b\u8ba4\u8bc1\u200b\u57fa\u7840\u200b\u8bbe\u8ba1\u200b\u8fc7\u7a0b\u200b\u4e2d\u200b\u8003\u8651\u200b\u5230\u200b\u5b89\u5168\u200b\u7ea6\u675f\u200b\uff0c\u200b\u53ea\u6709\u200b\u9009\u5b9a\u200b\u7684\u200b\u5185\u90e8\u200b\u65b9\u6cd5\u200b\u96c6\u200b\u53ef\u4ee5\u200b\u66b4\u9732\u200b\u7ed9\u200bPython\u3002</p>"},{"location":"14-%E8%AE%A4%E8%AF%81%E5%9F%BA%E7%A1%80/#142","title":"14.2 \u200b\u8bcd\u6c47\u8868","text":"<p>\u200b\u4ee5\u4e0b\u200b\u662f\u200b\u672c\u7ae0\u200b\u4e2d\u200b\u6700\u200b\u5e38\u89c1\u200b\u5bf9\u8c61\u200b\u7684\u200b\u4e00\u4e9b\u200b\u5b9a\u4e49\u200b\u3002</p> <ul> <li>\u200b\u4e3b\u200b\u5bc6\u7801\u200b</li> </ul> <p>\u200b\u5141\u8bb8\u200b\u8bbf\u95ee\u200b\u548c\u200b\u89e3\u5bc6\u200b\u5b58\u50a8\u200b\u5728\u200bQGIS\u200b\u8ba4\u8bc1\u200b\u4e2d\u200b\u51ed\u636e\u200b\u7684\u200b\u5bc6\u7801\u200b</p> <ul> <li>\u200b\u8ba4\u8bc1\u200b\u6570\u636e\u5e93\u200b</li> </ul> <p>\u200b\u4e00\u4e2a\u200b\u4e3b\u200b\u5bc6\u7801\u200b\u52a0\u5bc6\u200b\u540e\u200b\u7684\u200bSQLite\u200b\u6570\u636e\u5e93\u200b<code>qgis-auth.db</code> \uff0c\u200b\u5176\u4e2d\u200b\u8ba4\u8bc1\u200b\u914d\u7f6e\u200b\u5b58\u50a8\u200b\u5728\u200b\u8fd9\u91cc\u200b\u3002\u200b\u4f8b\u5982\u200b\u7528\u6237\u540d\u200b/\u200b\u5bc6\u7801\u200b\uff0c\u200b\u4e2a\u4eba\u200b\u8bc1\u4e66\u200b\u548c\u200b\u5bc6\u94a5\u200b\uff0c\u200b\u8bc1\u4e66\u200b\u9881\u53d1\u200b\u673a\u6784\u200b</p> <ul> <li>\u200b\u8ba4\u8bc1\u200b\u6570\u636e\u5e93\u200b</li> </ul> <p>\u200b\u8ba4\u8bc1\u200b\u6570\u636e\u5e93\u200b</p> <ul> <li>\u200b\u8ba4\u8bc1\u200b\u914d\u7f6e\u200b</li> </ul> <p>\u200b\u4e00\u7ec4\u200b\u8ba4\u8bc1\u200b\u6570\u636e\u200b\uff0c\u200b\u53d6\u51b3\u4e8e\u200b\u8ba4\u8bc1\u200b\u65b9\u6cd5\u200b\u3002\u200b\u4f8b\u5982\u200b\uff0c\u200b\u57fa\u672c\u200b\u8ba4\u8bc1\u200b\u65b9\u6cd5\u200b\u5b58\u50a8\u200b\u4e00\u5bf9\u200b\u7528\u6237\u540d\u200b/\u200b\u5bc6\u7801\u200b\u3002</p> <ul> <li>\u200b\u8ba4\u8bc1\u200b\u65b9\u6cd5\u200b</li> </ul> <p>\u200b\u7528\u4e8e\u200b\u83b7\u53d6\u200b\u8ba4\u8bc1\u200b\u7684\u200b\u7279\u5b9a\u200b\u65b9\u6cd5\u200b\u3002\u200b\u6bcf\u4e2a\u200b\u65b9\u6cd5\u200b\u90fd\u200b\u6709\u200b\u81ea\u5df1\u200b\u7684\u200b\u534f\u8bae\u200b\uff0c\u200b\u7528\u4e8e\u200b\u83b7\u53d6\u200b\u8ba4\u8bc1\u200b\u7ea7\u522b\u200b\u3002\u200b\u6bcf\u4e2a\u200b\u65b9\u6cd5\u200b\u90fd\u200b\u662f\u200b\u5728\u200bQGIS\u200b\u8ba4\u8bc1\u200b\u57fa\u7840\u200b\u521d\u59cb\u5316\u200b\u671f\u95f4\u200b\u52a8\u6001\u200b\u52a0\u8f7d\u200b\u7684\u200b\u5171\u4eab\u200b\u5e93\u200b\u3002</p>"},{"location":"14-%E8%AE%A4%E8%AF%81%E5%9F%BA%E7%A1%80/#143-qgsauthmanager","title":"14.3 QgsAuthManager\u200b\u5165\u53e3","text":"<p>\u200b\u5355\u4f8b\u200b\u7c7b\u200b<code>QgsAuthManager</code>\u200b\u662f\u200b\u4f7f\u7528\u200b\u5b58\u50a8\u200b\u5728\u200bQGIS\u200b\u8ba4\u8bc1\u200b\u6570\u636e\u5e93\u200b\u52a0\u5bc6\u200b\u8bc1\u4e66\u200b\u7684\u200b\u5165\u53e3\u200b\uff0c\u200b\u5373\u200b\uff0c\u200b\u5728\u200b\u5f53\u524d\u200b\u7528\u6237\u200b\u8d44\u6599\u200b\u6587\u4ef6\u5939\u200b\u4e0b\u200b\u7684\u200b<code>qgis-auth.db</code>\u200b\u6587\u4ef6\u200b\u3002</p> <p>\u200b\u6b64\u7c7b\u200b\u8d1f\u8d23\u200b\u7528\u6237\u200b\u4ea4\u4e92\u200b\uff1a\u200b\u901a\u8fc7\u200b\u8bbe\u7f6e\u200b\u4e3b\u200b\u5bc6\u7801\u200b\u6216\u200b\u900f\u660e\u200b\u5730\u200b\u4f7f\u7528\u200b\u5b83\u200b\u6765\u200b\u8bbf\u95ee\u200b\u52a0\u5bc6\u200b\u7684\u200b\u5b58\u50a8\u200b\u4fe1\u606f\u200b\u3002</p>"},{"location":"14-%E8%AE%A4%E8%AF%81%E5%9F%BA%E7%A1%80/#1431","title":"14.3.1 \u200b\u521d\u59cb\u5316\u200b\u7ba1\u7406\u5668\u200b\u5e76\u200b\u8bbe\u7f6e\u200b\u4e3b\u200b\u5bc6\u7801","text":"<p>\u200b\u4ee5\u4e0b\u200b\u4ee3\u7801\u6bb5\u200b\u63d0\u4f9b\u200b\u4e86\u200b\u4e00\u4e2a\u200b\u793a\u4f8b\u200b\uff0c\u200b\u8bbe\u7f6e\u200b\u4e3b\u200b\u5bc6\u7801\u200b\u6765\u200b\u6253\u5f00\u200b\u5bf9\u200b\u8ba4\u8bc1\u200b\u8bbe\u7f6e\u200b\u7684\u200b\u8bbf\u95ee\u200b\u6743\u9650\u200b\u3002\u200b\u4ee3\u7801\u200b\u6ce8\u91ca\u200b\u5bf9\u4e8e\u200b\u7406\u89e3\u200b\u4ee3\u7801\u200b\u975e\u5e38\u200b\u91cd\u8981\u200b\u3002</p> <pre><code>authMgr = QgsApplication.authManager()\n# \u200b\u68c0\u67e5\u200bQgsAuthManager\u200b\u662f\u5426\u200b\u5df2\u7ecf\u200b\u521d\u59cb\u5316\u200b... QgsAuthManager.init()\u200b\u7684\u200b\u989d\u5916\u200b\u4f5c\u7528\u200b\u662f\u200b\u8bbe\u7f6e\u200b\u4e86\u200bAuthDbPath\u3002\n# QgsAuthManager.init()\u200b\u5728\u200bQGIS\u200b\u5e94\u7528\u7a0b\u5e8f\u200b\u521d\u59cb\u5316\u200b\u671f\u95f4\u200b\u6267\u884c\u200b\uff0c\u200b\u56e0\u6b64\u200b\u901a\u5e38\u200b\u4e0d\u200b\u9700\u8981\u200b\u76f4\u63a5\u200b\u8c03\u7528\u200b\u5b83\u200b\u3002\nif authMgr.authenticationDatabasePath():\n    if authMgr.masterPasswordIsSet():\n        msg = 'Authentication master password not recognized'\n        assert authMgr.masterPasswordSame( \"your master password\" ), msg\n    else:\n        msg = 'Master password could not be set'\n        # \u200b\u9a8c\u8bc1\u200bverify\u200b\u53c2\u6570\u200b\u5bc6\u7801\u200b\u7684\u200b\u54c8\u5e0c\u200b\u503c\u200b\u662f\u5426\u200b\u5df2\u200b\u4fdd\u5b58\u200b\u5728\u200b\u8ba4\u8bc1\u200b\u6570\u636e\u5e93\u200b\u4e2d\u200b\n        assert authMgr.setMasterPassword( \"your master password\",verify=True), msg\nelse:\n    # \u200b\u5728\u200bqgis\u200b\u73af\u5883\u200b\u4e4b\u5916\u200b\uff0c\u200b\u4f8b\u5982\u200b\u5728\u200b\u6d4b\u8bd5\u73af\u5883\u200b\u4e2d\u200b=&gt;\u200b\u5728\u200b\u6570\u636e\u5e93\u200b\u521d\u59cb\u5316\u200b\u4e4b\u524d\u200b\u8bbe\u7f6e\u200b\u73af\u5883\u53d8\u91cf\u200b\n    os.environ['QGIS_AUTH_DB_DIR_PATH'] = \"/path/where/located/qgis-auth.db\"\n    msg = 'Master password could not be set'\n    assert authMgr.setMasterPassword(\"your master password\", True), msg\n    authMgr.init( \"/path/where/located/qgis-auth.db\" )\n</code></pre>"},{"location":"14-%E8%AE%A4%E8%AF%81%E5%9F%BA%E7%A1%80/#1432","title":"14.3.2 \u200b\u4f7f\u7528\u200b\u65b0\u200b\u7684\u200b\u8ba4\u8bc1\u200b\u914d\u7f6e\u200b\u9879\u200b\u586b\u5145\u200b\u8ba4\u8bc1\u200b\u6570\u636e\u5e93","text":"<p>\u200b\u4efb\u4f55\u200b\u5b58\u50a8\u200b\u7684\u200b\u51ed\u8bc1\u200b\u90fd\u200b\u662f\u200b<code>QgsAuthMethodConfig</code>\u200b\u7c7b\u200b\u7684\u200b\u8ba4\u8bc1\u200b\u914d\u7f6e\u200b\u5b9e\u4f8b\u200b\u2014\u2014\u200b\u4f7f\u7528\u200b\u552f\u4e00\u200b\u5b57\u7b26\u4e32\u200b\u8bbf\u95ee\u200b\uff1a</p> <pre><code>authcfg = 'fm1s770'\n</code></pre> <p>\u200b\u8be5\u200b\u5b57\u7b26\u4e32\u200b\u662f\u200b\u5728\u200b\u4f7f\u7528\u200bQGIS API\u200b\u6216\u200bGUI\u200b\u521b\u5efa\u200b\u6761\u76ee\u200b\u65f6\u200b\u81ea\u52a8\u200b\u751f\u6210\u200b\u7684\u200b\uff0c\u200b\u4f46\u200b\u5982\u679c\u200b\u914d\u7f6e\u200b\u5fc5\u987b\u200b\u5728\u200b\u4e00\u4e2a\u200b\u7ec4\u7ec7\u200b\u5185\u200b\u7684\u200b\u591a\u4e2a\u200b\u7528\u6237\u200b\u4e4b\u95f4\u200b\u5171\u4eab\u200b\uff08\u200b\u4e0d\u540c\u200b\u7684\u200b\u51ed\u8bc1\u200b\uff09\uff0c\u200b\u5c06\u200b\u5176\u200b\u624b\u52a8\u200b\u8bbe\u7f6e\u200b\u4e3a\u200b\u4e00\u4e2a\u200b\u5df2\u77e5\u200b\u503c\u200b\u53ef\u80fd\u200b\u662f\u200b\u6709\u7528\u200b\u7684\u200b\u3002</p> <p><code>QgsAuthMethodConfig</code>\u200b\u662f\u200b\u4efb\u4f55\u200b\u8ba4\u8bc1\u200b\u65b9\u6cd5\u200b\u7684\u200b\u57fa\u7c7b\u200b\u3002\u200b\u4efb\u4f55\u200b\u8ba4\u8bc1\u200b\u65b9\u6cd5\u200b\u96c6\u90fd\u4f1a\u200b\u914d\u7f6e\u200b\u54c8\u5e0c\u200b\u6620\u5c04\u200b\uff0c\u200b\u5176\u4e2d\u200b\u5b58\u50a8\u200b\u8ba4\u8bc1\u200b\u4fe1\u606f\u200b\u3002\u200b\u4e0b\u9762\u200b\u662f\u200b\u4e00\u4e2a\u200b\u6709\u7528\u200b\u7684\u200b\u4ee3\u7801\u200b\u7247\u6bb5\u200b\uff0c\u200b\u7528\u4e8e\u200b\u5b58\u50a8\u200balice\u200b\u7528\u6237\u200b\u7684\u200bPKI\u200b\u8def\u5f84\u200b\u51ed\u8bc1\u200b\uff1a</p> <pre><code>authMgr = QgsApplication.authManager()\n# \u200b\u8bbe\u7f6e\u200b alice PKI \u200b\u6570\u636e\u200b\np_config = QgsAuthMethodConfig()\np_config.setName(\"alice\")\np_config.setMethod(\"PKI-Paths\")\np_config.setUri(\"https://example.com\")\np_config.setConfig(\"certpath\", \"path/to/alice-cert.pem\" )\np_config.setConfig(\"keypath\", \"path/to/alice-key.pem\" )\n# \u200b\u68c0\u67e5\u200b\u65b9\u6cd5\u200b\u53c2\u6570\u200b\u662f\u5426\u200b\u6b63\u786e\u200b\u8bbe\u7f6e\u200b\nassert p_config.isValid()\n\n# \u200b\u5728\u200b\u8ba4\u8bc1\u200b\u6570\u636e\u5e93\u200b\u4e2d\u200b\u6ce8\u518c\u200balice\u200b\u6570\u636e\u200b\uff0c\u200b\u8fd4\u56de\u200b\u5b58\u50a8\u200b\u7684\u200b\u2018authcfg\u2019\u200b\u914d\u7f6e\u200b\nauthMgr.storeAuthenticationConfig(p_config)\nnewAuthCfgId = p_config.id()\nassert (newAuthCfgId)\n</code></pre>"},{"location":"14-%E8%AE%A4%E8%AF%81%E5%9F%BA%E7%A1%80/#14321","title":"14.3.2.1 \u200b\u53ef\u7528\u200b\u7684\u200b\u8ba4\u8bc1\u200b\u65b9\u6cd5","text":"<p>\u200b\u8ba4\u8bc1\u200b\u65b9\u6cd5\u200b\u5728\u200b\u8ba4\u8bc1\u200b\u7ba1\u7406\u5668\u200b\u521d\u59cb\u5316\u200b\u65f6\u200b\u52a8\u6001\u200b\u52a0\u8f7d\u200b\u3002\u200b\u53ef\u7528\u200b\u7684\u200b\u8ba4\u8bc1\u200b\u65b9\u6cd5\u200b\u5217\u8868\u200b\u5982\u4e0b\u200b\uff1a</p> <ol> <li><code>Basic</code> \u200b\u7528\u6237\u200b\u548c\u200b\u5bc6\u7801\u200b\u9a8c\u8bc1\u200b</li> <li><code>EsriToken</code> ESRI token \u200b\u57fa\u7840\u200b\u8ba4\u8bc1\u200b</li> <li><code>Identity-Cert</code> \u200b\u8eab\u4efd\u8bc1\u200b\u4e66\u200b\u8ba4\u8bc1\u200b</li> <li><code>PKI-Paths</code> PKI\u200b\u8def\u5f84\u200b\u8ba4\u8bc1\u200b</li> <li><code>PKI-PKCS#12</code> PKI PKCS\uff0312\u200b\u8ba4\u8bc1\u200b</li> </ol>"},{"location":"14-%E8%AE%A4%E8%AF%81%E5%9F%BA%E7%A1%80/#14322","title":"14.3.2.2 \u200b\u586b\u5145\u200b\u6743\u9650","text":"<pre><code>authMgr = QgsApplication.authManager()\n# \u200b\u6dfb\u52a0\u200b\u6743\u9650\u200b\ncacerts = QSslCertificate.fromPath( \"/path/to/ca_chains.pem\" )\nassert cacerts is not None\n# \u200b\u5b58\u50a8\u200b CA\nauthMgr.storeCertAuthorities(cacerts)\n# \u200b\u91cd\u5efa\u200bCA\u200b\u7f13\u5b58\u200b\nauthMgr.rebuildCaCertsCache()\nauthMgr.rebuildTrustedCaCertsCache()\n</code></pre>"},{"location":"14-%E8%AE%A4%E8%AF%81%E5%9F%BA%E7%A1%80/#14323-qgspkibundlepki","title":"14.3.2.3 \u200b\u4f7f\u7528\u200bQgsPkiBundle\u200b\u7ba1\u7406\u200bPKI","text":"<p>QgsPkiBundle\u200b\u7c7b\u200b\u662f\u200b\u4e00\u4e2a\u200b\u65b9\u4fbf\u200b\u7684\u200b\u7c7b\u200b\uff0c\u200b\u7528\u4e8e\u200b\u6253\u5305\u200b\u7531\u200bSslCert\u3001SslKey\u200b\u548c\u200bCA\u200b\u94fe\u200b\u7ec4\u6210\u200b\u7684\u200bPKI\u200b\u5305\u200b\u3002\u200b\u4e0b\u9762\u200b\u662f\u200b\u4e00\u4e2a\u200b\u83b7\u5f97\u200b\u5bc6\u7801\u4fdd\u62a4\u200b\u7684\u200b\u7247\u6bb5\u200b\uff1a</p> <pre><code># \u200b\u5bc6\u94a5\u200b\u4e0e\u200b\u5bc6\u7801\u200b\u4e00\u8d77\u200b\u6dfb\u52a0\u200balice\u200b\u8bc1\u4e66\u200b\ncaBundlesList = [] \nbundle = QgsPkiBundle.fromPemPaths( \"/path/to/alice-cert.pem\",\n                                     \"/path/to/alice-key_w-pass.pem\",\n                                     \"unlock_pwd\",\n                                     caBundlesList )\nassert bundle is not None\n# \u200b\u4f60\u200b\u53ef\u4ee5\u200b\u68c0\u67e5\u200b\u5b83\u200b\u662f\u5426\u200b\u6b63\u786e\u200b\n# bundle.isValid()\n</code></pre> <p>\u200b\u8bf7\u53c2\u9605\u200b<code>QgsPkiBundle</code>\u200b\u7c7b\u200b\u6587\u6863\u200b\uff0c\u200b\u4ece\u200b\u5305\u4e2d\u200b\u63d0\u53d6\u200b\u8bc1\u4e66\u200b/\u200b\u5bc6\u94a5\u200b/ CA.</p>"},{"location":"14-%E8%AE%A4%E8%AF%81%E5%9F%BA%E7%A1%80/#1433","title":"14.3.3 \u200b\u4ece\u200b\u8ba4\u8bc1\u200b\u6570\u636e\u5e93\u200b\u4e2d\u200b\u5220\u9664\u200b\u6761\u76ee","text":"<p>\u200b\u6211\u4eec\u200b\u53ef\u4ee5\u200b\u4f7f\u7528\u200b<code>authcfg</code>\u200b\u6807\u8bc6\u7b26\u200b\u4ece\u200b\u8ba4\u8bc1\u200b\u6570\u636e\u5e93\u200b\u4e2d\u200b\u5220\u9664\u200b\u6761\u76ee\u200b\uff1a</p> <pre><code>authMgr = QgsApplication.authManager()\nauthMgr.removeAuthenticationConfig( \"authCfg_Id_to_remove\" )\n</code></pre>"},{"location":"14-%E8%AE%A4%E8%AF%81%E5%9F%BA%E7%A1%80/#1434-qgsauthmanagerauthcfg","title":"14.3.4 \u200b\u4f7f\u7528\u200bQgsAuthManager\u200b\u6269\u5c55\u200bauthcfg","text":"<p>\u200b\u4f7f\u7528\u200b\u5b58\u50a8\u200b\u5728\u200b\u8ba4\u8bc1\u200b\u6570\u636e\u5e93\u200b\u4e2d\u200b\u7684\u200b\u8ba4\u8bc1\u200b\u914d\u7f6e\u200b\u7684\u200b\u6700\u597d\u200b\u65b9\u6cd5\u200b\u662f\u200b\u7528\u200b\u552f\u4e00\u200b\u7684\u200b\u6807\u8bc6\u7b26\u200b<code>authcfg</code>\u200b\u6765\u200b\u5f15\u7528\u200b\u5b83\u200b\u3002\u200b\u6269\u5c55\u200b\uff0c\u200b\u610f\u5473\u7740\u200b\u628a\u200b\u5b83\u200b\u4ece\u200b\u4e00\u4e2a\u200b\u6807\u8bc6\u7b26\u200b\u8f6c\u6362\u6210\u200b\u4e00\u5957\u200b\u5b8c\u6574\u200b\u7684\u200b\u51ed\u8bc1\u200b\u3002\u200b\u4f7f\u7528\u200b\u5b58\u50a8\u200b\u7684\u200b\u8ba4\u8bc1\u200b\u914d\u7f6e\u200b\u7684\u200b\u6700\u4f73\u200b\u505a\u6cd5\u200b\uff0c\u200b\u662f\u200b\u8ba9\u200b\u5b83\u200b\u7531\u200b\u8ba4\u8bc1\u200b\u7ba1\u7406\u5668\u200b\u81ea\u52a8\u200b\u7ba1\u7406\u200b\u3002\u200b\u5b58\u50a8\u914d\u7f6e\u200b\u7684\u200b\u5e38\u89c1\u200b\u7528\u9014\u200b\u662f\u200b\u8fde\u63a5\u200b\u5230\u200b\u4e00\u4e2a\u200b\u542f\u7528\u200b\u4e86\u200b\u8ba4\u8bc1\u200b\u7684\u200b\u670d\u52a1\u200b\uff0c\u200b\u5982\u200bWMS\u3001WFS\u200b\u6216\u200b\u6570\u636e\u5e93\u200b\u8fde\u63a5\u200b\u3002</p> <p>\u200b\u63d0\u793a\u200b</p> <p>\u200b\u5e76\u975e\u200b\u6240\u6709\u200b\u7684\u200bQGIS\u200b\u6570\u636e\u200b\u63d0\u4f9b\u8005\u200b\u90fd\u200b\u4e0e\u200b\u8ba4\u8bc1\u200b\u57fa\u7840\u200b\u96c6\u6210\u200b\u3002\u200b\u6bcf\u4e2a\u200b\u8ba4\u8bc1\u200b\u65b9\u6cd5\u200b\u90fd\u200b\u662f\u4ece\u200b\u57fa\u7c7b\u200bQgsAuthMethod\u200b\u6d3e\u751f\u200b\u51fa\u6765\u200b\u7684\u200b\uff0c\u200b\u5e76\u200b\u652f\u6301\u200b\u4e00\u7ec4\u200b\u4e0d\u540c\u200b\u7684\u200b\u63d0\u4f9b\u8005\u200b\u3002\u200b\u4f8b\u5982\u200b\uff0ccertIdentity()\u200b\u65b9\u6cd5\u200b\u652f\u6301\u200b\u4ee5\u4e0b\u200b\u7684\u200b\u63d0\u4f9b\u8005\u200b\u5217\u8868\u200b: <pre><code>authM = QgsApplication.authManager()\nprint(authM.authMethod(\"Identity-Cert\").supportedDataProviders())\n\n# ['ows', 'wfs', 'wcs', 'wms', 'postgres']\n</code></pre></p> <p>\u200b\u4f8b\u5982\u200b\uff0c\u200b\u8981\u200b\u4f7f\u7528\u200b<code>authcfg = 'fm1s770'</code>\u200b\u6807\u8bc6\u200b\u7684\u200b\u5b58\u50a8\u200b\u51ed\u8bc1\u200b\u8bbf\u95ee\u200bWMS\u200b\u670d\u52a1\u200b\uff0c\u200b\u6211\u4eec\u200b\u53ea\u200b\u9700\u200b\u5728\u200b\u6570\u636e\u6e90\u200bURL\u200b\u4e2d\u200b\u4f7f\u7528\u200b<code>authcfg</code>\uff0c\u200b\u5982\u200b\u4ee5\u4e0b\u200b\u4ee3\u7801\u200b: <pre><code>authCfg = 'fm1s770'\nquri = QgsDataSourceUri()\nquri.setParam(\"layers\", 'usa:states')\nquri.setParam(\"styles\", '')\nquri.setParam(\"format\", 'image/png')\nquri.setParam(\"crs\", 'EPSG:4326')\nquri.setParam(\"dpiMode\", '7')\nquri.setParam(\"featureCount\", '10')\nquri.setParam(\"authcfg\", authCfg)   # &lt;---- authCfg url \u200b\u914d\u7f6e\u200b\nquri.setParam(\"contextualWMSLegend\", '0')\nquri.setParam(\"url\", 'https://my_auth_enabled_server_ip/wms')\nrlayer = QgsRasterLayer(str(quri.encodedUri(), \"utf-8\"), 'states', 'wms')\n</code></pre> \u200b\u4ee5\u4e0a\u200b\u6848\u4f8b\u200b\uff0c<code>wms</code>\u200b\u63d0\u4f9b\u8005\u200b\u5728\u200b\u8bbe\u7f6e\u200bHTTP\u200b\u8fde\u63a5\u200b\u4e4b\u524d\u200b\uff0c\u200b\u4f1a\u200b\u5c06\u200b<code>authcfg</code> URI\u200b\u53c2\u6570\u200b\u4e0e\u200b\u51ed\u8bc1\u200b\u5c55\u5f00\u200b\u3002</p> <p>\u200b\u8b66\u544a\u200b</p> <p>\u200b\u5f00\u53d1\u8005\u200b\u5fc5\u987b\u200b\u5c06\u200b<code>authcfg</code>\u200b\u6269\u5c55\u200b\u7559\u7ed9\u200bQgsAuthManager\uff0c\u200b\u8fd9\u6837\u200b\uff0c\u200b\u5b83\u200b\u5c31\u200b\u80fd\u200b\u786e\u4fdd\u200b\u6269\u5c55\u200b\u4e0d\u4f1a\u200b\u592a\u65e9\u200b\u5b8c\u6210\u200b\u3002</p> <p>\u200b\u901a\u5e38\u200b\u60c5\u51b5\u200b\u4e0b\u200b\uff0c\u200b\u4f7f\u7528\u200bQgsDataSourceURI\u200b\u7c7b\u200b\u6784\u5efa\u200b\u7684\u200bURI\u200b\u5b57\u7b26\u4e32\u200b\u88ab\u200b\u7528\u6765\u200b\u8bbe\u7f6e\u200b\u6570\u636e\u6e90\u200b\uff0c\u200b\u5176\u200b\u65b9\u5f0f\u200b\u5982\u4e0b\u200b:</p> <pre><code>authCfg = 'fm1s770'\nquri = QgsDataSourceUri(\"my WMS uri here\")\nquri.setParam(\"authcfg\", authCfg)\nrlayer = QgsRasterLayer( quri.uri(False), 'states', 'wms')\n</code></pre> <p>\u200b\u63d0\u793a\u200b</p> <p><code>False</code>\u200b\u53c2\u6570\u200b\u5f88\u200b\u91cd\u8981\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u907f\u514d\u200bURL\u200b\u4e2d\u200b\u5df2\u200b\u5b58\u5728\u200b\u7684\u200b<code>authcfg</code></p>"},{"location":"14-%E8%AE%A4%E8%AF%81%E5%9F%BA%E7%A1%80/#14341-pki","title":"14.3.4.1 \u200b\u4f7f\u7528\u200b\u5176\u5b83\u200b\u6570\u636e\u200b\u63d0\u4f9b\u8005\u200b\u7684\u200bPKI\u200b\u4f8b\u5b50","text":"<p>\u200b\u5176\u5b83\u200b\u4f8b\u5b50\u200b\u53ef\u4ee5\u200b\u5728\u200bQGIS\u200b\u6d4b\u8bd5\u200b\u6587\u4ef6\u5939\u200b\u4e2d\u200b\u76f4\u63a5\u200b\u8bfb\u53d6\u200b\uff0c\u200b\u5982\u200btest_authmanager_pki_ows\u200b\u6216\u200btest_authmanager_pki_postgres.</p>"},{"location":"14-%E8%AE%A4%E8%AF%81%E5%9F%BA%E7%A1%80/#144","title":"14.4 \u200b\u8c03\u6574\u200b\u63d2\u4ef6\u200b\u4f7f\u7528\u200b\u8ba4\u8bc1\u200b\u57fa\u7840","text":"<p>\u200b\u8bb8\u591a\u200b\u7b2c\u4e09\u65b9\u200b\u63d2\u4ef6\u200b\u4f7f\u7528\u200bhttplib2\u200b\u6216\u200b\u5176\u4ed6\u200bPython\u200b\u7f51\u7edc\u200b\u5e93\u6765\u200b\u7ba1\u7406\u200bHTTP\u200b\u8fde\u63a5\u200b\uff0c\u200b\u800c\u200b\u4e0d\u662f\u200b\u4e0e\u200b<code>QgsNetworkAccessManager</code>\u200b\u53ca\u5176\u200b\u76f8\u5173\u200b\u8ba4\u8bc1\u200b\u57fa\u7840\u200b\u96c6\u6210\u200b\u3002</p> <p>\u200b\u4e3a\u4e86\u200b\u4fbf\u4e8e\u200b\u96c6\u6210\u200b\uff0c\u200b\u6211\u4eec\u200b\u521b\u5efa\u200b\u4e86\u200b\u4e00\u4e2a\u200b\u540d\u4e3a\u200b<code>NetworkAccessManager</code>\u200b\u7684\u200bPython\u200b\u5e2e\u52a9\u200b\u51fd\u6570\u200b\u3002\u200b\u5b83\u200b\u7684\u200b\u4ee3\u7801\u200b\u53ef\u4ee5\u200b\u5728\u200b\u8fd9\u91cc\u200b\u627e\u5230\u200b\u3002</p> <p>\u200b\u6b64\u200b\u5e2e\u52a9\u200b\u7a0b\u5e8f\u200b\u7c7b\u200b\u53ef\u4ee5\u200b\u5728\u200b\u4ee5\u4e0b\u200b\u4ee3\u7801\u6bb5\u200b\u4e2d\u200b\u4f7f\u7528\u200b\uff1a</p> <pre><code>http = NetworkAccessManager(authid=\"my_authCfg\", exception_class=My_FailedRequestError)\ntry:\n  response, content = http.request( \"my_rest_url\" )\nexcept My_FailedRequestError, e:\n  # \u200b\u5904\u7406\u200b\u5f02\u5e38\u200b\n  pass\n</code></pre>"},{"location":"14-%E8%AE%A4%E8%AF%81%E5%9F%BA%E7%A1%80/#145-gui","title":"14.5 \u200b\u8ba4\u8bc1\u200bGUI","text":"<p>\u200b\u672c\u200b\u8282\u200b\u5217\u51fa\u200b\u4e86\u200b\u53ef\u200b\u7528\u4e8e\u200b\u5728\u200b\u81ea\u5b9a\u4e49\u200b\u63a5\u53e3\u200b\u4e2d\u200b\u96c6\u6210\u200b\u8ba4\u8bc1\u200b\u57fa\u7840\u200b\u7684\u200b\u53ef\u7528\u200bGUI\u3002</p>"},{"location":"14-%E8%AE%A4%E8%AF%81%E5%9F%BA%E7%A1%80/#1451-gui","title":"14.5.1 GUI\u200b\u9009\u62e9\u200b\u8bc1\u4e66","text":"<p>\u200b\u5982\u679c\u200b\u9700\u8981\u200b\u4ece\u200b\u5b58\u50a8\u200b\u5728\u200b\u8ba4\u8bc1\u200b\u6570\u636e\u5e93\u200b\u4e2d\u200b\u9009\u62e9\u200b\u8ba4\u8bc1\u200b\u914d\u7f6e\u200b\uff0c\u200b\u5219\u200b\u53ef\u4ee5\u200b\u5728\u200bGUI\u200b\u7c7b\u200b<code>QgsAuthConfigSelect</code>\u200b\u4e2d\u200b\u4f7f\u7528\u200b\u3002</p> <p></p> <p>\u200b\u53ef\u200b\u5728\u200b\u4ee5\u4e0b\u200b\u4ee3\u7801\u6bb5\u200b\u4e2d\u200b\u4f7f\u7528\u200b\uff1a</p> <pre><code># \u200b\u521b\u5efa\u200b\u4e00\u4e2a\u200bQgsAuthConfigSelect GUI\u200b\u5b9e\u4f8b\u200b\uff0c\u200b\u8be5\u200b\u5b9e\u4f8b\u200b\u4e0e\u200b`parent`\u200b\u6709\u200b\u7236\u5b50\u5173\u7cfb\u200b\nparent = QWidget()  # GUI\u200b\u7236\u7ea7\u200b\u63a7\u4ef6\u200b\ngui = QgsAuthConfigSelect( parent, \"postgres\" )\n# \u200b\u5728\u200b\u4e00\u4e2a\u200b\u65b0\u200b\u6807\u7b7e\u200b\u4e2d\u200b\u6dfb\u52a0\u200b\u4e0a\u8ff0\u200b\u521b\u5efa\u200b\u7684\u200bGUI\u200b\u63a7\u4ef6\u200b\u3002\ntabGui = QTabWidget()\ntabGui.insertTab( 1, gui, \"Configurations\" )\n</code></pre> <p>\u200b\u4ee5\u4e0a\u200b\u793a\u4f8b\u200b\u6458\u81ea\u200bQGIS\u200b\u6e90\u4ee3\u7801\u200b\u3002GUI\u200b\u6784\u9020\u51fd\u6570\u200b\u7684\u200b\u7b2c\u4e8c\u4e2a\u200b\u53c2\u6570\u200b\u5f15\u7528\u200b\u6570\u636e\u200b\u63d0\u4f9b\u8005\u200b\u7c7b\u578b\u200b\u3002\u200b\u53c2\u6570\u200b\u7528\u4e8e\u200b\u9650\u5236\u200b\u4e0e\u200b\u6307\u5b9a\u200b\u63d0\u4f9b\u8005\u200b\u517c\u5bb9\u200b\u7684\u200b\u8ba4\u8bc1\u200b\u65b9\u6cd5\u200b\u3002</p>"},{"location":"14-%E8%AE%A4%E8%AF%81%E5%9F%BA%E7%A1%80/#1452","title":"14.5.2 \u200b\u8ba4\u8bc1\u200b\u7f16\u8f91\u5668","text":"<p>\u200b\u7528\u4e8e\u200b\u7ba1\u7406\u200b\u51ed\u636e\u200b\u3001\u200b\u6743\u9650\u200b\u548c\u200b\u8bbf\u95ee\u200b\u8ba4\u8bc1\u200b\u5b9e\u7528\u7a0b\u5e8f\u200b\u7684\u200b\u5b8c\u6574\u200bGUI\u200b\u7531\u200b<code>QgsAuthEditorWidgets</code>\u200b\u7c7b\u200b\u7ba1\u7406\u200b\u3002</p> <p></p> <p>\u200b\u53ef\u200b\u5728\u200b\u4ee5\u4e0b\u200b\u4ee3\u7801\u6bb5\u200b\u4e2d\u200b\u4f7f\u7528\u200b\uff1a</p> <pre><code># \u200b\u521b\u5efa\u200b\u4e00\u4e2a\u200bQgsAuthConfigSelect GUI\u200b\u5b9e\u4f8b\u200b\uff0c\u200b\u8be5\u200b\u5b9e\u4f8b\u200b\u4e0e\u200b`parent`\u200b\u6709\u200b\u7236\u5b50\u5173\u7cfb\u200b\nparent = QWidget()  # GUI\u200b\u7236\u7ea7\u200b\u63a7\u4ef6\u200b\ngui = QgsAuthConfigSelect( parent )\ngui.show()\n</code></pre> <p>\u200b\u53ef\u4ee5\u200b\u5728\u200b\u76f8\u5173\u200b\u7684\u200b\u6d4b\u8bd5\u4ee3\u7801\u200b\u4e2d\u200b\u627e\u5230\u200b\u4e00\u4e2a\u200b\u7efc\u5408\u200b\u7684\u200b\u4f8b\u5b50\u200b\u3002</p>"},{"location":"14-%E8%AE%A4%E8%AF%81%E5%9F%BA%E7%A1%80/#1453","title":"14.5.3 \u200b\u673a\u6784\u200b\uff08\u200b\u8bc1\u4e66\u200b\u9881\u53d1\u200b\uff09\u200b\u7f16\u8f91\u5668","text":"<p>\u200b\u4ec5\u200b\u7528\u4e8e\u200b\u7ba1\u7406\u673a\u6784\u200b\u7684\u200bGUI\u200b\u7531\u200b<code>QGSAuthoritiesEditor</code>\u200b\u7c7b\u200b\u7ba1\u7406\u200b\u3002</p> <p></p> <p>\u200b\u53ef\u200b\u5728\u200b\u4ee5\u4e0b\u200b\u4ee3\u7801\u6bb5\u200b\u4e2d\u200b\u4f7f\u7528\u200b\uff1a</p> <pre><code># \u200b\u521b\u5efa\u200b\u4e00\u4e2a\u200bQgsAuthConfigSelect GUI\u200b\u5b9e\u4f8b\u200b\uff0c\u200b\u8be5\u200b\u5b9e\u4f8b\u200b\u4e0e\u200b`parent`\u200b\u6709\u200b\u7236\u5b50\u5173\u7cfb\u200b\nparent = QWidget() # GUI\u200b\u7236\u7ea7\u200b\u63a7\u4ef6\u200b\ngui = QgsAuthAuthoritiesEditor( parent )\ngui.show()\n</code></pre>"},{"location":"15-%E4%BB%BB%E5%8A%A1%E2%80%94%E2%80%94%E5%9C%A8%E5%90%8E%E5%8F%B0%E5%81%9A%E7%B9%81%E9%87%8D%E7%9A%84%E5%B7%A5%E4%BD%9C/","title":"15-\u200b\u4efb\u52a1\u200b - \u200b\u5728\u200b\u540e\u53f0\u200b\u505a\u200b\u7e41\u91cd\u200b\u7684\u200b\u5de5\u4f5c","text":"<p>\u200b\u672c\u200b\u8282\u200b\u4ee3\u7801\u200b\u7247\u6bb5\u200b\u9700\u200b\u5bfc\u5165\u200b\u4ee5\u4e0b\u200b\u6a21\u5757\u200b\uff1a</p> <pre><code>from qgis.core import (\n    Qgis,\n    QgsApplication,\n    QgsMessageLog,\n    QgsProcessingAlgRunnerTask,\n    QgsProcessingContext,\n    QgsProcessingFeedback,\n    QgsProject,\n    QgsTask,\n    QgsTaskManager,\n)\n</code></pre>"},{"location":"15-%E4%BB%BB%E5%8A%A1%E2%80%94%E2%80%94%E5%9C%A8%E5%90%8E%E5%8F%B0%E5%81%9A%E7%B9%81%E9%87%8D%E7%9A%84%E5%B7%A5%E4%BD%9C/#15-","title":"15 \u200b\u4efb\u52a1\u200b - \u200b\u5728\u200b\u540e\u53f0\u200b\u505a\u200b\u7e41\u91cd\u200b\u7684\u200b\u5de5\u4f5c","text":""},{"location":"15-%E4%BB%BB%E5%8A%A1%E2%80%94%E2%80%94%E5%9C%A8%E5%90%8E%E5%8F%B0%E5%81%9A%E7%B9%81%E9%87%8D%E7%9A%84%E5%B7%A5%E4%BD%9C/#151","title":"15.1 \u200b\u5f15\u8a00","text":"<p>\u200b\u4f7f\u7528\u200b\u7ebf\u7a0b\u200b\u7684\u200b\u540e\u53f0\u200b\u5904\u7406\u200b\uff0c\u200b\u662f\u200b\u5728\u200b\u8fdb\u884c\u200b\u7e41\u91cd\u200b\u5904\u7406\u200b\u65f6\u200b\u4fdd\u6301\u200b\u7528\u6237\u754c\u9762\u200b\u54cd\u5e94\u200b\u7684\u200b\u4e00\u79cd\u200b\u65b9\u5f0f\u200b\u3002\u200b\u4efb\u52a1\u200b\u53ef\u200b\u7528\u4e8e\u200b\u5728\u200bQGIS\u200b\u4e2d\u200b\u5b9e\u73b0\u200b\u7ebf\u7a0b\u200b\u3002</p> <p>\u200b\u4efb\u52a1\u200b\uff08<code>QgsTask</code>\uff09\u200b\u662f\u200b\u5728\u200b\u540e\u53f0\u200b\u6267\u884c\u200b\u4ee3\u7801\u200b\u7684\u200b\u5bb9\u5668\u200b\uff0c\u200b\u4efb\u52a1\u200b\u7ba1\u7406\u200b\uff08<code>QgsTaskManager</code>\uff09\u200b\u7528\u4e8e\u200b\u63a7\u5236\u200b\u4efb\u52a1\u200b\u7684\u200b\u8fd0\u884c\u200b\u3002\u200b\u8fd9\u4e9b\u200b\u7c7b\u200b\u901a\u8fc7\u200b\u63d0\u4f9b\u200b\u4fe1\u53f7\u200b\u4f20\u9012\u200b\u673a\u5236\u200b\u3001\u200b\u8fdb\u5ea6\u200b\u62a5\u544a\u200b\u548c\u200b\u540e\u53f0\u200b\u8fdb\u7a0b\u200b\u72b6\u6001\u200b\u8bbf\u95ee\u200b\u673a\u5236\u200b\uff0c\u200b\u7b80\u5316\u200b\u4e86\u200bQGIS\u200b\u4e2d\u200b\u7684\u200b\u540e\u53f0\u200b\u5904\u7406\u200b\u3002\u200b\u53ef\u4ee5\u200b\u4f7f\u7528\u200b\u5b50\u200b\u4efb\u52a1\u200b\u5bf9\u200b\u4efb\u52a1\u200b\u8fdb\u884c\u200b\u5206\u7ec4\u200b\u3002</p> <p>\u200b\u5168\u5c40\u200b\u4efb\u52a1\u200b\u7ba1\u7406\u5668\u200b\uff08<code>QgsApplication.taskManager()</code>\uff09\u200b\u901a\u5e38\u200b\u88ab\u200b\u4f7f\u7528\u200b\u3002\u200b\u8fd9\u200b\u610f\u5473\u7740\u200b\u4f60\u200b\u7684\u200b\u4efb\u52a1\u200b\u53ef\u80fd\u200b\u4e0d\u662f\u200b\u7531\u200b\u4efb\u52a1\u200b\u7ba1\u7406\u5668\u200b\u63a7\u5236\u200b\u7684\u200b\u552f\u4e00\u200b\u4efb\u52a1\u200b\u3002</p> <p>\u200b\u6709\u200b\u51e0\u79cd\u200b\u65b9\u6cd5\u200b\u53ef\u4ee5\u200b\u521b\u5efa\u200bQGIS\u200b\u4efb\u52a1\u200b\uff1a</p> <ul> <li>\u200b\u901a\u8fc7\u200b\u6269\u5c55\u200b<code>QgsTask</code>\u200b\u521b\u5efa\u200b\u81ea\u5df1\u200b\u7684\u200b\u4efb\u52a1\u200b</li> </ul> <pre><code>class SpecialisedTask(QgsTask):\n    pass\n</code></pre> <ul> <li>\u200b\u4ece\u200b\u51fd\u6570\u200b\u521b\u5efa\u200b\u4efb\u52a1\u200b</li> </ul> <pre><code>def heavyFunction():\n    # \u200b\u4e00\u4e9b\u200bCPU\u200b\u5bc6\u96c6\u578b\u200b\u5904\u7406\u200b ...\n    pass\n\ndef workdone():\n    # ... \u200b\u4f7f\u7528\u200b\u7ed3\u679c\u200b\u505a\u200b\u4e00\u4e9b\u200b\u6709\u7528\u200b\u7684\u200b\u4e8b\u60c5\u200b\n    pass\n\ntask = QgsTask.fromFunction('heavy function', heavyFunction,\n                     on_finished=workdone)\n</code></pre> <ul> <li>\u200b\u4ece\u200b\u5904\u7406\u200b\u7b97\u6cd5\u200b\u521b\u5efa\u200b\u4efb\u52a1\u200b</li> </ul> <pre><code>params = dict()\ncontext = QgsProcessingContext()\ncontext.setProject(QgsProject.instance())\nfeedback = QgsProcessingFeedback()\n\nbuffer_alg = QgsApplication.instance().processingRegistry().algorithmById('native:buffer')\ntask = QgsProcessingAlgRunnerTask(buffer_alg, params, context,feedback)\n</code></pre> <p>Warning</p> <p>\u200b\u4efb\u4f55\u200b\u540e\u53f0\u4efb\u52a1\u200b\uff08\u200b\u65e0\u8bba\u5982\u4f55\u200b\u521b\u5efa\u200b\uff09\u200b\u51b3\u4e0d\u80fd\u200b\u4f7f\u7528\u200b\u4efb\u4f55\u200b\u4e3b\u7ebf\u200b\u7a0b\u4e0a\u200b\u7684\u200bQObject\uff0c\u200b\u6bd4\u5982\u200b\u8bbf\u95ee\u200bQgsVectorLayer, QgsProject\u200b\u6216\u8005\u200b\u6267\u884c\u200b\u4efb\u4f55\u200bGUI\u200b\u64cd\u4f5c\u200b\u2014\u2014\u200b\u6bd4\u5982\u200b\u521b\u5efa\u200b\u65b0\u200b\u7684\u200b\u90e8\u4ef6\u200b\u6216\u8005\u200b\u4e0e\u200b\u73b0\u6709\u200b\u90e8\u4ef6\u200b\u4ea4\u4e92\u200b\u3002\u200b\u53ea\u80fd\u200b\u4ece\u200b\u4e3b\u7ebf\u200b\u7a0b\u200b\u8bbf\u95ee\u200b\u6216\u200b\u4fee\u6539\u200bQt\u200b\u63a7\u4ef6\u200b\u3002\u200b\u5728\u200b\u4efb\u52a1\u200b\u542f\u52a8\u200b\u4e4b\u524d\u200b\uff0c\u200b\u5fc5\u987b\u200b\u590d\u5236\u200b\u4efb\u52a1\u200b\u4e2d\u200b\u4f7f\u7528\u200b\u7684\u200b\u6570\u636e\u200b\u3002\u200b\u8bd5\u56fe\u200b\u4ece\u200b\u540e\u53f0\u200b\u7ebf\u7a0b\u200b\u4f7f\u7528\u200b\u5b83\u4eec\u200b\u5c06\u200b\u5bfc\u81f4\u200b\u5d29\u6e83\u200b\u3002</p> <p>\u200b\u6b64\u5916\u200b\uff0c\u200b\u8bf7\u200b\u59cb\u7ec8\u200b\u786e\u4fdd\u200b\u5e76\u200b context \u200b\u548c\u200b feedback \u200b\u81f3\u5c11\u200b\u4e0e\u200b\u4f7f\u7528\u200b\u5b83\u4eec\u200b\u7684\u200b\u4efb\u52a1\u200b\u4e00\u6837\u200b\u957f\u200b\u3002\u200b\u5982\u679c\u200b\u5728\u200b\u5b8c\u6210\u200b\u4efb\u52a1\u200b\u540e\u200b\uff0cQGSTaskManager\u200b\u65e0\u6cd5\u8bbf\u95ee\u200b\u8ba1\u5212\u200b\u4efb\u52a1\u200b\u7684\u200b\u4e0a\u4e0b\u6587\u200b\u548c\u200b\u53cd\u9988\u200b\uff0c\u200b\u5219\u200bQGIS\u200b\u5c06\u200b\u5d29\u6e83\u200b\u3002</p> <p>Info</p> <p>\u200b\u5728\u200b\u8c03\u7528\u200b <code>QgsProcessingContext</code> \u200b\u540e\u200b\u4e0d\u4e45\u200b\u8c03\u7528\u200b setProject() \u200b\u662f\u200b\u4e00\u79cd\u200b\u5e38\u89c1\u200b\u7684\u200b\u6a21\u5f0f\u200b\u3002\u200b\u8fd9\u200b\u5141\u8bb8\u200b\u4efb\u52a1\u200b\u53ca\u5176\u200b\u56de\u8c03\u200b\u51fd\u6570\u200b\u4f7f\u7528\u200b\u5927\u591a\u6570\u200b\u9879\u76ee\u200b\u8303\u56f4\u200b\u7684\u200b\u8bbe\u7f6e\u200b\u3002\u200b\u8fd9\u200b\u5728\u200b\u56de\u8c03\u200b\u51fd\u6570\u200b\u4e2d\u200b\u4f7f\u7528\u200b\u7a7a\u95f4\u200b\u56fe\u5c42\u200b\u65f6\u200b\u7279\u522b\u200b\u6709\u200b\u4ef7\u503c\u200b\u3002</p> <p>\u200b\u53ef\u4ee5\u200b\u4f7f\u7528\u200b<code>QgsTask</code>\u200b\u4e2d\u200b\u7684\u200b<code>addSubTask()</code> \u200b\u51fd\u6570\u200b\u6765\u200b\u63cf\u8ff0\u200b\u4efb\u52a1\u200b\u4e4b\u95f4\u200b\u7684\u200b\u4f9d\u8d56\u200b\u5173\u7cfb\u200b\u3002\u200b\u5f53\u200b\u58f0\u660e\u200b\u4f9d\u8d56\u200b\u5173\u7cfb\u200b\u65f6\u200b\uff0c\u200b\u4efb\u52a1\u200b\u7ba1\u7406\u5668\u200b\u5c06\u200b\u81ea\u52a8\u200b\u786e\u5b9a\u200b\u5982\u4f55\u200b\u6267\u884c\u200b\u8fd9\u4e9b\u200b\u4f9d\u8d56\u200b\u5173\u7cfb\u200b\u3002\u200b\u53ea\u8981\u200b\u6709\u200b\u53ef\u80fd\u200b\uff0c\u200b\u4f9d\u8d56\u200b\u9879\u200b\u5c06\u200b\u5e76\u884c\u6267\u884c\u200b\uff0c\u200b\u4ee5\u4fbf\u200b\u5c3d\u5feb\u200b\u6ee1\u8db3\u200b\u5b83\u4eec\u200b\u3002\u200b\u5982\u679c\u200b\u53d6\u6d88\u200b\u4e86\u200b\u4e00\u4e2a\u200b\u4efb\u52a1\u200b\u6240\u200b\u4f9d\u8d56\u200b\u7684\u200b\u4efb\u52a1\u200b\uff0c\u200b\u5219\u200b\u76f8\u5173\u200b\u4efb\u52a1\u200b\u4e5f\u200b\u5c06\u200b\u88ab\u200b\u53d6\u6d88\u200b\u3002\u200b\u5faa\u73af\u200b\u4f9d\u8d56\u200b\u53ef\u80fd\u200b\u9020\u6210\u200b\u6b7b\u9501\u200b\uff0c\u200b\u6240\u4ee5\u200b\u8981\u200b\u5c0f\u5fc3\u200b\u3002</p> <p>\u200b\u5982\u679c\u200b\u4efb\u52a1\u200b\u4f9d\u8d56\u4e8e\u200b\u53ef\u7528\u200b\u7684\u200b\u56fe\u5c42\u200b\uff0c\u200b\u5219\u200b\u53ef\u4ee5\u200b\u4f7f\u7528\u200b<code>QgsTask</code>\u200b\u4e2d\u200b\u7684\u200b<code>setDependentLayers</code> \u200b\u51fd\u6570\u200b\u6765\u200b\u58f0\u660e\u200b\u3002\u200b\u5982\u679c\u200b\u4efb\u52a1\u200b\u6240\u200b\u4f9d\u8d56\u200b\u7684\u200b\u56fe\u5c42\u200b\u4e0d\u53ef\u200b\u7528\u200b\uff0c\u200b\u5219\u200b\u8be5\u200b\u4efb\u52a1\u200b\u5c06\u200b\u88ab\u200b\u53d6\u6d88\u200b\u3002</p> <p>\u200b\u521b\u5efa\u200b\u4efb\u52a1\u200b\u540e\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u4f7f\u7528\u200b\u4efb\u52a1\u200b\u7ba1\u7406\u5668\u200b\u7684\u200b<code>addTask()</code>\u200b\u51fd\u6570\u200b\u8c03\u5ea6\u200b\u4efb\u52a1\u200b\u8fd0\u884c\u200b\u3002\u200b\u5411\u200b\u7ba1\u7406\u5668\u200b\u6dfb\u52a0\u200b\u4efb\u52a1\u200b\u4f1a\u200b\u81ea\u52a8\u200b\u5c06\u200b\u8be5\u200b\u4efb\u52a1\u200b\u7684\u200b\u6240\u6709\u6743\u200b\u8f6c\u79fb\u200b\u7ed9\u200b\u7ba1\u7406\u5458\u200b\uff0c\u200b\u7ba1\u7406\u5458\u200b\u5c06\u200b\u5728\u200b\u6267\u884c\u200b\u5b8c\u540e\u200b\u6e05\u7406\u200b\u548c\u200b\u5220\u9664\u200b\u4efb\u52a1\u200b\u3002\u200b\u4efb\u52a1\u200b\u7684\u200b\u8c03\u5ea6\u200b\u53d7\u200b\u4efb\u52a1\u200b\u4f18\u5148\u7ea7\u200b\u7684\u200b\u5f71\u54cd\u200b\uff0c\u200b\u4efb\u52a1\u200b\u4f18\u5148\u7ea7\u200b\u5728\u200b<code>addTask()</code>\u200b\u4e2d\u200b\u8bbe\u7f6e\u200b\u3002</p> <p>\u200b\u4efb\u52a1\u200b\u7684\u200b\u72b6\u6001\u200b\u53ef\u4ee5\u200b\u4f7f\u7528\u200b<code>QgsTask</code>\u3001<code>QgsTaskManager</code>\u200b\u7684\u200b\u4fe1\u53f7\u200b\u548c\u200b\u51fd\u6570\u200b\u8fdb\u884c\u200b\u76d1\u63a7\u200b\u3002</p>"},{"location":"15-%E4%BB%BB%E5%8A%A1%E2%80%94%E2%80%94%E5%9C%A8%E5%90%8E%E5%8F%B0%E5%81%9A%E7%B9%81%E9%87%8D%E7%9A%84%E5%B7%A5%E4%BD%9C/#152","title":"15.2 \u200b\u793a\u4f8b","text":""},{"location":"15-%E4%BB%BB%E5%8A%A1%E2%80%94%E2%80%94%E5%9C%A8%E5%90%8E%E5%8F%B0%E5%81%9A%E7%B9%81%E9%87%8D%E7%9A%84%E5%B7%A5%E4%BD%9C/#1521-qgstask","title":"15.2.1 \u200b\u6269\u5c55\u200bQgsTask","text":"<p>\u200b\u5728\u200b\u6b64\u200b\u793a\u4f8b\u200b\u4e2d\u200b\uff0c<code>RandomIntegerSumTask</code>\u200b\u6269\u5c55\u200b\u4e86\u200b<code>QgsTask</code>\uff0c\u200b\u5b83\u200b\u5c06\u200b\u5728\u200b\u6307\u5b9a\u200b\u7684\u200b\u65f6\u95f4\u6bb5\u200b\u5185\u200b\u751f\u6210\u200b0\u200b\u5230\u200b500\u200b\u4e4b\u95f4\u200b\u7684\u200b100\u200b\u4e2a\u200b\u968f\u673a\u200b\u6574\u6570\u200b\u3002\u200b\u5982\u679c\u200b\u968f\u673a\u6570\u200b\u4e3a\u200b42\uff0c\u200b\u5219\u200b\u4e2d\u6b62\u200b\u4efb\u52a1\u200b\u5e76\u200b\u5f15\u53d1\u200b\u5f02\u5e38\u200b\u3002<code>RandomIntegerSumTask</code>\uff08\u200b\u5e26\u5b50\u200b\u4efb\u52a1\u200b\uff09\u200b\u751f\u6210\u200b\u4e86\u200b\u51e0\u4e2a\u200b\u5b9e\u4f8b\u200b\u5e76\u200b\u5c06\u200b\u5176\u200b\u6dfb\u52a0\u200b\u5230\u200b\u4efb\u52a1\u200b\u7ba1\u7406\u5668\u200b\uff0c\u200b\u5c55\u793a\u200b\u4e24\u79cd\u200b\u7c7b\u578b\u200b\u7684\u200b\u4f9d\u8d56\u200b\u9879\u200b\uff1a</p> <pre><code>import random\nfrom time import sleep\n\nfrom qgis.core import (\n    QgsApplication, QgsTask, QgsMessageLog, Qgis\n    )\n\nMESSAGE_CATEGORY = 'RandomIntegerSumTask'\n\nclass RandomIntegerSumTask(QgsTask):\n    \"\"\"\u200b\u5c55\u793a\u200b\u5982\u4f55\u200b\u5b50\u200b\u7c7b\u5316\u200bQgsTask\"\"\"\n    def __init__(self, description, duration):\n        super().__init__(description, QgsTask.CanCancel)\n        self.duration = duration\n        self.total = 0\n        self.iterations = 0\n        self.exception = None\n\n    def run(self):\n        \"\"\"\u200b\u5728\u200b\u8fd9\u91cc\u200b\u4f60\u200b\u8981\u200b\u5b9e\u73b0\u200b\u4f60\u200b\u7684\u200b\u4efb\u52a1\u200b\u3002\n        \u200b\u5e94\u8be5\u200b\u5b9a\u671f\u200b\u6d4b\u8bd5\u200bisCanceled()\uff0c\u200b\u4ee5\u4fbf\u200b\u4f18\u96c5\u200b\u5730\u200b\u7ec8\u6b62\u200b\u3002\n        \u200b\u6b64\u200b\u65b9\u6cd5\u200b\u5fc5\u987b\u200b\u8fd4\u56de\u200bTrue\u200b\u6216\u200bFalse\u3002\n        \u200b\u5f15\u53d1\u200b\u5f02\u5e38\u200b\u5c06\u200b\u4f7f\u200bQGIS\u200b\u5d29\u6e83\u200b\uff0c\u200b\u56e0\u6b64\u200b\u6211\u4eec\u200b\u5728\u200b\u5185\u90e8\u200b\u5904\u7406\u200b\u8fd9\u4e9b\u200b\u5f02\u5e38\u200b\uff0c\u200b\u5e76\u200b\u5728\u200bself.finished\u200b\u4e2d\u200b\u629b\u51fa\u200b\u3002\n        \"\"\"\n        QgsMessageLog.logMessage('Started task \"{}\"'.format(\n                                     self.description()),\n                                 MESSAGE_CATEGORY, Qgis.Info)\n        wait_time = self.duration / 100\n        for i in range(100):\n            sleep(wait_time)\n            # \u200b\u4f7f\u7528\u200bsetProgress\u200b\u62a5\u544a\u200b\u8fdb\u5ea6\u200b\n            self.setProgress(i)\n            arandominteger = random.randint(0, 500)\n            self.total += arandominteger\n            self.iterations += 1\n            # \u200b\u68c0\u67e5\u200bisCanceled()\u200b\u5904\u7406\u200b\u53d6\u6d88\u200b\n            if self.isCanceled():\n                return False\n            # \u200b\u6a21\u62df\u200b\u5f02\u5e38\u60c5\u51b5\u200b\n            if arandominteger == 42:\n                # \u200b\u4e0d\u8981\u200braise Exception('bad value!')\uff0c\u200b\u5426\u5219\u200b\u5c06\u200b\u4f7f\u200bQGIS\u200b\u5d29\u6e83\u200b\n                self.exception = Exception('bad value!')\n                return False\n        return True\n\n    def finished(self, result):\n        \"\"\"\n        \u200b\u5f53\u200b\u4efb\u52a1\u200b\u5b8c\u6210\u200b\uff08\u200b\u65e0\u8bba\u200b\u6210\u529f\u200b\u4e0e\u5426\u200b\uff09\u200b\u65f6\u200b\uff0c\u200b\u8fd9\u4e2a\u200b\u51fd\u6570\u200b\u4f1a\u200b\u88ab\u200b\u81ea\u52a8\u200b\u8c03\u7528\u200b\u3002\n        \u200b\u4f60\u200b\u53ef\u4ee5\u200b\u901a\u8fc7\u200b\u5b9e\u73b0\u200b finished() \u200b\u6765\u200b\u6267\u884c\u200b\u4efb\u52a1\u200b\u5b8c\u6210\u200b\u540e\u200b\u7684\u200b\u540e\u7eed\u200b\u4e8b\u60c5\u200b\u3002\n        finished\u200b\u603b\u662f\u200b\u4ece\u200b\u4e3b\u7ebf\u200b\u7a0b\u4e2d\u200b\u8c03\u7528\u200b\u7684\u200b\uff0c\u200b\u56e0\u6b64\u200b\u5728\u200b\u8fd9\u91cc\u200b\u8fdb\u884c\u200bGUI\u200b\u64cd\u4f5c\u200b\u548c\u200b\u5f15\u53d1\u200b Python \u200b\u5f02\u5e38\u200b\u662f\u200b\u5b89\u5168\u200b\u7684\u200b\u3002\n        result\u200b\u662f\u200bself.run\u200b\u7684\u200b\u8fd4\u56de\u503c\u200b\u3002\n        \"\"\"\n        if result:\n            QgsMessageLog.logMessage(\n                'Task \"{name}\" completed\\n' \\\n                'Total: {total} (with {iterations} '\\\n              'iterations)'.format(\n                  name=self.description(),\n                  total=self.total,\n                  iterations=self.iterations),\n              MESSAGE_CATEGORY, Qgis.Success)\n        else:\n            if self.exception is None:\n                QgsMessageLog.logMessage(\n                    'Task \"{name}\" not successful but without '\\\n                    'exception (probably the task was manually '\\\n                    'canceled by the user)'.format(\n                        name=self.description()),\n                    MESSAGE_CATEGORY, Qgis.Warning)\n            else:\n                QgsMessageLog.logMessage(\n                    'Task \"{name}\" Exception: {exception}'.format(\n                        name=self.description(),\n                        exception=self.exception),\n                    MESSAGE_CATEGORY, Qgis.Critical)\n                raise self.exception\n\n    def cancel(self):\n        QgsMessageLog.logMessage(\n            'Task \"{name}\" was canceled'.format(\n                name=self.description()),\n            MESSAGE_CATEGORY, Qgis.Info)\n        super().cancel()\n\n\nlongtask = RandomIntegerSumTask('waste cpu long', 20)\nshorttask = RandomIntegerSumTask('waste cpu short', 10)\nminitask = RandomIntegerSumTask('waste cpu mini', 5)\nshortsubtask = RandomIntegerSumTask('waste cpu subtask short', 5)\nlongsubtask = RandomIntegerSumTask('waste cpu subtask long', 10)\nshortestsubtask = RandomIntegerSumTask('waste cpu subtask shortest', 4)\n\n# \u200b\u6dfb\u52a0\u200b\u5b50\u200b\u4efb\u52a1\u200b(shortsubtask)\u200b\u5230\u200bshorttask\u2014\u2014\u200b\u5fc5\u987b\u200b\u5728\u200bminitask\u200b\u548c\u200blongtask\u200b\u5b8c\u6210\u200b\u540e\u200b\u6267\u884c\u200b\nshorttask.addSubTask(shortsubtask, [minitask, longtask])\n# \u200b\u6dfb\u52a0\u200b\u5b50\u200b\u4efb\u52a1\u200b(longsubtask)\u200b\u5230\u200blongtask\u2014\u2014\u200b\u5fc5\u987b\u200b\u7236\u200b\u7ea7\u4efb\u52a1\u200b\u4e4b\u524d\u200b\u8fd0\u884c\u200b\nlongtask.addSubTask(longsubtask, [], QgsTask.ParentDependsOnSubTask)\n# \u200b\u6dfb\u52a0\u200b\u5b50\u200b\u4efb\u52a1\u200b(shortestsubtask)\u200b\u5230\u200blongtask\nlongtask.addSubTask(shortestsubtask)\n\nQgsApplication.taskManager().addTask(longtask)\nQgsApplication.taskManager().addTask(shorttask)\nQgsApplication.taskManager().addTask(minitask)\n\n\n\n\n# RandomIntegerSumTask(0): Started task \"waste cpu subtask shortest\"\n# RandomIntegerSumTask(0): Started task \"waste cpu short\"\n# RandomIntegerSumTask(0): Started task \"waste cpu mini\"\n# RandomIntegerSumTask(0): Started task \"waste cpu subtask long\"\n# RandomIntegerSumTask(3): Task \"waste cpu subtask shortest\" completed\n# RandomTotal: 25452 (with 100 iterations)\n# RandomIntegerSumTask(3): Task \"waste cpu mini\" completed\n# RandomTotal: 23810 (with 100 iterations)\n# RandomIntegerSumTask(3): Task \"waste cpu subtask long\" completed\n# RandomTotal: 26308 (with 100 iterations)\n# RandomIntegerSumTask(0): Started task \"waste cpu long\"\n# RandomIntegerSumTask(3): Task \"waste cpu long\" completed\n# RandomTotal: 22534 (with 100 iterations)\n</code></pre>"},{"location":"15-%E4%BB%BB%E5%8A%A1%E2%80%94%E2%80%94%E5%9C%A8%E5%90%8E%E5%8F%B0%E5%81%9A%E7%B9%81%E9%87%8D%E7%9A%84%E5%B7%A5%E4%BD%9C/#1522","title":"15.2.2 \u200b\u4ece\u200b\u51fd\u6570\u200b\u521b\u5efa\u200b\u4efb\u52a1","text":"<p>\u200b\u4ece\u200b\u51fd\u6570\u200b\u521b\u5efa\u200b\u4efb\u52a1\u200b\uff08\u200b\u672c\u200b\u793a\u4f8b\u200b\u4e2d\u200b\u7684\u200b<code>doSomething</code>\uff09\u3002\u200b\u8be5\u200b\u51fd\u6570\u200b\u7684\u200b\u7b2c\u4e00\u4e2a\u200b\u53c2\u6570\u200b\u4e3a\u200b<code>QgsTask</code> \u3002\u200b\u4e00\u4e2a\u200b\u91cd\u8981\u200b\u7684\u200b\u53c2\u6570\u200b\u662f\u200b<code>on_finished</code>\uff0c\u200b\u5b83\u200b\u662f\u200b\u5728\u200b\u4efb\u52a1\u200b\u5b8c\u6210\u200b\u65f6\u200b\u88ab\u200b\u8c03\u7528\u200b\u7684\u200b\u51fd\u6570\u200b\u3002\u200b\u793a\u4f8b\u200b\u4e2d\u200b\u7684\u200b<code>doSomething</code>\u200b\u51fd\u6570\u200b\u6709\u200b\u53e6\u200b\u4e00\u4e2a\u200b\u53c2\u6570\u200b<code>wait_time</code>\u3002</p> <pre><code>import random\nfrom time import sleep\n\nMESSAGE_CATEGORY = 'TaskFromFunction'\n\ndef doSomething(task, wait_time):\n    \"\"\"\n    \u200b\u629b\u51fa\u200b\u4e00\u4e2a\u200b\u5f02\u5e38\u200b\u7ec8\u6b62\u200b\u4efb\u52a1\u200b\n    \u200b\u6210\u529f\u200b\u5219\u200b\u8fd4\u56de\u200b\u7ed3\u679c\u200b\n    \u200b\u7ed3\u679c\u200b\u5c06\u200b\u548c\u200b\u5f02\u5e38\u200b\u4e00\u8d77\u200b\u4f20\u9012\u200b\u7ed9\u200b (\u200b\u6210\u529f\u200b\u5219\u200b\u4e3a\u200b\u7a7a\u200b)on_finished\u200b\u51fd\u6570\u200b.\n    \u200b\u5982\u679c\u200b\u5b58\u5728\u200b\u5f02\u5e38\u200b\uff0c\u200b\u7ed3\u679c\u200b\u4e3a\u7a7a\u200b\n    \"\"\"\n    QgsMessageLog.logMessage('Started task {}'.format(task.description()),\n                             MESSAGE_CATEGORY, Qgis.Info)\n    wait_time = wait_time / 100\n    total = 0\n    iterations = 0\n    for i in range(100):\n        sleep(wait_time)\n        # \u200b\u4f7f\u7528\u200btask.setProgress\u200b\u62a5\u544a\u200b\u8fdb\u5ea6\u200b\n        task.setProgress(i)\n        arandominteger = random.randint(0, 500)\n        total += arandominteger\n        iterations += 1\n        # \u200b\u68c0\u67e5\u200btask.isCanceled()\u200b\u5904\u7406\u200b\u53d6\u6d88\u200b\n        if task.isCanceled():\n            stopped(task)\n            return None\n        # \u200b\u629b\u51fa\u200b\u5f02\u5e38\u200b\u7ec8\u6b62\u200b\u4efb\u52a1\u200b\n        if arandominteger == 42:\n            raise Exception('bad value!')\n    return {'total': total, 'iterations': iterations,\n            'task': task.description()}\n\ndef stopped(task):\n    QgsMessageLog.logMessage(\n        'Task \"{name}\" was canceled'.format(\n            name=task.description()),\n        MESSAGE_CATEGORY, Qgis.Info)\n\ndef completed(exception, result=None):\n    \"\"\"\u200b\u5f53\u200bdoSomething\u200b\u5b8c\u6210\u200b\u65f6\u200b\u5457\u200b\u8c03\u4f63\u200b\n    \u200b\u5982\u679c\u200b\u629b\u51fa\u200b\u5f02\u5e38\u200b\u5219\u200b\u5f02\u5e38\u200b\u4fe1\u606f\u200b\u4e0d\u662f\u200b\u7a7a\u200b\n    \u200b\u7ed3\u679c\u200b\u662f\u200bdoSomething\u200b\u8fd4\u56de\u200b\u7684\u200b\u7ed3\u679c\u200b\"\"\"\n    if exception is None:\n        if result is None:\n            QgsMessageLog.logMessage(\n                'Completed with no exception and no result '\\\n                '(probably manually canceled by the user)',\n                MESSAGE_CATEGORY, Qgis.Warning)\n        else:\n            QgsMessageLog.logMessage(\n                'Task {name} completed\\n'\n                'Total: {total} ( with {iterations} '\n                'iterations)'.format(\n                    name=result['task'],\n                    total=result['total'],\n                    iterations=result['iterations']),\n                MESSAGE_CATEGORY, Qgis.Info)\n    else:\n        QgsMessageLog.logMessage(\"Exception: {}\".format(exception),\n                                 MESSAGE_CATEGORY, Qgis.Critical)\n        raise exception\n\n# \u200b\u521b\u5efa\u200b\u4e00\u4e9b\u200b\u4efb\u52a1\u200b\ntask1 = QgsTask.fromFunction(u'Waste cpu 1', doSomething,\n                             on_finished=completed, wait_time=4)\ntask2 = QgsTask.fromFunction(u'Waste cpu 2', dosomething,\n                             on_finished=completed, wait_time=3)\nQgsApplication.taskManager().addTask(task1)\nQgsApplication.taskManager().addTask(task2)\n\n\n# RandomIntegerSumTask(0): Started task \"waste cpu subtask short\"\n# RandomTaskFromFunction(0): Started task Waste cpu 1\n# RandomTaskFromFunction(0): Started task Waste cpu 2\n# RandomTaskFromFunction(0): Task Waste cpu 2 completed\n# RandomTotal: 23263 ( with 100 iterations)\n# RandomTaskFromFunction(0): Task Waste cpu 1 completed\n# RandomTotal: 25044 ( with 100 iterations)\n</code></pre>"},{"location":"15-%E4%BB%BB%E5%8A%A1%E2%80%94%E2%80%94%E5%9C%A8%E5%90%8E%E5%8F%B0%E5%81%9A%E7%B9%81%E9%87%8D%E7%9A%84%E5%B7%A5%E4%BD%9C/#1423","title":"14.2.3 \u200b\u5904\u7406\u200b\u7b97\u6cd5\u200b\u4efb\u52a1","text":"<p>\u200b\u521b\u5efa\u200b\u4e00\u4e2a\u200b\u4f7f\u7528\u200b\u7b97\u6cd5\u200b<code>qgis:randompointsinextent</code>\u200b\u7684\u200b\u4efb\u52a1\u200b\uff0c\u200b\u5728\u200b\u6307\u5b9a\u200b\u8303\u56f4\u200b\u5185\u200b\u751f\u6210\u200b50000\u200b\u4e2a\u200b\u968f\u673a\u200b\u70b9\u200b\u3002\u200b\u7ed3\u679c\u200b\u4ee5\u200b\u5b89\u5168\u200b\u7684\u200b\u65b9\u5f0f\u200b\u6dfb\u52a0\u200b\u5230\u200b\u9879\u76ee\u200b\u4e2d\u200b\u3002</p> <pre><code>from functools import partial\nfrom qgis.core import (QgsTaskManager, QgsMessageLog,\n                       QgsProcessingAlgRunnerTask, QgsApplication,\n                       QgsProcessingContext, QgsProcessingFeedback,\n                       QgsProject)\n\nMESSAGE_CATEGORY = 'AlgRunnerTask'\n\ndef task_finished(context, successful, results):\n    if not successful:\n        QgsMessageLog.logMessage('Task finished unsucessfully',\n                                 MESSAGE_CATEGORY, Qgis.Warning)\n    output_layer = context.getMapLayer(results['OUTPUT'])\n    # \u200b\u56e0\u4e3a\u200bgetMapLayer\u200b\u6ca1\u6709\u200b\u79fb\u4ea4\u200b\u6240\u6709\u6743\u200b, \u200b\u5f53\u200b\u4e0a\u4e0b\u6587\u200b\u8d85\u51fa\u8303\u56f4\u200b\u65f6\u200b\u56fe\u5c42\u200b\u5c06\u200b\u88ab\u200b\u5220\u9664\u200b\uff0c\u200b\u4f60\u200b\u4f1a\u200b\u9047\u5230\u200b\u5d29\u6e83\u200b\n    # takeMapLayer\u200b\u79fb\u4ea4\u200b\u6240\u6709\u6743\u200b\uff0c\u200b\u56e0\u6b64\u200b\u5b83\u200b\u5c06\u200b\u5b89\u5168\u200b\u5730\u200b\u6dfb\u52a0\u200b\u5230\u200bQgsProject\u200b\u4e2d\u200b\uff0c\u200b\u5e76\u200b\u8d4b\u4e88\u200bQgsProject\u200b\u6240\u6709\u6743\u200b\n    if output_layer and output_layer.isValid():\n        QgsProject.instance().addMapLayer(\n             context.takeResultLayer(output_layer.id()))\n\nalg = QgsApplication.processingRegistry().algorithmById(\n                                      u'qgis:randompointsinextent')\ncontext = QgsProcessingContext()\nfeedback = QgsProcessingFeedback()\nparams = {\n    'EXTENT': '0.0,10.0,40,50 [EPSG:4326]',\n    'MIN_DISTANCE': 0.0,\n    'POINTS_NUMBER': 50000,\n    'TARGET_CRS': 'EPSG:4326',\n    'OUTPUT': 'memory:My random points'\n}\ntask = QgsProcessingAlgRunnerTask(alg, params, context, feedback)\ntask.executed.connect(partial(task_finished, context))\nQgsApplication.taskManager().addTask(task)\n</code></pre> <p>\u200b\u4e5f\u200b\u53ef\u4ee5\u200b\u67e5\u770b\u200b\u535a\u5ba2\u200b\uff1ahttps://www.opengis.ch/2018/06/22/threads-in-pyqgis3/</p>"},{"location":"16-%E5%BC%80%E5%8F%91Python%E6%8F%92%E4%BB%B6/","title":"16 \u200b\u5f00\u53d1\u200bPython\u200b\u63d2\u4ef6","text":"<p>\u200b\u53ef\u4ee5\u200b\u7528\u200bPython\u200b\u7f16\u7a0b\u8bed\u8a00\u200b\u521b\u5efa\u200b\u63d2\u4ef6\u200b\u3002\u200b\u4e0e\u200b\u7528\u200bC ++\u200b\u7f16\u5199\u200b\u63d2\u4ef6\u200b\u76f8\u6bd4\u200b\uff0c\u200b\u7531\u4e8e\u200bPython\u200b\u8bed\u8a00\u200b\u7684\u200b\u52a8\u6001\u200b\u7279\u6027\u200b\uff0c\u200b\u8fd9\u4e9b\u200b\u63d2\u4ef6\u200b\u5e94\u8be5\u200b\u66f4\u200b\u5bb9\u6613\u200b\u7f16\u5199\u200b\uff0c\u200b\u7406\u89e3\u200b\uff0c\u200b\u7ef4\u62a4\u200b\u548c\u200b\u5206\u53d1\u200b\u3002</p> <p>Python\u200b\u63d2\u4ef6\u200b\u4e0e\u200bQGIS\u200b\u63d2\u4ef6\u200b\u7ba1\u7406\u5668\u200b\u4e2d\u200b\u7684\u200bC ++\u200b\u63d2\u4ef6\u200b\u4e00\u8d77\u200b\u5217\u51fa\u200b\u3002\u200b\u4ed6\u4eec\u200b\u5728\u200b<code>~/(UserProfile)/python/plugins</code>\u200b\u548c\u200b\u4ee5\u4e0b\u200b\u8def\u5f84\u200b\u4e2d\u200b\u641c\u7d22\u200b\uff1a</p> <ul> <li>UNIX / Mac\u200b\u4e0a\u200b\uff1a <code>(qgis_prefix)/share/qgis/python/plugins</code></li> <li>Windows\uff1a <code>(qgis_prefix)/python/plugins</code></li> </ul> <p>\u200b\u6709\u5173\u200b<code>~</code>\u200b\u548c\u200b<code>(UserProfile)</code>\u200b\u7684\u200b\u5b9a\u4e49\u200b,\u200b\u8bf7\u200b\u67e5\u770b\u200bCore\u200b\u548c\u200bExternal\u200b\u63d2\u4ef6\u200b\u3002</p> <p>\u200b\u63d0\u793a\u200b</p> <p>\u200b\u5c06\u200bQGIS_PLUGINPATH\u200b\u8bbe\u7f6e\u200b\u4e3a\u200b\u4e00\u4e2a\u200b\u5b58\u5728\u200b\u7684\u200b\u76ee\u5f55\u200b\u8def\u5f84\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u5c06\u200b\u6b64\u200b\u8def\u5f84\u200b\u6dfb\u52a0\u200b\u5230\u200b\u63d2\u4ef6\u200b\u7684\u200b\u641c\u7d22\u200b\u8def\u5f84\u200b\u5217\u8868\u200b\u4e2d\u200b\u3002</p>"},{"location":"16-%E5%BC%80%E5%8F%91Python%E6%8F%92%E4%BB%B6/#161-python","title":"16.1 \u200b\u6784\u5efa\u200bPython\u200b\u63d2\u4ef6","text":"<p>\u200b\u521b\u5efa\u200b\u63d2\u4ef6\u200b\uff0c\u200b\u9700\u8981\u200b\u4ee5\u4e0b\u200b\u6b65\u9aa4\u200b\uff1a</p> <ol> <li>\u200b\u60f3\u6cd5\u200b\uff1a\u200b\u4f60\u200b\u60f3\u8981\u200b\u4f7f\u7528\u200b\u65b0\u200b\u7684\u200bQGIS\u200b\u63d2\u4ef6\u200b\u505a\u200b\u4ec0\u4e48\u200b\u3002\u200b\u4f60\u200b\u4e3a\u4ec0\u4e48\u200b\u8981\u200b\u8fd9\u4e48\u200b\u505a\u200b\uff1f\u200b\u4f60\u200b\u60f3\u200b\u89e3\u51b3\u200b\u4ec0\u4e48\u200b\u95ee\u9898\u200b\uff1f\u200b\u8fd9\u4e2a\u200b\u95ee\u9898\u200b\u5df2\u7ecf\u200b\u6709\u200b\u53e6\u200b\u4e00\u4e2a\u200b\u63d2\u4ef6\u200b\u5417\u200b\uff1f</li> <li>\u200b\u521b\u5efa\u200b\u6587\u4ef6\u200b\uff1a\u200b\u4e00\u4e9b\u200b\u5fc5\u8981\u200b\u6587\u4ef6\u200b\uff08\u200b\u67e5\u770b\u200b\u63d2\u4ef6\u200b\u6587\u4ef6\u200b\uff09</li> <li>\u200b\u7f16\u5199\u200b\u4ee3\u7801\u200b\uff1a\u200b\u5728\u200b\u6070\u5f53\u200b\u7684\u200b\u6587\u4ef6\u200b\u4e2d\u5199\u200b\u4ee3\u7801\u200b</li> <li>\u200b\u6587\u6863\u200b\uff1a\u200b\u7f16\u5199\u200b\u63d2\u4ef6\u200b\u6587\u6863\u200b </li> <li>\u200b\u53ef\u200b\u9009\u200b\uff1a\u200b\u7ffb\u8bd1\u200b\uff1a\u200b\u5c06\u200b\u63d2\u4ef6\u200b\u7ffb\u8bd1\u6210\u200b\u4e0d\u540c\u200b\u7684\u200b\u8bed\u8a00\u200b</li> <li>\u200b\u6d4b\u8bd5\u200b\uff1a\u200b\u5982\u679c\u200b\u51c6\u5907\u5c31\u7eea\u200b\uff0c\u200b\u91cd\u65b0\u200b\u52a0\u8f7d\u200b\u63d2\u4ef6\u200b</li> <li>\u200b\u53d1\u5e03\u200b\uff1a\u200b\u5728\u200bQGIS\u200b\u4ed3\u5e93\u200b\u4e2d\u200b\u53d1\u5e03\u200b\u4f60\u200b\u7684\u200b\u63d2\u4ef6\u200b\u6216\u200b\u5c06\u200b\u4f60\u200b\u81ea\u5df1\u200b\u7684\u200b\u4ed3\u5e93\u200b\u4f5c\u4e3a\u200b\u4e2a\u4eba\u200b\u201cGIS\u200b\u6b66\u5668\u200b\u201d\u200b\u7684\u200b\u201c\u200b\u6b66\u5668\u5e93\u200b\u201d\u3002</li> </ol>"},{"location":"16-%E5%BC%80%E5%8F%91Python%E6%8F%92%E4%BB%B6/#1611","title":"16.1.1 \u200b\u51c6\u5907\u200b\u5f00\u59cb","text":"<p>\u200b\u5728\u200b\u5f00\u59cb\u200b\u7f16\u5199\u200b\u65b0\u200b\u7684\u200b\u63d2\u4ef6\u200b\u4e4b\u524d\u200b\uff0c\u200b\u5148\u200b\u770b\u770b\u200bPython\u200b\u5b98\u65b9\u200b\u63d2\u4ef6\u200b\u5e93\u200b\u3002\u200b\u73b0\u6709\u200b\u63d2\u4ef6\u200b\u7684\u200b\u6e90\u4ee3\u7801\u200b\u53ef\u4ee5\u200b\u5e2e\u52a9\u200b\u4f60\u200b\u4e86\u89e3\u200b\u66f4\u200b\u591a\u200b\u7f16\u7a0b\u200b\u77e5\u8bc6\u200b\u3002\u200b\u4f60\u200b\u4e5f\u200b\u53ef\u80fd\u200b\u4f1a\u200b\u53d1\u73b0\u200b\u7c7b\u4f3c\u200b\u7684\u200b\u63d2\u4ef6\u200b\u5df2\u7ecf\u200b\u5b58\u5728\u200b\uff0c\u200b\u4f60\u200b\u53ef\u4ee5\u200b\u6269\u5c55\u200b\u5b83\u200b\uff0c\u200b\u6216\u8005\u200b\u81f3\u5c11\u200b\u5728\u200b\u5b83\u200b\u7684\u200b\u57fa\u7840\u200b\u4e0a\u200b\u5f00\u53d1\u200b\u81ea\u5df1\u200b\u7684\u200b\u63d2\u4ef6\u200b\u3002</p>"},{"location":"16-%E5%BC%80%E5%8F%91Python%E6%8F%92%E4%BB%B6/#16111","title":"16.1.1.1 \u200b\u63d2\u4ef6\u200b\u6587\u4ef6\u200b\u7ed3\u6784","text":"<p>\u200b\u5f00\u59cb\u200b\u4f7f\u7528\u200b\u4e00\u4e2a\u200b\u65b0\u200b\u7684\u200b\u63d2\u4ef6\u200b\uff0c\u200b\u6211\u4eec\u200b\u9700\u8981\u200b\u8bbe\u7f6e\u200b\u5fc5\u8981\u200b\u7684\u200b\u63d2\u4ef6\u200b\u6587\u4ef6\u200b\u3002</p> <p>\u200b\u6709\u200b\u4e24\u79cd\u200b\u63d2\u4ef6\u200b\u6a21\u677f\u200b\u8d44\u6e90\u200b\u53ef\u4ee5\u200b\u5e2e\u52a9\u200b\u4f60\u200b\u5165\u95e8\u200b\uff1a</p> <ul> <li>\u200b\u4e3a\u4e86\u200b\u6559\u80b2\u200b\u76ee\u7684\u200b\u6216\u8005\u200b\u5728\u200b\u9700\u8981\u200b\u91c7\u7528\u200b\u6781\u7b80\u200b\u4e3b\u4e49\u200b\u65b9\u6cd5\u200b\u65f6\u200b\uff0c\u200b\u6700\u5c0f\u5316\u200b\u63d2\u4ef6\u200b\u6a21\u677f\u200b\u63d0\u4f9b\u200b\u4e86\u200b\u521b\u5efa\u200b\u6709\u6548\u200b\u7684\u200bQGIS Python\u200b\u63d2\u4ef6\u200b\u6240\u200b\u9700\u200b\u7684\u200b\u57fa\u672c\u200b\u6587\u4ef6\u200b\uff08\u200b\u6846\u67b6\u200b\uff09\u3002</li> <li>\u200b\u66f4\u52a0\u200b\u5b8c\u6574\u200b\u7684\u200b\u63d2\u4ef6\u200b\u6a21\u677f\u200b\uff0c\u200b\u63d2\u4ef6\u200b\u6784\u5efa\u200b\u5668\u200b\u53ef\u4ee5\u200b\u521b\u5efa\u200b\u591a\u79cd\u4e0d\u540c\u200b\u7c7b\u578b\u200b\u7684\u200b\u63d2\u4ef6\u200b\u6a21\u677f\u200b\uff0c\u200b\u5305\u62ec\u200b\u672c\u5730\u5316\u200b\uff08\u200b\u7ffb\u8bd1\u200b\uff09\u200b\u548c\u200b\u6d4b\u8bd5\u200b\u7b49\u200b\u529f\u80fd\u200b\u3002</li> </ul> <p>\u200b\u5178\u578b\u200b\u7684\u200b\u63d2\u4ef6\u200b\u76ee\u5f55\u200b\u5305\u62ec\u200b\u4ee5\u4e0b\u200b\u6587\u4ef6\u200b\uff1a</p> <ul> <li><code>metadata.txt</code> - \u200b\u5fc5\u987b\u200b - \u200b\u5305\u542b\u200b\u63d2\u4ef6\u200b\u7f51\u7ad9\u200b\u548c\u200b\u63d2\u4ef6\u200b\u57fa\u7840\u200b\u7ed3\u6784\u200b\u4f7f\u7528\u200b\u7684\u200b\u5e38\u89c4\u200b\u4fe1\u606f\u200b\uff0c\u200b\u7248\u672c\u200b\u3001\u200b\u540d\u79f0\u200b\u548c\u200b\u4e00\u4e9b\u200b\u5176\u4ed6\u200b\u5143\u200b\u6570\u636e\u200b\u3002</li> <li><code>__init__.py</code> - \u200b\u5fc5\u987b\u200b - \u200b\u63d2\u4ef6\u200b\u7684\u200b\u5165\u53e3\u200b\u3002\u200b\u5b83\u200b\u5fc5\u987b\u200b\u5177\u6709\u200b <code>classFactory()</code>\u200b\u65b9\u6cd5\u200b\uff0c\u200b\u8fd8\u200b\u53ef\u4ee5\u200b\u5177\u6709\u200b\u4efb\u4f55\u200b\u5176\u4ed6\u200b\u521d\u59cb\u5316\u200b\u4ee3\u7801\u200b\u3002</li> <li><code>mainPlugin.py</code> - \u200b\u6838\u5fc3\u200b\u4ee3\u7801\u200b - \u200b\u63d2\u4ef6\u200b\u7684\u200b\u4e3b\u8981\u200b\u5de5\u4f5c\u200b\u4ee3\u7801\u200b\u3002\u200b\u5305\u542b\u200b\u6709\u5173\u200b\u63d2\u4ef6\u200b\u64cd\u4f5c\u200b\u548c\u200b\u4e3b\u8981\u200b\u4ee3\u7801\u200b\u7684\u200b\u6240\u6709\u200b\u4fe1\u606f\u200b\u3002</li> <li><code>form.ui</code> - \u200b\u63d2\u4ef6\u200b\u81ea\u5b9a\u4e49\u200bUI - Qt\u200b\u8bbe\u8ba1\u5e08\u200b\u521b\u5efa\u200b\u7684\u200bGUI\u3002</li> <li><code>form.py</code> - \u200b\u7f16\u8bd1\u200b\u7684\u200bGUI - \u200b\u5c06\u200b\u4e0a\u9762\u200b\u63cf\u8ff0\u200b\u7684\u200bform.ui\u200b\u8f6c\u6362\u200b\u4e3a\u200bPython\u200b\u4ee3\u7801\u200b\u3002</li> <li><code>resources.qrc</code> - \u200b\u53ef\u200b\u9009\u200b - Qt\u200b\u8bbe\u8ba1\u5e08\u200b\u521b\u5efa\u200b\u7684\u200bxml\u200b\u6587\u6863\u200b\u3002\u200b\u5305\u542b\u200b\u8868\u5355\u200b\u8d44\u6e90\u200b\u7684\u200b\u76f8\u5bf9\u8def\u5f84\u200b\u3002</li> <li><code>resources.py</code> - \u200b\u7f16\u8bd1\u200b\u7684\u200b\u8d44\u6e90\u200b\u6587\u4ef6\u200b\uff0c\u200b\u53ef\u200b\u9009\u200b - \u200b\u5c06\u200b\u4e0a\u8ff0\u200b.qrc\u200b\u6587\u4ef6\u200b\u8f6c\u6362\u200b\u4e3a\u200bPython\u200b\u4ee3\u7801\u200b\u3002</li> </ul> <p>Warning</p> <p>\u200b\u5982\u679c\u200b\u60a8\u200b\u6253\u7b97\u200b\u5c06\u200b\u63d2\u4ef6\u200b\u4e0a\u200b\u4f20\u5230\u200bPython\u200b\u5b98\u65b9\u200b\u63d2\u4ef6\u200b\u5e93\u200b\uff0c\u200b\u5219\u200b\u5fc5\u987b\u200b\u68c0\u67e5\u200b\u63d2\u4ef6\u200b\u662f\u5426\u200b\u9075\u5faa\u200b\u63d2\u4ef6\u200b\u9a8c\u8bc1\u200b\u6240\u200b\u5fc5\u9700\u200b\u7684\u200b\u4e00\u4e9b\u200b\u9644\u52a0\u200b\u89c4\u5219\u200b</p>"},{"location":"16-%E5%BC%80%E5%8F%91Python%E6%8F%92%E4%BB%B6/#1612","title":"16.1.2 \u200b\u7f16\u5199\u200b\u63d2\u4ef6\u200b\u4ee3\u7801","text":"<p>\u200b\u4ee5\u4e0b\u200b\u90e8\u5206\u200b\u663e\u793a\u200b\u4e86\u200b\u5e94\u8be5\u200b\u5728\u200b\u4e0a\u9762\u200b\u4ecb\u7ecd\u200b\u7684\u200b\u6bcf\u4e2a\u200b\u6587\u4ef6\u200b\u4e2d\u200b\u6dfb\u52a0\u200b\u54ea\u4e9b\u200b\u5185\u5bb9\u200b\u3002</p>"},{"location":"16-%E5%BC%80%E5%8F%91Python%E6%8F%92%E4%BB%B6/#16121-metadatatxt","title":"16.1.2.1 metadata.txt","text":"<p>\u200b\u9996\u5148\u200b\uff0c\u200b\u63d2\u4ef6\u200b\u7ba1\u7406\u5668\u200b\u9700\u8981\u200b\u68c0\u7d22\u200b\u6709\u5173\u200b\u63d2\u4ef6\u200b\u7684\u200b\u4e00\u4e9b\u200b\u57fa\u672c\u200b\u4fe1\u606f\u200b\uff0c\u200b\u4f8b\u5982\u200b\u5176\u200b\u540d\u79f0\u200b\u3001\u200b\u63cf\u8ff0\u200b\u7b49\u200b\u3002\u200b\u6587\u4ef6\u200b<code>metadata.txt</code>\u200b\u5b58\u50a8\u200b\u6b64\u200b\u4fe1\u606f\u200b\u3002</p> <p>\u200b\u63d0\u793a\u200b</p> <p>\u200b\u6240\u6709\u200b\u5143\u200b\u6570\u636e\u200b\u5fc5\u987b\u200b\u91c7\u7528\u200bUTF-8\u200b\u7f16\u7801\u200b\u3002</p> \u200b\u5143\u200b\u6570\u636e\u200b\u540d\u79f0\u200b \u200b\u662f\u5426\u200b\u5fc5\u9700\u200b \u200b\u63cf\u8ff0\u200b name \u200b\u662f\u200b \u200b\u63d2\u4ef6\u200b\u540d\u79f0\u200b\uff0c\u200b\u77ed\u200b\u5b57\u7b26\u4e32\u200b qgisMinimumVersion \u200b\u662f\u200b \u200b\u6700\u5c0f\u200bQGIS\u200b\u7248\u672c\u200b qgisMaximumVersion \u200b\u5426\u200b \u200b\u6700\u5927\u200bQGIS\u200b\u7248\u672c\u200b description \u200b\u662f\u200b \u200b\u63cf\u8ff0\u200b\u63d2\u4ef6\u200b\u7684\u200b\u7b80\u77ed\u200b\u6587\u672c\u200b\uff0c\u200b\u4e0d\u200b\u652f\u6301\u200bHTML about \u200b\u662f\u200b \u200b\u8f83\u957f\u200b\u7684\u200b\u6587\u672c\u200b\uff0c\u200b\u8be6\u7ec6\u63cf\u8ff0\u200b\u63d2\u4ef6\u200b\uff0c\u200b\u4e0d\u200b\u652f\u6301\u200bHTML version \u200b\u662f\u200b \u200b\u7248\u672c\u200b author \u200b\u662f\u200b \u200b\u4f5c\u8005\u59d3\u540d\u200b email \u200b\u662f\u200b \u200b\u4f5c\u8005\u200b\u7684\u200b\u7535\u5b50\u90ae\u4ef6\u200b\uff0c\u200b\u5728\u200b\u7f51\u7ad9\u200b\u4e0a\u4ec5\u200b\u663e\u793a\u200b\u7ed9\u200b\u767b\u5f55\u200b\u7684\u200b\u7528\u6237\u200b\uff0c\u200b\u4f46\u200b\u5728\u200b\u63d2\u4ef6\u200b\u5b89\u88c5\u200b\u540e\u200b\u53ef\u200b\u5728\u200b\u63d2\u4ef6\u200b\u7ba1\u7406\u5668\u200b\u4e2d\u200b\u770b\u5230\u200b changelog \u200b\u5426\u200b \u200b\u5b57\u7b26\u4e32\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u662f\u200b\u591a\u884c\u200b\uff0c\u200b\u4e0d\u200b\u652f\u6301\u200bHTML experimental \u200b\u5426\u200b \u200b\u5b9e\u9a8c\u6027\u200b\uff0c\u200b\u5e03\u5c14\u503c\u200b\uff0cTrue\u200b\u6216\u200bFalse deprecated \u200b\u5426\u200b \u200b\u5f03\u7528\u200b\uff0cboolean\u200b\u503c\u200b\uff0cTrue\u200b\u6216\u200bFalse\uff0c\u200b\u9002\u7528\u200b\u4e8e\u200b\u6574\u4e2a\u200b\u63d2\u4ef6\u200b\uff0c\u200b\u800c\u200b\u4e0d\u4ec5\u4ec5\u200b\u9002\u7528\u200b\u4e8e\u200b\u4e0a\u4f20\u200b\u7684\u200b\u7248\u672c\u200b tags \u200b\u5426\u200b \u200b\u4ee5\u200b\u9017\u53f7\u200b\u5206\u9694\u200b\u7684\u200b\u5217\u8868\u200b\uff0c\u200b\u5141\u8bb8\u200b\u5728\u200b\u5355\u4e2a\u200b\u6807\u8bb0\u200b\u5185\u200b\u4f7f\u7528\u200b\u7a7a\u683c\u200b homepage \u200b\u5426\u200b \u200b\u6307\u5411\u200b\u63d2\u4ef6\u200b\u4e3b\u9875\u200b\u7684\u200b\u6709\u6548\u200b\u7f51\u5740\u200b repository \u200b\u662f\u200b \u200b\u6e90\u4ee3\u7801\u200b\u5b58\u50a8\u200b\u5e93\u200b\u7684\u200b\u6709\u6548\u200bURL tracker \u200b\u5426\u200b \u200b\u6545\u969c\u200b\u548c\u200b\u9519\u8bef\u62a5\u544a\u200b\u7684\u200b\u6709\u6548\u200bURL icon \u200b\u5426\u200b \u200b\u5bf9\u4e8e\u200bweb\u200b\u53cb\u597d\u200b\u7684\u200b\u56fe\u50cf\u200b\uff08PNG\uff0cJPEG\uff09\u200b\u6587\u4ef6\u540d\u200b\u6216\u200b\u76f8\u5bf9\u8def\u5f84\u200b\uff08\u200b\u76f8\u5bf9\u200b\u4e8e\u200b\u63d2\u4ef6\u200b\u538b\u7f29\u5305\u200b\u7684\u200b\u6587\u4ef6\u5939\u200b\uff09 category \u200b\u5426\u200b <code>Raster</code>, <code>Vector</code>, <code>Database</code>, <code>Mesh</code> and <code>Web</code>\uff08\u200b\u6805\u683c\u200b\u3001\u200b\u77e2\u91cf\u200b\u3001\u200b\u6570\u636e\u5e93\u200b\u548c\u200b\u7f51\u7edc\u200b\uff09 plugin_dependencies \u200b\u5426\u200b \u200b\u7c7b\u4f3c\u200b\u4e8e\u200bPIP\u200b\u7684\u200b\u9017\u53f7\u200b\u5206\u9694\u200b\u7684\u200b\u5176\u4ed6\u200b\u63d2\u4ef6\u200b\u5217\u8868\u200b\uff0c\u200b\u4f7f\u7528\u200b\u6765\u81ea\u200b\u5143\u200b\u6570\u636e\u200b\u540d\u79f0\u200b\u5b57\u6bb5\u200b\u7684\u200b\u63d2\u4ef6\u200b\u540d\u79f0\u200b server \u200b\u5426\u200b \u200b\u5e03\u5c14\u503c\u200b\uff0cTrue\u200b\u6216\u200bFalse\uff0c\u200b\u786e\u5b9a\u200b\u63d2\u4ef6\u200b\u662f\u5426\u200b\u5177\u6709\u200b\u670d\u52a1\u5668\u200b\u63a5\u53e3\u200b hasProcessingProvider \u200b\u5426\u200b \u200b\u5e03\u5c14\u503c\u200b\uff0cTrue\u200b\u6216\u200bFalse\uff0c\u200b\u786e\u5b9a\u200b\u63d2\u4ef6\u200b\u662f\u5426\u200b\u63d0\u4f9b\u200b\u5904\u7406\u200b\u7b97\u6cd5\u200b <p>\u200b\u9ed8\u8ba4\u200b\u60c5\u51b5\u200b\u4e0b\u200b\uff0c\u200b\u63d2\u4ef6\u200b\u653e\u5728\u200b Plugins \u200b\u83dc\u5355\u200b\u4e2d\u200b\uff08\u200b\u6211\u4eec\u200b\u5c06\u200b\u5728\u200b\u4e0b\u200b\u4e00\u8282\u200b\u4e2d\u200b\u770b\u5230\u200b\u5982\u4f55\u200b\u4e3a\u200b\u63d2\u4ef6\u200b\u6dfb\u52a0\u200b\u83dc\u5355\u9879\u200b\uff09\uff0c\u200b\u4f46\u200b\u4e5f\u200b\u53ef\u4ee5\u200b\u5c06\u200b\u5b83\u4eec\u200b\u653e\u5165\u200b Raster \uff0c Vector \uff0c Database \uff0cMesh \u200b\u548c\u200b Web \u200b\u83dc\u5355\u200b\u4e2d\u200b\u3002</p> <p>\u200b\u8f93\u5165\u200b\u6307\u5b9a\u200b\u7684\u200b\u201ccategory\u201d\u200b\u5143\u200b\u6570\u636e\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u76f8\u5e94\u200b\u5730\u200b\u5bf9\u200b\u63d2\u4ef6\u200b\u8fdb\u884c\u200b\u5206\u7c7b\u200b\u3002\u200b\u6b64\u5143\u200b\u6570\u636e\u200b\u7528\u4e8e\u200b\u63d0\u793a\u200b\u7528\u6237\u200b\uff0c\u200b\u5e76\u200b\u544a\u8bc9\u200b\u4ed6\u4eec\u200b\u53ef\u4ee5\u200b\u5728\u200b\u54ea\u91cc\u200b\uff08\u200b\u5728\u200b\u54ea\u4e2a\u200b\u83dc\u5355\u200b\u4e2d\u200b\uff09\u200b\u627e\u5230\u200b\u8be5\u200b\u63d2\u4ef6\u200b\u3002\u201ccategory\u201d\u200b\u7684\u200b\u5141\u8bb8\u503c\u200b\u4e3a\u200b\uff1aVector, Raster, Database\u200b\u6216\u8005\u200bWeb\u3002\u200b\u4f8b\u5982\u200b\uff0c\u200b\u5982\u679c\u200b\u4f60\u200b\u7684\u200b\u63d2\u4ef6\u200b\u53ef\u4ee5\u200b\u4ece\u200bRaster\u200b\u83dc\u5355\u200b\u4e2d\u200b\u627e\u5230\u200b\uff0c\u200b\u8bf7\u200b\u5c06\u200b\u5176\u200b\u6dfb\u52a0\u200b\u5230\u200b<code>metadata.txt</code>\u200b\u4e2d\u200b</p> <pre><code>category=Raster\n</code></pre> <p>\u200b\u63d0\u793a\u200b</p> <p>\u200b\u5982\u679c\u200bqgisMaximumVersion\u200b\u4e3a\u7a7a\u200b\uff0c\u200b\u5219\u200b\u5728\u200b\u4e0a\u200b\u4f20\u5230\u200b\u5b98\u65b9\u200bPython\u200b\u63d2\u4ef6\u200b\u5e93\u65f6\u200b\uff0c\u200b\u5b83\u200b\u5c06\u200b\u81ea\u52a8\u200b\u8bbe\u7f6e\u200b\u4e3a\u200b\u4e3b\u8981\u200b\u7248\u672c\u200b\u52a0\u4e0a\u200b.99\uff08\u200b\u4f8b\u5982\u200b\uff1a3.99\uff09\u3002</p> <p>metadata.txt\u200b\u793a\u4f8b\u200b\uff1a</p> <pre><code>; \u200b\u4ee5\u4e0b\u200b\u662f\u200b\u5f3a\u5236\u6027\u200b\u7684\u200b\n\n[general]\nname=HelloWorld\nemail=me@example.com\nauthor=Just Me\nqgisMinimumVersion=3.0\ndescription=This is an example plugin for greeting the world.\\\n    Multiline is allowed:\\\n    lines starting with spaces belong to the same\\\n    field, in this case to the \"description\" field.\\\n    HTML formatting is not allowed.\nabout=This paragraph can contain a detailed description\\\n    of the plugin. Multiline is allowed, HTML is not.\nversion=version 1.2\ntracker=http://bugs.itopen.it\nrepository=http://www.itopen.it/repo\n; \u200b\u7ed3\u675f\u200b\u5f3a\u5236\u200b\n\n; \u200b\u4ee5\u4e0b\u200b\u662f\u200b\u53ef\u9009\u200b\u7684\u200b\ncategory=Raster\nchangelog=The changelog lists the plugin versions\\\n    and their changes as in the example below:\\\n    1.0 - First stable release\\\n    0.9 - All features implemented\\\n    0.8 - First testing release\n\n; \u200b\u6807\u7b7e\u200b\u91c7\u7528\u200b\u9017\u53f7\u200b\u5206\u9694\u200b\uff0c\u200b\u6807\u7b7e\u200b\u540d\u79f0\u200b\u5141\u8bb8\u200b\u4f7f\u7528\u200b\u7a7a\u683c\u200b\n; \u200b\u6807\u7b7e\u200b\u5e94\u8be5\u200b\u662f\u200b\u82f1\u6587\u200b\u7684\u200b\uff0c\u200b\u5728\u200b\u521b\u5efa\u200b\u4e4b\u524d\u200b\u8bf7\u200b\u68c0\u67e5\u200b\u73b0\u6709\u200b\u6807\u7b7e\u200b\u548c\u200b\u540c\u4e49\u8bcd\u200b\ntags=wkt,raster,hello world\n\n; \u200b\u8fd9\u4e9b\u200b\u5143\u200b\u6570\u636e\u200b\u53ef\u4ee5\u200b\u4e3a\u7a7a\u200b\uff0c\u200b\u6700\u7ec8\u200b\u5c06\u200b\u6210\u4e3a\u200b\u5f3a\u5236\u6027\u200b\u7684\u200b\u3002\nhomepage=https://www.itopen.it\nicon=icon.png\n\n; \u200b\u5b9e\u9a8c\u200b\u6807\u5fd7\u200b\uff08\u200b\u9002\u7528\u200b\u4e8e\u200b\u5355\u4e00\u200b\u7248\u672c\u200b\uff09\nexperimental=True\n\n; \u200b\u5f03\u7528\u200b\u6807\u5fd7\u200b \uff08\u200b\u9002\u7528\u200b\u4e8e\u200b\u6574\u4e2a\u200b\u63d2\u4ef6\u200b\uff0c\u200b\u4e0d\u4ec5\u200b\u9002\u7528\u200b\u4e8e\u200b\u4e0a\u4f20\u200b\u7684\u200b\u7248\u672c\u200b\uff09\ndeprecated=False\n\n; \u200b\u5982\u679c\u200b\u4e3a\u7a7a\u200b\uff0c\u200b\u5b83\u200b\u5c06\u200b\u81ea\u52a8\u200b\u8bbe\u7f6e\u200b\u4e3a\u200b\u4e3b\u8981\u200b\u7248\u672c\u200b+.99\nqgisMaximumVersion=3.99\n\n; \u200b\u4ece\u200b QGIS 3.8\u200b\u5f00\u59cb\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u6307\u5b9a\u200b\u4ee5\u200b\u9017\u53f7\u200b\u5206\u9694\u200b\u6307\u5b9a\u200b\u8981\u200b\u5b89\u88c5\u200b\uff08\u200b\u6216\u200b\u66f4\u65b0\u200b\uff09\u200b\u7684\u200b\u63d2\u4ef6\u200b\u5217\u8868\u200b\n; \u200b\u4e0b\u9762\u200b\u793a\u4f8b\u200b\u5b89\u88c5\u200b\u6216\u200b\u66f4\u65b0\u200b\u7248\u672c\u200b1.12\u200b\u7684\u200b\u201cMyOtherPlugin\u201d\u200b\u548c\u200b\u4efb\u4f55\u200b\u7248\u672c\u200b\u7684\u200b\u201cYetAnotherPlugin\u201d\nplugin_dependencies=MyOtherPlugin==1.12,YetAnotherPlugin\n</code></pre>"},{"location":"16-%E5%BC%80%E5%8F%91Python%E6%8F%92%E4%BB%B6/#16122-__init__py","title":"16.1.2.2 __init__.py","text":"<p>Python\u200b\u5305\u200b\u9700\u8981\u200b\u6b64\u200b\u6587\u4ef6\u200b\u3002\u200b\u6b64\u5916\u200b\uff0cQGIS\u200b\u8981\u6c42\u200b\u6b64\u200b\u6587\u4ef6\u200b\u5305\u542b\u200b\u4e00\u4e2a\u200b<code>classFactory()</code>\u200b\u51fd\u6570\u200b\uff0c\u200b\u8be5\u200b\u51fd\u6570\u200b\u5728\u200b\u63d2\u4ef6\u200b\u88ab\u200b\u52a0\u8f7d\u200b\u5230\u200bQGIS\u200b\u65f6\u200b\u8c03\u7528\u200b\u3002\u200b\u5b83\u200b\u63a5\u6536\u200b<code>QgisInterface</code>\u200b\u5b9e\u4f8b\u200b\uff0c \u200b\u5e76\u4e14\u200b\u5fc5\u987b\u200b\u8fd4\u56de\u200b<code>mainplugin.py</code>\u200b\u4e2d\u200b\u63d2\u4ef6\u200b\u7c7b\u200b\u7684\u200b\u5bf9\u8c61\u200b\u2014\u2014\u200b\u5728\u200b\u6211\u4eec\u200b\u7684\u200b\u4f8b\u5b50\u200b\u4e2d\u200b\u5b83\u200b\u88ab\u200b\u547d\u540d\u200b\u4e3a\u200b<code>TestPlugin</code>\uff08\u200b\u89c1\u4e0b\u6587\u200b\uff09\u3002<code>__init__.py</code>\u200b\u5e94\u8be5\u200b\u662f\u200b\u8fd9\u6837\u200b\u7684\u200b\uff1a</p> <pre><code>def classFactory(iface):\n    from .mainPlugin import TestPlugin\n    return TestPlugin(iface)\n\n# \u200b\u4efb\u4f55\u200b\u5176\u4ed6\u200b\u521d\u59cb\u5316\u200b\n</code></pre>"},{"location":"16-%E5%BC%80%E5%8F%91Python%E6%8F%92%E4%BB%B6/#16123-mainpluginpy","title":"16.1.2.3 mainPlugin.py","text":"<p>\u200b\u8fd9\u200b\u5c31\u662f\u200b\u9b54\u6cd5\u200b\u53d1\u751f\u200b\u7684\u200b\u5730\u65b9\u200b\uff0c\u200b\u4e0b\u9762\u200b\u5c31\u662f\u200b\u9b54\u6cd5\u200b\u7684\u200b\u4f8b\u5b50\u200b:</p> <pre><code>from qgis.PyQt.QtGui import *\nfrom qgis.PyQt.QtWidgets import *\n\n# \u200b\u4ece\u6587\u4ef6\u200bresources.py\u200b\u521d\u59cb\u5316\u200bQt\u200b\u7684\u200b\u8d44\u6e90\u200b\nfrom . import resources\n\n\nclass TestPlugin:\n\n    def __init__(self, iface):\n        # \u200b\u4fdd\u5b58\u200bQGIS interface\u200b\u5f15\u7528\u200b\n        self.iface = iface\n\n    def initGui(self):\n        # \u200b\u521b\u5efa\u200b\u64cd\u4f5c\u200b\uff0c\u200b\u5b83\u200b\u5c06\u200b\u542f\u52a8\u200b\u63d2\u4ef6\u200b\u914d\u7f6e\u200b\n        self.action = QAction(QIcon(\":/plugins/testplug/icon.png\"), \"Test plugin\", self.iface.mainWindow())\n        self.action.setObjectName(\"testAction\")\n        self.action.setWhatsThis(\"Configuration for test plugin\")\n        self.action.setStatusTip(\"This is status tip\")\n        self.action.triggered.connect(self.run)\n\n        # \u200b\u6dfb\u52a0\u200b\u5de5\u5177\u680f\u200b\u6309\u94ae\u200b\u548c\u200b\u83dc\u5355\u9879\u200b\n        self.iface.addToolBarIcon(self.action)\n        self.iface.addPluginToMenu(\"&amp;Test plugins\", self.action)\n\n        # \u200b\u8fde\u63a5\u200b\u4fe1\u53f7\u200brenderComplete\u2014\u2014\u200b\u753b\u5e03\u200b\u6e32\u67d3\u200b\u5b8c\u6210\u200b\u540e\u200b\u53d1\u9001\u200b\u7684\u200b\u4fe1\u53f7\u200b\n        self.iface.mapCanvas().renderComplete.connect(self.renderTest)\n\n    def unload(self):\n        # \u200b\u5220\u9664\u200b\u63d2\u4ef6\u200b\u83dc\u5355\u9879\u200b\u548c\u200b\u56fe\u6807\u200b\n        self.iface.removePluginMenu(\"&amp;Test plugins\", self.action)\n        self.iface.removeToolBarIcon(self.action)\n\n        # \u200b\u65ad\u5f00\u200b\u4fe1\u53f7\u200b\n        self.iface.mapCanvas().renderComplete.disconnect(self.renderTest)\n\n    def run(self):\n        # \u200b\u521b\u5efa\u200b\u5e76\u200b\u663e\u793a\u200b\u4e00\u4e2a\u200b\u914d\u7f6e\u200b\u5bf9\u8bdd\u6846\u200b\u6216\u200b\u7c7b\u4f3c\u200b\u7684\u200b\u4e8b\u60c5\u200b\n        print(\"TestPlugin: run called!\")\n\n    def renderTest(self, painter):\n\n        # \u200b\u4f7f\u7528\u200bpainter\u200b\u7ed8\u5236\u5730\u56fe\u200b\u753b\u5e03\u200b\n        print(\"TestPlugin: renderTest called!\")\n</code></pre> <p>\u200b\u4e3b\u200b\u63d2\u4ef6\u200b\u6e90\u6587\u4ef6\u200b\u4e2d\u200b\uff08\u200b\u4f8b\u5982\u200b <code>mainPlugin.py</code>\uff09\u200b\u5fc5\u987b\u200b\u5b58\u5728\u200b\u7684\u200b\u63d2\u4ef6\u200b\u51fd\u6570\u200b\u662f\u200b\uff1a</p> <ul> <li><code>__init__</code> - &gt;\u200b\u53ef\u4ee5\u200b\u8bbf\u95ee\u200bQGIS\u200b\u754c\u9762\u200b</li> <li><code>initGui()</code> - &gt;\u200b\u52a0\u8f7d\u200b\u63d2\u4ef6\u200b\u65f6\u200b\u8c03\u7528\u200b</li> <li><code>unload()</code> - &gt;\u200b\u5378\u8f7d\u200b\u63d2\u4ef6\u200b\u65f6\u200b\u8c03\u7528\u200b</li> </ul> <p>\u200b\u5728\u200b\u4e0a\u9762\u200b\u7684\u200b\u4f8b\u5b50\u200b\u4e2d\u200b\uff0c<code>addPluginToMenu()</code>\u200b\u88ab\u200b\u4f7f\u7528\u200b\u3002\u200b\u8fd9\u4f1a\u200b\u5c06\u200b\u76f8\u5e94\u200b\u7684\u200b\u83dc\u5355\u200b\u64cd\u4f5c\u200b\u6dfb\u52a0\u200b\u5230\u200b Plugins \u200b\u83dc\u5355\u200b\u4e2d\u200b\u3002\u200b\u5b58\u5728\u200b\u989d\u5916\u200b\u7684\u200b\u65b9\u6cd5\u200b\u5c06\u200b\u64cd\u4f5c\u200b\uff08action\uff09\u200b\u6dfb\u52a0\u200b\u5230\u200b\u4e0d\u540c\u200b\u83dc\u5355\u200b\u3002\u200b\u4ee5\u4e0b\u200b\u662f\u200b\u8fd9\u4e9b\u200b\u65b9\u6cd5\u200b\u7684\u200b\u5217\u8868\u200b\uff1a</p> <ul> <li><code>addPluginToRasterMenu()</code></li> <li><code>addPluginToVectorMenu()</code></li> <li><code>addPluginToDatabaseMenu()</code></li> <li><code>addPluginToWebMenu()</code></li> </ul> <p>\u200b\u5b83\u4eec\u200b\u90fd\u200b\u5177\u6709\u200b\u4e0e\u200b<code>addPluginToMenu()</code>\u200b\u65b9\u6cd5\u200b\u76f8\u540c\u200b\u7684\u200b\u8bed\u6cd5\u200b \u3002</p> <p>\u200b\u5efa\u8bae\u200b\u5c06\u200b\u63d2\u4ef6\u200b\u83dc\u5355\u200b\u6dfb\u52a0\u200b\u5230\u200b\u5176\u4e2d\u200b\u4e00\u4e2a\u200b\u9884\u200b\u5b9a\u4e49\u65b9\u6cd5\u200b\uff0c\u200b\u4ee5\u200b\u4fdd\u6301\u200b\u63d2\u4ef6\u200b\u6761\u76ee\u200b\u7ec4\u7ec7\u200b\u65b9\u5f0f\u200b\u7684\u200b\u4e00\u81f4\u6027\u200b\u3002\u200b\u4f46\u662f\u200b\uff0c\u200b\u4f60\u200b\u53ef\u4ee5\u200b\u5c06\u200b\u81ea\u5b9a\u4e49\u200b\u83dc\u5355\u200b\u7ec4\u200b\u76f4\u63a5\u200b\u6dfb\u52a0\u200b\u5230\u200b\u83dc\u5355\u680f\u200b\uff0c\u200b\u5982\u200b\u4e0b\u9762\u200b\u793a\u4f8b\u200b\u6240\u793a\u200b\uff1a</p> <pre><code>def initGui(self):\n    self.menu = QMenu(self.iface.mainWindow())\n    self.menu.setObjectName(\"testMenu\")\n    self.menu.setTitle(\"MyMenu\")\n\n    self.action = QAction(QIcon(\":/plugins/testplug/icon.png\"), \"Test plugin\", self.iface.mainWindow())\n    self.action.setObjectName(\"testAction\")\n    self.action.setWhatsThis(\"Configuration for test plugin\")\n    self.action.setStatusTip(\"This is status tip\")\n    self.action.triggered.connect(self.run)\n    self.menu.addAction(self.action)\n\n    menuBar = self.iface.mainWindow().menuBar()\n    menuBar.insertMenu(self.iface.firstRightStandardMenu().menuAction(), self.menu)\n\ndef unload(self):\n    self.menu.deleteLater()\n</code></pre> <p>\u200b\u4e0d\u8981\u200b\u5fd8\u8bb0\u200b\u8bbe\u7f6e\u200b<code>QAction</code>\u200b\u548c\u200b<code>QMenu</code> <code>objectName</code>\u200b\u63d2\u4ef6\u200b\u7684\u200b\u7279\u5b9a\u200b\u540d\u79f0\u200b\uff0c\u200b\u4ee5\u4fbf\u200b\u53ef\u4ee5\u200b\u81ea\u5b9a\u4e49\u200b\u3002</p> <p>\u200b\u867d\u7136\u200b\u5e2e\u52a9\u200b\u548c\u200b\u5173\u4e8e\u200b\u64cd\u4f5c\u200b\u4e5f\u200b\u53ef\u4ee5\u200b\u6dfb\u52a0\u200b\u5230\u200b\u4f60\u200b\u7684\u200b\u81ea\u5b9a\u4e49\u200b\u83dc\u5355\u200b\u4e2d\u200b\uff0c\u200b\u4f46\u200bQGIS\u200b\u4e3b\u200b \u200b\u5e2e\u52a9\u200b \u25ba \u200b\u63d2\u4ef6\u200b \u200b\u83dc\u5355\u200b\u4e2d\u6709\u200b\u4e00\u4e2a\u200b\u7b80\u4fbf\u200b\u7684\u200b\u5730\u65b9\u200b\u3002\u200b\u8fd9\u662f\u200b\u4f7f\u7528\u200b<code>pluginHelpMenu()</code>\u200b\u65b9\u6cd5\u200b\u5b8c\u6210\u200b\u7684\u200b\u3002</p> <pre><code>def initGui(self):\n\n    self.help_action = QAction(\n        QIcon(\":/plugins/testplug/icon.png\"),\n        self.tr(\"Test Plugin...\"),\n        self.iface.mainWindow()\n    )\n    # \u200b\u6dfb\u52a0\u200b\u64cd\u4f5c\u200b\u5230\u200b\u5e2e\u52a9\u200b\u83dc\u5355\u200b\n    self.iface.pluginHelpMenu().addAction(self.help_action)\n\n    self.help_action.triggered.connect(self.show_help)\n\n@staticmethod\ndef show_help():\n    \"\"\"\u200b\u6253\u5f00\u200b\u5728\u7ebf\u200b\u5e2e\u52a9\u200b\"\"\"\n    QDesktopServices.openUrl(QUrl('https://docs.qgis.org'))\n\ndef unload(self):\n\n    self.iface.pluginHelpMenu().removeAction(self.help_action)\n    del self.help_action\n</code></pre>"},{"location":"16-%E5%BC%80%E5%8F%91Python%E6%8F%92%E4%BB%B6/#1613","title":"16.1.3 \u200b\u6587\u6863","text":"<p>\u200b\u8be5\u200b\u63d2\u4ef6\u200b\u7684\u200b\u6587\u6863\u200b\u53ef\u4ee5\u200b\u7f16\u5199\u200b\u4e3a\u200bHTML\u200b\u5e2e\u52a9\u200b\u6587\u6863\u200b\u3002<code>qgis.utils</code>\u200b\u6a21\u5757\u200b\u63d0\u4f9b\u200b\u4e86\u200b\u4e00\u4e2a\u200b\u51fd\u6570\u200b\uff0c<code>showPluginHelp()</code>\u200b\u5c06\u200b\u6253\u5f00\u200b\u5e2e\u52a9\u200b\u6587\u6863\u200b\u6d4f\u89c8\u5668\u200b\uff0c\u200b\u4e0e\u200b\u5176\u4ed6\u200bQGIS\u200b\u5e2e\u52a9\u200b\u6587\u6863\u200b\u7684\u200b\u65b9\u5f0f\u200b\u76f8\u540c\u200b\u3002</p> <p><code>showPluginHelp()</code>\u200b\u51fd\u6570\u200b\u5728\u200b\u4e0e\u200b\u8c03\u7528\u200b\u6a21\u5757\u200b\u76f8\u540c\u200b\u7684\u200b\u76ee\u5f55\u200b\u4e2d\u200b\u67e5\u627e\u200b\u5e2e\u52a9\u200b\u6587\u6863\u200b\u3002\u200b\u5b83\u4f1a\u200b\u5bfb\u627e\u200b<code>index-ll_cc.html</code>\uff0c<code>index-ll.html</code>\uff0c<code>index-en.html</code>\uff0c<code>index-en_us.html</code>\u200b\u548c\u200b<code>index.html</code>\uff0c\u200b\u663e\u793a\u200b\u5b83\u200b\u627e\u5230\u200b\u7684\u200b\u7b2c\u4e00\u4e2a\u200b\u6587\u6863\u200b\u3002\u200b\u8fd9\u200b<code>ll_cc</code>\u200b\u662f\u200bQGIS\u200b\u8bed\u8a00\u200b\u73af\u5883\u200b\uff0c\u200b\u8fd9\u200b\u5141\u8bb8\u200b\u6587\u6863\u200b\u6709\u200b\u591a\u4e2a\u200b\u7ffb\u8bd1\u200b\u3002</p> <p><code>showPluginHelp()</code>\u200b\u51fd\u6570\u200b\u8fd8\u200b\u53ef\u4ee5\u200b\u4f7f\u7528\u200b\u53c2\u6570\u200b<code>packageName</code>\u2014\u2014\u200b\u5b83\u200b\u663e\u793a\u200b\u6307\u5b9a\u200b\u63d2\u4ef6\u200b\u7684\u200b\u5e2e\u52a9\u200b\u6587\u6863\u200b\uff0c<code>filename</code>\u2014\u2014\u200b\u53ef\u4ee5\u200b\u66ff\u6362\u200b\u88ab\u200b\u641c\u7d22\u200b\u7684\u200b\u6587\u4ef6\u540d\u200b\u4e2d\u200b\u7684\u200b\u201cindex\u201d\uff0csection\u2014\u2014\u200b\u5b83\u200b\u662f\u200bhtml\u200b\u951a\u200b\u6807\u8bb0\u200b\u7684\u200b\u540d\u79f0\u200b\uff0c\u200b\u6d4f\u89c8\u5668\u200b\u5c06\u200b\u5b9a\u4f4d\u200b\u5230\u200b\u8be5\u200b\u4f4d\u7f6e\u200b\u3002</p>"},{"location":"16-%E5%BC%80%E5%8F%91Python%E6%8F%92%E4%BB%B6/#1614","title":"16.1.4 \u200b\u7ffb\u8bd1","text":"<p>\u200b\u901a\u8fc7\u200b\u51e0\u4e2a\u200b\u6b65\u9aa4\u200b\uff0c\u200b\u4f60\u200b\u53ef\u4ee5\u200b\u8bbe\u7f6e\u200b\u63d2\u4ef6\u200b\u672c\u5730\u5316\u200b\u7684\u200b\u73af\u5883\u200b\uff0c\u200b\u4ee5\u4fbf\u200b\u6839\u636e\u200b\u8ba1\u7b97\u673a\u200b\u7684\u200b\u533a\u57df\u200b\uff0c\u200b\u63d2\u4ef6\u200b\u5c06\u200b\u4ee5\u200b\u4e0d\u540c\u200b\u8bed\u8a00\u200b\u52a0\u8f7d\u200b\u3002</p>"},{"location":"16-%E5%BC%80%E5%8F%91Python%E6%8F%92%E4%BB%B6/#16141","title":"16.1.4.1 \u200b\u8f6f\u4ef6\u200b\u8981\u6c42","text":"<p>\u200b\u521b\u5efa\u200b\u548c\u200b\u7ba1\u7406\u200b\u6240\u6709\u200b\u7ffb\u8bd1\u200b\u6587\u4ef6\u200b\u7684\u200b\u6700\u200b\u7b80\u5355\u200b\u65b9\u6cd5\u200b\u662f\u200b\u5b89\u88c5\u200b Qt Linguist\u3002\u200b\u5728\u200b\u57fa\u4e8e\u200bDebian\u200b\u7684\u200bGNU / Linux\u200b\u73af\u5883\u200b\u4e2d\u200b\uff0c\u200b\u4f60\u200b\u53ef\u4ee5\u200b\u8fd9\u6837\u200b\u5b89\u88c5\u200b\u5b83\u200b\uff1a</p> <pre><code>sudo apt-get install qttools5-dev-tools\n</code></pre>"},{"location":"16-%E5%BC%80%E5%8F%91Python%E6%8F%92%E4%BB%B6/#16142","title":"16.1.4.2 \u200b\u6587\u4ef6\u200b\u548c\u200b\u76ee\u5f55","text":"<p>\u200b\u521b\u5efa\u200b\u63d2\u4ef6\u200b\u65f6\u200b\uff0c\u200b\u4f60\u200b\u5c06\u200b\u5728\u200b\u4e3b\u200b\u63d2\u4ef6\u200b\u76ee\u5f55\u200b\u4e2d\u200b\u627e\u5230\u200b\u8be5\u200b\u6587\u4ef6\u5939\u200b<code>i18n</code>\u3002</p> <p>\u200b\u6240\u6709\u200b\u7ffb\u8bd1\u200b\u6587\u4ef6\u200b\u90fd\u200b\u5fc5\u987b\u200b\u653e\u5728\u200b\u6b64\u200b\u76ee\u5f55\u200b\u4e2d\u200b\u3002</p>"},{"location":"16-%E5%BC%80%E5%8F%91Python%E6%8F%92%E4%BB%B6/#161421-pro","title":"16.1.4.2.1 .pro\u200b\u6587\u4ef6","text":"<p>\u200b\u9996\u5148\u200b\uff0c\u200b\u4f60\u200b\u5e94\u8be5\u200b\u521b\u5efa\u200b\u4e00\u4e2a\u200b<code>.pro</code>\u200b\u6587\u4ef6\u200b\uff0c\u200b\u8fd9\u662f\u200b\u4e00\u4e2a\u200b\u53ef\u4ee5\u200b\u7531\u200b Qt Linguist \u200b\u7ba1\u7406\u200b\u7684\u200b \u200b\u9879\u76ee\u200b \u200b\u6587\u4ef6\u200b\u3002</p> <p>\u200b\u5728\u200b\u6b64\u200b<code>.pro</code>\u200b\u6587\u4ef6\u200b\u4e2d\u200b\uff0c\u200b\u4f60\u200b\u5fc5\u987b\u200b\u6307\u5b9a\u200b\u8981\u200b\u7ffb\u8bd1\u200b\u7684\u200b\u6240\u6709\u200b\u6587\u4ef6\u200b\u548c\u200b\u7a97\u4f53\u200b\uff08.ui\u200b\u6587\u4ef6\u200b\uff09\u3002\u200b\u6b64\u200b\u6587\u4ef6\u200b\u7528\u4e8e\u200b\u8bbe\u7f6e\u200b\u672c\u5730\u5316\u200b\u6587\u4ef6\u200b\u548c\u200b\u53d8\u91cf\u200b\u3002\u200b\u4e0b\u9762\u200b\u662f\u200b\u4e00\u4e2a\u200b\u9879\u76ee\u200b\u6587\u4ef6\u200b\uff0c\u200b\u5339\u914d\u200b\u6211\u4eec\u200b\u7684\u200b\u793a\u4f8b\u200b\u63d2\u4ef6\u200b\u7684\u200b\u7ed3\u6784\u200b \uff1a</p> <pre><code>FORMS = ../form.ui\nSOURCES = ../your_plugin.py\nTRANSLATIONS = your_plugin_it.ts\n</code></pre> <p>\u200b\u4f60\u200b\u7684\u200b\u63d2\u4ef6\u200b\u53ef\u80fd\u200b\u6709\u200b\u66f4\u200b\u590d\u6742\u200b\u7684\u200b\u7ed3\u6784\u200b\uff0c\u200b\u5e76\u4e14\u200b\u53ef\u80fd\u200b\u5206\u5e03\u200b\u5728\u200b\u591a\u4e2a\u200b\u6587\u4ef6\u200b\u4e2d\u200b\u3002\u200b\u5982\u679c\u200b\u662f\u200b\u8fd9\u79cd\u200b\u60c5\u51b5\u200b\uff0c\u200b\u8bf7\u200b\u8bb0\u4f4f\u200b\uff0c\u200b\u4f7f\u7528\u200b<code>pylupdate5</code>\u200b\u8bfb\u53d6\u200b<code>.pro</code>\u200b\u6587\u4ef6\u200b\u5e76\u200b\u66f4\u65b0\u200b\u53ef\u200b\u7ffb\u8bd1\u200b\u5b57\u7b26\u4e32\u200b\uff0c\u200b\u8fd9\u200b\u4e0d\u4f1a\u200b\u6269\u5c55\u200b\u901a\u914d\u7b26\u200b\uff0c\u200b\u56e0\u6b64\u200b\u4f60\u200b\u9700\u8981\u200b\u5c06\u200b\u6bcf\u4e2a\u200b\u6587\u4ef6\u200b\u663e\u5f0f\u200b\u653e\u5728\u200b<code>.pro</code>\u200b\u6587\u4ef6\u200b\u4e2d\u200b\u3002\u200b\u4f60\u200b\u7684\u200b\u9879\u76ee\u200b\u6587\u4ef6\u200b\u53ef\u80fd\u200b\u770b\u8d77\u6765\u200b\u50cf\u200b\u8fd9\u6837\u200b\uff1a</p> <pre><code>FORMS = ../ui/about.ui ../ui/feedback.ui \\\n        ../ui/main_dialog.ui\nSOURCES = ../your_plugin.py ../computation.py \\\n          ../utils.py\n</code></pre> <p>\u200b\u6b64\u5916\u200b\uff0c<code>your_plugin.py</code>\u200b\u6587\u4ef6\u200b\u662f\u200b\u8c03\u7528\u200b QGIS\u200b\u5de5\u5177\u680f\u200b\u4e2d\u200b\u63d2\u4ef6\u200b\u7684\u200b\u6240\u6709\u200b\u83dc\u5355\u200b\u548c\u5b50\u200b\u83dc\u5355\u200b\u7684\u200b\u6587\u4ef6\u200b\uff0c\u200b\u4f60\u200b\u5e0c\u671b\u200b\u5c06\u200b\u5b83\u4eec\u200b\u5168\u90e8\u200b\u7ffb\u8bd1\u200b\u3002</p> <p>\u200b\u6700\u540e\u200b\uff0c\u200b\u4f7f\u7528\u200bTRANSLATIONS\u200b\u53d8\u91cf\u200b\uff0c\u200b\u4f60\u200b\u53ef\u4ee5\u200b\u6307\u5b9a\u200b\u6240\u200b\u9700\u200b\u7684\u200b\u7ffb\u8bd1\u200b\u8bed\u8a00\u200b\u3002</p> <p>\u200b\u8b66\u544a\u200b</p> <p>\u200b\u786e\u4fdd\u200b<code>ts</code>\u200b\u6587\u4ef6\u540d\u200b\u79f0\u4e3a\u200b<code>your_plugin_</code> + <code>language</code> + <code>.ts</code>\uff0c\u200b\u5426\u5219\u200b\u8bed\u8a00\u200b\u5c06\u200b\u52a0\u8f7d\u200b\u5931\u8d25\u200b\u3002\u200b\u4f7f\u7528\u200b\u4e24\u4e2a\u200b\u5b57\u6bcd\u200b\u7684\u200b\u8bed\u8a00\u200b\u7f29\u5199\u200b\uff08it\u200b\u5bf9\u5e94\u200bItalian\uff0cde\u200b\u5bf9\u5e94\u200bGerman\uff0c\u200b\u7b49\u7b49\u200b\uff09</p>"},{"location":"16-%E5%BC%80%E5%8F%91Python%E6%8F%92%E4%BB%B6/#161422-ts","title":"16.1.4.2.2 .ts\u200b\u6587\u4ef6","text":"<p>\u200b\u521b\u5efa\u200b<code>.pro</code>\u200b\u5b8c\u6210\u200b\u540e\u200b\uff0c\u200b\u4f60\u200b\u5c31\u200b\u53ef\u4ee5\u200b\u4e3a\u200b\u63d2\u4ef6\u200b\u7684\u200b\u8bed\u8a00\u200b\u751f\u6210\u200b<code>.ts</code>\u200b\u6587\u4ef6\u200b\u4e86\u200b\u3002</p> <p>\u200b\u6253\u5f00\u200b\u7ec8\u7aef\u200b\uff0c\u200b\u8f6c\u200b\u5230\u200b<code>your_plugin/i18n</code>\u200b\u76ee\u5f55\u200b\u5e76\u200b\u8f93\u5165\u200b\uff1a</p> <pre><code>pylupdate5 your_plugin.pro\n</code></pre> <p>\u200b\u4f60\u200b\u5e94\u8be5\u200b\u53ef\u4ee5\u200b\u770b\u5230\u200b<code>your_plugin_language.ts</code>\u200b\u6587\u4ef6\u200b\u3002</p> <p>\u200b\u7528\u200b Qt Linguist \u200b\u6253\u5f00\u200b<code>.ts</code>\u200b\u6587\u4ef6\u200b\u5e76\u200b\u5f00\u59cb\u200b\u7ffb\u8bd1\u200b\u3002</p>"},{"location":"16-%E5%BC%80%E5%8F%91Python%E6%8F%92%E4%BB%B6/#161423-qm","title":"16.1.4.2.3 .qm\u200b\u6587\u4ef6","text":"<p>\u200b\u5f53\u200b\u4f60\u200b\u5b8c\u6210\u200b\u63d2\u4ef6\u200b\u7ffb\u8bd1\u200b\u65f6\u200b\uff08\u200b\u5982\u679c\u200b\u67d0\u4e9b\u200b\u5b57\u7b26\u4e32\u200b\u672a\u200b\u5b8c\u6210\u200b\uff0c\u200b\u5c06\u200b\u4f7f\u7528\u200b\u8fd9\u4e9b\u200b\u5b57\u7b26\u4e32\u200b\u7684\u200b\u6e90\u8bed\u8a00\u200b\uff09\uff0c\u200b\u4f60\u200b\u5fc5\u987b\u200b\u521b\u5efa\u200b<code>.qm</code> \u200b\u6587\u4ef6\u200b\uff08\u200b\u5c06\u200b\u88ab\u200bQGIS\u200b\u4f7f\u7528\u200b\u7684\u200b<code>.ts</code>\u200b\u7f16\u8bd1\u200b\u6587\u4ef6\u200b\uff09\u3002</p> <p>\u200b\u53ea\u200b\u9700\u200b\u5728\u200b<code>your_plugin/i18n</code>\u200b\u76ee\u5f55\u200b\u4e2d\u200b\u6253\u5f00\u200b\u7ec8\u7aef\u200bcd \u200b\u5e76\u200b\u8f93\u5165\u200b\uff1a</p> <pre><code>lrelease your_plugin.ts\n</code></pre> <p>\u200b\u73b0\u5728\u200b\uff0c\u200b\u5728\u200b<code>i18n</code>\u200b\u76ee\u5f55\u200b\u4e2d\u200b\u4f60\u200b\u5c06\u200b\u770b\u5230\u200b<code>your_plugin.qm</code>\u200b\u6587\u4ef6\u200b\u3002</p>"},{"location":"16-%E5%BC%80%E5%8F%91Python%E6%8F%92%E4%BB%B6/#16143-makefile","title":"16.1.4.3 \u200b\u4f7f\u7528\u200bMakeFile\u200b\u8fdb\u884c\u200b\u7ffb\u8bd1","text":"<p>\u200b\u6216\u8005\u200b\uff0c\u200b\u5982\u679c\u200b\u4f60\u200b\u4f7f\u7528\u200bPlugin Builder\u200b\u521b\u5efa\u200b\u4e86\u200b\u63d2\u4ef6\u200b\uff0c\u200b\u5219\u200b\u53ef\u4ee5\u200b\u4f7f\u7528\u200bmakefile\u200b\u4ece\u200bpython\u200b\u4ee3\u7801\u200b\u548c\u200bQt\u200b\u5bf9\u8bdd\u6846\u200b\u4e2d\u200b\u63d0\u53d6\u200b\u6d88\u606f\u200b\u3002\u200b\u5728\u200bMakefile\u200b\u7684\u200b\u5f00\u5934\u200b\u6709\u200b\u4e00\u4e2a\u200bLOCALES\u200b\u53d8\u91cf\u200b\uff1a</p> <pre><code>LOCALES = en\n</code></pre> <p>\u200b\u5c06\u200b\u8be5\u200b\u8bed\u8a00\u200b\u7684\u200b\u7f29\u5199\u200b\u6dfb\u52a0\u200b\u5230\u200b\u6b64\u200b\u53d8\u91cf\u200b\u4e2d\u200b\uff0c\u200b\u4f8b\u5982\u200b\u5308\u7259\u5229\u8bed\u200b\uff1a</p> <pre><code>LOCALES = en hu\n</code></pre> <p>\u200b\u73b0\u5728\u200b\uff0c\u200b\u4f60\u200b\u53ef\u4ee5\u200b\u901a\u8fc7\u200b\u4ee5\u4e0b\u200b\u65b9\u5f0f\u200b\u4ece\u6e90\u200b\u751f\u6210\u200b\u6216\u200b\u66f4\u65b0\u200b<code>hu.ts</code>\u200b\u6587\u4ef6\u200b\uff08\u200b\u4ee5\u53ca\u200b\u5176\u4e2d\u200b\u7684\u200b<code>en.ts</code>\uff09\uff1a</p> <pre><code>make transup\n</code></pre> <p>\u200b\u5728\u6b64\u4e4b\u540e\u200b\uff0c\u200b\u4f60\u200b\u5df2\u200b\u5728\u200bLOCALES\u200b\u53d8\u91cf\u200b\u4e2d\u200b\u66f4\u65b0\u200b<code>.ts</code>\u200b\u4e86\u200b\u6240\u6709\u200b\u8bed\u8a00\u200b\u7684\u200b\u6587\u4ef6\u200b\u3002\u200b\u4f7f\u7528\u200b Qt Linguist \u200b\u7ffb\u8bd1\u7a0b\u5e8f\u200b\u6d88\u606f\u200b\u3002\u200b\u5b8c\u6210\u200b\u7ffb\u8bd1\u200b\u540e\u200b\uff0c<code>.qm</code>\u200b\u53ef\u4ee5\u200b\u901a\u8fc7\u200b<code>transcompile</code>\u200b\u521b\u5efa\u200b\uff1a</p> <pre><code>make transcompile\n</code></pre> <p>\u200b\u4f60\u200b\u5fc5\u987b\u200b\u5728\u200b\u4f60\u200b\u7684\u200b\u63d2\u4ef6\u200b\u4e2d\u200b\u5206\u53d1\u200b<code>.ts</code>\u200b\u6587\u4ef6\u200b\u3002</p>"},{"location":"16-%E5%BC%80%E5%8F%91Python%E6%8F%92%E4%BB%B6/#16144","title":"16.1.4.4 \u200b\u52a0\u8f7d\u200b\u63d2\u4ef6","text":"<p>\u200b\u8981\u200b\u67e5\u770b\u200b\u63d2\u4ef6\u200b\u7684\u200b\u7ffb\u8bd1\u200b\uff0c\u200b\u53ea\u200b\u9700\u200b\u6253\u5f00\u200bQGIS\uff0c\u200b\u66f4\u6539\u200b\u8bed\u8a00\u200b\uff08 \u200b\u8bbe\u7f6e\u200b \u2023 \u200b\u9009\u9879\u200b \u2023 \u200b\u901a\u7528\u200b \uff09\u200b\u5e76\u200b\u91cd\u65b0\u542f\u52a8\u200bQGIS\u3002</p> <p>\u200b\u4f60\u200b\u5e94\u8be5\u200b\u770b\u5230\u200b\u4f60\u200b\u7684\u200b\u63d2\u4ef6\u200b\u4f7f\u7528\u200b\u6b63\u786e\u200b\u7684\u200b\u8bed\u8a00\u200b\u3002</p> <p>\u200b\u8b66\u544a\u200b</p> <p>\u200b\u5982\u679c\u200b\u4f60\u200b\u6539\u53d8\u200b\u4e86\u200b\u4e00\u4e9b\u200b\u4e1c\u897f\u200b\uff08\u200b\u65b0\u200b\u7684\u200bUI\uff0c\u200b\u65b0\u200b\u7684\u200b\u83dc\u5355\u200b\uff0c\u200b\u7b49\u7b49\u200b\uff09\uff0c\u200b\u4f60\u200b\u5fc5\u987b\u200b\u91cd\u65b0\u200b\u751f\u6210\u200b<code>.ts</code>\u200b\u548c\u200b<code>.qm</code>\u200b\u6587\u4ef6\u200b\uff0c\u200b\u56e0\u6b64\u200b\u9700\u8981\u200b\u518d\u200b\u4e00\u6b21\u200b\u6267\u884c\u200b\u4ee5\u4e0a\u200b\u547d\u4ee4\u200b\u3002</p>"},{"location":"16-%E5%BC%80%E5%8F%91Python%E6%8F%92%E4%BB%B6/#1615","title":"16.1.5 \u200b\u63d0\u793a\u200b\u548c\u200b\u6280\u5de7","text":""},{"location":"16-%E5%BC%80%E5%8F%91Python%E6%8F%92%E4%BB%B6/#16151","title":"16.1.5.1 \u200b\u63d2\u4ef6\u200b\u91cd\u8f7d","text":"<p>\u200b\u5728\u200b\u5f00\u53d1\u200b\u63d2\u4ef6\u200b\u671f\u95f4\u200b\uff0c\u200b\u4f60\u200b\u7ecf\u5e38\u200b\u9700\u8981\u200b\u5728\u200bQGIS\u200b\u4e2d\u200b\u91cd\u65b0\u200b\u52a0\u8f7d\u200b\u5b83\u200b\u4ee5\u200b\u8fdb\u884c\u200b\u6d4b\u8bd5\u200b\u3002\u200b\u4f7f\u7528\u200b Plugin Reloader \u200b\u63d2\u4ef6\u200b\u975e\u5e38\u5bb9\u6613\u200b\u3002\u200b\u4f60\u200b\u53ef\u4ee5\u200b\u5728\u200b\u63d2\u4ef6\u200b\u7ba1\u7406\u5668\u200b\u4e2d\u200b\u627e\u5230\u200b\u5b83\u200b\u3002</p>"},{"location":"16-%E5%BC%80%E5%8F%91Python%E6%8F%92%E4%BB%B6/#16152-qgis-plugin-ci","title":"16.1.5.2 \u200b\u4f7f\u7528\u200b qgis-plugin-ci\u200b\u81ea\u52a8\u200b\u6253\u5305\u200b\u3001\u200b\u53d1\u5e03\u200b\u548c\u200b\u7ffb\u8bd1","text":"<p>qgis-plugin-ci\u200b\u63d0\u4f9b\u200b\u4e86\u200b\u4e00\u4e2a\u200b\u547d\u4ee4\u884c\u200b\u754c\u9762\u200b\uff0c\u200b\u7528\u4e8e\u200b\u5728\u200b\u4f60\u200b\u7684\u200b\u8ba1\u7b97\u673a\u200b\u4e0a\u200b\u6267\u884c\u200b QGIS \u200b\u63d2\u4ef6\u200b\u7684\u200b\u81ea\u52a8\u200b\u6253\u5305\u200b\u548c\u200b\u90e8\u7f72\u200b\uff0c\u200b\u6216\u200b\u4f7f\u7528\u200b\u6301\u7eed\u200b\u96c6\u6210\u200b\uff08\u200b\u5982\u200b GitHub \u200b\u5de5\u4f5c\u200b\u6d41\u200b\u6216\u200b Gitlab-CI \u200b\u4ee5\u53ca\u200b Transifex \u200b\u8fdb\u884c\u200b\u7ffb\u8bd1\u200b\uff09\u3002</p>"},{"location":"16-%E5%BC%80%E5%8F%91Python%E6%8F%92%E4%BB%B6/#16153","title":"16.1.5.3 \u200b\u8bbf\u95ee\u200b\u63d2\u4ef6","text":"<p>\u200b\u4f60\u200b\u53ef\u4ee5\u200b\u4f7f\u7528\u200bpython\u200b\u4ece\u200bQGIS\u200b\u4e2d\u200b\u8bbf\u95ee\u200b\u6240\u6709\u200b\u5df2\u200b\u5b89\u88c5\u200b\u63d2\u4ef6\u200b\u7c7b\u200b\uff0c\u200b\u8fd9\u200b\u53ef\u4ee5\u200b\u65b9\u4fbf\u200b\u8c03\u8bd5\u200b\uff1a</p> <pre><code>my_plugin = qgis.utils.plugins['My Plugin']\n</code></pre>"},{"location":"16-%E5%BC%80%E5%8F%91Python%E6%8F%92%E4%BB%B6/#16154","title":"16.1.5.4 \u200b\u65e5\u5fd7\u200b\u6d88\u606f","text":"<p>\u200b\u63d2\u4ef6\u200b\u5728\u200b\u65e5\u5fd7\u200b\u6d88\u606f\u200b\u9762\u677f\u200b\u4e2d\u6709\u200b\u81ea\u5df1\u200b\u7684\u200b\u9009\u9879\u5361\u200b\u3002</p>"},{"location":"16-%E5%BC%80%E5%8F%91Python%E6%8F%92%E4%BB%B6/#16155","title":"16.1.5.5 \u200b\u5206\u4eab\u200b\u4f60\u200b\u7684\u200b\u63d2\u4ef6","text":"<p>QGIS\u200b\u5728\u200b\u63d2\u4ef6\u200b\u4ed3\u5e93\u200b\u4e2d\u200b\u6258\u7ba1\u200b\u4e86\u200b\u6570\u767e\u4e2a\u200b\u63d2\u4ef6\u200b\u3002\u200b\u8003\u8651\u200b\u5206\u4eab\u200b\u4f60\u200b\u7684\u200b\u63d2\u4ef6\u200b\uff01\u200b\u5b83\u200b\u5c06\u200b\u6269\u5c55\u200bQGIS\uff0c\u200b\u4eba\u4eec\u200b\u5c06\u200b\u80fd\u591f\u200b\u4ece\u200b\u4f60\u200b\u7684\u200b\u4ee3\u7801\u200b\u4e2d\u200b\u5b66\u4e60\u200b\u3002\u200b\u53ef\u4ee5\u200b\u4f7f\u7528\u200b\u63d2\u4ef6\u200b\u7ba1\u7406\u5668\u200b\u5728\u200bQGIS\u200b\u4e2d\u200b\u627e\u5230\u200b\u5e76\u200b\u5b89\u88c5\u200b\u6240\u6709\u200b\u6258\u7ba1\u200b\u7684\u200b\u63d2\u4ef6\u200b\u3002</p> <p>\u200b\u4fe1\u606f\u200b\u548c\u200b\u8981\u6c42\u200b\uff1aplugins.qgis.org\u3002</p>"},{"location":"16-%E5%BC%80%E5%8F%91Python%E6%8F%92%E4%BB%B6/#1616","title":"16.1.6 \u200b\u63d0\u793a\u200b\u548c\u200b\u6280\u5de7","text":""},{"location":"16-%E5%BC%80%E5%8F%91Python%E6%8F%92%E4%BB%B6/#16161","title":"16.1.6.1 \u200b\u63d2\u4ef6\u200b\u91cd\u65b0\u200b\u52a0\u8f7d\u200b\u7a0b\u5e8f","text":"<p>\u200b\u5728\u200b\u5f00\u53d1\u200b\u63d2\u4ef6\u200b\u8fc7\u7a0b\u200b\u4e2d\u200b\uff0c\u200b\u4f60\u200b\u7ecf\u5e38\u200b\u9700\u8981\u200b\u91cd\u65b0\u200b\u52a0\u8f7d\u200b\u5b83\u200b\u4ee5\u200b\u8fdb\u884c\u200b\u6d4b\u8bd5\u200b\u3002\u200b\u4f7f\u7528\u200bPlugin Reloader\u200b\u63d2\u4ef6\u200b\u975e\u5e38\u5bb9\u6613\u200b\u3002\u200b\u4f60\u200b\u53ef\u4ee5\u200b\u5728\u200b\u63d2\u4ef6\u200b\u7ba1\u7406\u5668\u200b\u4e2d\u200b\u627e\u5230\u200b\u5b83\u200b\u3002</p>"},{"location":"16-%E5%BC%80%E5%8F%91Python%E6%8F%92%E4%BB%B6/#16162-qgisci","title":"16.1.6.2 \u200b\u4f7f\u7528\u200bqgis\u200b\u63d2\u4ef6\u200bci\u200b\u81ea\u52a8\u200b\u6253\u5305\u200b\u3001\u200b\u53d1\u5e03\u200b\u548c\u200b\u7ffb\u8bd1","text":"<p>qgis-plugin-ci \u200b\u63d0\u4f9b\u200b\u4e86\u200b\u4e00\u4e2a\u200b\u547d\u4ee4\u884c\u200b\u754c\u9762\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u5728\u200b\u4f60\u200b\u7684\u200b\u8ba1\u7b97\u673a\u200b\u4e0a\u200b\u6216\u200b\u4f7f\u7528\u200b\u6301\u7eed\u200b\u96c6\u6210\u200b\u5de5\u5177\u200b\uff08\u200b\u5982\u200b GitHub \u200b\u5de5\u4f5c\u200b\u6d41\u200b\u6216\u200b Gitlab-CI\uff09\u200b\u4ee5\u53ca\u200b Transifex \u200b\u8fdb\u884c\u200b\u81ea\u52a8\u200b\u6253\u5305\u200b\u548c\u200b\u90e8\u7f72\u200b QGIS \u200b\u63d2\u4ef6\u200b\u3002\u200b\u5b83\u200b\u5141\u8bb8\u200b\u901a\u8fc7\u200b CLI \u200b\u6216\u200b\u5728\u200b CI \u200b\u64cd\u4f5c\u200b\u4e2d\u200b\u53d1\u5e03\u200b\u3001\u200b\u7ffb\u8bd1\u200b\u3001\u200b\u53d1\u5e03\u200b\u6216\u200b\u751f\u6210\u200b XML \u200b\u63d2\u4ef6\u200b\u5b58\u50a8\u200b\u5e93\u200b\u6587\u4ef6\u200b\u3002</p>"},{"location":"16-%E5%BC%80%E5%8F%91Python%E6%8F%92%E4%BB%B6/#16163","title":"16.1.6.3 \u200b\u8bbf\u95ee\u200b\u63d2\u4ef6","text":"<p>\u200b\u4f60\u200b\u53ef\u4ee5\u200b\u4f7f\u7528\u200bPython\u200b\u5728\u200bQGIS\u200b\u4e2d\u200b\u8bbf\u95ee\u200b\u6240\u6709\u200b\u5df2\u200b\u5b89\u88c5\u200b\u63d2\u4ef6\u200b\u7684\u200b\u7c7b\u200b\uff0c\u200b\u8fd9\u200b\u5bf9\u4e8e\u200b\u8c03\u8bd5\u200b\u5f88\u200b\u6709\u7528\u200b\u3002</p> <pre><code>my_plugin = qgis.utils.plugins['My Plugin']\n</code></pre>"},{"location":"16-%E5%BC%80%E5%8F%91Python%E6%8F%92%E4%BB%B6/#16164","title":"16.1.6.4 \u200b\u65e5\u5fd7\u200b\u4fe1\u606f","text":"<p>\u200b\u63d2\u4ef6\u200b\u5728\u200b\u65e5\u5fd7\u200b\u6d88\u606f\u200b\u9762\u677f\u200b\u4e2d\u6709\u200b\u81ea\u5df1\u200b\u7684\u200b\u9009\u9879\u5361\u200b\u3002</p>"},{"location":"16-%E5%BC%80%E5%8F%91Python%E6%8F%92%E4%BB%B6/#16165","title":"16.1.6.5 \u200b\u8d44\u6e90\u200b\u6587\u4ef6","text":"<p>\u200b\u4f60\u200b\u53ef\u4ee5\u200b\u770b\u5230\u200b\u5728\u200b<code>initGui()</code>\u200b\u4e2d\u200b\u6211\u4eec\u200b\u4f7f\u7528\u200b\u4e86\u200b\u8d44\u6e90\u200b\u6587\u4ef6\u200b\u4e2d\u200b\u7684\u200b\u56fe\u6807\u200b\uff08\u200b\u5728\u200b\u6211\u4eec\u200b\u7684\u200b\u6848\u4f8b\u200b\u4e2d\u662f\u200b<code>resources.qrc</code>\uff09</p> <pre><code>&lt;RCC&gt;\n  &lt;qresource prefix=\"/plugins/testplug\" &gt;\n     &lt;file&gt;icon.png&lt;/file&gt;\n  &lt;/qresource&gt;\n&lt;/RCC&gt;\n</code></pre> <p>\u200b\u6700\u597d\u200b\u4f7f\u7528\u200b\u4e0d\u4f1a\u200b\u4e0e\u200b\u5176\u4ed6\u200b\u63d2\u4ef6\u200b\u6216\u200bQGIS\u200b\u7684\u200b\u4efb\u4f55\u200b\u90e8\u5206\u200b\u53d1\u751f\u51b2\u7a81\u200b\u7684\u200b\u524d\u7f00\u200b\uff0c\u200b\u5426\u5219\u200b\u4f60\u200b\u53ef\u80fd\u200b\u4f1a\u200b\u5f97\u5230\u200b\u4f60\u200b\u4e0d\u200b\u60f3\u8981\u200b\u7684\u200b\u8d44\u6e90\u200b\u3002\u200b\u73b0\u5728\u200b\u4f60\u200b\u53ea\u200b\u9700\u8981\u200b\u751f\u6210\u200b\u4e00\u4e2a\u200b\u5305\u542b\u200b\u8d44\u6e90\u200b\u7684\u200bPython\u200b\u6587\u4ef6\u200b\u3002\u200b\u5b83\u200b\u662f\u200b\u7528\u200b pyrcc5 \u200b\u547d\u4ee4\u200b\u5b8c\u6210\u200b\u7684\u200b\uff1a</p> <pre><code>pyrcc5 -o resources.py resources.qrc\n</code></pre> <p>\u200b\u63d0\u793a\u200b</p> <p>\u200b\u5728\u200bWindows\u200b\u73af\u5883\u200b\u4e2d\u200b\uff0c\u200b\u5c1d\u8bd5\u200b\u4ece\u200bCMD\u200b\u6216\u200bPowershell\u200b\u8fd0\u884c\u200bpyrcc5\u200b\u53ef\u80fd\u200b\u4f1a\u200b\u5bfc\u81f4\u200b\u9519\u8bef\u200b\u201cWindows\u200b\u65e0\u6cd5\u8bbf\u95ee\u200b\u6307\u5b9a\u200b\u7684\u200b\u8bbe\u5907\u200b\uff0c\u200b\u8def\u5f84\u200b\uff0c\u200b\u6216\u200b\u6587\u4ef6\u200b[...]\u201d\u3002\u200b\u6700\u200b\u7b80\u5355\u200b\u7684\u200b\u89e3\u51b3\u65b9\u6848\u200b\u53ef\u80fd\u200b\u662f\u200b\u4f7f\u7528\u200bosgeo4wshell\uff0c\u200b\u4f46\u200b\u5982\u679c\u200b\u4f60\u200b\u613f\u610f\u200b\u4fee\u6539\u200bPATH\u200b\u73af\u5883\u53d8\u91cf\u200b\u6216\u200b\u663e\u5f0f\u200b\u6307\u5b9a\u200b\u53ef\u6267\u884c\u6587\u4ef6\u200b\u7684\u200b\u8def\u5f84\u200b\uff0c\u200b\u4f60\u200b\u5e94\u8be5\u200b\u53ef\u4ee5\u200b\u5728\u200b<code>&lt;Your QGIS Install Directory&gt;\\bin\\pyrcc5.exe</code>\u200b\u627e\u5230\u200b\u5b83\u200b</p> <p>\u200b\u5c31\u200b\u8fd9\u4e9b\u200b\u2026\u2026\u200b\u6ca1\u4ec0\u4e48\u200b\u590d\u6742\u200b\u7684\u200b:)</p> <p>\u200b\u5982\u679c\u200b\u4f60\u200b\u5df2\u200b\u6b63\u786e\u200b\u5b8c\u6210\u200b\u6240\u6709\u200b\u64cd\u4f5c\u200b\uff0c\u200b\u5219\u200b\u5e94\u8be5\u200b\u80fd\u591f\u200b\u5728\u200b\u63d2\u4ef6\u200b\u7ba1\u7406\u5668\u200b\u4e2d\u200b\u67e5\u627e\u200b\u5e76\u200b\u52a0\u8f7d\u200b\u63d2\u4ef6\u200b\uff0c\u200b\u5728\u200b\u70b9\u51fb\u200b\u5de5\u5177\u680f\u200b\u56fe\u6807\u200b\u6216\u200b\u76f8\u5e94\u200b\u7684\u200b\u83dc\u5355\u9879\u200b\u65f6\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u5728\u200b\u63a7\u5236\u53f0\u200b\u4e2d\u200b\u67e5\u770b\u200b\u5230\u200b\u6d88\u606f\u200b\u3002</p> <p>\u200b\u5728\u200b\u5904\u7406\u200b\u771f\u6b63\u200b\u7684\u200b\u63d2\u4ef6\u200b\u65f6\u200b\uff0c\u200b\u6700\u597d\u200b\u5c06\u200b\u63d2\u4ef6\u200b\u5199\u5165\u200b\u53e6\u200b\u4e00\u4e2a\u200b\uff08\u200b\u5de5\u4f5c\u200b\uff09\u200b\u76ee\u5f55\u200b\u5e76\u200b\u521b\u5efa\u200b\u4e00\u4e2a\u200bmakefile\uff0c\u200b\u5b83\u200b\u5c06\u200b\u751f\u6210\u200bUI\u200b\u548c\u200b\u8d44\u6e90\u200b\u6587\u4ef6\u200b\u5e76\u200b\u5c06\u200b\u63d2\u4ef6\u200b\u5b89\u88c5\u200b\u5230\u200bQGIS\u200b\u5b89\u88c5\u200b\u4e2d\u200b\u3002</p>"},{"location":"16-%E5%BC%80%E5%8F%91Python%E6%8F%92%E4%BB%B6/#162","title":"16.2 \u200b\u4ee3\u7801\u200b\u7247\u6bb5","text":"<p>\u200b\u672c\u8282\u200b\u4ee5\u200b\u4ee3\u7801\u200b\u7247\u6bb5\u200b\u4e3a\u4f8b\u200b\uff0c\u200b\u8bb2\u89e3\u200b\u63d2\u4ef6\u200b\u5f00\u53d1\u200b</p>"},{"location":"16-%E5%BC%80%E5%8F%91Python%E6%8F%92%E4%BB%B6/#1621","title":"16.2.1 \u200b\u5982\u4f55\u200b\u901a\u8fc7\u200b\u5feb\u6377\u952e\u200b\u8c03\u7528\u200b\u65b9\u6cd5","text":"<p>\u200b\u5728\u200b<code>initGui()</code>\u200b\u4e2d\u200b\u6dfb\u52a0\u200b\uff1a</p> <pre><code>self.key_action = QAction(\"Test Plugin\", self.iface.mainWindow())\nself.iface.registerMainWindowAction(self.key_action, \"Ctrl+I\")  # \u200b\u64cd\u4f5c\u200b\u88ab\u200bCtrl+I\u200b\u89e6\u53d1\u200b\nself.iface.addPluginToMenu(\"&amp;Test plugins\", self.key_action)\nself.key_action.triggered.connect(self.key_action_triggered)\n</code></pre> <p>\u200b\u5728\u200b<code>unload()</code>\u200b\u4e2d\u200b\u6dfb\u52a0\u200b\uff1a</p> <pre><code>self.iface.unregisterMainWindowAction(self.keyAction)\n</code></pre> <p>\u200b\u6309\u4e0b\u200b<code>CTRL+I</code>\u200b\u65f6\u200b\u8c03\u7528\u200b\u65b9\u6cd5\u200b\uff1a</p> <pre><code>def key_action_triggered(self):\n    QMessageBox.information(self.iface.mainWindow(),\"Ok\", \"You pressed Ctrl+I\")\n</code></pre> <p>\u200b\u8fd8\u200b\u53ef\u4ee5\u200b\u5141\u8bb8\u200b\u7528\u6237\u200b\u4e3a\u200b\u63d0\u4f9b\u200b\u7684\u200b\u64cd\u4f5c\u200b\u81ea\u5b9a\u4e49\u200b\u5feb\u6377\u952e\u200b\u3002\u200b\u8fd9\u662f\u200b\u901a\u8fc7\u200b\u6dfb\u52a0\u200b\u4ee5\u4e0b\u5185\u5bb9\u200b\u6765\u200b\u5b8c\u6210\u200b\u7684\u200b\uff1a</p> <pre><code># \u200b\u5728\u200b initGui() \u200b\u65b9\u6cd5\u200b\u4e2d\u200b\nQgsGui.shortcutsManager().registerAction(self.key_action)\n\n# \u200b\u5728\u200b unload() \u200b\u65b9\u6cd5\u200b\u4e2d\u200b\nQgsGui.shortcutsManager().unregisterAction(self.key_action)\n</code></pre>"},{"location":"16-%E5%BC%80%E5%8F%91Python%E6%8F%92%E4%BB%B6/#1622-qgis","title":"16.2.2 \u200b\u5982\u4f55\u200b\u91cd\u7528\u200bQGIS\u200b\u56fe\u6807","text":"<p>\u200b\u56e0\u4e3a\u200b\u5b83\u4eec\u200b\u662f\u200b\u4f17\u6240\u5468\u77e5\u200b\u7684\u200b\uff0c\u200b\u5e76\u4e14\u200b\u5411\u200b\u7528\u6237\u200b\u4f20\u8fbe\u200b\u4e86\u200b\u660e\u786e\u200b\u7684\u200b\u4fe1\u606f\u200b\uff0c\u200b\u6240\u4ee5\u200b\u6709\u65f6\u200b\u4f60\u200b\u53ef\u80fd\u200b\u5e0c\u671b\u200b\u5728\u200b\u63d2\u4ef6\u200b\u4e2d\u200b\u91cd\u7528\u200bQGIS\u200b\u56fe\u6807\u200b\uff0c\u200b\u800c\u200b\u4e0d\u662f\u200b\u7ed8\u5236\u200b\u548c\u200b\u8bbe\u7f6e\u200b\u65b0\u200b\u56fe\u6807\u200b\u3002\u200b\u4f7f\u7528\u200b<code>getThemeIcon()</code>\u200b\u65b9\u6cd5\u200b\u3002</p> <p>\u200b\u4f8b\u5982\u200b\uff0c\u200b\u91cd\u7528\u200b QGIS \u200b\u4ee3\u7801\u200b\u5b58\u50a8\u200b\u5e93\u4e2d\u200b\u53ef\u7528\u200b\u7684\u200b mActionFileOpen.svg \u200b\u56fe\u6807\u200b\uff1a</p> <pre><code># \u200b\u4f8b\u5982\u200b\uff1a\u200b\u5728\u200b\u521d\u59cb\u5316\u200bGUI\u200b\u65f6\u200b\nself.file_open_action = QAction(\n    QgsApplication.getThemeIcon(\"/mActionFileOpen.svg\"),\n    self.tr(\"Select a File...\"),\n    self.iface.mainWindow()\n)\nself.iface.addPluginToMenu(\"MyPlugin\", self.file_open_action)\n</code></pre> <p><code>iconPath()</code>\u200b\u662f\u200b\u8c03\u7528\u200b QGIS \u200b\u56fe\u6807\u200b\u7684\u200b\u53e6\u200b\u4e00\u79cd\u200b\u65b9\u6cd5\u200b\u3002\u200b\u6709\u5173\u200b\u8c03\u7528\u200b\u4e3b\u9898\u200b\u56fe\u6807\u200b\u7684\u200b\u793a\u4f8b\u200b\uff0c\u200b\u8bf7\u200b\u8bbf\u95ee\u200bQGIS\u200b\u5d4c\u5165\u5f0f\u200b\u56fe\u50cf\u200b\u2014\u200b\u901f\u67e5\u8868\u200b\u3002</p>"},{"location":"16-%E5%BC%80%E5%8F%91Python%E6%8F%92%E4%BB%B6/#1623","title":"16.2.3 \u200b\u9009\u9879\u200b\u5bf9\u8bdd\u6846\u200b\u4e2d\u200b\u7684\u200b\u63d2\u4ef6\u63a5\u53e3","text":"<p>\u200b\u4f60\u200b\u53ef\u4ee5\u200b\u5728\u200b \u200b\u8bbe\u7f6e\u200b \u2023 \u200b\u9009\u9879\u200b \u200b\u4e2d\u200b\u6dfb\u52a0\u200b\u4e00\u4e2a\u200b\u81ea\u5b9a\u4e49\u200b\u63d2\u4ef6\u200b\u9009\u9879\u200b\u6807\u7b7e\u200b\u3002\u200b\u8fd9\u6bd4\u4e3a\u200b\u4f60\u200b\u7684\u200b\u63d2\u4ef6\u200b\u9009\u9879\u200b\u6dfb\u52a0\u200b\u4e00\u4e2a\u200b\u7279\u5b9a\u200b\u7684\u200b\u4e3b\u200b\u83dc\u5355\u200b\u6761\u76ee\u200b\u66f4\u200b\u53ef\u53d6\u200b\uff0c\u200b\u56e0\u4e3a\u200b\u5b83\u200b\u5c06\u200b\u6240\u6709\u200b\u7684\u200bQGIS\u200b\u5e94\u7528\u7a0b\u5e8f\u200b\u8bbe\u7f6e\u200b\u548c\u200b\u63d2\u4ef6\u200b\u8bbe\u7f6e\u200b\u4fdd\u5b58\u200b\u5728\u200b\u4e00\u4e2a\u200b\u5355\u4e00\u200b\u7684\u200b\u5730\u65b9\u200b\uff0c\u200b\u4fbf\u4e8e\u200b\u7528\u6237\u200b\u53d1\u73b0\u200b\u548c\u200b\u5bfc\u822a\u200b\u3002</p> <p>\u200b\u4e0b\u9762\u200b\u7684\u200b\u4ee3\u7801\u200b\u7247\u6bb5\u200b\u5c06\u200b\u4e3a\u200b\u63d2\u4ef6\u200b\u7684\u200b\u8bbe\u7f6e\u200b\u6dfb\u52a0\u200b\u4e00\u4e2a\u200b\u65b0\u200b\u7684\u200b\u7a7a\u767d\u200b\u9009\u9879\u5361\u200b\uff0c\u200b\u4e3a\u200b\u4f60\u200b\u586b\u5145\u200b\u6240\u6709\u200b\u9009\u9879\u200b\u548c\u200b\u4f60\u200b\u7684\u200b\u63d2\u4ef6\u200b\u7279\u5b9a\u200b\u8bbe\u7f6e\u200b\u505a\u597d\u200b\u51c6\u5907\u200b\u3002\u200b\u4f60\u200b\u53ef\u4ee5\u200b\u5c06\u200b\u4e0b\u9762\u200b\u7684\u200b\u7c7b\u200b\u62c6\u200b\u5206\u6210\u200b\u4e0d\u540c\u200b\u7684\u200b\u6587\u4ef6\u200b\u3002\u200b\u5728\u200b\u8fd9\u4e2a\u200b\u4f8b\u5b50\u200b\u4e2d\u200b\uff0c\u200b\u6211\u4eec\u200b\u5728\u200bmainPlugin.py\u200b\u6587\u4ef6\u200b\u4e2d\u200b\u6dfb\u52a0\u200b\u4e86\u200b\u4e24\u4e2a\u200b\u7c7b\u200b\u3002</p> <pre><code>class MyPluginOptionsFactory(QgsOptionsWidgetFactory):\n\n    def __init__(self):\n        super().__init__()\n\n    def icon(self):\n        return QIcon('icons/my_plugin_icon.svg')\n\n    def createWidget(self, parent):\n        return ConfigOptionsPage(parent)\n\n\nclass ConfigOptionsPage(QgsOptionsPageWidget):\n\n    def __init__(self, parent):\n        super().__init__(parent)\n        layout = QHBoxLayout()\n        layout.setContentsMargins(0, 0, 0, 0)\n        self.setLayout(layout)\n</code></pre> <p>\u200b\u6700\u540e\u200b\u6211\u4eec\u200b\u6dfb\u52a0\u200b\u5bfc\u5165\u200b\u548c\u200b\u4fee\u6539\u200b<code>__init__</code>\u200b\u51fd\u6570\u200b\uff1a</p> <pre><code>from qgis.gui import QgsOptionsWidgetFactory, QgsOptionsPageWidget\n\n\nclass MyPlugin:\n    def __init__(self, iface):\n        \"\"\"\u200b\u6784\u9020\u51fd\u6570\u200b.\n\n        :param iface: \u200b\u5c06\u200b\u4f20\u9012\u200b\u7ed9\u200b\u8be5\u7c7b\u200b\u7684\u200b\u63a5\u53e3\u200b\u5b9e\u4f8b\u200b\u5b83\u200b\u63d0\u4f9b\u200b\u4e86\u200b\u4e00\u4e2a\u200b\u94a9\u5b50\u200b\uff0c\u200b\u4f60\u200b\u53ef\u4ee5\u200b\u901a\u8fc7\u200b\u5b83\u200b\u6765\u200b\u64cd\u4f5c\u200bQGIS\u200b\u8fd0\u884c\u200b\u65f6\u200b\u5e94\u7528\u7a0b\u5e8f\u200b\u3002\n        :type iface: QgsInterface\n        \"\"\"\n        # \u200b\u4fdd\u5b58\u200b\u5f15\u7528\u200b\n        self.iface = iface\n\n\n    def initGui(self):\n        self.options_factory = MyPluginOptionsFactory()\n        self.options_factory.setTitle(self.tr('My Plugin'))\n        iface.registerOptionsWidgetFactory(self.options_factory)\n\n    def unload(self):\n        iface.unregisterOptionsWidgetFactory(self.options_factory)\n</code></pre> <p>\u200b\u63d0\u793a\u200b</p> <p>\u200b\u5c06\u200b\u81ea\u5b9a\u4e49\u200b\u9009\u9879\u5361\u200b\u6dfb\u52a0\u200b\u5230\u200b\u56fe\u5c42\u200b\u5c5e\u6027\u200b\u5bf9\u8bdd\u6846\u200b </p> <p>\u200b\u4f60\u200b\u53ef\u4ee5\u200b\u5e94\u7528\u200b\u7c7b\u4f3c\u200b\u7684\u200b\u903b\u8f91\u200b\uff0c\u200b\u4f7f\u7528\u200bQgsMapLayerConfigWidgetFactory\u200b\u548c\u200bQgsMapLayerConfigWidget\u200b\u7c7b\u200b\u5c06\u200b\u63d2\u4ef6\u200b\u81ea\u5b9a\u4e49\u200b\u9009\u9879\u200b\u6dfb\u52a0\u200b\u5230\u200b\u56fe\u5c42\u200b\u5c5e\u6027\u200b\u5bf9\u8bdd\u6846\u200b\u4e2d\u200b\u3002</p>"},{"location":"16-%E5%BC%80%E5%8F%91Python%E6%8F%92%E4%BB%B6/#1624","title":"16.2.4 \u200b\u5728\u200b\u56fe\u5c42\u200b\u6811\u4e2d\u200b\u5d4c\u5165\u200b\u56fe\u5c42\u200b\u7684\u200b\u81ea\u5b9a\u4e49\u200b\u5c0f\u7ec4\u200b\u4ef6","text":"<p>\u200b\u9664\u4e86\u200b\u5728\u200b\u56fe\u200b\u5c42\u9762\u200b\u677f\u4e2d\u200b\u5e38\u89c1\u200b\u7684\u200b\u56fe\u5c42\u200b\u7b26\u53f7\u200b\u5143\u7d20\u200b\u4e4b\u5916\u200b\uff0c\u200b\u4f60\u200b\u8fd8\u200b\u53ef\u4ee5\u200b\u6dfb\u52a0\u200b\u81ea\u5df1\u200b\u7684\u200b\u5c0f\u200b\u90e8\u4ef6\u200b\uff0c\u200b\u4ee5\u4fbf\u200b\u5feb\u901f\u8bbf\u95ee\u200b\u4e00\u4e9b\u200b\u7ecf\u5e38\u200b\u4e0e\u200b\u56fe\u5c42\u200b\u4e00\u8d77\u200b\u4f7f\u7528\u200b\u7684\u200b\u64cd\u4f5c\u200b\uff08\u200b\u8bbe\u7f6e\u200b\u8fc7\u6ee4\u200b\u3001\u200b\u9009\u62e9\u200b\u3001\u200b\u6837\u5f0f\u200b\u3001\u200b\u4f7f\u7528\u200b\u6309\u94ae\u200b\u5c0f\u200b\u90e8\u4ef6\u200b\u5237\u65b0\u200b\u56fe\u5c42\u200b\u3001\u200b\u521b\u5efa\u200b\u57fa\u4e8e\u200b\u65f6\u95f4\u8f74\u200b\u7684\u200b\u56fe\u5c42\u200b\u6216\u4ec5\u200b\u5728\u200b\u6807\u7b7e\u200b\u4e2d\u200b\u663e\u793a\u200b\u989d\u5916\u200b\u7684\u200b\u56fe\u5c42\u200b\u4fe1\u606f\u200b\u7b49\u200b\uff09\u3002\u200b\u8fd9\u4e9b\u200b\u6240\u8c13\u200b\u7684\u200b\u56fe\u5c42\u200b\u6811\u200b\u5d4c\u5165\u5f0f\u200b\u5c0f\u200b\u90e8\u4ef6\u200b\u901a\u8fc7\u200b\u56fe\u5c42\u200b\u7684\u200b\u5c5e\u6027\u200b\u56fe\u4f8b\u200b\u9009\u9879\u5361\u200b\u4e3a\u200b\u5404\u4e2a\u200b\u56fe\u5c42\u200b\u63d0\u4f9b\u200b\u3002</p> <p>\u200b\u4ee5\u4e0b\u200b\u4ee3\u7801\u200b\u7247\u6bb5\u200b\u5728\u200b\u56fe\u4f8b\u200b\u4e2d\u200b\u521b\u5efa\u200b\u4e00\u4e2a\u200b\u4e0b\u62c9\u83dc\u5355\u200b\uff0c\u200b\u663e\u793a\u200b\u56fe\u5c42\u200b\u53ef\u7528\u200b\u7684\u200b\u56fe\u5c42\u200b\u6837\u5f0f\u200b\uff0c\u200b\u5141\u8bb8\u200b\u5feb\u901f\u200b\u5728\u200b\u4e0d\u540c\u200b\u7684\u200b\u56fe\u5c42\u200b\u6837\u5f0f\u200b\u4e4b\u95f4\u200b\u5207\u6362\u200b\u3002</p> <pre><code>class LayerStyleComboBox(QComboBox):\n    def __init__(self, layer):\n        QComboBox.__init__(self)\n        self.layer = layer\n        for style_name in layer.styleManager().styles():\n            self.addItem(style_name)\n\n        idx = self.findText(layer.styleManager().currentStyle())\n        if idx != -1:\n          self.setCurrentIndex(idx)\n\n        self.currentIndexChanged.connect(self.on_current_changed)\n\n    def on_current_changed(self, index):\n        self.layer.styleManager().setCurrentStyle(self.itemText(index))\n\nclass LayerStyleWidgetProvider(QgsLayerTreeEmbeddedWidgetProvider):\n    def __init__(self):\n        QgsLayerTreeEmbeddedWidgetProvider.__init__(self)\n\n    def id(self):\n        return \"style\"\n\n    def name(self):\n        return \"Layer style chooser\"\n\n    def createWidget(self, layer, widgetIndex):\n        return LayerStyleComboBox(layer)\n\n    def supportsLayer(self, layer):\n        return True   # any layer is fine\n\nprovider = LayerStyleWidgetProvider()\nQgsGui.layerTreeEmbeddedWidgetRegistry().addProvider(provider)\n</code></pre> <p>\u200b\u4ece\u200b\u7ed9\u5b9a\u200b\u56fe\u5c42\u200b\u7684\u200b\u56fe\u4f8b\u200b\u5c5e\u6027\u200b\u9009\u9879\u5361\u200b\u4e2d\u200b\uff0c\u200b\u5c06\u200b\u201c\u200b\u56fe\u5c42\u200b\u6837\u5f0f\u200b\u9009\u62e9\u5668\u200b\u201d\u200b\u4ece\u200b\u201c\u200b\u53ef\u7528\u200b\u5c0f\u200b\u90e8\u4ef6\u200b\u201d\u200b\u62d6\u52a8\u200b\u5230\u200b\u201c\u200b\u5df2\u7528\u200b\u5c0f\u200b\u90e8\u4ef6\u200b\u201d\uff0c\u200b\u4ee5\u200b\u5728\u200b\u56fe\u5c42\u200b\u6811\u4e2d\u200b\u542f\u7528\u200b\u5c0f\u200b\u90e8\u4ef6\u200b\u3002\u200b\u5d4c\u5165\u5f0f\u200b\u5c0f\u200b\u90e8\u4ef6\u200b\u59cb\u7ec8\u200b\u663e\u793a\u200b\u5728\u200b\u5176\u200b\u76f8\u5173\u200b\u56fe\u5c42\u200b\u8282\u70b9\u200b\u5b50\u9879\u200b\u7684\u200b\u9876\u90e8\u200b\u3002</p> <p>\u200b\u5982\u679c\u200b\u4f60\u200b\u60f3\u200b\u4ece\u200b\u63d2\u4ef6\u200b\u4e2d\u200b\u4f7f\u7528\u200b\u5c0f\u200b\u90e8\u4ef6\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u6309\u200b\u4ee5\u4e0b\u200b\u65b9\u6cd5\u200b\u6dfb\u52a0\u200b\u5b83\u4eec\u200b\uff1a</p> <pre><code>layer = iface.activeLayer()\ncounter = int(layer.customProperty(\"embeddedWidgets/count\", 0))\nlayer.setCustomProperty(\"embeddedWidgets/count\", counter+1)\nlayer.setCustomProperty(\"embeddedWidgets/{}/id\".format(counter), \"style\")\nview = self.iface.layerTreeView()\nview.layerTreeModel().refreshLayerLegend(view.currentLegendNode())\nview.currentNode().setExpanded(True)\n</code></pre>"},{"location":"16-%E5%BC%80%E5%8F%91Python%E6%8F%92%E4%BB%B6/#163-ide","title":"16.3 \u200b\u7f16\u5199\u200b\u548c\u200b\u8c03\u8bd5\u200b\u63d2\u4ef6\u200b\u7684\u200bIDE\u200b\u8bbe\u7f6e","text":"<p>TODO</p>"},{"location":"16-%E5%BC%80%E5%8F%91Python%E6%8F%92%E4%BB%B6/#164","title":"16.4 \u200b\u53d1\u5e03\u200b\u4f60\u200b\u7684\u200b\u63d2\u4ef6","text":"<p>\u200b\u4e00\u65e6\u200b\u4f60\u200b\u7684\u200b\u63d2\u4ef6\u200b\u51c6\u5907\u200b\u597d\u200b\u4e86\u200b\uff0c\u200b\u5e76\u4e14\u200b\u4f60\u200b\u8ba4\u4e3a\u200b\u8fd9\u4e2a\u200b\u63d2\u4ef6\u200b\u53ef\u80fd\u200b\u5bf9\u200b\u67d0\u4e9b\u200b\u4eba\u6709\u200b\u5e2e\u52a9\u200b\uff0c\u200b\u4e0d\u8981\u200b\u72b9\u8c6b\u200b\uff0c\u200b\u628a\u200b\u5b83\u200b\u4e0a\u200b\u4f20\u5230\u200b\u5b98\u65b9\u200bPython\u200b\u63d2\u4ef6\u200b\u4ed3\u5e93\u200b\u3002\u200b\u5728\u200b\u8be5\u200b\u9875\u9762\u200b\u4e0a\u200b\uff0c\u200b\u4f60\u200b\u8fd8\u200b\u53ef\u4ee5\u200b\u627e\u5230\u200b\u5173\u4e8e\u200b\u5982\u4f55\u200b\u51c6\u5907\u200b\u63d2\u4ef6\u200b\u4ee5\u200b\u4e0e\u200b\u63d2\u4ef6\u200b\u5b89\u88c5\u7a0b\u5e8f\u200b\u826f\u597d\u200b\u914d\u5408\u200b\u7684\u200b\u6253\u5305\u200b\u6307\u5357\u200b\u3002\u200b\u6216\u8005\u200b\uff0c\u200b\u5982\u679c\u200b\u4f60\u200b\u60f3\u200b\u5efa\u7acb\u200b\u81ea\u5df1\u200b\u7684\u200b\u63d2\u4ef6\u200b\u5e93\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u521b\u5efa\u200b\u4e00\u4e2a\u200b\u7b80\u5355\u200b\u7684\u200bXML\u200b\u6587\u4ef6\u200b\uff0c\u200b\u5217\u51fa\u200b\u63d2\u4ef6\u200b\u53ca\u5176\u200b\u5143\u200b\u6570\u636e\u200b\u3002</p> <p>\u200b\u8bf7\u200b\u7279\u522b\u200b\u6ce8\u610f\u200b\u4e00\u4e0b\u200b\u5efa\u8bae\u200b\uff1a</p>"},{"location":"16-%E5%BC%80%E5%8F%91Python%E6%8F%92%E4%BB%B6/#1641","title":"16.4.1 \u200b\u5143\u200b\u6570\u636e\u200b\u548c\u200b\u540d\u79f0","text":"<ul> <li>\u200b\u907f\u514d\u200b\u4f7f\u7528\u200b\u4e0e\u200b\u73b0\u6709\u200b\u63d2\u4ef6\u200b\u8fc7\u4e8e\u200b\u76f8\u4f3c\u200b\u7684\u200b\u540d\u79f0\u200b</li> <li>\u200b\u5982\u679c\u200b\u4f60\u200b\u7684\u200b\u63d2\u4ef6\u200b\u4e0e\u200b\u73b0\u6709\u200b\u7684\u200b\u63d2\u4ef6\u200b\u6709\u200b\u7c7b\u4f3c\u200b\u7684\u200b\u529f\u80fd\u200b\uff0c\u200b\u8bf7\u200b\u5728\u200b \"\u200b\u5173\u4e8e\u200b \"\u200b\u4e00\u680f\u200b\u4e2d\u200b\u89e3\u91ca\u200b\u5176\u200b\u533a\u522b\u200b\uff0c\u200b\u8fd9\u6837\u200b\u7528\u6237\u200b\u5c31\u200b\u4f1a\u200b\u77e5\u9053\u200b\u4f7f\u7528\u200b\u54ea\u200b\u4e00\u4e2a\u200b\uff0c\u200b\u800c\u200b\u4e0d\u200b\u9700\u8981\u200b\u5b89\u88c5\u200b\u548c\u200b\u6d4b\u8bd5\u200b\u3002</li> <li>\u200b\u907f\u514d\u200b\u5728\u200b\u63d2\u4ef6\u200b\u672c\u8eab\u200b\u7684\u200b\u540d\u79f0\u200b\u4e2d\u200b\u91cd\u590d\u4f7f\u7528\u200b\"plugin\"\u3002</li> <li>\u200b\u4f7f\u7528\u200b\u5143\u200b\u6570\u636e\u200b\u4e2d\u200b\u7684\u200b\u63cf\u8ff0\u200b\u5b57\u200b\u6bb5\u200b\u8fdb\u884c\u200b\u5355\u884c\u200b\u63cf\u8ff0\u200b\uff0c\u200b\u4f7f\u7528\u200b\u5173\u4e8e\u200b\u5b57\u200b\u6bb5\u200b\u8fdb\u884c\u200b\u66f4\u200b\u8be6\u7ec6\u200b\u7684\u200b\u8bf4\u660e\u200b</li> <li>\u200b\u5305\u62ec\u200b\u4e00\u4e2a\u200b\u4ee3\u7801\u200b\u5e93\u200b\u3001\u200b\u4e00\u4e2a\u200b\u9519\u8bef\u200b\u8ddf\u8e2a\u5668\u200b\u548c\u200b\u4e00\u4e2a\u200b\u4e3b\u9875\u200b\uff1b\u200b\u8fd9\u200b\u5c06\u200b\u6781\u5927\u5730\u63d0\u9ad8\u200b\u5408\u4f5c\u200b\u7684\u200b\u53ef\u80fd\u6027\u200b\uff0c\u200b\u5e76\u4e14\u200b\u53ef\u4ee5\u200b\u901a\u8fc7\u200b\u73b0\u6709\u200b\u7684\u200b\u7f51\u7edc\u200b\u57fa\u7840\u8bbe\u65bd\u200b\uff08GitHub\u3001GitLab\u3001Bitbucket\u200b\u7b49\u200b\uff09\u200b\u975e\u5e38\u5bb9\u6613\u200b\u5730\u200b\u5b8c\u6210\u200b\u3002</li> <li>\u200b\u8c28\u614e\u200b\u9009\u62e9\u200b\u6807\u7b7e\u200b\uff1a\u200b\u907f\u514d\u200b\u4e0d\u5177\u200b\u53c2\u8003\u4ef7\u503c\u200b\u7684\u200b\u6807\u7b7e\u200b\uff08\u200b\u5982\u200bvector\uff09\uff0c\u200b\u6700\u597d\u200b\u9009\u62e9\u200b\u5df2\u7ecf\u200b\u88ab\u200b\u4ed6\u4eba\u200b\u4f7f\u7528\u200b\u7684\u200b\u6807\u7b7e\u200b\uff08\u200b\u89c1\u200b\u63d2\u4ef6\u200b\u7f51\u7ad9\u200b\uff09\u3002</li> <li>\u200b\u6dfb\u52a0\u200b\u4e00\u4e2a\u200b\u5408\u9002\u200b\u7684\u200b\u56fe\u6807\u200b\uff0c\u200b\u4e0d\u8981\u200b\u4f7f\u7528\u200b\u9ed8\u8ba4\u200b\u7684\u200b\u56fe\u6807\u200b\uff1b\u200b\u53c2\u89c1\u200bQGIS\u200b\u754c\u9762\u200b\uff0c\u200b\u4e86\u89e3\u200b\u8981\u200b\u4f7f\u7528\u200b\u7684\u200b\u98ce\u683c\u200b\u5efa\u8bae\u200b</li> </ul>"},{"location":"16-%E5%BC%80%E5%8F%91Python%E6%8F%92%E4%BB%B6/#1642","title":"16.4.2 \u200b\u4ee3\u7801\u200b\u548c\u200b\u5e2e\u52a9","text":"<ul> <li> <p>\u200b\u4e0d\u8981\u200b\u628a\u200b\u751f\u6210\u200b\u7684\u200b\u6587\u4ef6\u200b\uff08ui_*.py, resources_rc.py, \u200b\u751f\u6210\u200b\u7684\u200b\u5e2e\u52a9\u6587\u4ef6\u200b...\uff09\u200b\u548c\u200b\u65e0\u7528\u200b\u7684\u200b\u4e1c\u897f\u200b\uff08\u200b\u5982\u200b.gitignore\uff09\u200b\u5305\u62ec\u200b\u5728\u200b\u7248\u672c\u200b\u5e93\u4e2d\u200b</p> </li> <li> <p>\u200b\u5c06\u200b\u63d2\u4ef6\u200b\u6dfb\u52a0\u200b\u5230\u200b\u9002\u5f53\u200b\u7684\u200b\u83dc\u5355\u200b\u4e2d\u200b\uff08Vector, Raster, Web, Database\uff09\u3002</p> </li> <li> <p>\u200b\u5728\u200b\u9002\u5f53\u200b\u7684\u200b\u65f6\u5019\u200b\uff08\u200b\u6267\u884c\u200b\u5206\u6790\u200b\u7684\u200b\u63d2\u4ef6\u200b\uff09\uff0c\u200b\u8003\u8651\u200b\u5c06\u200b\u63d2\u4ef6\u200b\u6dfb\u52a0\u200b\u4e3a\u200bProcessing\u200b\u6846\u67b6\u200b\u7684\u200b\u5b50\u200b\u63d2\u4ef6\u200b\uff1a\u200b\u8fd9\u200b\u5c06\u200b\u5141\u8bb8\u200b\u7528\u6237\u200b\u6279\u91cf\u200b\u8fd0\u884c\u200b\u5b83\u200b\uff0c\u200b\u5c06\u200b\u5b83\u200b\u96c6\u6210\u200b\u5230\u200b\u66f4\u200b\u590d\u6742\u200b\u7684\u200b\u5de5\u4f5c\u200b\u6d41\u4e2d\u200b\uff0c\u200b\u5e76\u200b\u5c06\u200b\u4f60\u200b\u4ece\u200b\u8bbe\u8ba1\u200b\u754c\u9762\u200b\u7684\u200b\u8d1f\u62c5\u200b\u4e2d\u200b\u89e3\u653e\u51fa\u6765\u200b</p> </li> <li> <p>\u200b\u81f3\u5c11\u200b\u5305\u62ec\u200b\u6700\u200b\u57fa\u672c\u200b\u7684\u200b\u6587\u6863\u200b\uff0c\u200b\u5982\u679c\u200b\u5bf9\u200b\u6d4b\u8bd5\u200b\u548c\u200b\u7406\u89e3\u200b\u6709\u7528\u200b\u7684\u8bdd\u200b\uff0c\u200b\u8fd8\u200b\u5305\u62ec\u200b\u6837\u672c\u200b\u6570\u636e\u200b\u3002</p> </li> </ul>"},{"location":"16-%E5%BC%80%E5%8F%91Python%E6%8F%92%E4%BB%B6/#1643-python","title":"16.4.3 \u200b\u5b98\u65b9\u200bpython\u200b\u63d2\u4ef6\u200b\u4ed3\u5e93","text":"<p>\u200b\u4f60\u200b\u53ef\u4ee5\u200b\u627e\u5230\u200b\u5b98\u65b9\u200bpython\u200b\u63d2\u4ef6\u200b\u4ed3\u5e93\u200b\uff1ahttps://plugins.qgis.org/\u3002</p> <p>\u200b\u4e3a\u4e86\u200b\u4f7f\u7528\u200b\u5b98\u65b9\u200bpython\u200b\u63d2\u4ef6\u200b\u4ed3\u5e93\u200b\uff0c\u200b\u4f60\u200b\u5fc5\u987b\u200b\u4ece\u200bOSGEO web portal\u200b\u83b7\u5f97\u200bOSGEO ID\u3002</p> <p>\u200b\u4e00\u65e6\u200b\u4f60\u200b\u4e0a\u4f20\u200b\u4e86\u200b\u4f60\u200b\u7684\u200b\u63d2\u4ef6\u200b\uff0c\u200b\u5b83\u200b\u5c06\u200b\u5f97\u5230\u200b\u4e00\u4e2a\u200b\u5de5\u4f5c\u4eba\u5458\u200b\u7684\u200b\u6279\u51c6\u200b\uff0c\u200b\u4f60\u200b\u4f1a\u200b\u5f97\u5230\u200b\u901a\u77e5\u200b\u3002</p>"},{"location":"16-%E5%BC%80%E5%8F%91Python%E6%8F%92%E4%BB%B6/#16431","title":"16.4.3.1 \u200b\u6743\u9650","text":"<p>\u200b\u8fd9\u4e9b\u200b\u89c4\u5219\u200b\u5df2\u7ecf\u200b\u5728\u200b\u5b98\u65b9\u200b\u63d2\u4ef6\u200b\u5e93\u4e2d\u200b\u5b9e\u73b0\u200b\uff1a</p> <ul> <li> <p>\u200b\u6bcf\u4e2a\u200b\u6ce8\u518c\u200b\u7528\u6237\u200b\u90fd\u200b\u53ef\u4ee5\u200b\u6dfb\u52a0\u200b\u4e00\u4e2a\u200b\u65b0\u200b\u7684\u200b\u63d2\u4ef6\u200b</p> </li> <li> <p>\u200b\u5458\u5de5\u200b\u7528\u6237\u200b\u53ef\u4ee5\u200b\u6279\u51c6\u200b\u6216\u200b\u4e0d\u200b\u6279\u51c6\u200b\u6240\u6709\u200b\u7684\u200b\u63d2\u4ef6\u200b\u7248\u672c\u200b</p> </li> <li> <p>\u200b\u62e5\u6709\u200b\u7279\u6b8a\u200b\u6743\u9650\u200b<code>plugins.can_approve</code>\u200b\u7684\u200b\u7528\u6237\u200b\u53ef\u4ee5\u200b\u81ea\u52a8\u200b\u6279\u51c6\u200b\u4ed6\u4eec\u200b\u4e0a\u4f20\u200b\u7684\u200b\u7248\u672c\u200b</p> </li> <li> <p>\u200b\u62e5\u6709\u200b\u7279\u6b8a\u200b\u6743\u9650\u200b<code>plugins.can_approve</code>\u200b\u7684\u200b\u7528\u6237\u200b\u53ef\u4ee5\u200b\u6279\u51c6\u200b\u5176\u4ed6\u4eba\u200b\u4e0a\u4f20\u200b\u7684\u200b\u7248\u672c\u200b\uff0c\u200b\u53ea\u8981\u200b\u4ed6\u4eec\u200b\u5728\u200b\u63d2\u4ef6\u200b\u6240\u6709\u8005\u200b\u7684\u200b\u5217\u8868\u200b\u4e2d\u200b\u3002</p> </li> <li> <p>\u200b\u4e00\u4e2a\u200b\u7279\u5b9a\u200b\u7684\u200b\u63d2\u4ef6\u200b\u53ea\u80fd\u200b\u7531\u200b\u5458\u5de5\u200b\u7528\u6237\u200b\u548c\u200b\u63d2\u4ef6\u200b\u6240\u6709\u8005\u200b\u5220\u9664\u200b\u548c\u200b\u7f16\u8f91\u200b\u3002</p> </li> <li> <p>\u200b\u5982\u679c\u200b\u4e00\u4e2a\u200b\u6ca1\u6709\u200b<code>plugins.can_approve</code>\u200b\u6743\u9650\u200b\u7684\u200b\u7528\u6237\u200b\u4e0a\u4f20\u200b\u4e86\u200b\u4e00\u4e2a\u200b\u65b0\u200b\u7684\u200b\u7248\u672c\u200b\uff0c\u200b\u8be5\u200b\u63d2\u4ef6\u200b\u7684\u200b\u7248\u672c\u200b\u4f1a\u200b\u81ea\u52a8\u200b\u53d6\u6d88\u200b\u5ba1\u6279\u200b\u3002</p> </li> </ul>"},{"location":"16-%E5%BC%80%E5%8F%91Python%E6%8F%92%E4%BB%B6/#16432","title":"16.4.3.2 \u200b\u4fe1\u4efb\u200b\u7ba1\u7406","text":"<p>\u200b\u5de5\u4f5c\u4eba\u5458\u200b\u53ef\u4ee5\u200b\u901a\u8fc7\u200b\u524d\u7aef\u200b\u5e94\u7528\u7a0b\u5e8f\u200b\u8bbe\u7f6e\u200b<code>plugins.can_approve</code>\u200b\u6743\u9650\u200b\uff0c\u200b\u5411\u200b\u9009\u5b9a\u200b\u7684\u200b\u63d2\u4ef6\u200b\u521b\u5efa\u8005\u200b\u6388\u4e88\u200b\u4fe1\u4efb\u200b\u3002</p> <p>\u200b\u63d2\u4ef6\u200b\u8be6\u60c5\u200b\u89c6\u56fe\u200b\u63d0\u4f9b\u200b\u4e86\u200b\u76f4\u63a5\u200b\u94fe\u63a5\u200b\uff0c\u200b\u4ee5\u200b\u6388\u4e88\u200b\u5bf9\u200b\u63d2\u4ef6\u200b\u521b\u5efa\u8005\u200b\u6216\u200b\u63d2\u4ef6\u200b\u6240\u6709\u8005\u200b\u7684\u200b\u4fe1\u4efb\u200b\u3002</p>"},{"location":"16-%E5%BC%80%E5%8F%91Python%E6%8F%92%E4%BB%B6/#16433","title":"16.4.3.3 \u200b\u9a8c\u8bc1","text":"<p>\u200b\u5728\u200b\u4e0a\u4f20\u200b\u63d2\u4ef6\u200b\u65f6\u200b\uff0c\u200b\u63d2\u4ef6\u200b\u7684\u200b\u5143\u200b\u6570\u636e\u200b\u4f1a\u200b\u81ea\u52a8\u200b\u4ece\u200b\u538b\u7f29\u5305\u200b\u4e2d\u200b\u5bfc\u5165\u200b\u5e76\u200b\u8fdb\u884c\u200b\u9a8c\u8bc1\u200b\u3002</p> <p>\u200b\u8fd9\u91cc\u200b\u6709\u200b\u4e00\u4e9b\u200b\u9a8c\u8bc1\u200b\u89c4\u5219\u200b\uff0c\u200b\u5f53\u200b\u4f60\u200b\u60f3\u200b\u5728\u200b\u5b98\u65b9\u200b\u4ed3\u5e93\u200b\u4e0a\u4f20\u200b\u4e00\u4e2a\u200b\u63d2\u4ef6\u200b\u65f6\u200b\uff0c\u200b\u4f60\u200b\u5e94\u8be5\u200b\u6ce8\u610f\u200b\uff1a</p> <ol> <li>\u200b\u5305\u542b\u200b\u63d2\u4ef6\u200b\u7684\u200b\u4e3b\u200b\u6587\u4ef6\u5939\u200b\u7684\u200b\u540d\u79f0\u200b\u5fc5\u987b\u200b\u53ea\u200b\u5305\u542b\u200bASCII\u200b\u5b57\u7b26\u200b\uff08A-Z\u200b\u548c\u200ba-z\uff09\u3001\u200b\u6570\u5b57\u200b\u548c\u200b\u4e0b\u5212\u7ebf\u200b\uff08_\uff09\u200b\u548c\u200b\u51cf\u53f7\u200b\uff08-\uff09\uff0c\u200b\u800c\u4e14\u200b\u4e0d\u80fd\u200b\u4ee5\u200b\u6570\u5b57\u200b\u5f00\u5934\u200b\u3002</li> <li><code>metadata.txt</code>\u200b\u662f\u200b\u5fc5\u9700\u200b\u7684\u200b</li> <li>\u200b\u5143\u200b\u6570\u636e\u8868\u200b\u4e2d\u200b\u5217\u51fa\u200b\u7684\u200b\u6240\u6709\u200b\u5fc5\u9700\u200b\u7684\u200b\u5143\u200b\u6570\u636e\u200b\u90fd\u200b\u5fc5\u987b\u200b\u5b58\u5728\u200b</li> <li>\u200b\u5143\u200b\u6570\u636e\u200b<code>version</code>\u200b\u5b57\u200b\u6bb5\u200b\u5fc5\u987b\u200b\u662f\u200b\u552f\u4e00\u200b\u7684\u200b</li> </ol>"},{"location":"16-%E5%BC%80%E5%8F%91Python%E6%8F%92%E4%BB%B6/#16434","title":"16.4.3.4 \u200b\u63d2\u4ef6\u200b\u7ed3\u6784","text":"<p>\u200b\u6309\u7167\u200b\u9a8c\u8bc1\u200b\u89c4\u5219\u200b\uff0c\u200b\u4f60\u200b\u7684\u200b\u63d2\u4ef6\u200b\u7684\u200b\u538b\u7f29\u5305\u200b\uff08.zip\uff09\u200b\u5fc5\u987b\u200b\u6709\u200b\u4e00\u4e2a\u200b\u7279\u5b9a\u200b\u7684\u200b\u7ed3\u6784\u200b\uff0c\u200b\u624d\u80fd\u200b\u4f5c\u4e3a\u200b\u4e00\u4e2a\u200b\u529f\u80fd\u6027\u200b\u63d2\u4ef6\u200b\u8fdb\u884c\u200b\u9a8c\u8bc1\u200b\u3002\u200b\u7531\u4e8e\u200b\u8be5\u200b\u63d2\u4ef6\u200b\u5c06\u200b\u88ab\u200b\u89e3\u538b\u200b\u5728\u200b\u7528\u6237\u200b\u7684\u200bplugins\u200b\u6587\u4ef6\u5939\u200b\u5185\u200b\uff0c\u200b\u5b83\u200b\u5fc5\u987b\u200b\u5728\u200b.zip\u200b\u6587\u4ef6\u200b\u5185\u6709\u200b\u81ea\u5df1\u200b\u7684\u200b\u76ee\u5f55\u200b\uff0c\u200b\u4ee5\u200b\u4e0d\u200b\u5e72\u6270\u200b\u5176\u4ed6\u200b\u63d2\u4ef6\u200b\u3002\u200b\u5fc5\u9700\u200b\u7684\u200b\u6587\u4ef6\u200b\u6709\u200b\uff1a<code>metadata.txt</code> \u200b\u548c\u200b <code>__init__.py</code>\u3002\u200b\u4f46\u200b\u5982\u679c\u200b\u80fd\u200b\u6709\u200b\u4e00\u4e2a\u200bREADME\uff0c\u200b\u5f53\u7136\u200b\u8fd8\u6709\u200b\u4e00\u4e2a\u200b\u4ee3\u8868\u200b\u8be5\u200b\u63d2\u4ef6\u200b\u7684\u200b\u56fe\u6807\u200b\uff08resources.qrc\uff09\uff0c\u200b\u90a3\u200b\u5c31\u200b\u66f4\u597d\u200b\u4e86\u200b\u3002\u200b\u4ee5\u4e0b\u200b\u662f\u200b\u4e00\u4e2a\u200bplugin.zip\u200b\u7684\u200b\u4f8b\u5b50\u200b\uff0c\u200b\u5b83\u200b\u5e94\u8be5\u200b\u662f\u200b\u8fd9\u6837\u200b\u7684\u200b\u3002</p> <pre><code>plugin.zip\n  pluginfolder/\n  |-- i18n\n  |   |-- translation_file_de.ts\n  |-- img\n  |   |-- icon.png\n  |   `-- iconsource.svg\n  |-- __init__.py\n  |-- Makefile\n  |-- metadata.txt\n  |-- more_code.py\n  |-- main_code.py\n  |-- README\n  |-- resources.qrc\n  |-- resources_rc.py\n  `-- ui_Qt_user_interface_file.ui\n</code></pre>"},{"location":"17-%E7%BC%96%E5%86%99%E5%A4%84%E7%90%86%E6%8F%92%E4%BB%B6/","title":"17 \u200b\u7f16\u5199\u200b\u5904\u7406\u200b\u63d2\u4ef6","text":"<p>\u200b\u53d6\u51b3\u4e8e\u200b\u4f60\u200b\u5c06\u200b\u5f00\u53d1\u200b\u7684\u200b\u63d2\u4ef6\u200b\u7c7b\u578b\u200b\uff0c\u200b\u5b83\u200b\u53ef\u80fd\u200b\u662f\u200b\u66f4\u597d\u200b\u7684\u200b\u9009\u62e9\u200b\u2014\u200b\u4f5c\u4e3a\u200b\u5904\u7406\u200b\u7b97\u6cd5\u200b\uff08\u200b\u6216\u8005\u200b\u7b97\u6cd5\u200b\u96c6\u5408\u200b\uff09\u200b\u53bb\u200b\u589e\u52a0\u200b\u529f\u80fd\u200b\u3002\u200b\u8fd9\u200b\u5c06\u200b\u5728\u200bQGIS\u200b\u4e2d\u200b\u63d0\u4f9b\u200b\u7ed9\u200b\u66f4\u597d\u200b\u7684\u200b\u96c6\u6210\u200b\uff0c\u200b\u989d\u5916\u200b\u7684\u200b\u529f\u80fd\u200b\uff08\u200b\u5b83\u200b\u53ef\u4ee5\u200b\u8fd0\u884c\u200b\u5728\u200b\u5904\u7406\u200b\u7ec4\u4ef6\u200b\u4e2d\u200b\uff0c\u200b\u5982\u200b\u5efa\u6a21\u200b\u6216\u200b\u6279\u5904\u7406\u200b\u754c\u9762\u200b\u8fd0\u884c\u200b\uff09\uff0c\u200b\u548c\u200b\u66f4\u200b\u5feb\u200b\u7684\u200b\u5f00\u53d1\u200b\u65f6\u95f4\u200b\uff08\u200b\u5904\u7406\u200b\u5c06\u200b\u82b1\u8d39\u200b\u7684\u200b\u5f88\u5927\u200b\u4e00\u90e8\u5206\u200b\u5de5\u4f5c\u200b\uff09\u3002</p> <p>\u200b\u4e3a\u4e86\u200b\u5206\u53d1\u200b\u8fd9\u4e9b\u200b\u7b97\u6cd5\u200b\uff0c\u200b\u4f60\u200b\u5e94\u8be5\u200b\u521b\u5efa\u200b\u4e00\u4e2a\u200b\u65b0\u200b\u7684\u200b\u63d2\u4ef6\u200b\uff0c\u200b\u5e76\u200b\u5c06\u200b\u5b83\u4eec\u200b\u6dfb\u52a0\u200b\u5230\u200b\u5904\u7406\u200b\u5de5\u5177\u7bb1\u200b\u3002\u200b\u8be5\u200b\u63d2\u4ef6\u200b\u5e94\u8be5\u200b\u5305\u542b\u200b\u4e00\u4e2a\u200b\u7b97\u6cd5\u200b\u63d0\u4f9b\u8005\u200b\uff0c\u200b\u5b83\u200b\u5728\u200b\u63d2\u4ef6\u200b\u5b9e\u4f8b\u200b\u5316\u200b\u65f6\u200b\u8fdb\u884c\u200b\u6ce8\u518c\u200b\u3002</p>"},{"location":"17-%E7%BC%96%E5%86%99%E5%A4%84%E7%90%86%E6%8F%92%E4%BB%B6/#171","title":"17.1 \u200b\u4ece\u5934\u5f00\u59cb\u200b\u521b\u5efa","text":"<p>\u200b\u4ece\u5934\u5f00\u59cb\u200b\u521b\u5efa\u200b\u4e00\u4e2a\u200b\u63d2\u4ef6\u200b\uff0c\u200b\u5b83\u200b\u5305\u542b\u200b\u4e00\u4e2a\u200b\u7b97\u6cd5\u200b\u63d0\u4f9b\u8005\u200b\uff0c\u200b\u4f60\u200b\u53ef\u4ee5\u200b\u4f7f\u7528\u200b\u63d2\u4ef6\u200b\u6784\u9020\u200b\u5668\u200b\uff0c\u200b\u6309\u7167\u200b\u4e0b\u5217\u200b\u6b65\u9aa4\u200b\u64cd\u4f5c\u200b\uff1a</p> <ol> <li>\u200b\u5b89\u88c5\u200b<code>Plugin Builder</code>\u200b\u63d2\u4ef6\u200b</li> <li>\u200b\u4f7f\u7528\u200b<code>Plugin Builder</code>\u200b\u521b\u5efa\u200b\u4e00\u4e2a\u200b\u65b0\u200b\u7684\u200b\u63d2\u4ef6\u200b\u3002\u200b\u5f53\u200b<code>Plugin Builder</code>\u200b\u8981\u6c42\u200b\u4f60\u200b\u4f7f\u7528\u200b\u6a21\u677f\u200b\u65f6\u200b\uff0c\u200b\u9009\u62e9\u200b\u201cProcessing provider\u201d\u3002</li> <li>\u200b\u521b\u5efa\u200b\u7684\u200b\u63d2\u4ef6\u200b\u5305\u542b\u200b\u4e00\u4e2a\u200b\u7b97\u6cd5\u200b\u63d0\u4f9b\u8005\u200b\u3002\u200b\u65e0\u8bba\u662f\u200b\u63d0\u4f9b\u8005\u200b\u6587\u4ef6\u200b\u548c\u200b\u7b97\u6cd5\u200b\u6587\u4ef6\u200b\u90fd\u200b\u88ab\u200b\u5b8c\u5168\u200b\u6ce8\u91ca\u200b\uff0c\u200b\u5e76\u200b\u5305\u542b\u200b\u6709\u5173\u200b\u5982\u4f55\u200b\u4fee\u6539\u200b\u63d0\u4f9b\u8005\u200b\uff0c\u200b\u5e76\u200b\u6dfb\u52a0\u200b\u989d\u5916\u200b\u7684\u200b\u7b97\u6cd5\u200b\u7684\u200b\u4fe1\u606f\u200b\u3002\u200b\u53c2\u8003\u200b\u5b83\u4eec\u200b\u4ee5\u200b\u83b7\u53d6\u200b\u66f4\u200b\u591a\u200b\u4fe1\u606f\u200b\u3002</li> </ol>"},{"location":"17-%E7%BC%96%E5%86%99%E5%A4%84%E7%90%86%E6%8F%92%E4%BB%B6/#172","title":"17.2 \u200b\u66f4\u65b0\u200b\u63d2\u4ef6","text":"<p>\u200b\u5982\u679c\u200b\u4f60\u200b\u60f3\u200b\u6dfb\u52a0\u200b\u4f60\u200b\u73b0\u6709\u200b\u7684\u200b\u63d2\u4ef6\u200b\u5230\u200b\u201cProcessing\u201d\uff0c\u200b\u4f60\u200b\u9700\u8981\u200b\u6dfb\u52a0\u200b\u4e00\u4e9b\u200b\u4ee3\u7801\u200b\u3002</p> <ol> <li> <p>\u200b\u5728\u200b\u4f60\u200b\u7684\u200b<code>metadata.txt</code>\uff0c\u200b\u4f60\u200b\u9700\u8981\u200b\u6dfb\u52a0\u200b\u4e00\u4e2a\u200b\u53d8\u91cf\u200b\uff1a</p> <pre><code>hasProcessingProvider=yes\n</code></pre> </li> <li> <p>\u200b\u5728\u200bPython\u200b\u6587\u4ef6\u200b\u4e2d\u200b\uff0c\u200b\u63d2\u4ef6\u200b\u4f7f\u7528\u200b<code>initGui</code>\u200b\u65b9\u6cd5\u200b\u5b89\u88c5\u200b\uff0c\u200b\u4f60\u200b\u9700\u8981\u200b\u6539\u5199\u200b\u8fd9\u6837\u200b\u7684\u200b\u4f8b\u5b50\u200b\uff1a</p> <pre><code>from qgis.core import QgsApplication\nfrom .processing_provider import Provider\n\nclass YourPluginName():\n\n    def __init__(self):\n        self.provider = None\n\n    def initProcessing(self):\n        self.provider = Provider()\n        QgsApplication.processingRegistry().addProvider(self.provider)\n\n    def initGui(self):\n        self.initProcessing()\n\n    def unload(self):\n        QgsApplication.processingRegistry().removeProvider(self.provider)\n</code></pre> </li> <li> <p>\u200b\u4f60\u200b\u53ef\u4ee5\u200b\u521b\u5efa\u200b\u4e00\u4e2a\u200b<code>processing_provider</code>\u200b\u6587\u4ef6\u5939\u200b\uff0c\u200b\u5176\u4e2d\u200b\u5305\u542b\u200b\u4e09\u4e2a\u200b\u6587\u4ef6\u200b</p> <ul> <li> <p><code>__init__.py</code>\u200b\u6ca1\u6709\u200b\u4efb\u4f55\u200b\u4e1c\u897f\u200b\u3002\u200b\u8fd9\u662f\u200bPython\u200b\u5305\u6240\u200b\u5fc5\u9700\u200b\u7684\u200b\u3002</p> </li> <li> <p><code>provider.py</code> \u200b\u8fd9\u200b\u5c06\u200b\u521b\u5efa\u200b\u5904\u7406\u200b\u63d0\u4f9b\u8005\u200b\u5e76\u200b\u516c\u5f00\u200b\u4f60\u200b\u7684\u200b\u7b97\u6cd5\u200b\u3002</p> </li> </ul> <pre><code>from qgis.core import QgsProcessingProvider\nfrom .example_processing_algorithm import ExampleProcessingAlgorithm\n\nclass Provider(QgsProcessingProvider):\n\n    def loadAlgorithms(self, *args, **kwargs):\n        self.addAlgorithm(ExampleProcessingAlgorithm())\n        # \u200b\u5728\u200b\u8fd9\u91cc\u200b\u6dfb\u52a0\u200b\u5176\u4ed6\u200b\u7b97\u6cd5\u200b\n        # self.addAlgorithm(MyOtherAlgorithm())\n\n    def id(self, *args, **kwargs):\n    \"\"\"\u200b\u63d2\u4ef6\u200b\u7684\u200bID\uff0c\u200b\u7528\u4e8e\u200b\u6807\u8bc6\u200b\u63d0\u4f9b\u8005\u200b\u3002\n\n    \u200b\u8be5\u200b\u5b57\u7b26\u4e32\u200b\u5e94\u8be5\u200b\u662f\u200b\u552f\u4e00\u200b\u7684\u200b\uff0c\u200b\u77ed\u200b\u7684\u200b\uff0c\u200b\u4ec5\u200b\u5b57\u7b26\u4e32\u200b\uff0c\u200b\u4f8b\u5982\u200b\u201cqgis\u201d\u200b\u6216\u200b\u201cgdal\u201d\u3002\u200b\u6b64\u200b\u5b57\u7b26\u4e32\u200b\u4e0d\u5e94\u200b\u88ab\u200b\u7ffb\u8bd1\u200b\uff08localised\uff09\u3002\n    \"\"\"\n    return 'yourplugin'\n\n    def name(self, *args, **kwargs):\n    \"\"\"\u200b\u63d2\u4ef6\u200b\u7684\u200b\u4eba\u6027\u5316\u200b\u540d\u79f0\u200b\u3002\n\n    \u200b\u8be5\u200b\u5b57\u7b26\u4e32\u200b\u5e94\u200b\u5c3d\u53ef\u80fd\u200b\u77ed\u200b\uff08\u200b\u4f8b\u5982\u200b\u201cLastools\u201d\uff0c\u200b\u800c\u200b\u4e0d\u662f\u200b\"Lastools version 1.0.1 64-bit\")\uff0c\u200b\u5e76\u4e14\u200b\u9700\u8981\u200b\u7ffb\u8bd1\u200b\uff08localised\uff09\u3002\n    \"\"\"\n    return self.tr('Your plugin')\n\n    def icon(self):\n    \"\"\"\u200b\u5e94\u8be5\u200b\u8fd4\u56de\u200b\u7528\u4e8e\u200b\u5904\u7406\u200b\u5de5\u5177\u7bb1\u200b\u4e2d\u200b\u63d0\u4f9b\u8005\u200b\u7684\u200bQIcon\u3002\n    \"\"\"\n    return QgsProcessingProvider.icon(self) \n</code></pre> <ul> <li><code>example_processing_algorithm.py</code>\uff0c\u200b\u5176\u4e2d\u200b\u5305\u542b\u200b\u793a\u4f8b\u200b\u7b97\u6cd5\u200b\u6587\u4ef6\u200b\u3002\u200b\u590d\u5236\u200b/\u200b\u7c98\u8d34\u200b\u6a21\u677f\u200b\u6587\u4ef6\u200b\u4e2d\u200b\u7684\u200b\u5185\u5bb9\u200b\uff0c\u200b\u5e76\u200b\u6839\u636e\u200b\u9700\u8981\u200b\u66f4\u65b0\u200b\u5b83\u200b\u3002</li> </ul> </li> <li> <p>\u200b\u73b0\u5728\u200b\uff0c\u200b\u4f60\u200b\u53ef\u4ee5\u200b\u5728\u200bQGIS\u200b\u4e2d\u200b\u91cd\u65b0\u200b\u52a0\u8f7d\u200b\u63d2\u4ef6\u200b\uff0c\u200b\u4f60\u200b\u5e94\u8be5\u200b\u53ef\u4ee5\u200b\u5728\u200b\u5904\u7406\u200b\u5de5\u5177\u7bb1\u200b\u548c\u200b\u6a21\u578b\u200b\u4e2d\u200b\u770b\u5230\u200b\u4f60\u200b\u7684\u200b\u793a\u4f8b\u200b\u811a\u672c\u200b\u3002</p> </li> </ol>"},{"location":"18-%E4%BD%BF%E7%94%A8%E6%8F%92%E4%BB%B6%E5%9B%BE%E5%B1%82/","title":"18-\u200b\u4f7f\u7528\u200b\u63d2\u4ef6\u200b\u56fe\u5c42","text":"<p>\u200b\u672c\u200b\u8282\u200b\u4ee3\u7801\u200b\u7247\u6bb5\u200b\u9700\u200b\u5bfc\u5165\u200b\u4ee5\u4e0b\u200b\u6a21\u5757\u200b\uff1a</p> <pre><code>from qgis.core import (\n    QgsPluginLayer,\n    QgsPluginLayerType,\n    QgsMapLayerRenderer,\n    QgsApplication,\n    QgsProject,\n)\n\nfrom qgis.PyQt.QtGui import QImage\n</code></pre>"},{"location":"18-%E4%BD%BF%E7%94%A8%E6%8F%92%E4%BB%B6%E5%9B%BE%E5%B1%82/#18","title":"18 \u200b\u4f7f\u7528\u200b\u63d2\u4ef6\u200b\u56fe\u5c42","text":"<p>\u200b\u5982\u679c\u200b\u4f60\u200b\u7684\u200b\u63d2\u4ef6\u200b\u4f7f\u7528\u200b\u81ea\u5df1\u200b\u7684\u200b\u65b9\u6cd5\u200b\u6e32\u67d3\u200b\u56fe\u5c42\u200b\uff0c\u200b\u57fa\u4e8e\u200b<code>QgsPluginLayer</code>\u200b\u7f16\u5199\u200b\u4f60\u200b\u81ea\u5df1\u200b\u7684\u200b\u56fe\u5c42\u200b\u7c7b\u578b\u200b\u662f\u200b\u6700\u200b\u6709\u6548\u200b\u7684\u200b\u65b9\u5f0f\u200b\u3002</p>"},{"location":"18-%E4%BD%BF%E7%94%A8%E6%8F%92%E4%BB%B6%E5%9B%BE%E5%B1%82/#181-qgspluginlayer","title":"18.1 \u200b\u5b50\u200b\u7c7b\u5316\u200bQgsPluginLayer","text":"<p>\u200b\u4e0b\u9762\u200b\u4f8b\u5b50\u200b\u662f\u200b<code>QgsPluginLayer</code>\u200b\u7684\u200b\u6700\u5c0f\u200b\u5b9e\u73b0\u200b\u3002\u200b\u5b83\u200b\u662f\u200b\u57fa\u4e8e\u200bWatermark example plugin\u200b\u7684\u200b\u539f\u7248\u200b\u5b9e\u73b0\u200b\u3002</p> <p>\u200b\u81ea\u5b9a\u4e49\u200b\u6e32\u67d3\u5668\u200b\u662f\u200b\u5b9e\u73b0\u200b\u753b\u5e03\u200b\u4e2d\u200b\u5b9e\u9645\u200b\u56fe\u5f62\u200b\u5de5\u5177\u200b\u7684\u200b\u4e00\u90e8\u5206\u200b\u3002</p> <pre><code>class WatermarkLayerRenderer(QgsMapLayerRenderer):\n\n    def __init__(self, layerId, rendererContext):\n        super().__init__(layerId, rendererContext)\n\n    def render(self):\n        image = QImage(\"/usr/share/icons/hicolor/128x128/apps/qgis.png\")\n        painter = self.renderContext().painter()\n        painter.save()\n        painter.drawImage(10, 10, image)\n        painter.restore()\n        return True\n\n\nclass WatermarkPluginLayer(QgsPluginLayer):\n    LAYER_TYPE = \"watermark\"\n\n    def __init__(self):\n        super().__init__(WatermarkPluginLayer.LAYER_TYPE, \"Watermark plugin layer\")\n        self.setValid(True)\n\n    def createMapRenderer(self, rendererContext):\n        return WatermarkLayerRenderer(self.id(), rendererContext)\n\n    def setTransformContext(self, ct):\n        pass\n\n    # \u200b\u53ef\u4ee5\u200b\u6dfb\u52a0\u200b\u8bfb\u5199\u200b\u9879\u76ee\u200b\u7279\u5b9a\u200b\u4fe1\u606f\u200b\u7684\u200b\u65b9\u6cd5\u200b\n\n    def readXml(self, node, context):\n        pass\n\n    def writeXml(self, node, doc, context):\n        pass\n</code></pre> <p>\u200b\u53ef\u4ee5\u200b\u5c06\u200b\u63d2\u4ef6\u200b\u56fe\u5c42\u200b\u6dfb\u52a0\u200b\u5230\u200b\u9879\u76ee\u200b\u4e2d\u200b\u5e76\u200b\u4f5c\u4e3a\u200b\u4efb\u4f55\u200b\u5176\u5b83\u200b\u56fe\u5c42\u200b\u6dfb\u52a0\u200b\u5230\u200b\u753b\u5e03\u200b\u4e2d\u200b\uff1a</p> <pre><code>plugin_layer = WatermarkPluginLayer()\nQgsProject.instance().addMapLayer(plugin_layer)\n</code></pre> <p>\u200b\u52a0\u8f7d\u200b\u5305\u542b\u200b\u6b64\u7c7b\u200b\u56fe\u5c42\u200b\u7684\u200b\u9879\u76ee\u200b\u65f6\u200b\uff0c\u200b\u9700\u8981\u200b\u5de5\u5382\u200b\u7c7b\u200b\uff1a</p> <pre><code>class WatermarkPluginLayerType(QgsPluginLayerType):\n\n    def __init__(self):\n        super().__init__(WatermarkPluginLayer.LAYER_TYPE)\n\n    def createLayer(self):\n        return WatermarkPluginLayer()\n\n    # \u200b\u4f60\u200b\u53ef\u4ee5\u200b\u6dfb\u52a0\u200bGUI\u200b\u4ee3\u7801\u200b\u6765\u81ea\u200b\u5b9a\u4e49\u200b\u663e\u793a\u200b\u56fe\u5c42\u200b\u7684\u200b\u5c5e\u6027\u200b\u4fe1\u606f\u200b\n    def showLayerProperties(self, layer):\n        pass\n\n\n# \u200b\u4fdd\u6301\u200b\u5f15\u7528\u200b\u8be5\u200b\u5b9e\u4f8b\u200b\uff0c\u200b\u9632\u6b62\u200b\u88ab\u200b\u5783\u573e\u200b\u56de\u6536\u200b\nplt = WatermarkPluginLayerType()\n\nassert QgsApplication.pluginLayerRegistry().addPluginLayerType(plt)\n</code></pre>"},{"location":"19-%E7%BD%91%E7%BB%9C%E5%88%86%E6%9E%90%E5%BA%93/","title":"19-\u200b\u7f51\u7edc\u5206\u6790\u200b\u5e93","text":"<p>\u200b\u672c\u200b\u8282\u200b\u4ee3\u7801\u200b\u7247\u6bb5\u200b\u9700\u200b\u5bfc\u5165\u200b\u4ee5\u4e0b\u200b\u6a21\u5757\u200b\uff1a</p> <pre><code>from qgis.core import (\n  QgsVectorLayer,\n  QgsPointXY,\n)\n</code></pre>"},{"location":"19-%E7%BD%91%E7%BB%9C%E5%88%86%E6%9E%90%E5%BA%93/#19","title":"19 \u200b\u7f51\u7edc\u5206\u6790\u200b\u5e93","text":"<p>\u200b\u7f51\u7edc\u5206\u6790\u200b\u5e93\u200b\u53ef\u200b\u7528\u4e8e\u200b\uff1a</p> <ul> <li>\u200b\u4ece\u200b\u5730\u7406\u200b\u6570\u636e\u200b\uff08\u200b\u77e2\u91cf\u200b\u7ebf\u200b\u6298\u7ebf\u56fe\u200b\u5c42\u200b\uff09\u200b\u521b\u5efa\u200b\u56fe\u200b</li> <li>\u200b\u5b9e\u73b0\u200b\u56fe\u8bba\u200b\u4e2d\u200b\u7684\u200b\u57fa\u672c\u200b\u7b97\u6cd5\u200b\uff08\u200b\u76ee\u524d\u200b\u53ea\u6709\u200bDijkstra\u200b\u7684\u200b\u7b97\u6cd5\u200b\uff09</li> </ul> <p>\u200b\u7f51\u7edc\u5206\u6790\u200b\u5e93\u662f\u200b\u901a\u8fc7\u200b\u4ece\u200b<code>RoadGraph</code>\u200b\u6838\u5fc3\u200b\u63d2\u4ef6\u200b\u5bfc\u51fa\u200b\u57fa\u672c\u200b\u51fd\u6570\u200b\u521b\u5efa\u200b\u7684\u200b\uff0c\u200b\u73b0\u5728\u200b\u4f60\u200b\u53ef\u4ee5\u200b\u5728\u200b\u63d2\u4ef6\u200b\u4e2d\u200b\u4f7f\u7528\u200b\u5b83\u200b\u7684\u200b\u65b9\u6cd5\u200b\uff0c\u200b\u4e5f\u200b\u53ef\u4ee5\u200b\u76f4\u63a5\u200b\u4ece\u200bPython\u200b\u63a7\u5236\u53f0\u200b\u4f7f\u7528\u200b\u5b83\u200b\u3002</p>"},{"location":"19-%E7%BD%91%E7%BB%9C%E5%88%86%E6%9E%90%E5%BA%93/#191","title":"19.1 \u200b\u4e00\u822c\u200b\u4fe1\u606f","text":"<p>\u200b\u7b80\u800c\u8a00\u4e4b\u200b\uff0c\u200b\u4e00\u4e2a\u200b\u5178\u578b\u200b\u7528\u4f8b\u200b\u53ef\u4ee5\u200b\u63cf\u8ff0\u200b\u4e3a\u200b\uff1a</p> <ul> <li>\u200b\u4ece\u200b\u5730\u7406\u200b\u6570\u636e\u200b\u521b\u5efa\u200b\u56fe\u200b\uff08\u200b\u77e2\u91cf\u200b\u6298\u7ebf\u56fe\u200b\u5c42\u200b\uff09</li> <li>\u200b\u8fd0\u884c\u56fe\u200b\u7b97\u6cd5\u200b</li> <li>\u200b\u4f7f\u7528\u200b\u5206\u6790\u200b\u7ed3\u679c\u200b</li> </ul>"},{"location":"19-%E7%BD%91%E7%BB%9C%E5%88%86%E6%9E%90%E5%BA%93/#192","title":"19.2 \u200b\u6784\u5efa\u200b\u4e00\u4e2a\u200b\u56fe","text":"<p>\u200b\u4f60\u200b\u9700\u8981\u200b\u505a\u200b\u7684\u200b\u7b2c\u4e00\u4ef6\u200b\u4e8b\u662f\u200b\u51c6\u5907\u200b\u8f93\u5165\u200b\u6570\u636e\u200b\uff0c\u200b\u4e5f\u200b\u5c31\u662f\u200b\u5c06\u200b\u77e2\u91cf\u56fe\u200b\u5c42\u200b\u8f6c\u6362\u200b\u4e3a\u200b\u56fe\u200b\u3002\u200b\u6240\u6709\u200b\u8fdb\u4e00\u6b65\u200b\u7684\u200b\u64cd\u4f5c\u200b\u90fd\u200b\u5c06\u200b\u4f7f\u7528\u200b\u8fd9\u4e2a\u200b\u56fe\u200b\uff0c\u200b\u800c\u200b\u4e0d\u662f\u200b\u56fe\u5c42\u200b\u3002</p> <p>\u200b\u4f5c\u4e3a\u200b\u6570\u636e\u6e90\u200b\uff0c\u200b\u6211\u4eec\u200b\u53ef\u4ee5\u200b\u4f7f\u7528\u200b\u4efb\u4f55\u200b\u6298\u7ebf\u200b\u77e2\u91cf\u56fe\u200b\u5c42\u200b\u3002\u200b\u6298\u7ebf\u200b\u7684\u200b\u8282\u70b9\u200b\u6210\u4e3a\u200b\u56fe\u200b\u7684\u200b\u9876\u70b9\u200b\uff0c\u200b\u6298\u7ebf\u200b\u7684\u200b\u7ebf\u6bb5\u200b\u6210\u4e3a\u200b\u56fe\u200b\u7684\u200b\u8fb9\u200b\u3002\u200b\u5982\u679c\u200b\u51e0\u4e2a\u200b\u8282\u70b9\u200b\u5177\u6709\u200b\u76f8\u540c\u200b\u7684\u200b\u5750\u6807\u200b\uff0c\u200b\u90a3\u4e48\u200b\u5b83\u4eec\u200b\u5c31\u662f\u200b\u76f8\u540c\u200b\u7684\u200b\u56fe\u200b\u9876\u70b9\u200b\u3002\u200b\u56e0\u6b64\u200b\uff0c\u200b\u5177\u6709\u200b\u516c\u5171\u200b\u8282\u70b9\u200b\u7684\u200b\u4e24\u6761\u7ebf\u200b\u5c31\u200b\u4f1a\u200b\u76f8\u4e92\u8fde\u63a5\u200b\u3002</p> <p>\u200b\u6b64\u5916\u200b\uff0c\u200b\u5728\u200b\u56fe\u200b\u521b\u5efa\u200b\u8fc7\u7a0b\u200b\u4e2d\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u5c06\u200b\u4efb\u610f\u200b\u6570\u91cf\u200b\u7684\u200b\u9644\u52a0\u200b\u70b9\u200b\u201c\u200b\u56fa\u5b9a\u200b\u201d\uff08\u201c\u200b\u7ed1\u200b\u201d\uff09\u200b\u5230\u200b\u8f93\u5165\u200b\u77e2\u91cf\u56fe\u200b\u5c42\u200b\u3002\u200b\u5bf9\u4e8e\u200b\u6bcf\u4e2a\u200b\u9644\u52a0\u200b\u70b9\u200b\uff0c\u200b\u5c06\u200b\u627e\u5230\u200b\u4e00\u4e2a\u200b\u5339\u914d\u200b\u2014\u2014\u200b\u6700\u8fd1\u200b\u7684\u200b\u9876\u70b9\u200b\u6216\u200b\u6700\u8fd1\u200b\u7684\u200b\u8fb9\u200b\u3002\u200b\u5728\u200b\u540e\u200b\u4e00\u79cd\u200b\u60c5\u51b5\u200b\u4e0b\u200b\uff0c\u200b\u8fb9\u200b\u5c06\u200b\u88ab\u200b\u5206\u5272\u200b\u5e76\u200b\u6dfb\u52a0\u200b\u4e00\u4e2a\u200b\u65b0\u200b\u9876\u70b9\u200b\u3002</p> <p>\u200b\u77e2\u91cf\u56fe\u200b\u5c42\u200b\u5c5e\u6027\u200b\u548c\u200b\u8fb9\u200b\u7684\u200b\u957f\u5ea6\u200b\u53ef\u4ee5\u200b\u7528\u4f5c\u200b\u8fb9\u200b\u7684\u200b\u5c5e\u6027\u200b\u3002</p> <p>\u200b\u4f7f\u7528\u200bBuilder\u200b\u7f16\u7a0b\u200b\u6a21\u5f0f\u200b\u5b8c\u6210\u200b\u4ece\u200b\u77e2\u91cf\u56fe\u200b\u5c42\u5230\u200b\u56fe\u200b\u7684\u200b\u8f6c\u6362\u200b\u3002\u200b\u56fe\u662f\u200b\u4f7f\u7528\u200b\u6240\u8c13\u200b\u7684\u200b\u63a7\u5236\u5668\u200b\u6784\u9020\u200b\u7684\u200b\u3002\u200b\u76ee\u524d\u200b\u53ea\u6709\u200b\u4e00\u4e2a\u200b\u63a7\u5236\u5668\u200b\uff1a<code>QgsVectorLayerDirector</code>\u3002\u200b\u63a7\u5236\u5668\u200b\u8bbe\u7f6e\u200b\u4e86\u200b\u57fa\u672c\u200b\u7684\u200b\u8bbe\u7f6e\u200b\u2014\u2014\u200b\u8fd9\u4e9b\u200b\u8bbe\u7f6e\u200b\u5c06\u200b\u7528\u4e8e\u200b\u4ece\u7ebf\u200b\u77e2\u91cf\u56fe\u200b\u5c42\u200b\u6784\u9020\u200b\u56fe\u200b\uff0c\u200b\u6784\u5efa\u200b\u5668\u200b\u7528\u6765\u200b\u521b\u5efa\u200b\u56fe\u200b\u3002\u200b\u76ee\u524d\u200b\uff0c\u200b\u63a7\u5236\u5668\u200b\u4e00\u6837\u200b\uff0c\u200b\u53ea\u6709\u200b\u4e00\u4e2a\u200b\u6784\u5efa\u200b\u5668\u200b\u5b58\u5728\u200b\uff1a<code>QgsGraphBuilder</code>\uff0c\u200b\u5b83\u200b\u53ef\u4ee5\u200b\u521b\u5efa\u200b<code>QgsGraph</code>\u200b\u5bf9\u8c61\u200b\u3002\u200b\u4f60\u200b\u53ef\u80fd\u200b\u5e0c\u671b\u200b\u5b9e\u73b0\u200b\u81ea\u5df1\u200b\u7684\u200b\u6784\u5efa\u200b\u5668\u200b\uff0c\u200b\u4ee5\u200b\u5efa\u7acb\u200b\u4e00\u4e2a\u200b\u4e0e\u200bBGL\u200b\u6216\u200bNetworkX\u200b\u7b49\u5e93\u200b\u517c\u5bb9\u200b\u7684\u200b\u56fe\u200b\u3002</p> <p>\u200b\u4e3a\u4e86\u200b\u8ba1\u7b97\u200b\u8fb9\u200b\u5c5e\u6027\u200b\uff0c\u200b\u4f7f\u7528\u200b\u7f16\u7a0b\u200b\u6a21\u5f0f\u200b\u7b56\u7565\u200b\u3002\u200b\u76ee\u524d\u200b\u53ea\u6709\u200b<code>QGSNetworkDistanceTreatgy</code>\u200b\u7b56\u7565\u200b\uff08\u200b\u8003\u8651\u200b\u5230\u200b\u8def\u7ebf\u200b\u7684\u200b\u957f\u5ea6\u200b\uff09\u200b\u548c\u200b<code>QgsNetworkSpeedStrategy</code>\uff08\u200b\u4e5f\u200b\u8003\u8651\u200b\u5230\u200b\u901f\u5ea6\u200b\uff09\u200b\u53ef\u7528\u200b\u3002\u200b\u4f60\u200b\u53ef\u4ee5\u200b\u5b9e\u73b0\u200b\u81ea\u5df1\u200b\u7684\u200b\u7b56\u7565\u200b\uff0c\u200b\u4f7f\u7528\u200b\u6240\u6709\u200b\u5fc5\u8981\u200b\u7684\u200b\u53c2\u6570\u200b\u3002\u200b\u4f8b\u5982\u200b\uff0cRoadGraph\u200b\u63d2\u4ef6\u200b\u4f7f\u7528\u200b\u7684\u200b\u7b56\u7565\u200b\u662f\u200b\u4f7f\u7528\u200b\u8fb9\u200b\u957f\u5ea6\u200b\u548c\u200b\u5c5e\u6027\u200b\u4e2d\u200b\u7684\u200b\u901f\u5ea6\u200b\u503c\u6765\u200b\u8ba1\u7b97\u200b\u884c\u7a0b\u200b\u65f6\u95f4\u200b\u3002</p> <p>\u200b\u662f\u200b\u65f6\u5019\u200b\u6df1\u5165\u7814\u7a76\u200b\u8fd9\u4e2a\u200b\u8fc7\u7a0b\u200b\u4e86\u200b\u3002</p> <p>\u200b\u9996\u5148\u200b\uff0c\u200b\u8981\u200b\u4f7f\u7528\u200b\u8fd9\u4e2a\u200b\u5e93\u200b\uff0c\u200b\u6211\u4eec\u200b\u5e94\u8be5\u200b\u5bfc\u5165\u200b\u5206\u6790\u200b\u6a21\u5757\u200b</p> <pre><code>from qgis.analysis import *\n</code></pre> <p>\u200b\u7136\u540e\u200b\u662f\u200b\u4e00\u4e9b\u200b\u521b\u5efa\u200b\u63a7\u5236\u5668\u200b\u7684\u200b\u793a\u4f8b\u200b\uff1a</p> <pre><code># \u200b\u4e0d\u8981\u200b\u4f7f\u7528\u200b\u56fe\u5c42\u200b\u5c5e\u6027\u200b\u4e2d\u200b\u6709\u5173\u200b\u9053\u8def\u200b\u65b9\u5411\u200b\u7684\u200b\u4fe1\u606f\u200b\uff0c\u200b\u6240\u6709\u200b\u9053\u8def\u200b\u90fd\u200b\u662f\u200b\u53cc\u5411\u200b\u7684\u200b\ndirector = QgsVectorLayerDirector(vectorLayer, -1, '', '', '', QgsVectorLayerDirector.DirectionBoth)\n\n# \u200b\u4f7f\u7528\u200b\u7b2c\u200b5\u200b\u4e2a\u200b\u5b57\u200b\u6bb5\u200b\u4f5c\u4e3a\u200b\u9053\u8def\u200b\u7684\u200b\u65b9\u5411\u200b\u4fe1\u606f\u200b.\n# \u200b\u6b63\u5411\u200b\u5355\u200b\u65b9\u5411\u200b\u9053\u8def\u200b\u4f7f\u7528\u200b \"yes\",\n# \u200b\u53cd\u5411\u200b\u5355\u200b\u65b9\u5411\u200b\u9053\u8def\u200b\u4f7f\u7528\u200b \"1\"\n# \u200b\u56e0\u6b64\u200b\uff0c\u200b\u53cc\u5411\u200b\u9053\u8def\u200b\u4f7f\u7528\u200b \u201cno\u201d\u3002\u200b\u9ed8\u8ba4\u200b\u60c5\u51b5\u200b\u9053\u8def\u200b\u662f\u200b\u53cc\u5411\u200b\u8def\u200b\u3002\n# \u200b\u6b64\u200b\u65b9\u6848\u200b\u53ef\u200b\u7528\u4e8e\u200bOpenStreetMap\u200b\u6570\u636e\u200b\ndirector = QgsVectorLayerDirector(vectorLayer, 5, 'yes', '1', 'no', QgsVectorLayerDirector.DirectionBoth)\n</code></pre> <p>\u200b\u4e3a\u4e86\u200b\u6784\u9020\u200b\u4e00\u4e2a\u200b\u63a7\u5236\u5668\u200b\uff0c\u200b\u6211\u4eec\u200b\u5e94\u8be5\u200b\u4f20\u9012\u200b\u4e00\u4e2a\u200b\u77e2\u91cf\u56fe\u200b\u5c42\u200b\uff0c\u200b\u8be5\u200b\u77e2\u91cf\u56fe\u200b\u5c42\u200b\u4f5c\u4e3a\u200b\u56fe\u200b\u7ed3\u6784\u200b\u7684\u200b\u6e90\u200b\uff0c\u200b\u4ee5\u53ca\u200b\u5173\u4e8e\u200b\u6bcf\u4e2a\u200b\u8def\u6bb5\u200b\u4e0a\u200b\u5141\u8bb8\u200b\u79fb\u52a8\u200b\u7684\u200b\u4fe1\u606f\u200b\uff08\u200b\u5355\u5411\u200b\u6216\u200b\u53cc\u5411\u200b\u79fb\u52a8\u200b\u3001\u200b\u76f4\u63a5\u200b\u6216\u200b\u53cd\u5411\u200b\uff09\uff0c\u200b\u50cf\u200b\u8fd9\u6837\u200b\uff1a</p> <pre><code>director = QgsVectorLayerDirector(vectorLayer,\n                                  directionFieldId,\n                                  directDirectionValue,\n                                  reverseDirectionValue,\n                                  bothDirectionValue,\n                                  defaultDirection)\n</code></pre> <p>\u200b\u4ee5\u4e0b\u200b\u662f\u200b\u8fd9\u4e9b\u200b\u53c2\u6570\u200b\u7684\u200b\u5168\u90e8\u200b\u542b\u4e49\u200b\uff1a</p> <ul> <li><code>vectorLayer</code>\u2014\u2014\u200b\u7528\u4e8e\u200b\u6784\u5efa\u200b\u56fe\u200b\u7684\u200b\u77e2\u91cf\u56fe\u200b\u5c42\u200b</li> <li><code>directionFieldId</code>\u2014\u2014\u200b\u5b57\u6bb5\u200b\u7684\u200b\u7d22\u5f15\u200b\u503c\u200b\uff0c\u200b\u7528\u4e8e\u200b\u5b58\u50a8\u200b\u9053\u8def\u200b\u65b9\u5411\u200b\u7684\u200b\u4fe1\u606f\u200b\u3002\u200b\u5982\u679c\u200b\u662f\u200b<code>-1</code>\uff0c\u200b\u8868\u793a\u200b\u4e0d\u200b\u4f7f\u7528\u200b\u8fd9\u4e9b\u200b\u4fe1\u606f\u200b\u3002\u200b\u6574\u578b\u200b\u3002</li> <li><code>directDirectionValue</code>\u2014\u2014\u200b\u6b63\u5411\u200b\u7684\u200b\u5b57\u200b\u6bb5\u503c\u200b\uff08\u200b\u4ece\u200b\u7b2c\u4e00\u4e2a\u200b\u76f4\u7ebf\u200b\u70b9\u200b\u79fb\u52a8\u200b\u5230\u200b\u6700\u540e\u200b\u4e00\u4e2a\u200b\u76f4\u7ebf\u200b\u70b9\u200b\uff09\u3002\u200b\u5b57\u7b26\u4e32\u200b\u3002</li> <li><code>reverseDirectionValue</code>\u2014\u2014\u200b\u53cd\u5411\u200b\u9053\u8def\u200b\u7684\u200b\u5b57\u200b\u6bb5\u503c\u200b\uff08\u200b\u4ece\u200b\u6700\u540e\u200b\u4e00\u4e2a\u200b\u76f4\u7ebf\u200b\u70b9\u200b\u79fb\u52a8\u200b\u5230\u200b\u7b2c\u4e00\u4e2a\u200b\u76f4\u7ebf\u200b\u70b9\u200b\uff09\u3002\u200b\u5b57\u7b26\u4e32\u200b\u3002</li> <li><code>bothDirectionValue</code>\u2014\u2014\u200b\u53cc\u5411\u200b\u9053\u8def\u200b\u7684\u200b\u5b57\u200b\u6bb5\u503c\u200b\uff08\u200b\u5bf9\u4e8e\u200b\u8fd9\u6837\u200b\u7684\u200b\u9053\u8def\u200b\uff0c\u200b\u6211\u4eec\u200b\u53ef\u4ee5\u200b\u4ece\u200b\u7b2c\u4e00\u70b9\u200b\u79fb\u52a8\u200b\u5230\u200b\u6700\u540e\u200b\u4e00\u70b9\u200b\uff0c\u200b\u4e5f\u200b\u53ef\u4ee5\u200b\u4ece\u200b\u6700\u540e\u200b\u4e00\u70b9\u200b\u79fb\u52a8\u200b\u5230\u200b\u7b2c\u4e00\u70b9\u200b\uff09\u3002\u200b\u5b57\u7b26\u4e32\u200b\u3002</li> <li><code>defaultDirectio</code>\u2014\u2014\u200b\u9ed8\u8ba4\u200b\u9053\u8def\u200b\u65b9\u5411\u200b\u3002\u200b\u8be5\u503c\u200b\u5c06\u200b\u7528\u4e8e\u200b\u8fd9\u4e9b\u200b\u9053\u8def\u200b\u5f53\u5b57\u6bb5\u200b<code>directionFieldId</code>\u200b\u672a\u200b\u8bbe\u7f6e\u200b\u65f6\u200b\u6216\u200b\u5177\u6709\u200b\u4e0e\u200b\u4e0a\u9762\u200b\u6307\u5b9a\u200b\u7684\u200b\u4e09\u4e2a\u200b\u503c\u4e2d\u200b\u7684\u200b\u4efb\u4f55\u200b\u4e00\u4e2a\u200b\u4e0d\u540c\u200b\u7684\u200b\u503c\u200b\u3002\u200b\u53ef\u7528\u200b\u7684\u200b\u503c\u200b\u662f\u200b\uff1a</li> <li><code>QgsVectorLayerDirector.DirectionForward</code>\u2014\u2014\u200b\u6b63\u5411\u200b\u5355\u5411\u200b\u9053\u8def\u200b</li> <li><code>QgsVectorLayerDirector.DirectionBackward</code>\u2014\u2014\u200b\u53cd\u5411\u200b\u5355\u5411\u200b\u9053\u8def\u200b</li> <li><code>QgsVectorLayerDirector.DirectionBoth</code>\u200b\u53cc\u5411\u200b\u9053\u8def\u200b</li> </ul> <p>\u200b\u7136\u540e\u200b\u6709\u200b\u5fc5\u8981\u200b\u521b\u5efa\u200b\u7528\u4e8e\u200b\u8ba1\u7b97\u200b\u8fb9\u200b\u5c5e\u6027\u200b\u7684\u200b\u7b56\u7565\u200b\uff1a</p> <pre><code># \u200b\u5305\u542b\u200b\u901f\u5ea6\u200b\u4fe1\u606f\u200b\u7684\u200b\u5b57\u200b\u6bb5\u200b\u7d22\u5f15\u200b\u503c\u200b\nattributeId = 1\n# \u200b\u9ed8\u8ba4\u200b\u901f\u5ea6\u200b\ndefaultValue = 50\n# \u200b\u8f6c\u5316\u200b\u901f\u5ea6\u200b\u5230\u200b\u7c73\u5236\u200b\u5355\u4f4d\u200b ('1' \u200b\u8868\u793a\u200b\u4e0d\u200b\u8f6c\u5316\u200b)\ntoMetricFactor = 1\nstrategy = QgsNetworkSpeedStrategy(attributeId, defaultValue, toMetricFactor)\n</code></pre> <p>\u200b\u544a\u8bc9\u200b\u63a7\u5236\u5668\u200b\u8fd9\u4e2a\u200b\u7b56\u7565\u200b</p> <pre><code>director = QgsVectorLayerDirector(vectorLayer, -1, '', '', '', 3)\ndirector.addStrategy(strategy)\n</code></pre> <p>\u200b\u73b0\u5728\u200b\u6211\u4eec\u200b\u53ef\u4ee5\u200b\u4f7f\u7528\u200b\u6784\u9020\u200b\u5668\u6765\u200b\u521b\u5efa\u200b\u56fe\u200b\u3002<code>QgsGraphBuilder</code>\u200b\u7c7b\u200b\u6784\u9020\u51fd\u6570\u200b\u63a5\u53d7\u200b\u51e0\u4e2a\u200b\u53c2\u6570\u200b\uff1a</p> <ul> <li><code>crs</code>\u2014\u2014\u200b\u5750\u6807\u200b\u53c2\u8003\u200b\u7cfb\u7edf\u200b\u3002\u200b\u5fc5\u9700\u200b\u3002</li> <li><code>otfEnabled</code>\u2014\u2014\u200b\u4f7f\u7528\u200b\u201con the fly\u201d \u200b\u91cd\u200b\u6295\u5f71\u200b. \u200b\u9ed8\u8ba4\u200b\u4e3a\u200b<code>True</code> (use OTF).</li> <li><code>topologyTolerance</code>\u2014\u2014\u200b\u62d3\u6251\u200b\u5bb9\u5dee\u200b\u3002\u200b\u9ed8\u8ba4\u200b\u4e3a\u200b0\u3002</li> <li><code>ellipsoidID</code>\u2014\u2014\u200b\u53c2\u8003\u200b\u692d\u7403\u200b\u3002\u200b\u9ed8\u8ba4\u200b\u4e3a\u200b\u201cWGS84\u201d\u3002</li> </ul> <pre><code># \u200b\u53ea\u200b\u8bbe\u7f6e\u200bCRS,\uff0c\u200b\u5176\u5b83\u200b\u503c\u200b\u9ed8\u8ba4\u200b\nbuilder = QgsGraphBuilder(vectorLayer.crs())\n</code></pre> <p>\u200b\u6211\u4eec\u200b\u8fd8\u200b\u53ef\u4ee5\u200b\u5b9a\u4e49\u200b\u51e0\u4e2a\u200b\u70b9\u200b\uff0c\u200b\u8fd9\u4e9b\u200b\u70b9\u5c06\u200b\u7528\u4e8e\u200b\u5206\u6790\u200b\u3002\u200b\u4f8b\u5982\u200b\uff1a</p> <pre><code>startPoint = QgsPointXY(1179720.1871, 5419067.3507)\nendPoint = QgsPointXY(1180616.0205, 5419745.7839)\n</code></pre> <p>\u200b\u73b0\u5728\u200b\u4e00\u5207\u200b\u5c31\u7eea\u200b\uff0c\u200b\u6211\u4eec\u200b\u53ef\u4ee5\u200b\u6784\u5efa\u200b\u56fe\u8868\u200b\u5e76\u200b\u5c06\u200b\u8fd9\u4e9b\u200b\u70b9\u200b\u201c\u200b\u8fde\u63a5\u200b\u201d\u200b\u5230\u200b\u5b83\u200b</p> <pre><code>tiedPoints = director.makeGraph(builder, [startPoint, endPoint])\n</code></pre> <p>\u200b\u6784\u5efa\u200b\u56fe\u200b\u53ef\u80fd\u200b\u9700\u8981\u200b\u4e00\u4e9b\u200b\u65f6\u95f4\u200b\uff08\u200b\u8fd9\u200b\u53d6\u51b3\u4e8e\u200b\u56fe\u5c42\u200b\u4e2d\u200b\u7684\u200b\u8981\u7d20\u200b\u6570\u91cf\u200b\u548c\u200b\u56fe\u5c42\u200b\u5927\u5c0f\u200b\uff09\u3002<code>tiedPoints</code>\u200b\u662f\u200b\u4e00\u4e2a\u200b\u5305\u542b\u200b\u201c\u200b\u7ed1\u5b9a\u200b\u201d\u200b\u70b9\u200b\u5750\u6807\u200b\u7684\u200b\u5217\u8868\u200b\u3002\u200b\u5f53\u200b\u6784\u5efa\u200b\u64cd\u4f5c\u200b\u5b8c\u6210\u200b\u65f6\u200b\uff0c\u200b\u6211\u4eec\u200b\u53ef\u4ee5\u200b\u5f97\u5230\u200b\u56fe\u200b\u5e76\u200b\u5c06\u200b\u5176\u200b\u7528\u4e8e\u200b\u5206\u6790\u200b</p> <pre><code>graph = builder.graph()\n</code></pre> <p>\u200b\u901a\u8fc7\u200b\u4e0b\u9762\u200b\u7684\u200b\u4ee3\u7801\u200b\uff0c\u200b\u6211\u4eec\u200b\u53ef\u4ee5\u200b\u5f97\u5230\u200b\u70b9\u200b\u7684\u200b\u9876\u70b9\u200b\u7d22\u5f15\u200b</p> <pre><code>startId = graph.findVertex(tiedPoints[0])\nendId = graph.findVertex(tiedPoints[1])\n</code></pre>"},{"location":"19-%E7%BD%91%E7%BB%9C%E5%88%86%E6%9E%90%E5%BA%93/#193","title":"19.3 \u200b\u56fe\u200b\u5206\u6790","text":"<p>\u200b\u7f51\u7edc\u5206\u6790\u200b\u7528\u4e8e\u200b\u627e\u5230\u200b\u4e24\u4e2a\u200b\u95ee\u9898\u200b\u7684\u200b\u7b54\u6848\u200b\uff1a\u200b\u54ea\u4e9b\u200b\u9876\u70b9\u200b\u662f\u200b\u76f8\u8fde\u200b\u7684\u200b\uff0c\u200b\u4ee5\u53ca\u200b\u5982\u4f55\u200b\u627e\u5230\u200b\u6700\u77ed\u200b\u8def\u5f84\u200b\u3002\u200b\u4e3a\u4e86\u200b\u89e3\u51b3\u200b\u8fd9\u4e9b\u200b\u95ee\u9898\u200b\uff0c\u200b\u7f51\u7edc\u5206\u6790\u200b\u5e93\u200b\u63d0\u4f9b\u200b\u4e86\u200bDijkstra\u200b\u7b97\u6cd5\u200b\u3002</p> <p>Dijkstra\u200b\u7b97\u6cd5\u200b\u627e\u5230\u200b\u4ece\u56fe\u200b\u7684\u200b\u4e00\u4e2a\u200b\u9876\u70b9\u200b\u5230\u200b\u6240\u6709\u200b\u5176\u4ed6\u200b\u9876\u70b9\u200b\u7684\u200b\u6700\u200b\u77ed\u200b\u8def\u5f84\u200b\u4ee5\u53ca\u200b\u4f18\u5316\u200b\u53c2\u6570\u200b\u7684\u200b\u503c\u200b\u3002\u200b\u7ed3\u679c\u200b\u53ef\u4ee5\u200b\u8868\u793a\u200b\u4e3a\u200b\u6700\u200b\u77ed\u200b\u8def\u5f84\u200b\u6811\u200b\u3002</p> <p>\u200b\u6700\u77ed\u200b\u8def\u5f84\u200b\u6811\u662f\u200b\u4e00\u4e2a\u200b\u6709\u200b\u5411\u200b\u52a0\u6743\u200b\u56fe\u200b\uff08\u200b\u6216\u200b\u66f4\u200b\u51c6\u786e\u200b\u5730\u200b\u8bf4\u200b\u662f\u200b\u4e00\u68f5\u6811\u200b\uff09\uff0c\u200b\u5177\u6709\u200b\u4ee5\u4e0b\u200b\u7279\u6027\u200b\uff1a</p> <ul> <li>\u200b\u53ea\u6709\u200b\u4e00\u4e2a\u200b\u9876\u70b9\u200b\u6ca1\u6709\u200b\u5165\u5c04\u200b\u8fb9\u200b\u2014\u2014\u200b\u6811\u200b\u7684\u200b\u6839\u200b </li> <li>\u200b\u6240\u6709\u200b\u5176\u4ed6\u200b\u9876\u70b9\u200b\u53ea\u6709\u200b\u4e00\u6761\u200b\u5165\u5c04\u200b\u8fb9\u200b </li> <li>\u200b\u5982\u679c\u200b\u9876\u70b9\u200bB\u200b\u53ef\u4ee5\u200b\u4ece\u200b\u9876\u70b9\u200bA\u200b\u5230\u8fbe\u200b\uff0c\u200b\u90a3\u4e48\u200b\u4ece\u200bA\u200b\u5230\u200bB\u200b\u7684\u200b\u8def\u5f84\u200b\u662f\u200b\u552f\u4e00\u200b\u53ef\u7528\u200b\u7684\u200b\u8def\u5f84\u200b\uff0c\u200b\u5e76\u4e14\u200b\u5b83\u200b\u5728\u200b\u8be5\u200b\u56fe\u200b\u4e0a\u200b\u662f\u200b\u6700\u4f18\u200b\u7684\u200b\uff08\u200b\u6700\u77ed\u200b\u7684\u200b\uff09\u200b\u8def\u5f84\u200b</li> </ul> <p>\u200b\u8981\u200b\u83b7\u5f97\u200b\u6700\u77ed\u200b\u8def\u5f84\u200b\u6811\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u4f7f\u7528\u200b<code>QgsGraphAnalyzer</code>\u200b\u7c7b\u200b\u7684\u200b<code>shortestTree()</code> \u200b\u548c\u200b<code>dijkstra()</code>\u200b\u65b9\u6cd5\u200b\u3002\u200b\u5efa\u8bae\u200b\u4f7f\u7528\u200b<code>dijkstra()</code>\u200b\u65b9\u6cd5\u200b\uff0c\u200b\u56e0\u4e3a\u200b\u5b83\u200b\u66f4\u200b\u5feb\u200b\uff0c\u200b\u800c\u4e14\u200b\u66f4\u200b\u6709\u6548\u200b\u5730\u200b\u4f7f\u7528\u200b\u5185\u5b58\u200b\u3002</p> <p><code>shortestTree()</code>\u200b\u65b9\u6cd5\u200b\u5728\u200b\u4f60\u200b\u60f3\u200b\u5728\u200b\u6700\u200b\u77ed\u200b\u8def\u5f84\u200b\u6811\u4e0a\u200b\u884c\u8d70\u200b\u65f6\u200b\u5f88\u200b\u6709\u7528\u200b\u3002\u200b\u5b83\u200b\u603b\u662f\u200b\u521b\u5efa\u200b\u4e00\u4e2a\u200b\u65b0\u200b\u7684\u200b\u56fe\u200b\u5bf9\u8c61\u200b\uff08QgsGraph\uff09\u200b\u5e76\u200b\u63a5\u53d7\u200b\u4e09\u4e2a\u200b\u53d8\u91cf\u200b\uff1a</p> <ul> <li><code>source</code>\u2014\u2014\u200b\u8f93\u5165\u200b\u7684\u200b\u56fe\u200b</li> <li><code>startVertexIdx</code>\u2014\u2014\u200b\u6811\u4e0a\u200b\u7684\u200b\u70b9\u200b\u7684\u200b\u7d22\u5f15\u200b\uff08\u200b\u6811\u200b\u7684\u200b\u6839\u200b\uff09</li> <li><code>criterionNum</code>\u2014\u2014\u200b\u4f7f\u7528\u200b\u7684\u200b\u8fb9\u200b\u5c5e\u6027\u200b\u7684\u200b\u6570\u91cf\u200b\uff08\u200b\u4ece\u200b0\u200b\u5f00\u59cb\u200b\uff09</li> </ul> <pre><code>tree = QgsGraphAnalyzer.shortestTree(graph, startId, 0)\n</code></pre> <p><code>dijkstra()</code>\u200b\u65b9\u6cd5\u200b\u6709\u200b\u76f8\u540c\u200b\u7684\u200b\u53c2\u6570\u200b\uff0c\u200b\u4f46\u200b\u8fd4\u56de\u200b\u4e24\u4e2a\u200b\u6570\u7ec4\u200b\u3002\u200b\u5728\u200b\u7b2c\u4e00\u4e2a\u200b\u6570\u7ec4\u200b\u4e2d\u200b\uff0cn\u200b\u5143\u7d20\u200b\u5305\u542b\u200b\u4f20\u5165\u200b\u8fb9\u200b\u7684\u200b\u7d22\u5f15\u200b\uff0c\u200b\u5982\u679c\u200b\u6ca1\u6709\u200b\u4f20\u5165\u200b\u8fb9\u5219\u200b\u4e3a\u200b-1\u3002\u200b\u5728\u200b\u7b2c\u4e8c\u4e2a\u200b\u6570\u7ec4\u200b\u4e2d\u200b\uff0cn\u200b\u5143\u7d20\u200b\u5305\u542b\u200b\u4ece\u6811\u200b\u7684\u200b\u6839\u5230\u200b\u9876\u70b9\u200bn\u200b\u7684\u200b\u8ddd\u79bb\u200b\uff0c\u200b\u5982\u679c\u200b\u9876\u70b9\u200bn\u200b\u4ece\u200b\u6839\u90e8\u200b\u65e0\u6cd5\u200b\u5230\u8fbe\u200b\uff0c\u200b\u5219\u200b\u4e3a\u200bDOUBLE_MAX\u3002</p> <pre><code>(tree, cost) = QgsGraphAnalyzer.dijkstra(graph, startId, 0)\n</code></pre> <p>\u200b\u4e0b\u9762\u200b\u662f\u200b\u4e00\u4e9b\u200b\u975e\u5e38\u7b80\u5355\u200b\u7684\u200b\u4ee3\u7801\u200b\uff0c\u200b\u4f7f\u7528\u200b<code>shortestTree()</code>\u200b\u65b9\u6cd5\u200b\u521b\u5efa\u200b\u7684\u200b\u56fe\u200b\u663e\u793a\u200b\u6700\u77ed\u200b\u8def\u5f84\u200b\u6811\u200b\uff08\u200b\u5728\u200b<code>Layers</code>\u200b\u9762\u677f\u200b\u4e2d\u200b\u9009\u62e9\u200b<code>linestring</code>\u200b\u56fe\u5c42\u200b\uff0c\u200b\u7528\u200b\u4f60\u200b\u81ea\u5df1\u200b\u7684\u200b\u5750\u6807\u200b\u66ff\u6362\u200b\uff09\u3002</p> <p>\u200b\u8b66\u544a\u200b</p> <p>\u200b\u8fd9\u200b\u6bb5\u200b\u4ee3\u7801\u200b\u4ec5\u200b\u4f5c\u4e3a\u200b\u4e00\u4e2a\u200b\u4f8b\u5b50\u200b\uff0c\u200b\u5b83\u200b\u521b\u5efa\u200b\u4e86\u200b\u5927\u91cf\u200b\u7684\u200b<code>QgsRubberBand</code>\u200b\u5bf9\u8c61\u200b\uff0c\u200b\u5728\u200b\u5927\u200b\u6570\u636e\u200b\u96c6\u4e0a\u200b\u53ef\u80fd\u200b\u4f1a\u200b\u5f88\u6162\u200b\u3002</p> <pre><code>from qgis.core import *\nfrom qgis.gui import *\nfrom qgis.analysis import *\nfrom qgis.PyQt.QtCore import *\nfrom qgis.PyQt.QtGui import *\n\nvectorLayer = QgsVectorLayer('testdata/network.gpkg|layername=network_lines', 'lines')\ndirector = QgsVectorLayerDirector(vectorLayer, -1, '', '', '', QgsVectorLayerDirector.DirectionBoth)\nstrategy = QgsNetworkDistanceStrategy()\ndirector.addStrategy(strategy)\nbuilder = QgsGraphBuilder(vectorLayer.crs())\n\npStart = QgsPointXY(1179661.925139,5419188.074362)\ntiedPoint = director.makeGraph(builder, [pStart])\npStart = tiedPoint[0]\n\ngraph = builder.graph()\n\nidStart = graph.findVertex(pStart)\n\ntree = QgsGraphAnalyzer.shortestTree(graph, idStart, 0)\n\ni = 0\nwhile (i &lt; tree.edgeCount()):\n  rb = QgsRubberBand(iface.mapCanvas())\n  rb.setColor (Qt.red)\n  rb.addPoint (tree.vertex(tree.edge(i).fromVertex()).point())\n  rb.addPoint (tree.vertex(tree.edge(i).toVertex()).point())\n  i = i + 1\n</code></pre> <p>\u200b\u4f7f\u7528\u200b<code>dijkstra()</code>\u200b\u65b9\u6cd5\u200b</p> <pre><code>from qgis.core import *\nfrom qgis.gui import *\nfrom qgis.analysis import *\nfrom qgis.PyQt.QtCore import *\nfrom qgis.PyQt.QtGui import *\n\nvectorLayer = QgsVectorLayer('testdata/network.gpkg|layername=network_lines', 'lines')\n\ndirector = QgsVectorLayerDirector(vectorLayer, -1, '', '', '', QgsVectorLayerDirector.DirectionBoth)\nstrategy = QgsNetworkDistanceStrategy()\ndirector.addStrategy(strategy)\nbuilder = QgsGraphBuilder(vectorLayer.crs())\n\npStart = QgsPointXY(1179661.925139,5419188.074362)\ntiedPoint = director.makeGraph(builder, [pStart])\npStart = tiedPoint[0]\n\ngraph = builder.graph()\n\nidStart = graph.findVertex(pStart)\n\n(tree, costs) = QgsGraphAnalyzer.dijkstra(graph, idStart, 0)\n\nfor edgeId in tree:\n  if edgeId == -1:\n    continue\n  rb = QgsRubberBand(iface.mapCanvas())\n  rb.setColor (Qt.red)\n  rb.addPoint (graph.vertex(graph.edge(edgeId).fromVertex()).point())\n  rb.addPoint (graph.vertex(graph.edge(edgeId).toVertex()).point())\n</code></pre>"},{"location":"19-%E7%BD%91%E7%BB%9C%E5%88%86%E6%9E%90%E5%BA%93/#1931","title":"19.3.1 \u200b\u67e5\u627e\u200b\u6700\u77ed\u200b\u8def\u5f84","text":"<p>\u200b\u4e3a\u4e86\u200b\u627e\u5230\u200b\u4e24\u70b9\u200b\u4e4b\u95f4\u200b\u7684\u200b\u6700\u4f73\u200b\u8def\u5f84\u200b\uff0c\u200b\u91c7\u7528\u200b\u4e86\u200b\u4ee5\u4e0b\u200b\u65b9\u6cd5\u200b\u3002\u200b\u4e24\u70b9\u200b\uff08\u200b\u8d77\u70b9\u200bA\u200b\u548c\u200b\u7ec8\u70b9\u200bB\uff09\u200b\u5728\u200b\u56fe\u200b\u5efa\u7acb\u200b\u65f6\u200b\u90fd\u200b\u88ab\u200b \"\u200b\u6346\u7ed1\u200b \"\u200b\u5728\u200b\u4e00\u8d77\u200b\u3002\u200b\u7136\u540e\u200b\u4f7f\u7528\u200b<code>shortestTree()</code>\u200b\u6216\u200b<code>dijkstra()</code>\u200b\u65b9\u6cd5\u200b\uff0c\u200b\u6211\u4eec\u200b\u5efa\u7acb\u200b\u4ee5\u200b\u8d77\u70b9\u200bA\u200b\u4e3a\u6839\u200b\u7684\u200b\u6700\u200b\u77ed\u200b\u8def\u5f84\u200b\u6811\u200b\u3002\u200b\u5728\u200b\u540c\u200b\u4e00\u68f5\u6811\u200b\u4e0a\u200b\uff0c\u200b\u6211\u4eec\u200b\u4e5f\u200b\u627e\u5230\u200b\u4e86\u200b\u7ec8\u70b9\u200bB\uff0c\u200b\u5e76\u200b\u5f00\u59cb\u200b\u4ece\u200bB\u200b\u70b9\u200b\u8d70\u200b\u5230\u200bA\u200b\u70b9\u200b\uff0c\u200b\u6574\u4e2a\u200b\u7b97\u6cd5\u200b\u53ef\u4ee5\u200b\u5199\u6210\u200b\u8fd9\u6837\u200b\uff1a</p> <pre><code>assign T = B\nwhile T != B\n    add point T to path\n    get incoming edge for point T\n    look for point TT, that is start point of this edge\n    assign T = TT\nadd point A to path\n</code></pre> <p>\u200b\u5728\u200b\u8fd9\u200b\u4e00\u70b9\u200b\u4e0a\u200b\uff0c\u200b\u6211\u4eec\u200b\u6709\u200b\u4e00\u4e2a\u200b\u8def\u5f84\u200b\uff0c\u200b\u5176\u200b\u5f62\u5f0f\u200b\u662f\u200b\u9876\u70b9\u200b\u7684\u200b\u5012\u7f6e\u200b\u5217\u8868\u200b\uff08\u200b\u9876\u70b9\u200b\u662f\u200b\u6309\u7167\u200b\u4ece\u200b\u7ec8\u70b9\u200b\u5230\u200b\u8d77\u70b9\u200b\u7684\u200b\u76f8\u53cd\u200b\u987a\u5e8f\u6392\u5217\u200b\u7684\u200b\uff09\uff0c\u200b\u8fd9\u4e9b\u200b\u9876\u70b9\u200b\u5c06\u200b\u5728\u200b\u8fd9\u6761\u200b\u8def\u5f84\u200b\u7684\u200b\u884c\u7a0b\u200b\u4e2d\u200b\u88ab\u200b\u8bbf\u95ee\u200b\u3002</p> <p>\u200b\u4ee5\u4e0b\u200b\u662f\u200b\u4f7f\u7528\u200b<code>shortestTree()</code>\u200b\u65b9\u6cd5\u200b\u7684\u200bQGIS Python\u200b\u63a7\u5236\u53f0\u200b\u793a\u4f8b\u200b\u4ee3\u7801\u200b\uff08\u200b\u4f60\u200b\u53ef\u80fd\u200b\u9700\u8981\u200b\u5728\u200b\u56fe\u5c42\u200b\u76ee\u5f55\u200b\u6811\u4e2d\u200b\u4e2d\u200b\u52a0\u8f7d\u200b\u5e76\u200b\u9009\u62e9\u200b\u4e00\u4e2a\u200b\u7ebf\u56fe\u200b\u5c42\u200b\uff0c\u200b\u5e76\u200b\u5c06\u200b\u4ee3\u7801\u200b\u4e2d\u200b\u7684\u200b\u5750\u6807\u200b\u66ff\u6362\u200b\u4e3a\u200b\u4f60\u200b\u7684\u200b\u5750\u6807\u200b\uff09\u3002</p> <pre><code>from qgis.core import *\nfrom qgis.gui import *\nfrom qgis.analysis import *\n\nfrom qgis.PyQt.QtCore import *\nfrom qgis.PyQt.QtGui import *\n\nvectorLayer = QgsVectorLayer('testdata/network.gpkg|layername=network_lines', 'lines')\nbuilder = QgsGraphBuilder(vectorLayer.sourceCrs())\ndirector = QgsVectorLayerDirector(vectorLayer, -1, '', '', '', QgsVectorLayerDirector.DirectionBoth)\nstrategy = QgsNetworkDistanceStrategy()\ndirector.addStrategy(strategy)\n\nstartPoint = QgsPointXY(1179661.925139,5419188.074362)\nendPoint = QgsPointXY(1180942.970617,5420040.097560)\n\ntiedPoints = director.makeGraph(builder, [startPoint, endPoint])\ntStart, tStop = tiedPoints\n\ngraph = builder.graph()\nidxStart = graph.findVertex(tStart)\n\ntree = QgsGraphAnalyzer.shortestTree(graph, idxStart, 0)\n\nidxStart = tree.findVertex(tStart)\nidxEnd = tree.findVertex(tStop)\n\nif idxEnd == -1:\n    raise Exception('No route!')\n\n# \u200b\u6dfb\u52a0\u200b\u6700\u540e\u200b\u4e00\u4e2a\u70b9\u200b\nroute = [tree.vertex(idxEnd).point()]\n\n# \u200b\u904d\u5386\u200b\u56fe\u200b\nwhile idxEnd != idxStart:\n    edgeIds = tree.vertex(idxEnd).incomingEdges()\n    if len(edgeIds) == 0:\n        break\n    edge = tree.edge(edgeIds[0])\n    route.insert(0, tree.vertex(edge.fromVertex()).point())\n    idxEnd = edge.fromVertex()\n\n# \u200b\u663e\u793a\u200b\nrb = QgsRubberBand(iface.mapCanvas())\nrb.setColor(Qt.green)\n\n# \u200b\u5982\u679c\u200b\u9879\u76ee\u200b\u7684\u200b\u5750\u6807\u7cfb\u200b\u548c\u200b\u56fe\u5c42\u200b\u7684\u200b\u5750\u6807\u7cfb\u200b\u4e0d\u200b\u4e00\u6837\u200b\uff0c\u200b\u5219\u200b\u9700\u8981\u200b\u5750\u6807\u200b\u8f6c\u6362\u200b\nfor p in route:\n    rb.addPoint(p)\n</code></pre> <p>\u200b\u4f7f\u7528\u200b<code>dijkstra()</code>\u200b\u65b9\u6cd5\u200b</p> <pre><code>from qgis.core import *\nfrom qgis.gui import *\nfrom qgis.analysis import *\n\nfrom qgis.PyQt.QtCore import *\nfrom qgis.PyQt.QtGui import *\n\nvectorLayer = QgsVectorLayer('testdata/network.gpkg|layername=network_lines', 'lines')\ndirector = QgsVectorLayerDirector(vectorLayer, -1, '', '', '', QgsVectorLayerDirector.DirectionBoth)\nstrategy = QgsNetworkDistanceStrategy()\ndirector.addStrategy(strategy)\n\nbuilder = QgsGraphBuilder(vectorLayer.sourceCrs())\n\nstartPoint = QgsPointXY(1179661.925139,5419188.074362)\nendPoint = QgsPointXY(1180942.970617,5420040.097560)\n\ntiedPoints = director.makeGraph(builder, [startPoint, endPoint])\ntStart, tStop = tiedPoints\n\ngraph = builder.graph()\nidxStart = graph.findVertex(tStart)\nidxEnd = graph.findVertex(tStop)\n\n(tree, costs) = QgsGraphAnalyzer.dijkstra(graph, idxStart, 0)\n\nif tree[idxEnd] == -1:\n    raise Exception('No route!')\n\n# Total cost\ncost = costs[idxEnd]\n\n# \u200b\u6dfb\u52a0\u200b\u6700\u540e\u200b\u4e00\u4e2a\u70b9\u200b\nroute = [graph.vertex(idxEnd).point()]\n\n# \u200b\u904d\u5386\u200b\u56fe\u200b\nwhile idxEnd != idxStart:\n    idxEnd = graph.edge(tree[idxEnd]).fromVertex()\n    route.insert(0, graph.vertex(idxEnd).point())\n\n# \u200b\u663e\u793a\u200b\nrb = QgsRubberBand(iface.mapCanvas())\nrb.setColor(Qt.red)\n\n# \u200b\u5982\u679c\u200b\u9879\u76ee\u200b\u7684\u200b\u5750\u6807\u7cfb\u200b\u548c\u200b\u56fe\u5c42\u200b\u7684\u200b\u5750\u6807\u7cfb\u200b\u4e0d\u200b\u4e00\u6837\u200b\uff0c\u200b\u5219\u200b\u9700\u8981\u200b\u5750\u6807\u200b\u8f6c\u6362\u200b\nfor p in route:\n    rb.addPoint(p)\n</code></pre>"},{"location":"19-%E7%BD%91%E7%BB%9C%E5%88%86%E6%9E%90%E5%BA%93/#1932","title":"19.3.2 \u200b\u53ef\u200b\u8fbe\u200b\u533a\u57df","text":"<p>\u200b\u9876\u70b9\u200bA\u200b\u7684\u200b\u53ef\u8fbe\u200b\u533a\u57df\u200b\u662f\u200b\u6307\u200b\u53ef\u4ee5\u200b\u4ece\u200b\u9876\u70b9\u200bA\u200b\u8fdb\u5165\u200b\u7684\u200b\u56fe\u5f62\u200b\u9876\u70b9\u200b\u7684\u200b\u5b50\u96c6\u200b\uff0c\u200b\u5e76\u4e14\u200b\u4ece\u200bA\u200b\u5230\u200b\u8fd9\u4e9b\u200b\u9876\u70b9\u200b\u7684\u200b\u8def\u5f84\u200b\u6210\u672c\u200b\u4e0d\u200b\u8d85\u8fc7\u200b\u67d0\u4e2a\u200b\u503c\u200b\u3002</p> <p>\u200b\u8fd9\u200b\u4e00\u70b9\u200b\u53ef\u4ee5\u200b\u901a\u8fc7\u200b\u4ee5\u4e0b\u200b\u4f8b\u5b50\u200b\u66f4\u200b\u6e05\u695a\u200b\u5730\u200b\u8868\u660e\u200b\u3002\"\u200b\u6709\u200b\u4e00\u4e2a\u200b\u6d88\u9632\u7ad9\u200b\uff0c\u200b\u6d88\u9632\u8f66\u200b\u53ef\u4ee5\u200b\u5728\u200b5\u200b\u5206\u949f\u200b\u5185\u200b\u5230\u8fbe\u200b\u57ce\u5e02\u200b\u7684\u200b\u54ea\u4e9b\u5730\u65b9\u200b\uff1f10\u200b\u5206\u949f\u200b\uff1f15\u200b\u5206\u949f\u200b\uff1f\"\u3002\u200b\u8fd9\u4e9b\u200b\u95ee\u9898\u200b\u7684\u200b\u7b54\u6848\u200b\u5c31\u662f\u200b\u6d88\u9632\u7ad9\u200b\u7684\u200b\u53ef\u8fbe\u200b\u533a\u57df\u200b\u3002</p> <p>\u200b\u4e3a\u4e86\u200b\u627e\u5230\u200b\u53ef\u8fbe\u200b\u7684\u200b\u533a\u57df\u200b\uff0c\u200b\u6211\u4eec\u200b\u53ef\u4ee5\u200b\u4f7f\u7528\u200b<code>QgsGraphAnalyzer</code>\u200b\u7c7b\u200b\u7684\u200b<code>dijkstra()</code>\u200b\u65b9\u6cd5\u200b\u3002\u200b\u53ea\u200b\u9700\u200b\u5c06\u200bcost\u200b\u6570\u7ec4\u200b\u7684\u200b\u5143\u7d20\u200b\u4e0e\u200b\u9884\u5b9a\u200b\u4e49\u200b\u7684\u200b\u503c\u200b\u8fdb\u884c\u200b\u6bd4\u8f83\u200b\u3002\u200b\u5982\u679c\u200bcost[i]\u200b\u5c0f\u4e8e\u200b\u6216\u200b\u7b49\u4e8e\u200b\u4e00\u4e2a\u200b\u9884\u5b9a\u200b\u4e49\u200b\u7684\u200b\u503c\u200b\uff0c\u200b\u90a3\u4e48\u200b\u9876\u70b9\u200bi\u200b\u5c31\u200b\u5728\u200b\u53ef\u8fbe\u200b\u533a\u57df\u200b\u5185\u200b\uff0c\u200b\u5426\u5219\u200b\u5b83\u200b\u5c31\u200b\u5728\u200b\u5916\u9762\u200b\u3002</p> <p>\u200b\u4e00\u4e2a\u200b\u66f4\u200b\u56f0\u96be\u200b\u7684\u200b\u95ee\u9898\u200b\u662f\u200b\u8981\u200b\u5f97\u5230\u200b\u53ef\u200b\u8fbe\u200b\u533a\u57df\u200b\u7684\u200b\u8fb9\u754c\u200b\u3002\u200b\u5e95\u90e8\u200b\u8fb9\u754c\u200b\u662f\u200b\u4ecd\u200b\u53ef\u200b\u8bbf\u95ee\u200b\u7684\u200b\u9876\u70b9\u200b\u96c6\u5408\u200b\uff0c\u200b\u800c\u200b\u9876\u90e8\u200b\u8fb9\u754c\u200b\u662f\u200b\u4e0d\u53ef\u200b\u8bbf\u95ee\u200b\u7684\u200b\u9876\u70b9\u200b\u96c6\u5408\u200b\u3002\u200b\u4e8b\u5b9e\u4e0a\u200b\u8fd9\u200b\u5f88\u200b\u7b80\u5355\u200b\uff1a\u200b\u5b83\u200b\u662f\u200b\u57fa\u4e8e\u200b\u6700\u77ed\u200b\u8def\u5f84\u200b\u6811\u200b\u7684\u200b\u8fb9\u200b\u7684\u200b\u53ef\u8fbe\u6027\u200b\u8fb9\u754c\u200b\uff0c\u200b\u5bf9\u4e8e\u200b\u8fd9\u4e9b\u200b\u8fb9\u200b\u7684\u200b\u6e90\u200b\u9876\u70b9\u200b\u662f\u200b\u53ef\u200b\u8bbf\u95ee\u200b\u7684\u200b\uff0c\u200b\u800c\u8fb9\u200b\u7684\u200b\u76ee\u6807\u200b\u9876\u70b9\u200b\u5219\u200b\u4e0d\u662f\u200b\u3002</p> <p>\u200b\u4e0b\u9762\u200b\u662f\u200b\u4e00\u4e2a\u200b\u4f8b\u5b50\u200b\uff1a</p> <pre><code>director = QgsVectorLayerDirector(vectorLayer, -1, '', '', '', QgsVectorLayerDirector.DirectionBoth)\nstrategy = QgsNetworkDistanceStrategy()\ndirector.addStrategy(strategy)\nbuilder = QgsGraphBuilder(vectorLayer.crs())\n\n\npStart = QgsPointXY(1179661.925139, 5419188.074362)\ndelta = iface.mapCanvas().getCoordinateTransform().mapUnitsPerPixel() * 1\n\nrb = QgsRubberBand(iface.mapCanvas())\nrb.setColor(Qt.green)\nrb.addPoint(QgsPointXY(pStart.x() - delta, pStart.y() - delta))\nrb.addPoint(QgsPointXY(pStart.x() + delta, pStart.y() - delta))\nrb.addPoint(QgsPointXY(pStart.x() + delta, pStart.y() + delta))\nrb.addPoint(QgsPointXY(pStart.x() - delta, pStart.y() + delta))\n\ntiedPoints = director.makeGraph(builder, [pStart])\ngraph = builder.graph()\ntStart = tiedPoints[0]\n\nidStart = graph.findVertex(tStart)\n\n(tree, cost) = QgsGraphAnalyzer.dijkstra(graph, idStart, 0)\n\nupperBound = []\nr = 1500.0\ni = 0\ntree.reverse()\n\nwhile i &lt; len(cost):\n    if cost[i] &gt; r and tree[i] != -1:\n        outVertexId = graph.edge(tree [i]).toVertex()\n        if cost[outVertexId] &lt; r:\n            upperBound.append(i)\n    i = i + 1\n\nfor i in upperBound:\n    centerPoint = graph.vertex(i).point()\n    rb = QgsRubberBand(iface.mapCanvas())\n    rb.setColor(Qt.red)\n    rb.addPoint(QgsPointXY(centerPoint.x() - delta, centerPoint.y() - delta))\n    rb.addPoint(QgsPointXY(centerPoint.x() + delta, centerPoint.y() - delta))\n    rb.addPoint(QgsPointXY(centerPoint.x() + delta, centerPoint.y() + delta))\n    rb.addPoint(QgsPointXY(centerPoint.x() - delta, centerPoint.y() + delta))\n</code></pre>"},{"location":"2-%E5%8A%A0%E8%BD%BD%E9%A1%B9%E7%9B%AE/","title":"2-\u200b\u52a0\u8f7d\u200b\u9879\u76ee","text":"<p>\u200b\u672c\u8282\u200b\u7684\u200b\u4ee3\u7801\u200b\u7247\u6bb5\u200b\u9700\u8981\u200b\u5bfc\u5165\u200b\u4ee5\u4e0b\u200b\u6a21\u5757\u200b\uff1a</p> <pre><code>from qgis.core import (\n    Qgis,\n    QgsProject,\n    QgsPathResolver\n)\n\nfrom qgis.gui import (\n    QgsLayerTreeMapCanvasBridge,\n)\n</code></pre>"},{"location":"2-%E5%8A%A0%E8%BD%BD%E9%A1%B9%E7%9B%AE/#2","title":"2 \u200b\u52a0\u8f7d\u200b\u9879\u76ee","text":"<p>\u200b\u6709\u65f6\u200b\u4f60\u200b\u9700\u8981\u200b\u4ece\u200b\u63d2\u4ef6\u200b\u52a0\u8f7d\u200b\u73b0\u6709\u200b\u9879\u76ee\u200b\uff0c\u200b\u6216\u8005\u200b\uff08\u200b\u66f4\u200b\u5e38\u89c1\u200b\uff09\u200b\u5728\u200b\u5f00\u53d1\u200b\u72ec\u7acb\u200b\u7684\u200bQGIS Python\u200b\u5e94\u7528\u7a0b\u5e8f\u200b\u65f6\u200b\u52a0\u8f7d\u200b\uff08\u200b\u8bf7\u53c2\u9605\u200b\uff1aPython\u200b\u5e94\u7528\u7a0b\u5e8f\u200b\uff09\u3002</p> <p>\u200b\u5c06\u200b\u9879\u76ee\u200b\u52a0\u8f7d\u200b\u5230\u200b\u5f53\u524d\u200bQGIS\u200b\u5e94\u7528\u7a0b\u5e8f\u200b\u4e2d\u200b\uff0c\u200b\u9700\u8981\u200b\u521b\u5efa\u200b<code>QgsProject</code>\u200b\u7c7b\u200b\u7684\u200b\u5b9e\u4f8b\u200b\u3002\u200b\u8fd9\u662f\u200b\u4e00\u4e2a\u200b\u5355\u4f8b\u200b\u7c7b\u200b\uff0c\u200b\u56e0\u6b64\u200b\u4f60\u200b\u5fc5\u987b\u200b\u4f7f\u7528\u200b\u5176\u200b<code>instance()</code>\u200b\u65b9\u6cd5\u200b\u6765\u200b\u6267\u884c\u200b\u6b64\u200b\u64cd\u4f5c\u200b\u3002\u200b\u4f60\u200b\u53ef\u4ee5\u200b\u8c03\u7528\u200b<code>read()</code>\u200b\u65b9\u6cd5\u200b\uff0c\u200b\u4f20\u9012\u200b\u52a0\u8f7d\u200b\u9879\u76ee\u200b\u7684\u200b\u8def\u5f84\u200b\uff1a</p> <pre><code># \u200b\u5982\u679c\u200b\u4f60\u200b\u4e0d\u200b\u5728\u200bQGIS\u200b\u63a7\u5236\u53f0\u200b\u5185\u200b\u8fd0\u884c\u200b\uff0c\u200b\u9996\u5148\u200b\u9700\u8981\u200b\u5bfc\u5165\u200bqgis\u200b\u548c\u200bPyQt\u200b\u7c7b\u200b\uff0c\u200b\u5982\u4e0b\u200b\u6240\u793a\u200b\uff1a\nfrom qgis.core import QgsProject\n# \u200b\u83b7\u53d6\u200b\u9879\u76ee\u200b\u5b9e\u4f8b\u200b\nproject = QgsProject.instance()\n# \u200b\u6253\u5370\u200b\u5f53\u524d\u200b\u9879\u76ee\u200b\u7684\u200b\u6587\u4ef6\u540d\u200b\uff08\u200b\u53ef\u80fd\u200b\u4e3a\u7a7a\u200b\uff0c\u200b\u56e0\u4e3a\u200b\u6ca1\u6709\u200b\u9879\u76ee\u200b\u52a0\u8f7d\u200b\uff09\n# print(project.fileName())\n\n# \u200b\u52a0\u8f7d\u200b\u53e6\u200b\u4e00\u4e2a\u200b\u9879\u76ee\u200b\nproject.read('testdata/01_project.qgs')\nprint(project.fileName())\n# testdata/01_project.qgs\n</code></pre> <p>\u200b\u5982\u679c\u200b\u4f60\u200b\u9700\u8981\u200b\u5bf9\u200b\u9879\u76ee\u200b\u8fdb\u884c\u200b\u4fee\u6539\u200b\uff08\u200b\u4f8b\u5982\u200b\u6dfb\u52a0\u200b\u6216\u200b\u5220\u9664\u200b\u67d0\u4e9b\u200b\u56fe\u5c42\u200b\uff09\u200b\u5e76\u200b\u4fdd\u5b58\u200b\u66f4\u6539\u200b\uff0c\u200b\u8c03\u7528\u200b<code>write()</code>\u200b\u65b9\u6cd5\u200b\u3002\u200b\u8be5\u200b\u65b9\u6cd5\u200b\u8fd8\u200b\u652f\u6301\u200b\u5c06\u200b\u9879\u76ee\u200b\u4fdd\u5b58\u200b\u5230\u200b\u65b0\u200b\u7684\u200b\u4f4d\u7f6e\u200b\uff1a</p> <pre><code># \u200b\u5c06\u200b\u9879\u76ee\u200b\u4fdd\u5b58\u200b\u5230\u200b\u540c\u4e00\u4e2a\u200b\u6587\u4ef6\u200b\nproject.write()\n# ...\u200b\u6216\u200b\u65b0\u200b\u6587\u4ef6\u200b\nproject.write('testdata/my_new_qgis_project.qgs')\n</code></pre> <p><code>read()</code>\u200b\u548c\u200b<code>write()</code>\u200b\u51fd\u6570\u200b\u90fd\u200b\u8fd4\u56de\u200b\u4e00\u4e2a\u200b\u5e03\u5c14\u503c\u200b\uff0c\u200b\u4f60\u200b\u53ef\u4ee5\u200b\u4f7f\u7528\u200b\u5b83\u200b\u6765\u200b\u68c0\u67e5\u200b\u64cd\u4f5c\u200b\u662f\u5426\u200b\u6210\u529f\u200b\u3002</p> <p>\u200b\u63d0\u793a\u200b</p> <p>\u200b\u5982\u679c\u200b\u4f60\u200b\u6b63\u5728\u200b\u7f16\u5199\u200bQGIS\u200b\u72ec\u7acb\u200b\u5e94\u7528\u7a0b\u5e8f\u200b\uff0c\u200b\u4e3a\u4e86\u200b\u5c06\u200b\u52a0\u8f7d\u200b\u7684\u200b\u9879\u76ee\u200b\u4e0e\u200b\u753b\u5e03\u200b\u540c\u6b65\u200b\uff0c\u200b\u4f60\u200b\u9700\u8981\u200b\u5b9e\u4f8b\u200b\u5316\u200b<code>QgsLayerTreeMapCanvasBridge</code>\uff0c\u200b\u5982\u4e0b\u200b\u6240\u793a\u200b\uff1a</p> <pre><code>bridge = QgsLayerTreeMapCanvasBridge(QgsProject.instance().layerTreeRoot(), canvas)\n# \u200b\u73b0\u5728\u200b\u4f60\u200b\u53ef\u4ee5\u200b\u5b89\u5168\u200b\u5730\u200b\u52a0\u8f7d\u200b\u9879\u76ee\u200b\uff0c\u200b\u5e76\u200b\u5728\u200b\u753b\u5e03\u200b\u4e0a\u200b\u770b\u5230\u200b\u5b83\u200b\nproject.read('testdata/my_new_qgis_project.qgs')\n</code></pre>"},{"location":"2-%E5%8A%A0%E8%BD%BD%E9%A1%B9%E7%9B%AE/#21","title":"2.1 \u200b\u89e3\u51b3\u200b\u9519\u8bef\u200b\u8def\u5f84","text":"<p>\u200b\u5728\u200b\u9879\u76ee\u200b\u4e2d\u200b\u52a0\u8f7d\u200b\u7684\u200b\u56fe\u5c42\u200b\u53ef\u80fd\u200b\u88ab\u200b\u79fb\u52a8\u200b\u5230\u200b\u53e6\u200b\u4e00\u4e2a\u200b\u4f4d\u7f6e\u200b\u3002\u200b\u5f53\u200b\u9879\u76ee\u200b\u518d\u6b21\u200b\u52a0\u8f7d\u200b\u65f6\u200b\uff0c\u200b\u6240\u6709\u200b\u7684\u200b\u56fe\u5c42\u200b\u8def\u5f84\u200b\u90fd\u200b\u88ab\u200b\u7834\u574f\u200b\u3002<code>QgsPathResolver</code>\u200b\u7c7b\u200b\u5e2e\u52a9\u200b\u4f60\u200b\u5728\u200b\u9879\u76ee\u200b\u4e2d\u200b\u91cd\u5199\u200b\u56fe\u5c42\u200b\u8def\u5f84\u200b\u3002</p> <p><code>setPathPreprocessor()</code>\u200b\u65b9\u6cd5\u200b\u5141\u8bb8\u200b\u8bbe\u7f6e\u200b\u4e00\u4e2a\u200b\u81ea\u5b9a\u4e49\u200b\u7684\u200b\u8def\u5f84\u200b\u9884\u5904\u7406\u200b\u51fd\u6570\u200b\uff0c\u200b\u5b83\u200b\u5141\u8bb8\u200b\u5728\u200b\u5c06\u200b\u8def\u5f84\u200b\u548c\u200b\u6570\u636e\u6e90\u200b\u89e3\u6790\u200b\u4e3a\u200b\u6587\u4ef6\u200b\u5f15\u7528\u200b\u6216\u200b\u56fe\u5c42\u200b\u6e90\u200b\u4e4b\u524d\u200b\u5bf9\u200b\u5b83\u4eec\u200b\u8fdb\u884c\u200b\u64cd\u4f5c\u200b\u3002</p> <p>\u200b\u8be5\u200b\u5904\u7406\u51fd\u6570\u200b\u5fc5\u987b\u200b\u63a5\u53d7\u200b\u4e00\u4e2a\u200b\u5355\u4e00\u200b\u7684\u200b\u5b57\u7b26\u4e32\u200b\u53c2\u6570\u200b\uff08\u200b\u4ee3\u8868\u200b\u539f\u59cb\u200b\u6587\u4ef6\u200b\u8def\u5f84\u200b\u6216\u200b\u6570\u636e\u6e90\u200b\uff09\uff0c\u200b\u5e76\u200b\u8fd4\u56de\u200b\u8be5\u200b\u8def\u5f84\u200b\u7684\u200b\u5904\u7406\u200b\u7248\u672c\u200b\u3002</p> <p>\u200b\u8def\u5f84\u200b\u9884\u200b\u5904\u7406\u5668\u200b\u51fd\u6570\u200b\u5728\u200b\u4efb\u4f55\u200b\u9519\u8bef\u200b\u56fe\u5c42\u200b\u5904\u7406\u7a0b\u5e8f\u200b\u4e4b\u524d\u200b\u88ab\u200b\u8c03\u7528\u200b\u3002\u200b\u5982\u679c\u200b\u8bbe\u7f6e\u200b\u4e86\u200b\u591a\u4e2a\u200b\u9884\u200b\u5904\u7406\u5668\u200b\uff0c\u200b\u5c06\u200b\u6839\u636e\u200b\u6700\u521d\u200b\u8bbe\u7f6e\u200b\u7684\u200b\u987a\u5e8f\u200b\u4f9d\u6b21\u200b\u8c03\u7528\u200b\u5b83\u4eec\u200b\u3002</p> <p>\u200b\u4e00\u4e9b\u200b\u5e94\u7528\u200b\u6848\u4f8b\u200b\uff1a</p> <ol> <li>\u200b\u66ff\u6362\u200b\u8fc7\u65f6\u200b\u7684\u200b\u8def\u5f84\u200b\uff1a</li> </ol> <pre><code>def my_processor(path):\n    return path.replace('c:/Users/ClintBarton/Documents/Projects', 'x:/Projects/')\n\nQgsPathResolver.setPathPreprocessor(my_processor)\n</code></pre> <ol> <li>\u200b\u7528\u200b\u4e00\u4e2a\u200b\u65b0\u200b\u7684\u200b\u6570\u636e\u5e93\u200b\u4e3b\u673a\u200b\u5730\u5740\u200b\u6765\u200b\u66ff\u6362\u200b\uff1a</li> </ol> <pre><code>def my_processor(path):\n    return path.replace('host=10.1.1.115', 'host=10.1.1.116')\n\nQgsPathResolver.setPathPreprocessor(my_processor)\n</code></pre> <ol> <li>\u200b\u66ff\u6362\u200b\u65b0\u200b\u7684\u200b\u6570\u636e\u5e93\u200b\u8bc1\u4e66\u200b\uff1a</li> </ol> <pre><code>def my_processor(path):\n    path= path.replace(\"user='gis_team'\", \"user='team_awesome'\")\n    path = path.replace(\"password='cats'\", \"password='g7as!m*'\")\n    return path\n\nQgsPathResolver.setPathPreprocessor(my_processor)\n</code></pre> <p>\u200b\u540c\u6837\u200b\uff0c\u200b\u8def\u5f84\u200b\u7f16\u5199\u200b\u5668\u200b\u51fd\u6570\u200b\u4e5f\u200b\u53ef\u4ee5\u200b\u4f7f\u7528\u200b<code>setPathWriter()</code>\u200b\u65b9\u6cd5\u200b\u3002</p> <p>\u200b\u4f7f\u7528\u200b\u53d8\u91cf\u200b\u66ff\u6362\u200b\u8def\u5f84\u200b\u7684\u200b\u793a\u4f8b\u200b\uff1a</p> <pre><code>def my_processor(path):\n  return path.replace('c:/Users/ClintBarton/Documents/Projects', '$projectdir$')\n\nQgsPathResolver.setPathWriter(my_processor)\n</code></pre> <p>\u200b\u8fd9\u200b\u4e24\u79cd\u200b\u65b9\u6cd5\u200b\u90fd\u200b\u8fd4\u56de\u200b\u4e00\u4e2a\u200b<code>id</code>\uff0c\u200b\u53ef\u200b\u7528\u4e8e\u200b\u5220\u9664\u200b\u5b83\u4eec\u200b\u6dfb\u52a0\u200b\u7684\u200b\u9884\u200b\u5904\u7406\u5668\u200b\u6216\u200b\u5199\u5165\u200b\u7a0b\u5e8f\u200b\u3002\u200b\u67e5\u770b\u200b<code>removePathPreprocessor()</code>\u200b\u548c\u200b<code>removePathWriter()</code>\u3002</p>"},{"location":"2-%E5%8A%A0%E8%BD%BD%E9%A1%B9%E7%9B%AE/#22","title":"2.2 \u200b\u4f7f\u7528\u200b\u6807\u8bc6\u7b26","text":"<p>\u200b\u5728\u200b\u67d0\u4e9b\u200b\u60c5\u51b5\u200b\u4e0b\u200b\uff0c\u200b\u4f60\u200b\u53ef\u80fd\u200b\u4e0d\u200b\u9700\u8981\u200b\u4f7f\u7528\u200b\u529f\u80fd\u9f50\u5168\u200b\u7684\u200b\u9879\u76ee\u200b\uff0c\u200b\u800c\u200b\u53ea\u662f\u200b\u51fa\u4e8e\u200b\u7279\u5b9a\u200b\u539f\u56e0\u200b\u60f3\u8981\u200b\u8bbf\u95ee\u200b\u5b83\u200b\uff0c\u200b\u6807\u8bc6\u200b\u53ef\u80fd\u200b\u4f1a\u200b\u6709\u6240\u200b\u5e2e\u52a9\u200b\u3002\u200b\u5b8c\u6574\u200b\u7684\u200b\u6807\u8bc6\u200b\u5217\u8868\u200b\u53ef\u200b\u5728\u200b<code>ProjectReadFlag</code>\u200b\u4e0b\u200b\u627e\u5230\u200b\u3002\u200b\u53ef\u4ee5\u200b\u5c06\u200b\u591a\u4e2a\u200b\u6807\u5fd7\u200b\u6dfb\u52a0\u200b\u5728\u200b\u4e00\u8d77\u200b\u3002</p> <p>\u200b\u4f8b\u5982\u200b\uff0c\u200b\u5982\u679c\u200b\u6211\u4eec\u200b\u4e0d\u200b\u5173\u5fc3\u200b\u5b9e\u9645\u200b\u7684\u200b\u56fe\u5c42\u200b\u548c\u200b\u6570\u636e\u200b\uff0c\u200b\u800c\u200b\u53ea\u662f\u200b\u60f3\u200b\u8bbf\u95ee\u200b\u9879\u76ee\u200b\uff08\u200b\u4f8b\u5982\u200b\u5e03\u5c40\u200b\u6216\u200b3D\u200b\u89c6\u56fe\u200b\u8bbe\u7f6e\u200b\uff09\uff0c\u200b\u5219\u200b\u53ef\u4ee5\u200b\u4f7f\u7528\u200b<code>DontResolveLayers</code>\u200b\u6807\u8bc6\u200b\u7ed5\u8fc7\u200b\u6570\u636e\u200b\u9a8c\u8bc1\u200b\u6b65\u9aa4\u200b\u5e76\u200b\u9632\u6b62\u51fa\u73b0\u200b\u65e0\u6548\u200b\u56fe\u5c42\u200b\u5bf9\u8bdd\u6846\u200b\u3002\u200b\u53ef\u4ee5\u200b\u6267\u884c\u200b\u4ee5\u4e0b\u200b\u64cd\u4f5c\u200b\uff1a</p> <pre><code>readflags = Qgis.ProjectReadFlags()\nreadflags |= Qgis.ProjectReadFlag.DontResolveLayers\nproject = QgsProject().instance()\nproject.read('C:/Users/ClintBarton/Documents/Projects/mysweetproject.qgs', readflags)\n</code></pre> <p>\u200b\u6dfb\u52a0\u200b\u66f4\u200b\u591a\u200b\u6807\u5fd7\u200b\uff0c\u200b\u5fc5\u987b\u200b\u4f7f\u7528\u200b python \u200b\u6309\u4f4d\u200b\u6216\u200b\u8fd0\u7b97\u7b26\u200b \uff08|\uff09\u3002</p>"},{"location":"20-QGIS%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%92%8CPython/","title":"20-QGIS\u200b\u670d\u52a1\u5668\u200b\u548c\u200bPython","text":""},{"location":"20-QGIS%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%92%8CPython/#201","title":"20.1 \u200b\u4ecb\u7ecd","text":"<p>\u200b\u8981\u200b\u4e86\u89e3\u200b\u6709\u5173\u200bQGIS\u200b\u670d\u52a1\u5668\u200b\u7684\u200b\u66f4\u200b\u591a\u200b\u4fe1\u606f\u200b\uff0c\u200b\u8bf7\u200b\u9605\u8bfb\u200bQGIS\u200b\u670d\u52a1\u5668\u200b\u6307\u5357\u200b/\u200b\u624b\u518c\u200b\u3002</p> <p>QGIS\u200b\u670d\u52a1\u5668\u200b\u662f\u200b\u4e09\u4e2a\u200b\u4e0d\u540c\u200b\u7684\u200b\u4e1c\u897f\u200b\uff1a</p> <ol> <li>QGIS\u200b\u670d\u52a1\u5668\u200b\u5e93\u200b\uff1a\u200b\u4e00\u4e2a\u200b\u4e3a\u200b\u521b\u5efa\u200bOGC\u200b\u7f51\u7edc\u670d\u52a1\u200b\u63d0\u4f9b\u200bAPI\u200b\u7684\u200b\u5e93\u200b</li> <li>QGIS\u200b\u670d\u52a1\u5668\u200bFCGI\uff1a\u200b\u4e00\u4e2a\u200bFCGI\u200b\u4e8c\u8fdb\u5236\u200b\u5e94\u7528\u7a0b\u5e8f\u200b<code>qgis_mapserv.fcgi</code>\uff0c\u200b\u4e0e\u200b\u7f51\u7edc\u200b\u670d\u52a1\u5668\u200b\u4e00\u8d77\u200b\u5b9e\u73b0\u200b\u4e00\u5957\u200bOGC\u200b\u670d\u52a1\u200b\uff08WMS\u3001WFS\u3001WCS\u200b\u7b49\u200b\uff09\u200b\u548c\u200bOGC APIs\uff08WFS3/OAPIF\uff09\u3002</li> <li>QGIS\u200b\u5f00\u53d1\u200b\u670d\u52a1\u5668\u200b\uff1a\u200b\u4e00\u4e2a\u200b\u5f00\u53d1\u200b\u670d\u52a1\u5668\u200b\u4e8c\u8fdb\u5236\u200b\u5e94\u7528\u7a0b\u5e8f\u200b<code>qgis_mapserver</code>\uff0c\u200b\u5b9e\u73b0\u200b\u4e86\u200b\u4e00\u5957\u200bOGC\u200b\u670d\u52a1\u200b\uff08WMS\u3001WFS\u3001WCS\u200b\u7b49\u200b\uff09\u200b\u548c\u200bOGC APIs\uff08WFS3/OAPIF\uff09\u3002</li> </ol> <p>\u200b\u672c\u7ae0\u200b\u7684\u200b\u91cd\u70b9\u200b\u662f\u200b\u7b2c\u4e00\u4e2a\u200b\u8bdd\u9898\u200b\uff0c\u200b\u901a\u8fc7\u200b\u89e3\u91ca\u200bQGIS\u200b\u670d\u52a1\u5668\u200bAPI\u200b\u7684\u200b\u7528\u6cd5\u200b\u6765\u200b\u8bf4\u660e\u200b\u5982\u4f55\u200b\u4f7f\u7528\u200bPython\u200b\u6765\u200b\u6269\u5c55\u200b\u3001\u200b\u589e\u5f3a\u200b\u6216\u200b\u5b9a\u5236\u200b\u670d\u52a1\u5668\u200b\u884c\u4e3a\u200b\uff0c\u200b\u6216\u200b\u5982\u4f55\u200b\u4f7f\u7528\u200bQGIS\u200b\u670d\u52a1\u5668\u200bAPI\u200b\u5c06\u200bQGIS\u200b\u670d\u52a1\u5668\u200b\u5d4c\u5165\u200b\u5230\u200b\u53e6\u200b\u4e00\u4e2a\u200b\u5e94\u7528\u7a0b\u5e8f\u200b\u3002</p> <p>\u200b\u4f60\u200b\u53ef\u4ee5\u200b\u901a\u8fc7\u200b\u4e00\u4e9b\u200b\u4e0d\u540c\u200b\u7684\u200b\u65b9\u5f0f\u200b\u6765\u200b\u6539\u53d8\u200bQGIS\u200b\u670d\u52a1\u5668\u200b\u7684\u200b\u884c\u4e3a\u200b\u6216\u200b\u6269\u5c55\u200b\u5176\u200b\u529f\u80fd\u200b\uff0c\u200b\u4ee5\u200b\u63d0\u4f9b\u200b\u65b0\u200b\u7684\u200b\u5b9a\u5236\u200b\u670d\u52a1\u200b\u6216\u200bAPI\uff0c\u200b\u4e00\u4e0b\u200b\u662f\u200b\u4f60\u200b\u53ef\u80fd\u200b\u9762\u4e34\u200b\u7684\u200b\u4e3b\u8981\u200b\u60c5\u51b5\u200b\uff1a</p> <ul> <li>\u200b\u878d\u5408\u200b \u2192 \u200b\u4ece\u200b\u53e6\u200b\u4e00\u4e2a\u200bPython\u200b\u5e94\u7528\u7a0b\u5e8f\u200b\u4e2d\u200b\u4f7f\u7528\u200bQGIS\u200b\u670d\u52a1\u5668\u200bAPI</li> <li>\u200b\u72ec\u7acb\u200b \u2192 \u200b\u4ee5\u200b\u72ec\u7acb\u200b\u7684\u200bWSGI/HTTP\u200b\u670d\u52a1\u200b\u65b9\u5f0f\u200b\u8fd0\u884c\u200bQGIS\u200b\u670d\u52a1\u5668\u200b</li> <li>\u200b\u8fc7\u6ee4\u200b \u2192 \u200b\u4f7f\u7528\u200b\u8fc7\u6ee4\u200b\u63d2\u4ef6\u200b\u589e\u5f3a\u200b/\u200b\u5b9a\u5236\u200bQGIS\u200b\u670d\u52a1\u5668\u200b</li> <li>\u200b\u670d\u52a1\u200b \u2192 \u200b\u6dfb\u52a0\u200b\u4e00\u4e2a\u200b\u65b0\u200b\u7684\u200b\u670d\u52a1\u200b</li> <li>OGC APIs \u2192  \u200b\u6dfb\u52a0\u200b\u4e00\u4e2a\u200b\u65b0\u200b\u7684\u200bOGC API</li> </ul> <p>\u200b\u5d4c\u5165\u200b\u548c\u200b\u72ec\u7acb\u200b\u7684\u200b\u5e94\u7528\u7a0b\u5e8f\u200b\u9700\u8981\u200b\u76f4\u63a5\u200b\u4ece\u200b\u53e6\u200b\u4e00\u4e2a\u200bPython\u200b\u811a\u672c\u200b\u6216\u200b\u5e94\u7528\u7a0b\u5e8f\u200b\u4e2d\u200b\u4f7f\u7528\u200bQGIS\u200b\u670d\u52a1\u5668\u200b\u7684\u200bPython API\u3002\u200b\u5176\u4f59\u200b\u7684\u200b\u9009\u9879\u200b\u66f4\u200b\u9002\u5408\u200b\u4e8e\u200b\u5f53\u200b\u4f60\u200b\u60f3\u200b\u5728\u200b\u6807\u51c6\u200b\u7684\u200bQGIS\u200b\u670d\u52a1\u5668\u200b\u4e8c\u8fdb\u5236\u200b\u5e94\u7528\u7a0b\u5e8f\u200b\uff08FCGI\u200b\u6216\u200b\u5f00\u53d1\u200b\u670d\u52a1\u5668\u200b\uff09\u200b\u4e2d\u200b\u6dfb\u52a0\u200b\u81ea\u5b9a\u4e49\u200b\u529f\u80fd\u200b\u65f6\u200b\uff1a\u200b\u5728\u200b\u8fd9\u79cd\u200b\u60c5\u51b5\u200b\u4e0b\u200b\uff0c\u200b\u4f60\u200b\u9700\u8981\u200b\u4e3a\u200b\u670d\u52a1\u5668\u5e94\u7528\u7a0b\u5e8f\u200b\u7f16\u5199\u200b\u4e00\u4e2a\u200bPython\u200b\u63d2\u4ef6\u200b\uff0c\u200b\u5e76\u200b\u6ce8\u518c\u200b\u4f60\u200b\u7684\u200b\u81ea\u5b9a\u4e49\u200b\u8fc7\u6ee4\u5668\u200b\u3001\u200b\u670d\u52a1\u200b\u6216\u200bAPI\u3002</p>"},{"location":"20-QGIS%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%92%8CPython/#202-api","title":"20.2 \u200b\u670d\u52a1\u5668\u200bAPI\u200b\u57fa\u7840","text":"<p>\u200b\u4e00\u4e2a\u200b\u5178\u578b\u200b\u7684\u200bQGIS\u200b\u670d\u52a1\u5668\u5e94\u7528\u7a0b\u5e8f\u200b\u6240\u200b\u6d89\u53ca\u200b\u7684\u200b\u57fa\u672c\u200b\u7c7b\u200b\u662f\u200b\uff1a</p> <ul> <li><code>QgsServer</code> \u200b\u670d\u52a1\u200b\u5b9e\u4f8b\u200b (\u200b\u901a\u5e38\u200b\u5728\u200b\u6574\u4e2a\u200b\u5e94\u7528\u7a0b\u5e8f\u200b\u7684\u200b\u751f\u547d\u5468\u671f\u200b\u4e2d\u200b\u53ea\u6709\u200b\u4e00\u4e2a\u200b\u5b9e\u4f8b\u200b)</li> <li><code>QgsServerRequest</code> \u200b\u8bf7\u6c42\u200b\u5bf9\u8c61\u200b(\u200b\u901a\u5e38\u200b\u5728\u200b\u6bcf\u6b21\u200b\u8bf7\u6c42\u200b\u65f6\u200b\u91cd\u65b0\u200b\u521b\u5efa\u200b)</li> <li><code>QgsServer.handleRequest(request, response)</code> \u200b\u5904\u7406\u200b\u8bf7\u6c42\u200b\u5e76\u200b\u54cd\u5e94\u200b</li> </ul> <p>QGIS\u200b\u670d\u52a1\u5668\u200bFCGI\u200b\u6216\u200b\u5f00\u53d1\u200b\u670d\u52a1\u5668\u200b\u7684\u200b\u5de5\u4f5c\u200b\u6d41\u7a0b\u200b\u53ef\u4ee5\u200b\u6982\u62ec\u200b\u4e3a\u200b\u4ee5\u4e0b\u51e0\u70b9\u200b\uff1a</p> <pre><code>initialize the QgsApplication\ncreate the QgsServer\nthe main server loop waits forever for client requests:\n    for each incoming request:\n        create a QgsServerRequest request\n        create a QgsServerResponse response\n        call QgsServer.handleRequest(request, response)\n            filter plugins may be executed\n        send the output to the client\n</code></pre> <p>\u200b\u5728\u200b<code>QgsServer.handleRequest(request, response)</code>\u200b\u65b9\u6cd5\u200b\u4e2d\u200b\uff0c\u200b\u8fc7\u6ee4\u5668\u200b\u63d2\u4ef6\u200b\u7684\u200b\u56de\u8c03\u200b\u51fd\u6570\u200b\u88ab\u200b\u8c03\u7528\u200b\uff0c<code>QgsServerRequest</code>\u200b\u548c\u200b<code>QgsServerResponse</code>\u200b\u901a\u8fc7\u200b<code>QgsServerInterface</code>\u200b\u7c7b\u200b\u88ab\u200b\u63d0\u4f9b\u200b\u7ed9\u200b\u63d2\u4ef6\u200b\u3002</p> <p>\u200b\u8b66\u544a\u200b</p> <p>QGIS\u200b\u670d\u52a1\u5668\u200b\u7c7b\u200b\u4e0d\u662f\u200b\u7ebf\u7a0b\u200b\u5b89\u5168\u200b\u7684\u200b\uff0c\u200b\u5728\u200b\u6784\u5efa\u200b\u57fa\u4e8e\u200bQGIS\u200b\u670d\u52a1\u5668\u200bAPI\u200b\u7684\u200b\u53ef\u200b\u6269\u5c55\u200b\u5e94\u7528\u7a0b\u5e8f\u200b\u65f6\u200b\uff0c\u200b\u4f60\u200b\u5e94\u8be5\u200b\u59cb\u7ec8\u200b\u4f7f\u7528\u200b\u591a\u200b\u8fdb\u7a0b\u200b\u6a21\u578b\u200b\u6216\u200b\u5bb9\u5668\u200b\u3002</p>"},{"location":"20-QGIS%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%92%8CPython/#203","title":"20.3 \u200b\u72ec\u7acb\u200b\u6216\u200b\u5d4c\u5165","text":"<p>\u200b\u5bf9\u4e8e\u200b\u72ec\u7acb\u200b\u7684\u200b\u670d\u52a1\u5668\u200b\u5e94\u7528\u200b\u6216\u200b\u5d4c\u5165\u200b\uff0c\u200b\u4f60\u200b\u9700\u8981\u200b\u76f4\u63a5\u200b\u4f7f\u7528\u200b\u4e0a\u8ff0\u200b\u7684\u200b\u670d\u52a1\u5668\u200b\u7c7b\u200b\uff0c\u200b\u5c06\u200b\u5b83\u4eec\u200b\u5305\u88c5\u200b\u6210\u200b\u4e00\u4e2a\u200bWeb\u200b\u670d\u52a1\u5668\u200b\u5b9e\u73b0\u200b\uff0c\u200b\u7ba1\u7406\u200b\u6240\u6709\u200b\u4e0e\u200b\u5ba2\u6237\u7aef\u200b\u7684\u200bHTTP\u200b\u534f\u8bae\u200b\u4ea4\u4e92\u200b\u3002</p> <p>\u200b\u8fd9\u91cc\u200b\u6709\u200b\u4e00\u4e2a\u200b\u5173\u4e8e\u200bQGIS\u200b\u670d\u52a1\u5668\u200bAPI\u200b\u5e94\u7528\u200b\u7684\u200b\u6700\u5c0f\u200b\u4f8b\u5b50\u200b\uff08\u200b\u6ca1\u6709\u200bHTTP\u200b\u90e8\u5206\u200b\uff09\uff1a</p> <pre><code>from qgis.core import QgsApplication\nfrom qgis.server import *\napp = QgsApplication([], False)\n\n# \u200b\u521b\u5efa\u200b\u670d\u52a1\u5668\u200b\u5b9e\u4f8b\u200b\uff0c\u200b\u5b83\u200b\u53ef\u80fd\u200b\u662f\u200b\u4e00\u4e2a\u200b\u5355\u4e00\u200b\u7684\u200b\u5b9e\u4f8b\u200b\uff0c\u200b\u5728\u200b\u591a\u4e2a\u200b\u8bf7\u6c42\u200b\u4e2d\u200b\u91cd\u590d\u4f7f\u7528\u200b\nserver = QgsServer()\n\n# \u200b\u901a\u8fc7\u200b\u6307\u5b9a\u200b\u5b8c\u6574\u200b\u7684\u200bURL\u200b\u548c\u200b\u4e00\u4e2a\u200b\u53ef\u9009\u200b\u7684\u200b\u4e3b\u4f53\u200b\u6765\u200b\u521b\u5efa\u200b\u8bf7\u6c42\u200b\uff08\u200b\u4f8b\u5982\u200bPOST\u200b\u8bf7\u6c42\u200b\uff09\nrequest = QgsBufferServerRequest(\n    'http://localhost:8081/?MAP=/qgis-server/projects/helloworld.qgs' +\n    '&amp;SERVICE=WMS&amp;REQUEST=GetCapabilities')\n\n# \u200b\u521b\u5efa\u200b\u54cd\u5e94\u200b\u5bf9\u8c61\u200b\nresponse = QgsBufferServerResponse()\n\n# \u200b\u5904\u7406\u200b\u8bf7\u6c42\u200b\nserver.handleRequest(request, response)\n\nprint(response.headers())\nprint(response.body().data().decode('utf8'))\n\napp.exitQgis()\n</code></pre> <p>\u200b\u8fd9\u91cc\u200b\u6709\u200b\u4e00\u4e2a\u200b\u5b8c\u6574\u200b\u7684\u200b\u72ec\u7acb\u200b\u5e94\u7528\u200b\u5b9e\u4f8b\u200b\uff0c\u200b\u5b83\u200b\u662f\u200b\u4e3a\u200bQGIS\u200b\u6e90\u4ee3\u7801\u200b\u5e93\u200b\u7684\u200b\u6301\u7eed\u200b\u96c6\u6210\u200b\u6d4b\u8bd5\u200b\u800c\u200b\u5f00\u53d1\u200b\u7684\u200b\uff0c\u200b\u5b83\u200b\u5c55\u793a\u200b\u4e86\u200b\u4e00\u7cfb\u5217\u200b\u4e0d\u540c\u200b\u7684\u200b\u63d2\u4ef6\u200b\u8fc7\u6ee4\u5668\u200b\u548c\u200b\u8ba4\u8bc1\u200b\u65b9\u6848\u200b\uff08\u200b\u4e0d\u200b\u610f\u5473\u7740\u200b\u53ef\u200b\u7528\u4e8e\u200b\u751f\u4ea7\u200b\u73af\u5883\u200b\uff0c\u200b\u56e0\u4e3a\u200b\u5b83\u4eec\u200b\u53ea\u662f\u200b\u4e3a\u200b\u6d4b\u8bd5\u200b\u76ee\u7684\u200b\u800c\u200b\u5f00\u53d1\u200b\u7684\u200b\uff0c\u200b\u4f46\u200b\u5bf9\u4e8e\u200b\u5b66\u4e60\u200b\u6765\u8bf4\u200b\u4ecd\u7136\u200b\u5f88\u200b\u6709\u8da3\u200b\uff09\uff1ahttps://github.com/qgis/QGIS/blob/master/tests/src/python/qgis_wrapped_server.py</p>"},{"location":"20-QGIS%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%92%8CPython/#204","title":"20.4 \u200b\u670d\u52a1\u5668\u200b\u63d2\u4ef6","text":"<p>\u200b\u670d\u52a1\u5668\u200bpython\u200b\u63d2\u4ef6\u200b\u5728\u200bQGIS\u200b\u670d\u52a1\u5668\u5e94\u7528\u7a0b\u5e8f\u200b\u542f\u52a8\u200b\u65f6\u200b\u88ab\u200b\u52a0\u8f7d\u200b\u4e00\u6b21\u200b\uff0c\u200b\u53ef\u200b\u7528\u4e8e\u200b\u6ce8\u518c\u200b\u8fc7\u6ee4\u5668\u200b\u3001\u200b\u670d\u52a1\u200b\u6216\u200bAPI\u3002</p> <p>\u200b\u670d\u52a1\u5668\u200b\u63d2\u4ef6\u200b\u7684\u200b\u7ed3\u6784\u200b\u4e0e\u200b\u684c\u9762\u7248\u200b\u7684\u200b\u63d2\u4ef6\u200b\u975e\u5e38\u200b\u76f8\u4f3c\u200b\uff0c\u200b\u4e00\u4e2a\u200b<code>QgsServerInterface</code>\u200b\u5bf9\u8c61\u200b\u88ab\u200b\u63d0\u4f9b\u200b\u7ed9\u200b\u63d2\u4ef6\u200b\uff0c\u200b\u63d2\u4ef6\u200b\u53ef\u4ee5\u200b\u901a\u8fc7\u200b\u4f7f\u7528\u200b\u670d\u52a1\u5668\u200b\u63a5\u53e3\u200b\u66b4\u9732\u200b\u7684\u200b\u65b9\u6cd5\u200b\u5c06\u200b\u4e00\u4e2a\u200b\u6216\u200b\u591a\u4e2a\u200b\u81ea\u5b9a\u4e49\u200b\u8fc7\u6ee4\u5668\u200b\u3001\u200b\u670d\u52a1\u200b\u6216\u200bAPI\u200b\u6ce8\u518c\u200b\u5230\u200b\u76f8\u5e94\u200b\u7684\u200b\u6ce8\u518c\u8868\u200b\u3002</p>"},{"location":"20-QGIS%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%92%8CPython/#2041","title":"20.4.1 \u200b\u670d\u52a1\u5668\u200b\u8fc7\u6ee4\u200b\u63d2\u4ef6","text":"<p>\u200b\u8fc7\u6ee4\u5668\u200b\u6709\u200b\u4e09\u79cd\u200b\u4e0d\u540c\u200b\u7684\u200b\u7c7b\u578b\u200b\uff0c\u200b\u5b83\u4eec\u200b\u53ef\u4ee5\u200b\u901a\u8fc7\u200b\u5b50\u200b\u7c7b\u5316\u200b\u4e0b\u9762\u200b\u7684\u200b\u4e00\u4e2a\u200b\u7c7b\u200b\u5e76\u200b\u8c03\u7528\u200b<code>QgsServerInterface</code>\u200b\u7684\u200b\u76f8\u5e94\u200b\u65b9\u6cd5\u200b\u6765\u200b\u5b9e\u4f8b\u200b\u5316\u200b\u3002</p> \u200b\u8fc7\u6ee4\u5668\u200b\u7c7b\u578b\u200b \u200b\u57fa\u7c7b\u200b QgsServerInterface \u200b\u6ce8\u518c\u200b I/O <code>QgsServerFilter</code> <code>registerFilter()</code> Access Control <code>QgsAccessControlFilter</code> <code>registerAccessControl()</code> Cache <code>QgsServerCacheFilter</code> <code>registerServerCache()</code>"},{"location":"20-QGIS%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%92%8CPython/#20411-io","title":"20.4.1.1 I/O\u200b\u8fc7\u6ee4\u5668","text":"<p>I/O\u200b\u8fc7\u6ee4\u5668\u200b\u53ef\u4ee5\u200b\u4fee\u6539\u200b\u6838\u5fc3\u200b\u670d\u52a1\u200b\uff08WMS\u3001WFS\u200b\u7b49\u200b\uff09\u200b\u7684\u200b\u670d\u52a1\u5668\u200b\u8f93\u5165\u200b\u548c\u200b\u8f93\u51fa\u200b\uff08\u200b\u8bf7\u6c42\u200b\u548c\u200b\u54cd\u5e94\u200b\uff09\uff0c\u200b\u5141\u8bb8\u200b\u5bf9\u200b\u670d\u52a1\u200b\u5de5\u4f5c\u200b\u6d41\u200b\u8fdb\u884c\u200b\u4efb\u4f55\u200b\u5f62\u5f0f\u200b\u7684\u200b\u64cd\u4f5c\u200b\u3002\u200b\u4f8b\u5982\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u9650\u5236\u200b\u5bf9\u200b\u9009\u5b9a\u200b\u56fe\u5c42\u200b\u7684\u200b\u8bbf\u95ee\u200b\uff0c\u200b\u5411\u200bXML\u200b\u54cd\u5e94\u200b\u6ce8\u5165\u200bXSL\u200b\u6837\u5f0f\u8868\u200b\uff0c\u200b\u5411\u200b\u751f\u6210\u200b\u7684\u200bWMS\u200b\u56fe\u50cf\u200b\u6dfb\u52a0\u200b\u6c34\u5370\u200b\u7b49\u7b49\u200b\u3002</p> <p>\u200b\u4ece\u8fd9\u4e00\u70b9\u200b\u6765\u770b\u200b\uff0c\u200b\u4f60\u200b\u53ef\u80fd\u200b\u4f1a\u200b\u53d1\u73b0\u200b\u5feb\u901f\u200b\u6d4f\u89c8\u200b\u4e00\u4e0b\u200b\u670d\u52a1\u5668\u200b\u63d2\u4ef6\u200b\u7684\u200bAPI\u200b\u6587\u6863\u200b\u5f88\u200b\u6709\u7528\u200b\u3002</p> <p>\u200b\u6bcf\u200b\u4e00\u4e2a\u200b\u63d2\u4ef6\u200b\u5e94\u8be5\u200b\u81f3\u5c11\u200b\u5b9e\u73b0\u200b\u4ee5\u4e0b\u200b\u4e09\u4e2a\u200b\u56de\u8c03\u200b\u51fd\u6570\u200b\uff1a</p> <ul> <li><code>onRequestReady()</code></li> <li><code>onResponseComplete()</code></li> <li><code>onSendResponse()</code></li> </ul> <p>\u200b\u6240\u6709\u200b\u7684\u200b\u8fc7\u6ee4\u5668\u200b\u90fd\u200b\u53ef\u4ee5\u200b\u8bbf\u95ee\u200b\u8bf7\u6c42\u200b/\u200b\u54cd\u5e94\u200b\u5bf9\u8c61\u200b\uff08<code>QgsRequestHandler</code>\uff09\uff0c\u200b\u5e76\u4e14\u200b\u53ef\u4ee5\u200b\u64cd\u4f5c\u200b\u5b83\u200b\u7684\u200b\u6240\u6709\u200b\u5c5e\u6027\u200b\uff08\u200b\u8f93\u5165\u200b/\u200b\u8f93\u51fa\u200b\uff09\u200b\u548c\u200b\u5f15\u53d1\u200b\u5f02\u5e38\u200b\uff08\u200b\u540c\u65f6\u200b\u4ee5\u200b\u4e00\u79cd\u200b\u76f8\u5f53\u200b\u7279\u522b\u200b\u7684\u200b\u65b9\u5f0f\u200b\uff0c\u200b\u6211\u4eec\u200b\u5c06\u200b\u5728\u200b\u4e0b\u9762\u200b\u770b\u5230\u200b\uff09\u3002</p> <p>\u200b\u6240\u6709\u200b\u8fd9\u4e9b\u200b\u65b9\u6cd5\u200b\u90fd\u200b\u8fd4\u56de\u200b\u4e00\u4e2a\u200b\u5e03\u5c14\u503c\u200b\uff0c\u200b\u6307\u793a\u200b\u8c03\u7528\u200b\u662f\u5426\u200b\u5e94\u200b\u4f20\u64ad\u200b\u5230\u200b\u540e\u7eed\u200b\u8fc7\u6ee4\u5668\u200b\u3002\u200b\u5982\u679c\u200b\u5176\u4e2d\u200b\u4e00\u4e2a\u200b\u65b9\u6cd5\u200b\u8fd4\u56de\u200bFalse\uff0c\u200b\u5219\u200b\u4f20\u64ad\u200b\u94fe\u200b\u505c\u6b62\u200b\uff0c\u200b\u5426\u5219\u200b\u8c03\u7528\u200b\u5c06\u200b\u4f20\u64ad\u200b\u5230\u200b\u4e0b\u200b\u4e00\u4e2a\u200b\u8fc7\u6ee4\u5668\u200b\u3002</p> <p>\u200b\u4e0b\u9762\u200b\u662f\u200b\u663e\u793a\u200b\u670d\u52a1\u5668\u200b\u5982\u4f55\u200b\u5904\u7406\u200b\u4e00\u4e2a\u200b\u5178\u578b\u200b\u8bf7\u6c42\u200b\u4ee5\u53ca\u200b\u4f55\u65f6\u200b\u8c03\u7528\u200b\u8fc7\u6ee4\u5668\u200b\u56de\u8c03\u200b\u51fd\u6570\u200b\u7684\u200b\u4f2a\u200b\u4ee3\u7801\u200b\u3002</p> <pre><code>for each incoming request:\n    create GET/POST request handler\n    pass request to an instance of QgsServerInterface\n    call onRequestReady filters\n\n    if there is not a response:\n        if SERVICE is WMS/WFS/WCS:\n            create WMS/WFS/WCS service\n            call service\u2019s executeRequest\n                possibly call onSendResponse for each chunk of bytes\n                sent to the client by a streaming services (WFS)\n        call onResponseComplete\n    request handler sends the response to the client\n</code></pre> <p>\u200b\u4e0b\u9762\u200b\u51e0\u4e2a\u200b\u6bb5\u843d\u200b\u8be6\u7ec6\u63cf\u8ff0\u200b\u4e86\u200b\u53ef\u7528\u200b\u7684\u200b\u56de\u8c03\u200b\u51fd\u6570\u200b\u3002</p>"},{"location":"20-QGIS%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%92%8CPython/#204111","title":"20.4.1.1.1 \u200b\u8bf7\u6c42\u200b\u5c31\u7eea","text":"<p>\u200b\u5f53\u200b\u8bf7\u6c42\u200b\u51c6\u5907\u5c31\u7eea\u200b\u65f6\u200b\uff0c\u200b\u5c06\u200b\u88ab\u200b\u8c03\u7528\u200b\uff1a\u200b\u4f20\u5165\u200b\u7684\u200bURL\u200b\u548c\u200b\u6570\u636e\u200b\u5df2\u7ecf\u200b\u88ab\u200b\u89e3\u6790\u200b\uff0c\u200b\u5728\u200b\u8fdb\u5165\u200b\u6838\u5fc3\u200b\u670d\u52a1\u200b\uff08WMS\uff0cWFS\u200b\u7b49\u200b\uff09\u200b\u5f00\u5173\u200b\u4e4b\u524d\u200b\uff0c\u200b\u8fd9\u200b\u662f\u200b\u4f60\u200b\u53ef\u4ee5\u200b\u64cd\u4f5c\u200b\u8f93\u5165\u200b\u548c\u200b\u6267\u884c\u200b\u52a8\u4f5c\u200b\u7684\u200b\u5730\u65b9\u200b\uff1a</p> <ul> <li>\u200b\u8ba4\u8bc1\u200b\u6388\u6743\u200b</li> <li>\u200b\u91cd\u5b9a\u5411\u200b</li> <li>\u200b\u6dfb\u52a0\u200b\u5220\u9664\u200b\u67d0\u4e9b\u200b\u53c2\u6570\u200b (\u200b\u4f8b\u5982\u200b\u7c7b\u578b\u200b\u540d\u79f0\u200b)</li> <li>\u200b\u629b\u51fa\u200b\u5f02\u5e38\u200b</li> </ul> <p>\u200b\u4f60\u200b\u751a\u81f3\u200b\u53ef\u4ee5\u200b\u901a\u8fc7\u200b\u6539\u53d8\u200b SERVICE \u200b\u53c2\u6570\u200b\u6765\u200b\u5b8c\u5168\u200b\u66ff\u4ee3\u200b\u4e00\u4e2a\u200b\u6838\u5fc3\u200b\u670d\u52a1\u200b\uff0c\u200b\u4ece\u800c\u200b\u5b8c\u5168\u200b\u7ed5\u8fc7\u200b\u6838\u5fc3\u200b\u670d\u52a1\u200b\uff08\u200b\u4e0d\u8fc7\u200b\u8fd9\u200b\u5e76\u200b\u6ca1\u6709\u200b\u4ec0\u4e48\u200b\u610f\u4e49\u200b\uff09\u3002</p>"},{"location":"20-QGIS%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%92%8CPython/#204112","title":"20.4.1.1.2 \u200b\u53d1\u9001\u200b\u54cd\u5e94","text":"<p>\u200b\u65e0\u8bba\u200b\u4f55\u65f6\u200b\u4ece\u200b\u54cd\u5e94\u200b\u7f13\u51b2\u533a\u200b\u5237\u65b0\u200b\u4efb\u4f55\u200b\u90e8\u5206\u200b\u8f93\u51fa\u200b\uff0c\u200b\u90fd\u200b\u4f1a\u200b\u8c03\u7528\u200b\u8be5\u200b\u51fd\u6570\u200b\uff08\u200b\u4f8b\u5982\u200b FCGI \u200b\u6807\u51c6\u200b\u8f93\u51fa\u200b\u88ab\u200b\u4f7f\u7528\u200b\uff09\uff0c\u200b\u5e76\u200b\u4ece\u200b\u7f13\u51b2\u533a\u200b\u5237\u65b0\u200b\u5230\u200b\u5ba2\u6237\u7aef\u200b\u3002\u200b\u5f53\u200b\u5927\u91cf\u200b\u5185\u5bb9\u200b\u88ab\u200b\u6d41\u5f0f\u200b\u4f20\u8f93\u200b\uff08\u200b\u6bd4\u5982\u200bWFS GetFeature\uff09\u200b\u65f6\u200b\uff0c\u200b\u5c31\u200b\u4f1a\u200b\u53d1\u751f\u200b\u8fd9\u79cd\u200b\u60c5\u51b5\u200b\u3002\u200b\u5728\u200b\u8fd9\u79cd\u200b\u60c5\u51b5\u200b\u4e0b\u200b\uff0c<code>onSendResponse()</code>\u200b\u53ef\u80fd\u200b\u4f1a\u200b\u88ab\u200b\u591a\u6b21\u200b\u8c03\u7528\u200b\u3002</p> <p>\u200b\u8bf7\u200b\u6ce8\u610f\u200b\uff0c\u200b\u5982\u679c\u200b\u54cd\u5e94\u200b\u6ca1\u6709\u200b\u6d41\u5f0f\u200b\u4f20\u8f93\u200b\uff0c\u200b\u5219\u200b\u6839\u672c\u200b\u4e0d\u4f1a\u200b\u8c03\u7528\u200b<code>onSendResponse()</code>\u3002</p> <p>\u200b\u5728\u200b\u6240\u6709\u200b\u60c5\u51b5\u200b\u4e0b\u200b\uff0c\u200b\u8c03\u7528\u200b<code>onResponseComplete()</code>\u200b\u540e\u200b\uff0c\u200b\u6700\u540e\u200b\u4e00\u4e2a\u200b\uff08\u200b\u6216\u200b\u552f\u4e00\u200b\u7684\u200b\uff09\u200b\u5757\u200b\u5c06\u200b\u88ab\u200b\u53d1\u9001\u5230\u200b\u5ba2\u6237\u7aef\u200b\u3002</p> <p>\u200b\u8fd4\u56de\u200b<code>False</code>\u200b\u5c06\u200b\u9632\u6b62\u200b\u5411\u200b\u5ba2\u6237\u7aef\u200b\u5237\u65b0\u200b\u6570\u636e\u200b\u3002\u200b\u5f53\u200b\u63d2\u4ef6\u200b\u5e0c\u671b\u200b\u4ece\u200b\u54cd\u5e94\u200b\u4e2d\u200b\u6536\u96c6\u200b\u6240\u6709\u200b\u5757\u200b\uff0c\u200b\u5e76\u200b\u5728\u200b<code>onResponseComplete()</code>\u200b\u4e2d\u200b\u68c0\u67e5\u200b\u6216\u200b\u66f4\u6539\u200b\u54cd\u5e94\u200b\u65f6\u200b\uff0c\u200b\u8fd9\u662f\u200b\u53ef\u53d6\u200b\u7684\u200b\u3002</p>"},{"location":"20-QGIS%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%92%8CPython/#204113","title":"20.4.1.1.3 \u200b\u54cd\u5e94\u200b\u5b8c\u6210","text":"<p>\u200b\u5f53\u200b\u6838\u5fc3\u200b\u670d\u52a1\u200b\uff08\u200b\u5982\u679c\u200b\u88ab\u200b\u51fb\u4e2d\u200b\u7684\u8bdd\u200b\uff09\u200b\u5b8c\u6210\u200b\u5b83\u4eec\u200b\u7684\u200b\u8fc7\u7a0b\u200b\uff0c\u200b\u5e76\u4e14\u200b\u8bf7\u6c42\u200b\u51c6\u5907\u200b\u597d\u200b\u88ab\u200b\u53d1\u9001\u5230\u200b\u5ba2\u6237\u7aef\u200b\u65f6\u200b\uff0c\u200b\u5c06\u200b\u88ab\u200b\u8c03\u7528\u200b\u4e00\u6b21\u200b\u3002\u200b\u5982\u4e0a\u6240\u8ff0\u200b\uff0c\u200b\u901a\u5e38\u200b\u5728\u200b<code>onSendResponse()</code>\u200b\u4e4b\u524d\u200b\u8c03\u7528\u200b\uff0c\u200b\u9664\u4e86\u200b\u6d41\u5a92\u4f53\u200b\u670d\u52a1\u200b\uff08\u200b\u6216\u200b\u5176\u4ed6\u200b\u63d2\u4ef6\u200b\u8fc7\u6ee4\u5668\u200b\uff09\u200b\u53ef\u80fd\u200b\u5728\u200b\u4e4b\u524d\u200b\u8c03\u7528\u200b<code>sendResponse()</code>\u3002</p> <p><code>onResponseComplete()</code>\u200b\u662f\u200b\u63d0\u4f9b\u200b\u65b0\u200b\u670d\u52a1\u200b\u5b9e\u73b0\u200b\uff08WPS\u200b\u6216\u200b\u81ea\u5b9a\u4e49\u200b\u670d\u52a1\u200b\uff09\u200b\u548c\u200b\u5bf9\u200b\u6765\u81ea\u200b\u6838\u5fc3\u200b\u670d\u52a1\u200b\u7684\u200b\u8f93\u51fa\u200b\u8fdb\u884c\u200b\u76f4\u63a5\u200b\u64cd\u4f5c\u200b\u7684\u200b\u7406\u60f3\u200b\u573a\u6240\u200b\uff08\u200b\u4f8b\u5982\u200b\uff0c\u200b\u5728\u200bWMS\u200b\u56fe\u50cf\u200b\u4e0a\u200b\u6dfb\u52a0\u200b\u6c34\u5370\u200b\uff09\u3002</p> <p>\u200b\u8bf7\u200b\u6ce8\u610f\u200b\uff0c\u200b\u8fd4\u56de\u200b<code>False</code>\u200b\u5c06\u200b\u963b\u6b62\u200b\u4e0b\u200b\u4e00\u4e2a\u200b\u63d2\u4ef6\u200b\u6267\u884c\u200b<code>onResponseComplete()</code>\uff0c\u200b\u4f46\u200b\u5728\u200b\u4efb\u4f55\u200b\u60c5\u51b5\u200b\u4e0b\u200b\uff0c\u200b\u90fd\u200b\u4f1a\u200b\u963b\u6b62\u200b\u5c06\u200b\u54cd\u5e94\u200b\u53d1\u9001\u5230\u200b\u5ba2\u6237\u7aef\u200b\u3002</p>"},{"location":"20-QGIS%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%92%8CPython/#20412","title":"20.4.1.2 \u200b\u4ece\u200b\u63d2\u4ef6\u200b\u5f15\u53d1\u200b\u5f02\u5e38","text":"<p>\u200b\u5728\u200b\u8fd9\u4e2a\u200b\u95ee\u9898\u200b\u4e0a\u200b\u8fd8\u6709\u200b\u4e00\u4e9b\u200b\u5de5\u4f5c\u200b\u8981\u200b\u505a\u200b\uff1a\u200b\u76ee\u524d\u200b\u7684\u200b\u5b9e\u73b0\u200b\u53ef\u4ee5\u200b\u901a\u8fc7\u200b\u5c06\u200b<code>QgsRequestHandler</code>\u200b\u5c5e\u6027\u200b\u8bbe\u7f6e\u200b\u4e3a\u200bQgsMapServiceException\u200b\u7684\u200b\u4e00\u4e2a\u200b\u5b9e\u4f8b\u200b\u6765\u200b\u533a\u5206\u200b\u5df2\u200b\u5904\u7406\u200b\u548c\u200b\u672a\u200b\u5904\u7406\u200b\u7684\u200b\u5f02\u5e38\u200b\uff0c\u200b\u8fd9\u6837\u200b\uff0c\u200b\u4e3b\u8981\u200b\u7684\u200bC++\u200b\u4ee3\u7801\u200b\u53ef\u4ee5\u200b\u6355\u83b7\u200b\u5df2\u200b\u5904\u7406\u200b\u7684\u200bPython\u200b\u5f02\u5e38\u200b\u800c\u200b\u5ffd\u7565\u200b\u672a\u200b\u5904\u7406\u200b\u7684\u200b\u5f02\u5e38\u200b\uff08\u200b\u6216\u8005\u200b\u66f4\u597d\u200b\u7684\u200b\u662f\u200b\uff1a\u200b\u8bb0\u5f55\u200b\u65e5\u5fd7\u200b\uff09\u3002</p> <p>\u200b\u8fd9\u79cd\u200b\u65b9\u6cd5\u200b\u57fa\u672c\u4e0a\u200b\u662f\u200b\u53ef\u884c\u200b\u7684\u200b\uff0c\u200b\u4f46\u200b\u5b83\u200b\u4e0d\u662f\u200b\u5f88\u200b \"pythonic\"\uff1a\u200b\u4e00\u4e2a\u200b\u66f4\u597d\u200b\u7684\u200b\u65b9\u6cd5\u200b\u662f\u200b\u5728\u200bpython\u200b\u4ee3\u7801\u200b\u4e2d\u200b\u5f15\u53d1\u200b\u5f02\u5e38\u200b\uff0c\u200b\u5e76\u200b\u770b\u5230\u200b\u5b83\u4eec\u200b\u8fdb\u5165\u200b\u5230\u200bC++\u200b\u5faa\u73af\u200b\u4e2d\u200b\u88ab\u200b\u5904\u7406\u200b\u3002</p>"},{"location":"20-QGIS%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%92%8CPython/#20413","title":"20.4.1.3 \u200b\u7f16\u5199\u200b\u4e00\u4e2a\u200b\u670d\u52a1\u5668\u200b\u63d2\u4ef6","text":"<p>\u200b\u670d\u52a1\u5668\u200b\u63d2\u4ef6\u200b\u662f\u200b\u4e00\u4e2a\u200b\u6807\u51c6\u200b\u7684\u200b QGIS Python \u200b\u63d2\u4ef6\u200b\uff0c\u200b\u5982\u200b16-\u200b\u5f00\u53d1\u200bPython\u200b\u63d2\u4ef6\u200b\u4e2d\u200b\u6240\u8ff0\u200b\uff0c\u200b\u5b83\u200b\u53ea\u662f\u200b\u63d0\u4f9b\u200b\u4e86\u200b\u4e00\u4e2a\u200b\u989d\u5916\u200b\u7684\u200b\uff08\u200b\u6216\u200b\u66ff\u4ee3\u200b\u7684\u200b\uff09\u200b\u63a5\u53e3\u200b\uff1a\u200b\u5178\u578b\u200b\u7684\u200b QGIS \u200b\u684c\u9762\u200b\u63d2\u4ef6\u200b\u901a\u8fc7\u200b <code>QgisInterface</code>\u200b\u5b9e\u4f8b\u200b\u8bbf\u95ee\u200b QGIS \u200b\u5e94\u7528\u7a0b\u5e8f\u200b\uff0c\u200b\u800c\u200b\u670d\u52a1\u5668\u200b\u63d2\u4ef6\u200b\u53ea\u6709\u200b\u5728\u200b QGIS Server \u200b\u5e94\u7528\u7a0b\u5e8f\u200b\u4e0a\u4e0b\u6587\u200b\u4e2d\u200b\u6267\u884c\u200b\u65f6\u200b\u624d\u80fd\u200b\u8bbf\u95ee\u200b\u3002</p> <p>\u200b\u4e3a\u4e86\u200b\u8ba9\u200bQGIS Server\u200b\u77e5\u9053\u200b\u4e00\u4e2a\u200b\u63d2\u4ef6\u200b\u6709\u200b\u4e00\u4e2a\u200b\u670d\u52a1\u5668\u200b\u63a5\u53e3\u200b\uff0c\u200b\u9700\u8981\u200b\u4e00\u4e2a\u200b\u7279\u6b8a\u200b\u7684\u200b\u5143\u200b\u6570\u636e\u200b\u6761\u76ee\u200b\uff08\u200b\u5728\u200b<code>metadata.txt</code>\u200b\u4e2d\u200b\uff09\u3002</p> <pre><code>server=True\n</code></pre> <p>\u200b\u91cd\u8981\u200b\u7684\u200b</p> <p>\u200b\u53ea\u6709\u200b\u8bbe\u7f6e\u200b\u4e86\u200b<code>server=True</code>\u200b\u5143\u200b\u6570\u636e\u200b\u7684\u200b\u63d2\u4ef6\u200b\u624d\u80fd\u200b\u88ab\u200bQGIS Server\u200b\u52a0\u8f7d\u200b\u548c\u200b\u6267\u884c\u200b\u3002</p> <p>\u200b\u8fd9\u91cc\u200b\u8ba8\u8bba\u200b\u7684\u200b qgis3-server-vagrant \u200b\u793a\u4f8b\u200b\u63d2\u4ef6\u200b\uff08\u200b\u4ee5\u53ca\u200b\u66f4\u200b\u591a\u200b\u63d2\u4ef6\u200b\uff09\u200b\u53ef\u200b\u5728\u200b Github \u200b\u4e0a\u200b\u627e\u5230\u200b\uff0c\u200b\u4e00\u4e9b\u200b\u670d\u52a1\u5668\u200b\u63d2\u4ef6\u200b\u4e5f\u200b\u53d1\u5e03\u200b\u5728\u200b\u5b98\u65b9\u200b\u7684\u200b QGIS \u200b\u63d2\u4ef6\u200b\u4ed3\u5e93\u200b\u4e2d\u200b\u3002</p>"},{"location":"20-QGIS%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%92%8CPython/#20414","title":"20.4.1.4 \u200b\u63d2\u4ef6\u200b\u6587\u4ef6","text":"<p>\u200b\u4e0b\u9762\u200b\u662f\u200b\u6211\u4eec\u200b\u7684\u200b\u793a\u4f8b\u200b\u670d\u52a1\u5668\u200b\u63d2\u4ef6\u200b\u7684\u200b\u76ee\u5f55\u200b\u7ed3\u6784\u200b\u3002</p> <pre><code>PYTHON_PLUGINS_PATH/\n  HelloServer/\n    __init__.py    --&gt; *required*\n    HelloServer.py  --&gt; *required*\n    metadata.txt   --&gt; *required*\n</code></pre>"},{"location":"20-QGIS%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%92%8CPython/#204141-__init__py","title":"20.4.1.4.1 __init__.py","text":"<p>\u200b\u8fd9\u4e2a\u200b\u6587\u4ef6\u200b\u662f\u200bPython\u200b\u7684\u200b\u5bfc\u5165\u200b\u7cfb\u7edf\u200b\u6240\u200b\u8981\u6c42\u200b\u7684\u200b\u3002\u200b\u6b64\u5916\u200b\uff0cQGIS Server\u200b\u8981\u6c42\u200b\u8be5\u200b\u6587\u4ef6\u200b\u5305\u542b\u200b\u4e00\u4e2a\u200b<code>serverClassFactory()</code>\u200b\u51fd\u6570\u200b\uff0c\u200b\u5f53\u200b\u670d\u52a1\u5668\u200b\u542f\u52a8\u200b\u65f6\u200b\uff0c\u200b\u63d2\u4ef6\u200b\u88ab\u200b\u52a0\u8f7d\u200b\u5230\u200bQGIS Server\u200b\u4e2d\u200b\u65f6\u200b\uff0c\u200b\u8be5\u200b\u51fd\u6570\u200b\u5c06\u200b\u88ab\u200b\u8c03\u7528\u200b\u3002\u200b\u5b83\u200b\u63a5\u6536\u200b\u5bf9\u200b<code>QgsServerInterface</code>\u200b\u5b9e\u4f8b\u200b\u7684\u200b\u5f15\u7528\u200b\uff0c\u200b\u5e76\u200b\u5fc5\u987b\u200b\u8fd4\u56de\u200b\u4f60\u200b\u7684\u200b\u63d2\u4ef6\u200b\u7c7b\u200b\u7684\u200b\u5b9e\u4f8b\u200b\u3002\u200b\u4ee5\u4e0b\u200b\u662f\u200b\u63d2\u4ef6\u200b\u793a\u4f8b\u200b <code>__init__.py</code>\u200b\u7684\u200b\u6837\u5b50\u200b\uff1a</p> <pre><code>def serverClassFactory(serverIface):\n    from .HelloServer import HelloServerServer\n    return HelloServerServer(serverIface)\n</code></pre>"},{"location":"20-QGIS%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%92%8CPython/#204142-helloserverpy","title":"20.4.1.4.2  HelloServer.py","text":"<p>\u200b\u8fd9\u200b\u5c31\u662f\u200b\u9b54\u6cd5\u200b\u53d1\u751f\u200b\u7684\u200b\u5730\u65b9\u200b\uff0c\u200b\u8fd9\u200b\u5c31\u662f\u200b\u9b54\u6cd5\u200b\u7684\u200b\u6a21\u6837\u200b\u3002(\u200b\u4f8b\u5982\u200b\uff1a<code>HelloServer.py</code>)</p> <p>\u200b\u4e00\u4e2a\u200b\u670d\u52a1\u5668\u200b\u63d2\u4ef6\u200b\u901a\u5e38\u200b\u7531\u200b\u4e00\u4e2a\u200b\u6216\u200b\u591a\u4e2a\u200b\u56de\u8c03\u200b\u51fd\u6570\u200b\u7ec4\u6210\u200b\uff0c\u200b\u88ab\u200b\u6253\u5305\u200b\u5230\u200b<code>QgsServerFilter</code>\u200b\u7684\u200b\u5b9e\u4f8b\u200b\u4e2d\u200b\u3002</p> <p>\u200b\u6bcf\u4e2a\u200b<code>QgsServerFilter</code>\u200b\u90fd\u200b\u5b9e\u73b0\u200b\u4e86\u200b\u4e00\u4e2a\u200b\u6216\u200b\u591a\u4e2a\u200b\u4ee5\u4e0b\u200b\u7684\u200b\u56de\u8c03\u200b\u51fd\u6570\u200b\uff1a</p> <ul> <li><code>onRequestReady()</code></li> <li><code>onResponseComplete()</code></li> <li><code>onSendResponse()</code></li> </ul> <p>\u200b\u4e0b\u9762\u200b\u7684\u200b\u4f8b\u5b50\u200b\u5b9e\u73b0\u200b\u4e86\u200b\u4e00\u4e2a\u200b\u6700\u5c0f\u200b\u7684\u200b\u8fc7\u6ee4\u5668\u200b\uff0c\u200b\u5f53\u200b SERVICE \u200b\u53c2\u6570\u200b\u7b49\u4e8e\u200b \" HELLO \"\u200b\u65f6\u200b\uff0c\u200b\u6253\u5370\u200b\u51fa\u200bHelloServer!</p> <pre><code>class HelloFilter(QgsServerFilter):\n\n    def __init__(self, serverIface):\n        super().__init__(serverIface)\n\n    def onRequestReady(self) -&gt; bool:\n        QgsMessageLog.logMessage(\"HelloFilter.onRequestReady\")\n        return True\n\n    def onSendResponse(self) -&gt; bool:\n        QgsMessageLog.logMessage(\"HelloFilter.onSendResponse\")\n        return True\n\n    def onResponseComplete(self) -&gt; bool:\n        QgsMessageLog.logMessage(\"HelloFilter.onResponseComplete\")\n        request = self.serverInterface().requestHandler()\n        params = request.parameterMap()\n        if params.get('SERVICE', '').upper() == 'HELLO':\n            request.clear()\n            request.setResponseHeader('Content-type', 'text/plain')\n            # \u200b\u6ce8\u610f\u200b\u5185\u5bb9\u200b\u7c7b\u578b\u200b\u662f\u200b\"bytes\"\n            request.appendBody(b'HelloServer!')\n        return True\n</code></pre> <p>\u200b\u8fc7\u6ee4\u5668\u200b\u5fc5\u987b\u200b\u88ab\u200b\u6ce8\u518c\u200b\u5230\u200b serverIface \u200b\u4e2d\u200b\uff0c\u200b\u5982\u4e0b\u200b\u4f8b\u200b\u6240\u793a\u200b\uff1a</p> <pre><code>class HelloServerServer:\n    def __init__(self, serverIface):\n        serverIface.registerFilter(HelloFilter(serverIface), 100)\n</code></pre> <p><code>registerFilter()</code>\u200b\u7684\u200b\u7b2c\u4e8c\u4e2a\u200b\u53c2\u6570\u8bbe\u7f6e\u200b\u4e86\u200b\u4e00\u4e2a\u200b\u4f18\u5148\u7ea7\u200b\uff0c\u200b\u5b9a\u4e49\u200b\u4e86\u200b\u540c\u540d\u200b\u56de\u8c03\u200b\u51fd\u6570\u200b\u7684\u200b\u987a\u5e8f\u200b\uff08\u200b\u4f18\u5148\u7ea7\u200b\u4f4e\u200b\u7684\u200b\u56de\u8c03\u200b\u5148\u200b\u88ab\u200b\u8c03\u7528\u200b\uff09\u3002</p> <p>\u200b\u901a\u8fc7\u200b\u4f7f\u7528\u200b\u8fd9\u200b\u4e09\u4e2a\u200b\u56de\u8c03\u200b\u51fd\u6570\u200b\uff0c\u200b\u63d2\u4ef6\u200b\u53ef\u4ee5\u200b\u4ee5\u200b\u8bb8\u591a\u200b\u4e0d\u540c\u200b\u7684\u200b\u65b9\u5f0f\u200b\u64cd\u7eb5\u200b\u670d\u52a1\u5668\u200b\u7684\u200b\u8f93\u5165\u8f93\u51fa\u200b\u3002\u200b\u5728\u200b\u6bcf\u4e2a\u200b\u65f6\u523b\u200b\uff0c\u200b\u63d2\u4ef6\u200b\u5b9e\u4f8b\u200b\u90fd\u200b\u53ef\u4ee5\u200b\u901a\u8fc7\u200b<code>QgsServerInterface</code>\u200b\u8bbf\u95ee\u200b<code>QgsRequestHandler</code>\u3002<code>QgsRequestHandler</code>\u200b\u7c7b\u6709\u200b\u5f88\u591a\u200b\u65b9\u6cd5\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u7528\u6765\u200b\u5728\u200b\u8fdb\u5165\u200b\u670d\u52a1\u5668\u200b\u7684\u200b\u6838\u5fc3\u200b\u5904\u7406\u200b\u4e4b\u524d\u200b\uff08\u200b\u901a\u8fc7\u200b\u4f7f\u7528\u200b<code>requestReady()</code>\uff09\u200b\u6216\u200b\u5728\u200b\u8bf7\u6c42\u200b\u88ab\u200b\u6838\u5fc3\u200b\u670d\u52a1\u200b\u5904\u7406\u200b\u4e4b\u540e\u200b\uff08\u200b\u901a\u8fc7\u200b\u4f7f\u7528\u200b<code>sendResponse()</code>\uff09\u200b\u6539\u53d8\u200b\u8f93\u5165\u200b\u53c2\u6570\u200b\u3002</p> <p>\u200b\u4e0b\u9762\u200b\u7684\u200b\u4f8b\u5b50\u200b\u6db5\u76d6\u200b\u4e86\u200b\u4e00\u4e9b\u200b\u5e38\u89c1\u200b\u7684\u200b\u4f7f\u7528\u200b\u6848\u4f8b\u200b\u3002</p>"},{"location":"20-QGIS%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%92%8CPython/#204143","title":"20.4.1.4.3  \u200b\u4fee\u6539\u200b\u8f93\u5165","text":"<p>\u200b\u793a\u4f8b\u200b\u63d2\u4ef6\u200b\u5305\u542b\u200b\u4e00\u4e2a\u200b\u6539\u53d8\u200b\u6765\u81ea\u200b\u67e5\u8be2\u200b\u5b57\u7b26\u4e32\u200b\u7684\u200b\u8f93\u5165\u200b\u53c2\u6570\u200b\u7684\u200b\u6d4b\u8bd5\u200b\u4f8b\u5b50\u200b\uff0c\u200b\u5728\u200b\u8fd9\u4e2a\u200b\u4f8b\u5b50\u200b\u4e2d\u200b\uff0c\u200b\u4e00\u4e2a\u200b\u65b0\u200b\u7684\u200b\u53c2\u6570\u200b\u88ab\u200b\u6ce8\u5165\u200b\u5230\u200b\uff08\u200b\u5df2\u7ecf\u200b\u89e3\u6790\u200b\u8fc7\u200b\u7684\u200b\uff09<code>parameterMap</code>\u200b\u4e2d\u200b\uff0c\u200b\u7136\u540e\u200b\u8fd9\u4e2a\u200b\u53c2\u6570\u200b\u88ab\u200b\u6838\u5fc3\u200b\u670d\u52a1\u200b\uff08WMS\u200b\u7b49\u200b\uff09\u200b\u770b\u5230\u200b\uff0c\u200b\u5728\u200b\u6838\u5fc3\u200b\u670d\u52a1\u200b\u5904\u7406\u200b\u7ed3\u675f\u200b\u65f6\u200b\uff0c\u200b\u6211\u4eec\u200b\u68c0\u67e5\u200b\u8fd9\u4e2a\u200b\u53c2\u6570\u200b\u662f\u5426\u200b\u4ecd\u7136\u200b\u5b58\u5728\u200b\uff1a</p> <pre><code>class ParamsFilter(QgsServerFilter):\n\n    def __init__(self, serverIface):\n        super(ParamsFilter, self).__init__(serverIface)\n\n    def onRequestReady(self) -&gt; bool:\n        request = self.serverInterface().requestHandler()\n        params = request.parameterMap( )\n        request.setParameter('TEST_NEW_PARAM', 'ParamsFilter')\n        return True\n\n    def onResponseComplete(self) -&gt; bool:\n        request = self.serverInterface().requestHandler()\n        params = request.parameterMap( )\n        if params.get('TEST_NEW_PARAM') == 'ParamsFilter':\n            QgsMessageLog.logMessage(\"SUCCESS - ParamsFilter.onResponseComplete\")\n        else:\n            QgsMessageLog.logMessage(\"FAIL    - ParamsFilter.onResponseComplete\")\n        return True\n</code></pre> <p>\u200b\u8fd9\u662f\u200b\u65e5\u5fd7\u200b\u6587\u4ef6\u200b\u4e2d\u200b\u5185\u5bb9\u200b\u7684\u200b\u6458\u5f55\u200b\uff1a</p> <pre><code>src/core/qgsmessagelog.cpp: 45: (logMessage) [0ms] 2014-12-12T12:39:29 plugin[0] HelloServerServer - loading filter ParamsFilter\n src/core/qgsmessagelog.cpp: 45: (logMessage) [1ms] 2014-12-12T12:39:29 Server[0] Server plugin HelloServer loaded!\n src/core/qgsmessagelog.cpp: 45: (logMessage) [0ms] 2014-12-12T12:39:29 Server[0] Server python plugins loaded\n src/mapserver/qgshttprequesthandler.cpp: 547: (requestStringToParameterMap) [1ms] inserting pair SERVICE // HELLO into the parameter map\n src/mapserver/qgsserverfilter.cpp: 42: (onRequestReady) [0ms] QgsServerFilter plugin default onRequestReady called\n src/core/qgsmessagelog.cpp: 45: (logMessage) [0ms] 2014-12-12T12:39:29 plugin[0] SUCCESS - ParamsFilter.onResponseComplete\n</code></pre> <p>\u200b\u5728\u200b\u7a81\u51fa\u200b\u663e\u793a\u200b\u7684\u200b\u4e00\u884c\u200b\uff0c\"SUCCESS \"\u200b\u5b57\u7b26\u4e32\u200b\u8868\u793a\u200b\u8be5\u200b\u63d2\u4ef6\u200b\u901a\u8fc7\u200b\u4e86\u200b\u6d4b\u8bd5\u200b\u3002</p> <p>\u200b\u540c\u6837\u200b\u7684\u200b\u6280\u672f\u200b\u53ef\u4ee5\u200b\u88ab\u200b\u5229\u7528\u200b\u6765\u200b\u4ee3\u66ff\u200b\u6838\u5fc3\u200b\u670d\u52a1\u200b\uff1a\u200b\u4f8b\u5982\u200b\uff0c\u200b\u4f60\u200b\u53ef\u4ee5\u200b\u8df3\u8fc7\u200b WFS SERVICE \u200b\u8bf7\u6c42\u200b\u6216\u200b\u4efb\u4f55\u200b\u5176\u4ed6\u200b\u6838\u5fc3\u200b\u8bf7\u6c42\u200b\uff0c\u200b\u53ea\u200b\u9700\u200b\u5c06\u200b SERVICE \u200b\u53c2\u6570\u200b\u6539\u4e3a\u200b\u4e0d\u540c\u200b\u7684\u200b\u53c2\u6570\u200b\uff0c\u200b\u6838\u5fc3\u200b\u670d\u52a1\u200b\u5c31\u200b\u4f1a\u200b\u88ab\u200b\u8df3\u200b\u8fc7\u200b\u3002\u200b\u7136\u540e\u200b\uff0c\u200b\u4f60\u200b\u53ef\u4ee5\u200b\u5c06\u200b\u4f60\u200b\u7684\u200b\u81ea\u5b9a\u4e49\u200b\u7ed3\u679c\u200b\u6ce8\u5165\u200b\u5230\u200b\u8f93\u51fa\u200b\u4e2d\u200b\uff0c\u200b\u5e76\u200b\u5c06\u200b\u5176\u200b\u53d1\u9001\u7ed9\u200b\u5ba2\u6237\u7aef\u200b\uff08\u200b\u8fd9\u200b\u5c06\u200b\u5728\u200b\u4e0b\u9762\u200b\u89e3\u91ca\u200b\uff09\u3002</p> <p>\u200b\u63d0\u793a\u200b</p> <p>\u200b\u5982\u679c\u200b\u4f60\u200b\u771f\u7684\u200b\u60f3\u200b\u5b9e\u73b0\u200b\u4e00\u4e2a\u200b\u81ea\u5b9a\u4e49\u200b\u7684\u200b\u670d\u52a1\u200b\uff0c\u200b\u5efa\u8bae\u200b\u5c06\u200b<code>QgsService</code>\u200b\u5b50\u200b\u7c7b\u5316\u200b\uff0c\u200b\u5e76\u200b\u901a\u8fc7\u200b\u8c03\u7528\u200b\u5176\u200b<code>registerService(service)</code>\u200b\u65b9\u6cd5\u200b\u5728\u200b<code>registerFilter()</code>\u200b\u65b9\u6cd5\u200b\u4e0a\u200b\u6ce8\u518c\u200b\u4f60\u200b\u7684\u200b\u670d\u52a1\u200b\u3002</p>"},{"location":"20-QGIS%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%92%8CPython/#204144","title":"20.4.1.4.4  \u200b\u4fee\u6539\u200b\u6216\u200b\u66ff\u6362\u200b\u8f93\u51fa","text":"<p>\u200b\u6c34\u5370\u200b\u8fc7\u6ee4\u5668\u200b\u7684\u200b\u4f8b\u5b50\u200b\u663e\u793a\u200b\u4e86\u200b\u5982\u4f55\u200b\u7528\u200b\u4e00\u4e2a\u200b\u65b0\u200b\u7684\u200b\u56fe\u50cf\u200b\u66ff\u6362\u200bWMS\u200b\u7684\u200b\u8f93\u51fa\u200b\uff0c\u200b\u8be5\u200b\u56fe\u50cf\u200b\u662f\u200b\u901a\u8fc7\u200b\u5728\u200bWMS\u200b\u6838\u5fc3\u200b\u670d\u52a1\u200b\u751f\u6210\u200b\u7684\u200bWMS\u200b\u56fe\u50cf\u200b\u4e0a\u200b\u6dfb\u52a0\u200b\u4e00\u4e2a\u200b\u6c34\u5370\u200b\u56fe\u50cf\u200b\u800c\u200b\u83b7\u5f97\u200b\uff1a</p> <pre><code>from qgis.server import *\nfrom qgis.PyQt.QtCore import *\nfrom qgis.PyQt.QtGui import *\n\nclass WatermarkFilter(QgsServerFilter):\n\n    def __init__(self, serverIface):\n        super().__init__(serverIface)\n\n    def responseComplete(self):\n        request = self.serverInterface().requestHandler()\n        params = request.parameterMap( )\n        # \u200b\u4e00\u4e9b\u200b\u68c0\u67e5\u200b\n        if (params.get('SERVICE').upper() == 'WMS' \\\n                and params.get('REQUEST').upper() == 'GETMAP' \\\n                and not request.exceptionRaised() ):\n            QgsMessageLog.logMessage(\"WatermarkFilter.responseComplete: image ready %s\" % request.parameter(\"FORMAT\"))\n            # \u200b\u83b7\u53d6\u200b\u56fe\u50cf\u200b\n            img = QImage()\n            img.loadFromData(request.body())\n            # \u200b\u6dfb\u52a0\u200b\u6c34\u5370\u200b\n            watermark = QImage(os.path.join(os.path.dirname(__file__), 'media/watermark.png'))\n            p = QPainter(img)\n            p.drawImage(QRect( 20, 20, 40, 40), watermark)\n            p.end()\n            ba = QByteArray()\n            buffer = QBuffer(ba)\n            buffer.open(QIODevice.WriteOnly)\n            img.save(buffer, \"PNG\" if \"png\" in request.parameter(\"FORMAT\") else \"JPG\")\n            # \u200b\u8bbe\u7f6e\u200b\u6570\u636e\u200b\u4f53\u200b\n            request.clearBody()\n            request.appendBody(ba)\n</code></pre> <p>\u200b\u5728\u200b\u8fd9\u4e2a\u200b\u4f8b\u5b50\u200b\u4e2d\u200b\uff0cSERVICE \u200b\u53c2\u6570\u503c\u200b\u88ab\u200b\u68c0\u67e5\u200b\uff0c\u200b\u5982\u679c\u200b\u4f20\u5165\u200b\u7684\u200b\u8bf7\u6c42\u200b\u662f\u200b\u4e00\u4e2a\u200b WMS GETMAP \uff0c\u200b\u5e76\u4e14\u200b\u6ca1\u6709\u200b\u88ab\u200b\u5148\u524d\u200b\u6267\u884c\u200b\u7684\u200b\u63d2\u4ef6\u200b\u6216\u200b\u6838\u5fc3\u200b\u670d\u52a1\u200b\uff08\u200b\u5728\u200b\u8fd9\u4e2a\u200b\u4f8b\u5b50\u200b\u4e2d\u662f\u200bWMS\uff09\u200b\u8bbe\u7f6e\u200b\u8fc7\u200b\u5f02\u5e38\u200b\uff0c\u200b\u90a3\u4e48\u200bWMS\u200b\u751f\u6210\u200b\u7684\u200b\u56fe\u50cf\u200b\u5c31\u200b\u4f1a\u200b\u4ece\u200b\u8f93\u51fa\u200b\u7f13\u51b2\u533a\u200b\u4e2d\u200b\u88ab\u200b\u68c0\u7d22\u200b\u51fa\u6765\u200b\uff0c\u200b\u5e76\u4e14\u200b\u6dfb\u52a0\u200b\u6c34\u5370\u200b\u56fe\u50cf\u200b\u3002\u200b\u6700\u540e\u200b\u4e00\u6b65\u200b\u662f\u200b\u6e05\u9664\u200b\u8f93\u51fa\u200b\u7f13\u51b2\u533a\u200b\uff0c\u200b\u7528\u200b\u65b0\u200b\u751f\u6210\u200b\u7684\u200b\u56fe\u50cf\u200b\u66ff\u6362\u200b\u5b83\u200b\u3002\u200b\u8bf7\u200b\u6ce8\u610f\u200b\uff0c\u200b\u5728\u200b\u73b0\u5b9e\u200b\u4e16\u754c\u200b\u4e2d\u200b\uff0c\u200b\u6211\u4eec\u200b\u8fd8\u200b\u5e94\u8be5\u200b\u68c0\u67e5\u200b\u6240\u200b\u8981\u6c42\u200b\u7684\u200b\u56fe\u50cf\u200b\u7c7b\u578b\u200b\uff0c\u200b\u800c\u200b\u4e0d\u662f\u200b\u53ea\u200b\u652f\u6301\u200bPNG\u200b\u6216\u200bJPG\u3002</p>"},{"location":"20-QGIS%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%92%8CPython/#20415","title":"20.4.1.5 \u200b\u8bbf\u95ee\u63a7\u5236\u200b\u8fc7\u6ee4\u5668","text":"<p>\u200b\u8bbf\u95ee\u63a7\u5236\u200b\u8fc7\u6ee4\u5668\u200b\u4e3a\u200b\u5f00\u53d1\u8005\u200b\u63d0\u4f9b\u200b\u4e86\u200b\u5bf9\u200b\u54ea\u4e9b\u200b\u5c42\u200b\u3001\u200b\u8981\u7d20\u200b\u548c\u200b\u5c5e\u6027\u200b\u53ef\u4ee5\u200b\u88ab\u200b\u8bbf\u95ee\u200b\u7684\u200b\u7ec6\u7c92\u5ea6\u200b\u63a7\u5236\u200b\uff0c\u200b\u4ee5\u4e0b\u200b\u56de\u8c03\u200b\u51fd\u6570\u200b\u53ef\u4ee5\u200b\u5728\u200b\u8bbf\u95ee\u63a7\u5236\u200b\u8fc7\u6ee4\u5668\u200b\u4e2d\u200b\u5b9e\u73b0\u200b\uff1a</p> <ul> <li><code>layerFilterExpression(layer)</code></li> <li><code>layerFilterSubsetString(layer)</code></li> <li><code>layerPermissions(layer)</code></li> <li><code>authorizedLayerAttributes(layer, attributes)</code></li> <li><code>allowToEdit(layer, feature)</code></li> <li><code>cacheKey()</code></li> </ul>"},{"location":"20-QGIS%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%92%8CPython/#204151","title":"20.4.1.5.1. \u200b\u63d2\u4ef6\u200b\u6587\u4ef6","text":"<p>\u200b\u4e0b\u9762\u200b\u662f\u200b\u6211\u4eec\u200b\u7684\u200b\u793a\u4f8b\u200b\u670d\u52a1\u5668\u200b\u63d2\u4ef6\u200b\u7684\u200b\u76ee\u5f55\u200b\u7ed3\u6784\u200b\uff1a</p> <pre><code>PYTHON_PLUGINS_PATH/\n  MyAccessControl/\n    __init__.py    --&gt; *required*\n    AccessControl.py  --&gt; *required*\n    metadata.txt   --&gt; *required*\n</code></pre>"},{"location":"20-QGIS%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%92%8CPython/#204152-__init__py","title":"20.4.1.5.2 __init__.py","text":"<p>\u200b\u8fd9\u4e2a\u200b\u6587\u4ef6\u200b\u662f\u200bPython\u200b\u7684\u200b\u5bfc\u5165\u200b\u7cfb\u7edf\u200b\u6240\u200b\u8981\u6c42\u200b\u7684\u200b\u3002\u200b\u5bf9\u4e8e\u200b\u6240\u6709\u200b\u7684\u200bQGIS\u200b\u670d\u52a1\u5668\u200b\u63d2\u4ef6\u200b\u6765\u8bf4\u200b\uff0c\u200b\u8fd9\u4e2a\u200b\u6587\u4ef6\u200b\u5305\u542b\u200b\u4e00\u4e2a\u200b<code>serverClassFactory()</code>\u200b\u51fd\u6570\u200b\uff0c\u200b\u5f53\u200b\u63d2\u4ef6\u200b\u5728\u200b\u542f\u52a8\u200b\u65f6\u200b\u88ab\u200b\u52a0\u8f7d\u200b\u5230\u200bQGIS\u200b\u670d\u52a1\u5668\u200b\u4e2d\u200b\u65f6\u200b\uff0c\u200b\u5b83\u200b\u5c06\u200b\u88ab\u200b\u8c03\u7528\u200b\u3002\u200b\u5b83\u200b\u63a5\u6536\u200b\u4e00\u4e2a\u200b\u5bf9\u200b<code>QgsServerInterface</code>\u200b\u5b9e\u4f8b\u200b\u7684\u200b\u5f15\u7528\u200b\uff0c\u200b\u5e76\u200b\u5fc5\u987b\u200b\u8fd4\u56de\u200b\u4e00\u4e2a\u200b\u4f60\u200b\u7684\u200b\u63d2\u4ef6\u200b\u7c7b\u200b\u7684\u200b\u5b9e\u4f8b\u200b\u3002\u200b\u4ee5\u4e0b\u200b\u662f\u200b\u63d2\u4ef6\u200b\u5b9e\u4f8b\u200b <code>__init__.py</code>\u200b\u7684\u200b\u6837\u5b50\u200b\uff1a</p> <pre><code>def serverClassFactory(serverIface):\n    from MyAccessControl.AccessControl import AccessControlServer\n    return AccessControlServer(serverIface)\n</code></pre>"},{"location":"20-QGIS%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%92%8CPython/#204153-accesscontrolpy","title":"20.4.1.5.3. AccessControl.py","text":"<pre><code>class AccessControlFilter(QgsAccessControlFilter):\n\n    def __init__(self, server_iface):\n        super().__init__(server_iface)\n\n    def layerFilterExpression(self, layer):\n        \"\"\" \u200b\u8fd4\u56de\u200b\u4e00\u4e2a\u200b\u989d\u5916\u200b\u7684\u200b\u8868\u8fbe\u5f0f\u200b\u8fc7\u6ee4\u5668\u200b \"\"\"\n        return super().layerFilterExpression(layer)\n\n    def layerFilterSubsetString(self, layer):\n        \"\"\" \u200b\u8fd4\u56de\u200b\u4e00\u4e2a\u200b\u989d\u5916\u200b\u7684\u200b\u5b50\u96c6\u200b\u5b57\u7b26\u4e32\u200b\uff08\u200b\u901a\u5e38\u200b\u662f\u200bSQL\uff09\u200b\u8fc7\u6ee4\u5668\u200b \"\"\"\n        return super().layerFilterSubsetString(layer)\n\n    def layerPermissions(self, layer):\n        \"\"\" \u200b\u8fd4\u56de\u200b\u8be5\u5c42\u200b\u7684\u200b\u6743\u9650\u200b \"\"\"\n        return super().layerPermissions(layer)\n\n    def authorizedLayerAttributes(self, layer, attributes):\n        \"\"\" \u200b\u8fd4\u56de\u200b\u6388\u6743\u200b\u7684\u200b\u56fe\u5c42\u200b\u5c5e\u6027\u200b \"\"\"\n        return super().authorizedLayerAttributes(layer, attributes)\n\n    def allowToEdit(self, layer, feature):\n        \"\"\" \u200b\u6211\u4eec\u200b\u662f\u5426\u200b\u88ab\u200b\u6388\u6743\u200b\u4fee\u6539\u200b\u4ee5\u4e0b\u200b\u51e0\u4f55\u56fe\u5f62\u200b \"\"\"\n        return super().allowToEdit(layer, feature)\n\n    def cacheKey(self):\n        return super().cacheKey()\n\nclass AccessControlServer:\n\n   def __init__(self, serverIface):\n      \"\"\" \u200b\u6ce8\u518c\u200b\u8bbf\u95ee\u63a7\u5236\u200b\u8fc7\u6ee4\u5668\u200b \"\"\"\n      serverIface.registerAccessControl(AccessControlFilter(serverIface), 100)\n</code></pre> <p>\u200b\u8fd9\u4e2a\u200b\u4f8b\u5b50\u200b\u4e3a\u200b\u6bcf\u4e2a\u200b\u4eba\u200b\u63d0\u4f9b\u200b\u4e86\u200b\u4e00\u4e2a\u200b\u5b8c\u6574\u200b\u7684\u200b\u8bbf\u95ee\u200b\u6743\u9650\u200b\u3002</p> <p>\u200b\u63d2\u4ef6\u200b\u7684\u200b\u4f5c\u7528\u200b\u662f\u200b\u77e5\u9053\u200b\u8c01\u200b\u5728\u200b\u767b\u5f55\u200b\u3002</p> <p>\u200b\u5728\u200b\u6240\u6709\u200b\u8fd9\u4e9b\u200b\u65b9\u6cd5\u200b\u4e2d\u200b\uff0c\u200b\u6211\u4eec\u200b\u90fd\u200b\u6709\u200b\u4e00\u4e2a\u200b\u56fe\u5c42\u200b\u7684\u200b\u53c2\u6570\u200b\uff0c\u200b\u4ee5\u4fbf\u200b\u80fd\u591f\u200b\u5b9a\u5236\u200b\u6bcf\u4e2a\u200b\u56fe\u5c42\u200b\u7684\u200b\u9650\u5236\u200b\u3002</p>"},{"location":"20-QGIS%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%92%8CPython/#204154-layerfilterexpression","title":"20.4.1.5.4. layerFilterExpression","text":"<p>\u200b\u7528\u4e8e\u200b\u6dfb\u52a0\u200b\u4e00\u4e2a\u200b\u8868\u8fbe\u5f0f\u200b\u6765\u200b\u9650\u5236\u200b\u7ed3\u679c\u200b\u3002</p> <p>\u200b\u4f8b\u5982\u200b\uff1a\u200b\u9650\u5236\u200b\u8981\u7d20\u200b\u7684\u200b\u5c5e\u6027\u200b<code>role</code>\u200b\u7b49\u4e8e\u200b<code>user</code>\u3002</p> <pre><code>def layerFilterExpression(self, layer):\n    return \"$role = 'user'\"\n</code></pre>"},{"location":"20-QGIS%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%92%8CPython/#204155-layerfiltersubsetstring","title":"20.4.1.5.5. layerFilterSubsetString","text":"<p>\u200b\u4e0e\u200b\u524d\u8005\u200b\u76f8\u540c\u200b\uff0c\u200b\u4f46\u200b\u4f7f\u7528\u200b<code>SubsetString</code>\uff08\u200b\u5728\u200b\u6570\u636e\u5e93\u200b\u4e2d\u200b\u6267\u884c\u200b\uff09\u3002</p> <pre><code>def layerFilterSubsetString(self, layer):\n    return \"role = 'user'\"\n</code></pre> <p>\u200b\u9650\u5236\u200b\u8981\u7d20\u200b\u7684\u200b\u5c5e\u6027\u200b<code>role</code>\u200b\u7b49\u4e8e\u200b<code>\u201cuser\u201d</code>\u3002</p>"},{"location":"20-QGIS%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%92%8CPython/#204156-layerpermissions","title":"20.4.1.5.6. layerPermissions","text":"<p>\u200b\u9650\u5236\u200b\u8bbf\u95ee\u200b\u56fe\u5c42\u200b\u3002</p> <p>\u200b\u8fd4\u56de\u200b\u4e00\u4e2a\u200b<code>LayerPermissions()</code>\u200b\u5bf9\u8c61\u200b\uff0c\u200b\u5b83\u200b\u6709\u200b\u4ee5\u4e0b\u200b\u5c5e\u6027\u200b\uff1a</p> <ul> <li><code>canRead</code>\u200b\u53ef\u4ee5\u200b\u5728\u200b<code>GetCapabilities</code>\u200b\u4e2d\u200b\u770b\u5230\u200b\u5b83\u200b\u5e76\u200b\u6709\u200b\u8bfb\u53d6\u200b\u6743\u9650\u200b\u3002</li> <li><code>canInsert</code>\u200b\u80fd\u591f\u200b\u63d2\u5165\u200b\u4e00\u4e2a\u200b\u65b0\u200b\u7684\u200b\u8981\u7d20\u200b\u3002</li> <li><code>canUpdate</code>\u200b\u80fd\u591f\u200b\u66f4\u65b0\u200b\u4e00\u4e2a\u200b\u8981\u7d20\u200b\u3002</li> <li><code>canDelete</code>\u200b\u80fd\u591f\u200b\u5220\u9664\u200b\u4e00\u4e2a\u200b\u8981\u7d20\u200b\u3002</li> </ul> <p>\u200b\u4f8b\u5982\u200b\uff1a</p> <pre><code>def layerPermissions(self, layer):\n    rights = QgsAccessControlFilter.LayerPermissions()\n    rights.canRead = True\n    rights.canInsert = rights.canUpdate = rights.canDelete = False\n    return rights\n</code></pre> <p>\u200b\u9650\u5236\u200b\u6bcf\u200b\u4e00\u4e2a\u200b\u4eba\u200b\u53ea\u8bfb\u200b\u8bbf\u95ee\u200b\u3002</p>"},{"location":"20-QGIS%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%92%8CPython/#204157-authorizedlayerattributes","title":"20.4.1.5.7. authorizedLayerAttributes","text":"<p>\u200b\u7528\u4e8e\u200b\u9650\u5236\u200b\u4e00\u4e2a\u200b\u7279\u5b9a\u200b\u7684\u200b\u5c5e\u6027\u200b\u5b50\u96c6\u200b\u7684\u200b\u53ef\u89c1\u200b\u6027\u200b\u3002</p> <p>\u200b\u53c2\u6570\u200b attribute \u200b\u8fd4\u56de\u200b\u5f53\u524d\u200b\u7684\u200b\u53ef\u89c1\u200b\u5c5e\u6027\u200b\u96c6\u200b\u3002</p> <p>\u200b\u4f8b\u5982\u200b\uff1a</p> <pre><code>def authorizedLayerAttributes(self, layer, attributes):\n    return [a for a in attributes if a != \"role\"]\n</code></pre> <p>\u200b\u9690\u85cf\u200b\u2018role\u2019\u200b\u5c5e\u6027\u200b\u3002</p>"},{"location":"20-QGIS%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%92%8CPython/#204158-allowtoedit","title":"20.4.1.5.8. allowToEdit","text":"<p>\u200b\u8fd9\u200b\u88ab\u200b\u7528\u6765\u200b\u9650\u5236\u200b\u5bf9\u200b\u4e00\u4e2a\u200b\u5c5e\u6027\u200b\u5b50\u96c6\u200b\u7684\u200b\u7f16\u8f91\u200b\u3002</p> <p>\u200b\u5b83\u200b\u5728\u200b<code>WFS-Transaction</code>\u200b\u534f\u8bae\u200b\u4e2d\u200b\u4f7f\u7528\u200b\u3002</p> <p>\u200b\u4f8b\u5982\u200b\uff1a</p> <pre><code>def allowToEdit(self, layer, feature):\n    return feature.attribute('role') == 'user'\n</code></pre> <p>\u200b\u53ea\u200b\u80fd\u591f\u200b\u7f16\u8f91\u200b\u5177\u6709\u200b\u2018role\u2019\u200b\u5c5e\u6027\u200b\u7684\u200b\u8981\u7d20\u200b\u3002</p>"},{"location":"20-QGIS%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%92%8CPython/#204159-cachekey","title":"20.4.1.5.9. cacheKey","text":"<p>QGIS\u200b\u670d\u52a1\u5668\u200b\u4f1a\u200b\u5bf9\u200b\u80fd\u529b\u200b\u8fdb\u884c\u200b\u7f13\u5b58\u200b\uff0c\u200b\u5982\u679c\u200b\u8981\u200b\u5bf9\u200b\u6bcf\u4e2a\u200b\u89d2\u8272\u200b\u8fdb\u884c\u200b\u7f13\u5b58\u200b\uff0c\u200b\u4f60\u200b\u53ef\u4ee5\u200b\u5728\u200b\u6b64\u200b\u65b9\u6cd5\u200b\u4e2d\u200b\u8fd4\u56de\u200b\u89d2\u8272\u200b\u3002\u200b\u6216\u8005\u200b\u8fd4\u56de\u200b<code>None</code>\u200b\u4ee5\u200b\u5b8c\u5168\u200b\u7981\u7528\u200b\u7f13\u5b58\u200b\u3002</p>"},{"location":"20-QGIS%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%92%8CPython/#2042","title":"20.4.2 \u200b\u81ea\u5b9a\u4e49\u200b\u670d\u52a1","text":"<p>\u200b\u5728\u200bQGIS\u200b\u670d\u52a1\u5668\u200b\u4e2d\u200b\uff0cWMS\u3001WFS\u200b\u548c\u200bWCS\u200b\u7b49\u200b\u6838\u5fc3\u200b\u670d\u52a1\u200b\u662f\u200b\u4f5c\u4e3a\u200b<code>QgsService</code>\u200b\u7684\u200b\u5b50\u7c7b\u200b\u5b9e\u73b0\u200b\u7684\u200b\u3002</p> <p>\u200b\u4e3a\u4e86\u200b\u5b9e\u73b0\u200b\u4e00\u4e2a\u200b\u65b0\u200b\u7684\u200b\u670d\u52a1\u200b\uff0c\u200b\u5f53\u200b\u67e5\u8be2\u200b\u5b57\u7b26\u4e32\u200b\u53c2\u6570\u200b<code>SERVICE</code>\u200b\u4e0e\u200b\u670d\u52a1\u200b\u540d\u79f0\u200b\u76f8\u5339\u914d\u200b\u65f6\u200b\u5c06\u200b\u88ab\u200b\u6267\u884c\u200b\uff0c\u200b\u4f60\u200b\u53ef\u4ee5\u200b\u5b9e\u73b0\u200b\u4f60\u200b\u81ea\u5df1\u200b\u7684\u200b<code>QgsService</code>\uff0c\u200b\u5e76\u200b\u901a\u8fc7\u200b\u8c03\u7528\u200b<code>registerService(service)</code>\u200b\u5728\u200b<code>serviceRegistry()</code>\u200b\u4e0a\u200b\u6ce8\u518c\u200b\u4f60\u200b\u7684\u200b\u670d\u52a1\u200b\u3002</p> <p>\u200b\u4e0b\u9762\u200b\u662f\u200b\u4e00\u4e2a\u200b\u540d\u4e3a\u200bCUSTOM\u200b\u7684\u200b\u81ea\u5b9a\u4e49\u200b\u670d\u52a1\u200b\u7684\u200b\u4f8b\u5b50\u200b\uff1a</p> <pre><code>from qgis.server import QgsService\nfrom qgis.core import QgsMessageLog\n\nclass CustomServiceService(QgsService):\n\n    def __init__(self):\n        QgsService.__init__(self)\n\n    def name(self):\n        return \"CUSTOM\"\n\n    def version(self):\n        return \"1.0.0\"\n\n    def executeRequest(self, request, response, project):\n        response.setStatusCode(200)\n        QgsMessageLog.logMessage('Custom service executeRequest')\n        response.write(\"Custom service executeRequest\")\n\n\nclass CustomService():\n\n    def __init__(self, serverIface):\n        serverIface.serviceRegistry().registerService(CustomServiceService())\n</code></pre>"},{"location":"20-QGIS%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%92%8CPython/#2043-apis","title":"20.4.3. \u200b\u81ea\u5b9a\u4e49\u200bAPIs","text":"<p>\u200b\u5728\u200bQGIS Server\u200b\u4e2d\u200b\uff0c\u200b\u8bf8\u5982\u200bOAPIF\uff08\u200b\u53c8\u79f0\u200bWFS3\uff09\u200b\u7b49\u200b\u6838\u5fc3\u200bOGC APIs\u200b\u88ab\u200b\u5b9e\u73b0\u200b\u4e3a\u200b<code>QgsServerOgcApiHandler</code>\u200b\u5b50\u7c7b\u200b\u7684\u200b\u96c6\u5408\u200b\uff0c\u200b\u8fd9\u4e9b\u200b\u5b50\u7c7b\u200b\u88ab\u200b\u6ce8\u518c\u200b\u5230\u200b<code>QgsServerOgcApi</code>\uff08\u200b\u6216\u200b\u5176\u7236\u200b\u7c7b\u200b<code>QgsServerApi</code>\uff09\u200b\u7684\u200b\u5b9e\u4f8b\u200b\u4e2d\u200b\u3002</p> <p>\u200b\u8981\u200b\u5b9e\u73b0\u200b\u4e00\u4e2a\u200b\u65b0\u200b\u7684\u200bAPI\uff0c\u200b\u5f53\u200burl\u200b\u8def\u5f84\u200b\u4e0e\u200b\u67d0\u4e2a\u200bURL\u200b\u76f8\u5339\u914d\u200b\u65f6\u200b\u5c31\u200b\u4f1a\u200b\u88ab\u200b\u6267\u884c\u200b\uff0c\u200b\u4f60\u200b\u53ef\u4ee5\u200b\u5b9e\u73b0\u200b\u4f60\u200b\u81ea\u5df1\u200b\u7684\u200b<code>QgsServerOgcApiHandler</code>\u200b\u5b9e\u4f8b\u200b\uff0c\u200b\u5c06\u200b\u5b83\u4eec\u200b\u6dfb\u52a0\u200b\u5230\u200b<code>QgsServerOgcApi</code>\u200b\u4e2d\u200b\uff0c\u200b\u5e76\u200b\u901a\u8fc7\u200b\u8c03\u7528\u200b\u5176\u200b<code>registerApi(api)</code>\u200b\u5728\u200b<code>serviceRegistry()</code>\u200b\u4e0a\u200b\u6ce8\u518c\u200b\u8be5\u200bAPI\u3002</p> <p>\u200b\u4e0b\u9762\u200b\u662f\u200b\u4e00\u4e2a\u200b\u81ea\u5b9a\u4e49\u200bAPI\u200b\u7684\u200b\u4f8b\u5b50\u200b\uff0c\u200b\u5f53\u200bURL\u200b\u5305\u542b\u200b<code>/customapi</code>\u200b\u65f6\u200b\u5c06\u200b\u88ab\u200b\u6267\u884c\u200b\uff1a</p> <pre><code>import json\nimport os\n\nfrom qgis.PyQt.QtCore import QBuffer, QIODevice, QTextStream, QRegularExpression\nfrom qgis.server import (\n    QgsServiceRegistry,\n    QgsService,\n    QgsServerFilter,\n    QgsServerOgcApi,\n    QgsServerQueryStringParameter,\n    QgsServerOgcApiHandler,\n)\n\nfrom qgis.core import (\n    QgsMessageLog,\n    QgsJsonExporter,\n    QgsCircle,\n    QgsFeature,\n    QgsPoint,\n    QgsGeometry,\n)\n\n\nclass CustomApiHandler(QgsServerOgcApiHandler):\n\n    def __init__(self):\n        super(CustomApiHandler, self).__init__()\n        self.setContentTypes([QgsServerOgcApi.HTML, QgsServerOgcApi.JSON])\n\n    def path(self):\n        return QRegularExpression(\"/customapi\")\n\n    def operationId(self):\n        return \"CustomApiXYCircle\"\n\n    def summary(self):\n        return \"Creates a circle around a point\"\n\n    def description(self):\n        return \"Creates a circle around a point\"\n\n    def linkTitle(self):\n        return \"Custom Api XY Circle\"\n\n    def linkType(self):\n        return QgsServerOgcApi.data\n\n    def handleRequest(self, context):\n        \"\"\"Simple Circle\"\"\"\n\n        values = self.values(context)\n        x = values['x']\n        y = values['y']\n        r = values['r']\n        f = QgsFeature()\n        f.setAttributes([x, y, r])\n        f.setGeometry(QgsCircle(QgsPoint(x, y), r).toCircularString())\n        exporter = QgsJsonExporter()\n        self.write(json.loads(exporter.exportFeature(f)), context)\n\n    def templatePath(self, context):\n        # \u200b\u6a21\u677f\u200b\u8def\u5f84\u200b\u7528\u4e8e\u200b\u63d0\u4f9b\u200bHTML\u200b\u5185\u5bb9\u200b\n        return os.path.join(os.path.dirname(__file__), 'circle.html')\n\n    def parameters(self, context):\n        return [QgsServerQueryStringParameter('x', True, QgsServerQueryStringParameter.Type.Double, 'X coordinate'),\n                QgsServerQueryStringParameter(\n                    'y', True, QgsServerQueryStringParameter.Type.Double, 'Y coordinate'),\n                QgsServerQueryStringParameter('r', True, QgsServerQueryStringParameter.Type.Double, 'radius')]\n\n\nclass CustomApi():\n\n    def __init__(self, serverIface):\n        api = QgsServerOgcApi(serverIface, '/customapi',\n                            'custom api', 'a custom api', '1.1')\n        handler = CustomApiHandler()\n        api.registerHandler(handler)\n        serverIface.serviceRegistry().registerApi(api)\n</code></pre>"},{"location":"21-PyQGIS%E9%80%9F%E6%9F%A5%E8%A1%A8/","title":"21 PyQGIS\u200b\u901f\u67e5\u8868","text":""},{"location":"21-PyQGIS%E9%80%9F%E6%9F%A5%E8%A1%A8/#211","title":"21.1 \u200b\u7528\u6237\u200b\u63a5\u53e3","text":"<p>\u200b\u6539\u53d8\u200b\u5916\u89c2\u200b</p> <p><pre><code>from qgis.PyQt.QtWidgets import QApplication\n\napp = QApplication.instance()\napp.setStyleSheet(\".QWidget {color: blue; background-color: yellow;}\")\n# \u200b\u4f60\u200b\u53ef\u4ee5\u200b\u4ece\u6587\u4ef6\u200b\u8bfb\u53d6\u200b\u6837\u5f0f\u200b\nwith  open(\"testdata/file.qss\") as qss_file_content:\n    app.setStyleSheet(qss_file_content.read())\n</code></pre> \u200b\u6539\u53d8\u200b\u56fe\u6807\u200b\u548c\u200b\u6807\u9898\u200b</p> <pre><code>from qgis.PyQt.QtGui import QIcon\n\nicon = QIcon(r\"/path/to/logo/file.png\")\niface.mainWindow().setWindowIcon(icon)\niface.mainWindow().setWindowTitle(\"My QGIS\")\n</code></pre>"},{"location":"21-PyQGIS%E9%80%9F%E6%9F%A5%E8%A1%A8/#212","title":"21.2 \u200b\u8bbe\u7f6e","text":"<p>\u200b\u83b7\u5f97\u200b\u8bbe\u7f6e\u200b\u5217\u8868\u200b</p> <pre><code>from qgis.PyQt.QtCore import QSettings\n\nqs = QSettings()\n\nfor k in sorted(qs.allKeys()):\n    print (k)\n</code></pre>"},{"location":"21-PyQGIS%E9%80%9F%E6%9F%A5%E8%A1%A8/#213","title":"21.3 \u200b\u5de5\u5177\u680f","text":"<p>\u200b\u79fb\u9664\u200b\u5de5\u5177\u680f\u200b</p> <p><pre><code>from qgis.utils import iface\n\ntoolbar = iface.helpToolBar()\nparent = toolbar.parentWidget()\nparent.removeToolBar(toolbar)\n\n# \u200b\u6dfb\u52a0\u200b\nparent.addToolBar(toolbar)\n</code></pre> \u200b\u79fb\u9664\u200b\u64cd\u4f5c\u200b</p> <pre><code>actions = iface.attributesToolBar().actions()\niface.attributesToolBar().clear()\niface.attributesToolBar().addAction(actions[4])\niface.attributesToolBar().addAction(actions[3])\n</code></pre>"},{"location":"21-PyQGIS%E9%80%9F%E6%9F%A5%E8%A1%A8/#214","title":"21.4 \u200b\u83dc\u5355","text":"<p>\u200b\u79fb\u9664\u200b\u83dc\u5355\u200b</p> <pre><code>from qgis.utils import iface\n\n# \u200b\u5e2e\u52a9\u200b\u83dc\u5355\u200b\nmenu = iface.helpMenu()\nmenubar = menu.parentWidget()\nmenubar.removeAction(menu.menuAction())\n\n# \u200b\u6dfb\u52a0\u200b\nmenubar.addAction(menu.menuAction())\n</code></pre>"},{"location":"21-PyQGIS%E9%80%9F%E6%9F%A5%E8%A1%A8/#215","title":"21.5 \u200b\u753b\u5e03","text":"<p>\u200b\u8bbf\u95ee\u200b\u753b\u5e03\u200b</p> <p><pre><code>from qgis.utils import iface\n\ncanvas = iface.mapCanvas()\n</code></pre> \u200b\u6539\u53d8\u200b\u753b\u5e03\u200b\u989c\u8272\u200b</p> <p><pre><code>from qgis.PyQt.QtCore import Qt\n\niface.mapCanvas().setCanvasColor(Qt.black)\niface.mapCanvas().refresh()\n</code></pre> \u200b\u753b\u5e03\u200b\u5237\u65b0\u200b\u95f4\u9694\u200b</p> <pre><code>from qgis.PyQt.QtCore import QSettings\n# 150\u200b\u6beb\u79d2\u200b\nQSettings().setValue(\"/qgis/map_update_interval\", 150)\n</code></pre>"},{"location":"21-PyQGIS%E9%80%9F%E6%9F%A5%E8%A1%A8/#216","title":"21.6 \u200b\u56fe\u5c42","text":"<p>\u200b\u6dfb\u52a0\u200b\u56fe\u5c42\u200b</p> <p><pre><code>from qgis.utils import iface\n\nlayer = iface.addVectorLayer(\"/path/to/shapefile/file.shp\", \"layer name you like\", \"ogr\")\nif not layer:\n    print(\"Layer failed to load!\")\n</code></pre> \u200b\u83b7\u53d6\u200b\u5f53\u524d\u200b\u56fe\u5c42\u200b</p> <p><pre><code>layer = iface.activeLayer()\n</code></pre> \u200b\u56fe\u5c42\u200b\u5217\u8868\u200b</p> <pre><code>from qgis.core import QgsProject\n\nQgsProject.instance().mapLayers().values()\n</code></pre> <p>\u200b\u83b7\u5f97\u200b\u56fe\u5c42\u200b\u540d\u79f0\u200b</p> <p><pre><code>from qgis.core import QgsVectorLayer\nlayer = QgsVectorLayer(\"Point?crs=EPSG:4326\", \"layer name you like\", \"memory\")\nQgsProject.instance().addMapLayer(layer)\n\nlayers_names = []\nfor layer in QgsProject.instance().mapLayers().values():\n    layers_names.append(layer.name())\n\nprint(\"layers TOC = {}\".format(layers_names))\n\nlayers_names = [layer.name() for layer in QgsProject.instance().mapLayers().values()]\nprint(\"layers TOC = {}\".format(layers_names))\n</code></pre> \u200b\u901a\u8fc7\u200b\u540d\u79f0\u200b\u67e5\u627e\u200b\u56fe\u5c42\u200b</p> <p><pre><code>from qgis.core import QgsProject\n\nlayer = QgsProject.instance().mapLayersByName(\"layer name you like\")[0]\nprint(layer.name())\n</code></pre> \u200b\u8bbe\u7f6e\u200b\u5f53\u524d\u200b\u56fe\u5c42\u200b</p> <p><pre><code>from qgis.core import QgsProject\n\nlayer = QgsProject.instance().mapLayersByName(\"layer name you like\")[0]\niface.setActiveLayer(layer)\n</code></pre> \u200b\u5237\u65b0\u200b\u56fe\u5c42\u200b</p> <p><pre><code>from qgis.core import QgsProject\n\nlayer = QgsProject.instance().mapLayersByName(\"layer name you like\")[0]\n# 5\u200b\u79d2\u200b\nlayer.setAutoRefreshInterval(5000)\n# \u200b\u81ea\u52a8\u200b\u5237\u65b0\u200b\nlayer.setAutoRefreshMode(Qgis.AutoRefreshMode.ReloadData)\n</code></pre> \u200b\u6dfb\u52a0\u200b\u8868\u5355\u200b\u8981\u7d20\u200b</p> <p><pre><code>from qgis.core import QgsFeature, QgsGeometry\n\nfeat = QgsFeature()\ngeom = QgsGeometry()\nfeat.setGeometry(geom)\nfeat.setFields(layer.fields())\n\niface.openFeatureForm(layer, feat, False)\n</code></pre> \u200b\u6dfb\u52a0\u200b\u65e0\u200b\u8868\u5355\u200b\u8981\u7d20\u200b</p> <p><pre><code>from qgis.core import QgsPointXY\n\npr = layer.dataProvider()\nfeat = QgsFeature()\nfeat.setGeometry(QgsGeometry.fromPointXY(QgsPointXY(10,10)))\npr.addFeatures([feat])\n</code></pre> \u200b\u83b7\u5f97\u200b\u8981\u7d20\u200b</p> <p><pre><code>for f in layer.getFeatures():\n    print (f)\n</code></pre> \u200b\u83b7\u5f97\u200b\u5df2\u9009\u200b\u8981\u7d20\u200b</p> <p><pre><code>for f in layer.selectedFeatures():\n    print (f)\n</code></pre> \u200b\u83b7\u5f97\u200b\u8981\u7d20\u200bid</p> <p><pre><code>selected_ids = layer.selectedFeatureIds()\nprint(selected_ids)\n</code></pre> \u200b\u4ece\u200b\u5df2\u9009\u200b\u8981\u7d20\u200bid\u200b\u521b\u5efa\u200b\u5185\u5b58\u200b\u56fe\u5c42\u200b</p> <p><pre><code>from qgis.core import QgsFeatureRequest\n\nmemory_layer = layer.materialize(QgsFeatureRequest().setFilterFids(layer.selectedFeatureIds()))\nQgsProject.instance().addMapLayer(memory_layer)\n</code></pre> \u200b\u83b7\u5f97\u200b\u51e0\u4f55\u200b</p> <p><pre><code># \u200b\u70b9\u200b\u56fe\u5c42\u200b\nfor f in layer.getFeatures():\n    geom = f.geometry()\n    print ('%f, %f' % (geom.asPoint().y(), geom.asPoint().x()))\n</code></pre> \u200b\u79fb\u52a8\u200b\u51e0\u4f55\u200b</p> <p><pre><code>from qgis.core import QgsFeature, QgsGeometry\npoly = QgsFeature()\ngeom = QgsGeometry.fromWkt(\"POINT(7 45)\")\ngeom.translate(1, 1)\npoly.setGeometry(geom)\nprint(poly.geometry())\n</code></pre> \u200b\u8bbe\u7f6e\u200b\u5750\u6807\u200b\u53c2\u8003\u200b\u7cfb\u7edf\u200b</p> <p><pre><code>from qgis.core import QgsProject, QgsCoordinateReferenceSystem\n\nfor layer in QgsProject.instance().mapLayers().values():\n    layer.setCrs(QgsCoordinateReferenceSystem(4326, QgsCoordinateReferenceSystem.EpsgCrsId))\n</code></pre> \u200b\u67e5\u770b\u200b\u5750\u6807\u200b\u53c2\u8003\u200b\u7cfb\u7edf\u200b</p> <p><pre><code>from qgis.core import QgsProject\n\nfor layer in QgsProject.instance().mapLayers().values():\n    crs = layer.crs().authid()\n    layer.setName('{} ({})'.format(layer.name(), crs))\n</code></pre> \u200b\u9690\u85cf\u200b\u5b57\u200b\u6bb5\u200b</p> <p><pre><code>from qgis.core import QgsEditorWidgetSetup\n\ndef fieldVisibility (layer,fname):\n    setup = QgsEditorWidgetSetup('Hidden', {})\n    for i, column in enumerate(layer.fields()):\n        if column.name()==fname:\n            layer.setEditorWidgetSetup(idx, setup)\n            break\n        else:\n            continue\n</code></pre> \u200b\u56fe\u5c42\u200b\u6dfb\u52a0\u200bWKT\u200b\u8981\u7d20\u200b</p> <p><pre><code>from qgis.core import QgsVectorLayer, QgsFeature, QgsGeometry, QgsProject\n\nlayer = QgsVectorLayer('Polygon?crs=epsg:4326', 'Mississippi', 'memory')\npr = layer.dataProvider()\npoly = QgsFeature()\ngeom = QgsGeometry.fromWkt(\"POLYGON ((-88.82 34.99,-88.09 34.89,-88.39 30.34,-89.57 30.18,-89.73 31,-91.63 30.99,-90.87 32.37,-91.23 33.44,-90.93 34.23,-90.30 34.99,-88.82 34.99))\")\npoly.setGeometry(geom)\npr.addFeatures([poly])\nlayer.updateExtents()\nQgsProject.instance().addMapLayers([layer])\n</code></pre> \u200b\u4ece\u200bGeoPackage\u200b\u52a0\u8f7d\u200b\u6240\u6709\u200b\u56fe\u5c42\u200b</p> <p><pre><code>from qgis.core import QgsVectorLayer, QgsProject\n\nfileName = \"/path/to/gpkg/file.gpkg\"\nlayer = QgsVectorLayer(fileName,\"test\",\"ogr\")\nsubLayers =layer.dataProvider().subLayers()\n\nfor subLayer in subLayers:\n    name = subLayer.split('!!::!!')[1]\n    uri = \"%s|layername=%s\" % (fileName, name,)\n    # \u200b\u521b\u5efa\u200b\u56fe\u5c42\u200b\n    sub_vlayer = QgsVectorLayer(uri, name, 'ogr')\n    # Add layer to map\n    QgsProject.instance().addMapLayer(sub_vlayer)\n</code></pre> \u200b\u52a0\u8f7d\u200b\u74e6\u7247\u200b\u56fe\u5c42\u200b\uff08xyz\uff09</p> <p><pre><code>from qgis.core import QgsRasterLayer, QgsProject\n\ndef loadXYZ(url, name):\n    rasterLyr = QgsRasterLayer(\"type=xyz&amp;url=\" + url, name, \"wms\")\n    QgsProject.instance().addMapLayer(rasterLyr)\n\nurlWithParams = 'type=xyz&amp;url=https://a.tile.openstreetmap.org/%7Bz%7D/%7Bx%7D/%7By%7D.png&amp;zmax=19&amp;zmin=0&amp;crs=EPSG3857'\nloadXYZ(urlWithParams, 'OpenStreetMap')\n</code></pre> \u200b\u79fb\u9664\u200b\u6240\u6709\u200b\u56fe\u5c42\u200b</p> <p><pre><code>QgsProject.instance().removeAllMapLayers()\n</code></pre> \u200b\u79fb\u9664\u200b\u5168\u90e8\u200b</p> <pre><code>QgsProject.instance().clear()\n</code></pre>"},{"location":"21-PyQGIS%E9%80%9F%E6%9F%A5%E8%A1%A8/#217","title":"21.7 \u200b\u76ee\u5f55","text":"<p>\u200b\u8bbf\u95ee\u200b\u9009\u4e2d\u200b\u7684\u200b\u56fe\u5c42\u200b</p> <p><pre><code>from qgis.utils import iface\n\niface.mapCanvas().layers()\n</code></pre> \u200b\u79fb\u9664\u200b\u4e0a\u4e0b\u6587\u200b\u83dc\u5355\u200b</p> <pre><code>ltv = iface.layerTreeView()\nmp = ltv.menuProvider()\nltv.setMenuProvider(None)\n# \u200b\u6062\u590d\u200b\nltv.setMenuProvider(mp)\n</code></pre>"},{"location":"21-PyQGIS%E9%80%9F%E6%9F%A5%E8%A1%A8/#218","title":"21.8 \u200b\u9ad8\u7ea7\u200b\u76ee\u5f55","text":"<p>\u200b\u6839\u200b\u8282\u70b9\u200b</p> <p><pre><code>from qgis.core import QgsVectorLayer, QgsProject, QgsLayerTreeLayer\n\nroot = QgsProject.instance().layerTreeRoot()\nnode_group = root.addGroup(\"My Group\")\n\nlayer = QgsVectorLayer(\"Point?crs=EPSG:4326\", \"layer name you like\", \"memory\")\nQgsProject.instance().addMapLayer(layer, False)\n\nnode_group.addLayer(layer)\n\nprint(root)\nprint(root.children())\n</code></pre> \u200b\u8bbf\u95ee\u200b\u7b2c\u4e00\u4e2a\u200b\u5b50\u200b\u8282\u70b9\u200b</p> <p><pre><code>from qgis.core import QgsLayerTreeGroup, QgsLayerTreeLayer, QgsLayerTree\n\nchild0 = root.children()[0]\nprint (child0.name())\nprint (type(child0))\nprint (isinstance(child0, QgsLayerTreeLayer))\nprint (isinstance(child0.parent(), QgsLayerTree))\n</code></pre> \u200b\u67e5\u627e\u200b\u56fe\u5c42\u200b\u7ec4\u548c\u200b\u6240\u6709\u200b\u8282\u70b9\u200b</p> <p><pre><code>from qgis.core import QgsLayerTreeGroup, QgsLayerTreeLayer\n\ndef get_group_layers(group):\n   print('- group: ' + group.name())\n   for child in group.children():\n      if isinstance(child, QgsLayerTreeGroup):\n         # \u200b\u904d\u5386\u200b\u5d4c\u5957\u200b\u56fe\u5c42\u200b\u7ec4\u200b\n         get_group_layers(child)\n      else:\n         print('  - layer: ' + child.name())\n\n\nroot = QgsProject.instance().layerTreeRoot()\nfor child in root.children():\n   if isinstance(child, QgsLayerTreeGroup):\n      get_group_layers(child)\n   elif isinstance(child, QgsLayerTreeLayer):\n      print ('- layer: ' + child.name())\n</code></pre> \u200b\u901a\u8fc7\u200b\u540d\u79f0\u200b\u67e5\u627e\u200b\u56fe\u5c42\u200b\u7ec4\u200b</p> <p><pre><code>print (root.findGroup(\"My Group\"))\n</code></pre> \u200b\u901a\u8fc7\u200bid\u200b\u67e5\u627e\u200b\u56fe\u5c42\u200b\u7ec4\u200b</p> <p><pre><code>print (root.findLayer(layer.layerId()))\n</code></pre> \u200b\u6dfb\u52a0\u200b\u56fe\u5c42\u200b</p> <p><pre><code>from qgis.core import QgsVectorLayer, QgsProject\n\nlayer1 = QgsVectorLayer(\"Point?crs=EPSG:4326\", \"layer name you like\", \"memory\")\nQgsProject.instance().addMapLayer(layer1, False)\nnode_layer1 = root.addLayer(layer1)\n</code></pre> \u200b\u6dfb\u52a0\u200b\u56fe\u5c42\u200b\u7ec4\u200b</p> <p><pre><code>from qgis.core import QgsLayerTreeGroup\n\nnode_group2 = QgsLayerTreeGroup(\"Group 2\")\nroot.addChildNode(node_group2)\n</code></pre> \u200b\u79fb\u9664\u200b\u52a0\u8f7d\u200b\u7684\u200b\u56fe\u5c42\u200b</p> <p><pre><code>layer = QgsProject.instance().mapLayersByName(\"layer name you like\")[0]\nroot = QgsProject.instance().layerTreeRoot()\n\nmyLayer = root.findLayer(layer.id())\nmyClone = myLayer.clone()\nparent = myLayer.parent()\n\nmyGroup = root.findGroup(\"My Group\")\n# \u200b\u63d2\u5165\u200b\u5230\u200b\u7b2c\u4e00\u4e2a\u200b\u4f4d\u7f6e\u200b\nmyGroup.insertChildNode(0, myClone)\n\nparent.removeChildNode(myLayer)\n</code></pre> \u200b\u79fb\u9664\u200b\u6307\u5b9a\u200b\u56fe\u5c42\u200b\u7ec4\u200b</p> <p><pre><code>QgsProject.instance().addMapLayer(layer, False)\n\nroot = QgsProject.instance().layerTreeRoot()\nmyGroup = root.findGroup(\"My Group\")\nmyOriginalLayer = root.findLayer(layer.id())\nmyLayer = myOriginalLayer.clone()\nmyGroup.insertChildNode(0, myLayer)\nparent.removeChildNode(myOriginalLayer)\n</code></pre> \u200b\u6539\u53d8\u200b\u53ef\u89c1\u200b\u6027\u200b</p> <pre><code>root = QgsProject.instance().layerTreeRoot()\nnode = root.findLayer(layer.id())\nnew_state = Qt.Checked if node.isVisible() == Qt.Unchecked else Qt.Unchecked\nnode.setItemVisibilityChecked(new_state)\n</code></pre> <p>\u200b\u56fe\u5c42\u200b\u7ec4\u200b\u662f\u5426\u200b\u88ab\u200b\u9009\u62e9\u200b</p> <pre><code>def isMyGroupSelected( groupName ):\n    myGroup = QgsProject.instance().layerTreeRoot().findGroup( groupName )\n    return myGroup in iface.layerTreeView().selectedNodes()\n\nprint(isMyGroupSelected( 'my group name' ))\n</code></pre> <p>\u200b\u79fb\u52a8\u200b\u8282\u70b9\u200b</p> <p><pre><code>cloned_group1 = node_group.clone()\nroot.insertChildNode(0, cloned_group1)\nroot.removeChildNode(node_group)\n</code></pre> \u200b\u5c55\u5f00\u200b\u8282\u70b9\u200b</p> <pre><code>print(myGroup.isExpanded())\nmyGroup.setExpanded(False)\n</code></pre> <p>\u200b\u9690\u85cf\u200b\u8282\u70b9\u200b</p> <pre><code>from qgis.core import QgsProject\n\nmodel = iface.layerTreeView().layerTreeModel()\nltv = iface.layerTreeView()\nroot = QgsProject.instance().layerTreeRoot()\n\nlayer = QgsProject.instance().mapLayersByName('layer name you like')[0]\nnode = root.findLayer(layer.id())\n\nindex = model.node2index( node )\nltv.setRowHidden( index.row(), index.parent(), True )\nnode.setCustomProperty( 'nodeHidden', 'true')\nltv.setCurrentIndex(model.node2index(root))\n</code></pre> <p>\u200b\u8282\u70b9\u200b\u4fe1\u53f7\u200b</p> <pre><code>def onWillAddChildren(node, indexFrom, indexTo):\n    print (\"WILL ADD\", node, indexFrom, indexTo)\n\ndef onAddedChildren(node, indexFrom, indexTo):\n    print (\"ADDED\", node, indexFrom, indexTo)\n\nroot.willAddChildren.connect(onWillAddChildren)\nroot.addedChildren.connect(onAddedChildren)\n</code></pre> <p>\u200b\u79fb\u9664\u200b\u56fe\u5c42\u200b</p> <pre><code>root.removeLayer(layer)\n</code></pre> <p>\u200b\u79fb\u9664\u200b\u56fe\u5c42\u200b\u7ec4\u200b</p> <pre><code>root.removeChildNode(node_group2)\n</code></pre> <p>\u200b\u521b\u5efa\u200b\u65b0\u200b\u7684\u200b\u76ee\u5f55\u200b\u6811\u200b</p> <pre><code>root = QgsProject.instance().layerTreeRoot()\nmodel = QgsLayerTreeModel(root)\nview = QgsLayerTreeView()\nview.setModel(model)\nview.show()\n</code></pre> <p>\u200b\u79fb\u52a8\u200b\u8282\u70b9\u200b</p> <pre><code>cloned_group1 = node_group.clone()\nroot.insertChildNode(0, cloned_group1)\nroot.removeChildNode(node_group)\n</code></pre> <p>\u200b\u91cd\u547d\u540d\u200b\u8282\u70b9\u200b</p> <pre><code>cloned_group1.setName(\"Group X\")\nnode_layer1.setName(\"Layer X\")\n</code></pre>"},{"location":"21-PyQGIS%E9%80%9F%E6%9F%A5%E8%A1%A8/#219","title":"21.9 \u200b\u5904\u7406\u200b\u7b97\u6cd5","text":"<p>\u200b\u83b7\u5f97\u200b\u7b97\u6cd5\u200b\u5217\u8868\u200b</p> <p><pre><code>from qgis.core import QgsApplication\n\nfor alg in QgsApplication.processingRegistry().algorithms():\n    if 'buffer' == alg.name():\n        print(\"{}:{} --&gt; {}\".format(alg.provider().name(), alg.name(), alg.displayName()))\n</code></pre> \u200b\u83b7\u5f97\u200b\u7b97\u6cd5\u200b\u5e2e\u52a9\u200b</p> <p><pre><code>from qgis import processing\n\nprocessing.algorithmHelp(\"qgis:randomselection\")\n</code></pre> \u200b\u8fd0\u884c\u200b\u7b97\u6cd5\u200b</p> <p>\u200b\u672c\u200b\u793a\u4f8b\u200b\uff0c\u200b\u7ed3\u679c\u200b\u5b58\u50a8\u200b\u5728\u200b\u6dfb\u52a0\u200b\u5230\u200b\u9879\u76ee\u200b\u7684\u200b\u4e34\u65f6\u200b\u5185\u5b58\u200b\u5c42\u4e2d\u200b\u3002</p> <p><pre><code>from qgis import processing\nresult = processing.run(\"native:buffer\", {'INPUT': layer, 'OUTPUT': 'memory:'})\nQgsProject.instance().addMapLayer(result['OUTPUT'])\n</code></pre> \u200b\u7b97\u6cd5\u200b\u7edf\u8ba1\u200b</p> <p><pre><code>from qgis.core import QgsApplication\n\nlen(QgsApplication.processingRegistry().algorithms())\n</code></pre> \u200b\u6570\u636e\u200b\u63d0\u4f9b\u8005\u200b\u7edf\u8ba1\u200b</p> <p><pre><code>from qgis.core import QgsApplication\n\nlen(QgsApplication.processingRegistry().providers())\n</code></pre> \u200b\u8868\u8fbe\u5f0f\u200b\u7edf\u8ba1\u200b</p> <pre><code>from qgis.core import QgsExpression\n\nlen(QgsExpression.Functions())\n</code></pre>"},{"location":"21-PyQGIS%E9%80%9F%E6%9F%A5%E8%A1%A8/#2110","title":"21.10 \u200b\u88c5\u9970\u200b\u5668","text":"<p>\u200b\u7248\u6743\u200b</p> <pre><code>from qgis.PyQt.Qt import QTextDocument\nfrom qgis.PyQt.QtGui import QFont\n\nmQFont = \"Sans Serif\"\nmQFontsize = 9\nmLabelQString = \"\u00a9 QGIS 2019\"\nmMarginHorizontal = 0\nmMarginVertical = 0\nmLabelQColor = \"#FF0000\"\n\nINCHES_TO_MM = 0.0393700787402 # 1 \u200b\u6beb\u7c73\u200b = 0.0393700787402 \u200b\u82f1\u5bf8\u200b\ncase = 2\n\ndef add_copyright(p, text, xOffset, yOffset):\n    p.translate( xOffset , yOffset  )\n    text.drawContents(p)\n    p.setWorldTransform( p.worldTransform() )\n\ndef _on_render_complete(p):\n    deviceHeight = p.device().height() # \u200b\u83b7\u53d6\u200b\u7ed8\u5236\u200b\u8bbe\u5907\u200b\u9ad8\u5ea6\u200b\n    deviceWidth  = p.device().width() # \u200b\u83b7\u53d6\u200b\u7ed8\u5236\u200b\u8bbe\u5907\u200b\u5bbd\u5ea6\u200b\n    # \u200b\u521b\u5efa\u200b\u4e00\u4e2a\u200b\u65b0\u200b\u7684\u200b\u5bcc\u200b\u6587\u672c\u200b\u5bb9\u5668\u200b\n    text = QTextDocument()\n    font = QFont()\n    font.setFamily(mQFont)\n    font.setPointSize(int(mQFontsize))\n    text.setDefaultFont(font)\n    style = \"&lt;style type=\\\"text/css\\\"&gt; p {color: \" + mLabelQColor + \"}&lt;/style&gt;\"\n    text.setHtml( style + \"&lt;p&gt;\" + mLabelQString + \"&lt;/p&gt;\" )\n    # \u200b\u6587\u672c\u200b\u5927\u5c0f\u200b\n    size = text.size()\n\n    # \u200b\u6e32\u67d3\u200b\n    pixelsInchX  = p.device().logicalDpiX()\n    pixelsInchY  = p.device().logicalDpiY()\n    xOffset  = pixelsInchX  * INCHES_TO_MM * int(mMarginHorizontal)\n    yOffset  = pixelsInchY  * INCHES_TO_MM * int(mMarginVertical)\n\n    # \u200b\u8ba1\u7b97\u200b\u70b9\u4f4d\u200b\n    if case == 0:\n        # \u200b\u5de6\u200b\u4e0a\u200b\n        add_copyright(p, text, xOffset, yOffset)\n\n    elif case == 1:\n        # \u200b\u5de6\u200b\u4e0b\u200b\n        yOffset = deviceHeight - yOffset - size.height()\n        add_copyright(p, text, xOffset, yOffset)\n\n    elif case == 2:\n        # \u200b\u53f3\u200b\u4e0a\u200b\n        xOffset  = deviceWidth  - xOffset - size.width()\n        add_copyright(p, text, xOffset, yOffset)\n\n    elif case == 3:\n        # \u200b\u53f3\u200b\u4e0b\u200b\n        yOffset  = deviceHeight - yOffset - size.height()\n        xOffset  = deviceWidth  - xOffset - size.width()\n        add_copyright(p, text, xOffset, yOffset)\n\n    elif case == 4:\n        # \u200b\u4e0a\u200b\u4e2d\u5fc3\u70b9\u200b\n        xOffset = deviceWidth / 2\n        add_copyright(p, text, xOffset, yOffset)\n\n    else:\n        # \u200b\u4e0b\u200b\u4e2d\u5fc3\u70b9\u200b\n        yOffset = deviceHeight - yOffset - size.height()\n        xOffset = deviceWidth / 2\n        add_copyright(p, text, xOffset, yOffset)\n\n# \u200b\u5f53\u200b\u753b\u5e03\u200b\u6e32\u67d3\u200b\u5b8c\u6210\u200b\u540e\u200b\u53d1\u9001\u200b\u4fe1\u53f7\u200b\niface.mapCanvas().renderComplete.connect(_on_render_complete)\n# \u200b\u91cd\u200b\u7ed8\u753b\u200b\u5e03\u200b\niface.mapCanvas().refresh()\n</code></pre>"},{"location":"21-PyQGIS%E9%80%9F%E6%9F%A5%E8%A1%A8/#2111","title":"21.11 \u200b\u521b\u4f5c\u8005","text":"<p>\u200b\u6309\u200b\u540d\u79f0\u200b\u83b7\u53d6\u200b\u6253\u5370\u200b\u5e03\u5c40\u200b</p> <pre><code>composerTitle = 'MyComposer' # \u200b\u521b\u4f5c\u8005\u200b\u540d\u79f0\u200b\n\nproject = QgsProject.instance()\nprojectLayoutManager = project.layoutManager()\nlayout = projectLayoutManager.layoutByName(composerTitle)\n</code></pre>"},{"location":"21-PyQGIS%E9%80%9F%E6%9F%A5%E8%A1%A8/#2112","title":"21.12 \u200b\u6765\u6e90","text":"<ul> <li>QGIS Python (PyQGIS) API</li> <li>QGIS C++ API</li> <li>StackOverFlow QGIS questions</li> <li>Script by Klas Karlsson</li> </ul>"},{"location":"3-%E5%8A%A0%E8%BD%BD%E5%9B%BE%E5%B1%82/","title":"3 \u200b\u52a0\u8f7d\u200b\u56fe\u5c42","text":"<p>\u200b\u6b64\u200b\u9875\u9762\u200b\u4e0a\u200b\u7684\u200b\u4ee3\u7801\u200b\u7247\u6bb5\u200b\u9700\u8981\u200b\u5bfc\u5165\u200b\u4ee5\u4e0b\u200b\u6a21\u5757\u200b\uff1a</p> <pre><code>import os # pyqgis\u200b\u63a7\u5236\u53f0\u200b\u540c\u6837\u200b\u9700\u8981\u200b\nfrom qgis.core import (\n    QgsVectorLayer\n)\n</code></pre> <p>\u200b\u8ba9\u200b\u6211\u4eec\u200b\u4f7f\u7528\u200b\u6570\u636e\u200b\u6253\u5f00\u200b\u4e00\u4e9b\u200b\u56fe\u5c42\u200b\u3002QGIS\u200b\u53ef\u200b\u8bc6\u522b\u200b\u77e2\u91cf\u200b\u548c\u200b\u6805\u683c\u200b\u56fe\u5c42\u200b\u3002\u200b\u6b64\u5916\u200b\uff0c\u200b\u81ea\u5b9a\u4e49\u200b\u56fe\u5c42\u200b\u7c7b\u578b\u200b\u4e5f\u200b\u53ef\u4ee5\u200b\u4f7f\u7528\u200b\uff0c\u200b\u4f46\u200b\u6211\u4eec\u200b\u4e0d\u200b\u6253\u7b97\u200b\u5728\u200b\u6b64\u200b\u8ba8\u8bba\u200b\u3002</p>"},{"location":"3-%E5%8A%A0%E8%BD%BD%E5%9B%BE%E5%B1%82/#31","title":"3.1 \u200b\u77e2\u91cf\u56fe\u200b\u5c42","text":"<p>\u200b\u521b\u5efa\u200b\u4e00\u4e2a\u200b\u77e2\u91cf\u56fe\u200b\u5c42\u200b\u5b9e\u4f8b\u200b\uff0c\u200b\u6307\u5b9a\u200b\u56fe\u5c42\u200b\u7684\u200b\u6570\u636e\u6e90\u200b\u6807\u8bc6\u200b\u3001\u200b\u56fe\u5c42\u200b\u540d\u79f0\u200b\u548c\u200b\u63d0\u4f9b\u8005\u200b\u540d\u79f0\u200b\uff1a</p> <pre><code># \u200b\u83b7\u53d6\u200bshapefile\u200b\u7684\u200b\u8def\u5f84\u200b\uff0c\u200b\u4f8b\u5982\u200b\uff1a/home/project/data/ports.shp \npath_to_airports_layer = \"testdata/airports.shp\"\n\n# \u200b\u683c\u5f0f\u200b\u4e3a\u200b\uff1a\n# vlayer = QgsVectorLayer(data_source, layer_name, provider_name)\n\nvlayer = QgsVectorLayer(path_to_ports_layer, \"Airports layer\", \"ogr\")\n\nif not vlayer.isValid():\n    print(\"\u200b\u56fe\u5c42\u200b\u52a0\u8f7d\u200b\u5931\u8d25\u200b\uff01\")\nelse:\n    QgsProject.instance().addMapLayer(vlayer)\n</code></pre> <p>\u200b\u6570\u636e\u6e90\u200b\u6807\u8bc6\u200b\u662f\u200b\u4e00\u4e2a\u200b\u5b57\u7b26\u4e32\u200b\uff0c\u200b\u5b83\u200b\u7279\u5b9a\u200b\u4e8e\u200b\u6bcf\u4e2a\u200b\u77e2\u91cf\u200b\u6570\u636e\u200b\u63d0\u4f9b\u8005\u200b\u3002\u200b\u56fe\u5c42\u200b\u540d\u79f0\u200b\u7528\u4e8e\u200b\u56fe\u5c42\u200b\u5217\u8868\u200b\u90e8\u4ef6\u200b\u3002\u200b\u68c0\u67e5\u200b\u56fe\u5c42\u200b\u662f\u5426\u200b\u5df2\u200b\u6210\u529f\u200b\u52a0\u8f7d\u200b\u975e\u5e38\u200b\u91cd\u8981\u200b\u3002\u200b\u5982\u679c\u200b\u4e0d\u662f\u200b\uff0c\u200b\u5219\u200b\u8fd4\u56de\u200b\u65e0\u6548\u200b\u7684\u200b\u56fe\u5c42\u200b\u5b9e\u4f8b\u200b\u3002</p> <p><code>geopackage</code>\u200b\u77e2\u91cf\u56fe\u200b\u5c42\u200b\uff1a</p> <pre><code># \u200b\u83b7\u53d6\u200bgeopackage\u200b\u7684\u200b\u8def\u5f84\u200b\uff0c\u200b\u4f8b\u5982\u200b\uff1a/home/project/data/data.gpkg \npath_to_gpkg = os.path.join(QgsProject.instance().homePath(), \"data\", \"data.gpkg\")\n# \u200b\u8ffd\u52a0\u200b\u56fe\u5c42\u200b\u540d\u79f0\u200b\ngpkg_places_layer = path_to_gpkg + \"|layername=places\"\n# \u200b\u4f8b\u5982\u200b\uff1agpkg_places_layer = \"/home/project/data/data.gpkg|layername=places\"\nvlayer = QgsVectorLayer(gpkg_places_layer, \"Places layer\", \"ogr\")\nif not vlayer.isValid():\n    print(\"\u200b\u56fe\u5c42\u200b\u52a0\u8f7d\u200b\u5931\u8d25\u200b\uff01\")\nelse:\n    QgsProject.instance().addMapLayer(vlayer)\n</code></pre> <p>\u200b\u5728\u200bQGIS\u200b\u4e2d\u200b\u6253\u5f00\u200b\u5e76\u200b\u663e\u793a\u200b\u77e2\u91cf\u56fe\u200b\u5c42\u200b\u7684\u200b\u6700\u5feb\u200b\u65b9\u5f0f\u200b\u662f\u200b\u4f7f\u7528\u200b<code>QgisInterface</code>\u200b\u7c7b\u200b\u7684\u200b <code>addVectorLayer()</code> \u200b\u65b9\u6cd5\u200b\uff1a</p> <pre><code>vlayer = iface.addVectorLayer(path_to_ports_layer, \"Ports layer\", \"ogr\")\nif not vlayer:\n    print(\"\u200b\u56fe\u5c42\u200b\u52a0\u8f7d\u200b\u5931\u8d25\u200b\uff01\")\n</code></pre> <p>\u200b\u8fd9\u200b\u5c06\u200b\u521b\u5efa\u200b\u4e00\u4e2a\u200b\u65b0\u200b\u56fe\u5c42\u200b\uff0c\u200b\u5e76\u200b\u5c06\u200b\u5176\u200b\u6dfb\u52a0\u200b\u5230\u200b\u5f53\u524d\u200bQGIS\u200b\u9879\u76ee\u200b\u4e2d\u200b\uff08\u200b\u4f7f\u200b\u5176\u200b\u663e\u793a\u200b\u5728\u200b\u56fe\u5c42\u200b\u5217\u8868\u200b\u4e2d\u200b\uff09\u3002\u200b\u8be5\u200b\u51fd\u6570\u200b\u8fd4\u56de\u200b\u56fe\u5c42\u200b\u5b9e\u4f8b\u200b\uff0c\u200b\u5982\u679c\u200b\u65e0\u6cd5\u200b\u52a0\u8f7d\u200b\u56fe\u5c42\u200b\u5219\u200b\u8fd4\u56de\u200b<code>None</code> \u3002</p> <p>\u200b\u4ee5\u4e0b\u200b\u5217\u8868\u200b\u5c55\u793a\u200b\u4e86\u200b\u5982\u4f55\u200b\u4f7f\u7528\u200b\u77e2\u91cf\u200b\u6570\u636e\u200b\u63d0\u4f9b\u8005\u200b\u8bbf\u95ee\u200b\u5404\u79cd\u200b\u6570\u636e\u6e90\u200b\uff1a</p> <ul> <li> <p>GDAL \u200b\u5e93\u200b\uff08Shapefile\u200b\u548c\u200b\u8bb8\u591a\u200b\u5176\u4ed6\u200b\u6587\u4ef6\u683c\u5f0f\u200b\uff09\u2014\u2014\u200b\u6570\u636e\u6e90\u200b\u662f\u200b\u6587\u4ef6\u200b\u7684\u200b\u8def\u5f84\u200b\uff1a</p> </li> <li> <p>Shapefile\uff1a</p> <pre><code>vlayer = QgsVectorLayer(\"/path/to/shapefile/file.shp\", \"layer_name_you_like\", \"ogr\")\nQgsProject.instance().addMapLayer(vlayer)\n</code></pre> </li> <li> <p>dxf\uff08\u200b\u6ce8\u610f\u200b\u6570\u636e\u6e90\u200buri\u200b\u4e2d\u200b\u7684\u200b\u5185\u90e8\u200b\u9009\u9879\u200b\uff09\uff1a</p> <pre><code>uri = \"/path/to/dxffile/file.dxf|layername=entities|geometrytype=Point\"\nvlayer = QgsVectorLayer(uri, \"layer_name_you_like\", \"ogr\")\nQgsProject.instance().addMapLayer(vlayer)\n</code></pre> </li> <li> <p>PostGIS \u200b\u6570\u636e\u5e93\u200b\u2014\u2014\u200b\u6570\u636e\u6e90\u200b\u662f\u200b\u4e00\u4e2a\u200b\u5b57\u7b26\u4e32\u200b\uff0c\u200b\u5176\u4e2d\u200b\u5305\u542b\u200b\u4e0e\u200bPostgreSQL\u200b\u6570\u636e\u5e93\u200b\u521b\u5efa\u200b\u8fde\u63a5\u200b\u6240\u200b\u9700\u200b\u7684\u200b\u6240\u6709\u200b\u4fe1\u606f\u200b\u3002</p> <p><code>QgsDataSourceUri</code>\u200b\u7c7b\u200b\u53ef\u4ee5\u200b\u4e3a\u200b\u4f60\u200b\u751f\u6210\u200b\u8fd9\u4e2a\u200b\u5b57\u7b26\u4e32\u200b\u3002\u200b\u8bf7\u200b\u6ce8\u610f\u200b\uff0c\u200b\u5fc5\u987b\u200b\u5728\u200b\u7f16\u8bd1\u200bQGIS\u200b\u65f6\u200b\u652f\u6301\u200bPostgres\uff0c\u200b\u5426\u5219\u200b\u6b64\u200b\u63d0\u4f9b\u8005\u200b\u4e0d\u53ef\u200b\u7528\u200b\uff1a</p> <pre><code>uri = QgsDataSourceUri()\n# \u200b\u8bbe\u7f6e\u200b\u4e3b\u673a\u200b\uff0c\u200b\u7aef\u53e3\u200b\uff0c\u200b\u6570\u636e\u5e93\u200b\u540d\u79f0\u200b\uff0c\u200b\u7528\u6237\u540d\u200b\u548c\u200b\u5bc6\u7801\u200b\nuri.setConnection(\"localhost\", \"5432\", \"dbname\", \"johny\", \"xxx\")\n# \u200b\u8bbe\u7f6e\u200b\u6570\u636e\u5e93\u200b\u67b6\u6784\u200b\uff0c\u200b\u8868\u540d\u200b\uff0c\u200b\u51e0\u4f55\u200b\u5217\u200b\u548c\u200b\u53ef\u9009\u9879\u200b\uff08WHERE \u200b\u8bed\u53e5\u200b\uff09\nuri.setDataSource(\"public\", \"roads\", \"the_geom\", \"cityid = 2643\", \"primary_key_field\")\nvlayer = QgsVectorLayer(uri.uri(False), \"layer name you like\", \"postgres\")\n</code></pre> </li> </ul> <p>:   !!! \u200b\u63d0\u793a\u200b</p> <pre><code>    `uri.uri(False)`\u200b\u4e2d\u200b\u7684\u200b`False`\u200b\u53c2\u6570\u200b\u53ef\u4ee5\u200b\u9632\u6b62\u200b\u6269\u5c55\u200b\u8ba4\u8bc1\u200b\u914d\u7f6e\u200b\u53c2\u6570\u200b\uff0c\u200b\u5982\u679c\u200b\u4f60\u200b\u6ca1\u6709\u200b\u4f7f\u7528\u200b\u4efb\u4f55\u200b\u8eab\u4efd\u9a8c\u8bc1\u200b\u914d\u7f6e\u200b\uff0c\u200b\u5219\u200b\u6b64\u53c2\u6570\u200b\u4e0d\u4f1a\u200b\u4ea7\u751f\u200b\u4efb\u4f55\u200b\u5dee\u5f02\u200b\u3002\n</code></pre> <ul> <li> <p>CSV\u200b\u6216\u200b\u5176\u4ed6\u200b\u5206\u9694\u200b\u7684\u200b\u6587\u672c\u6587\u4ef6\u200b\u2014\u2014\u200b\u6253\u5f00\u200b\u4e00\u4e2a\u200b\u7528\u5206\u200b\u53f7\u200b\u4f5c\u4e3a\u200b\u5206\u9694\u7b26\u200b\u7684\u200b\u6587\u4ef6\u200b\uff0cX\u200b\u5750\u6807\u200b\u4f7f\u7528\u200b\u5b57\u200b\u6bb5\u200b\u201cx\u201d\uff0cY\u200b\u5750\u6807\u200b\u4f7f\u7528\u200b\u5b57\u200b\u6bb5\u200b\u201cy\u201d\uff1a</p> <pre><code>uri = \"file://{}/testdata/delimited_xy.csv?delimiter={}&amp;xField={}&amp;yField={}\".format(os.getcwd(), \";\", \"x\", \"y\")\nvlayer = QgsVectorLayer(uri, \"layer name you like\", \"delimitedtext\")\nQgsProject.instance().addMapLayer(vlayer)\n</code></pre> </li> </ul> <p>:   !!! \u200b\u63d0\u793a\u200b</p> <pre><code>    \u200b\u63d0\u4f9b\u8005\u200b\u7684\u200b\u5b57\u7b26\u4e32\u200b\u4f5c\u4e3a\u200b\u4e00\u4e2a\u200bURL\uff0c\u200b\u56e0\u6b64\u200b\u8def\u5f84\u200b\u5fc5\u987b\u200b\u4ee5\u200bfile://\u200b\u4e3a\u200b\u524d\u7f00\u200b\u3002\u200b\u5b83\u200b\u8fd8\u200b\u5141\u8bb8\u200bWKT\uff08(well known text\uff09\u200b\u683c\u5f0f\u200b\u7684\u200b\u51e0\u4f55\u200b\u4f5c\u4e3a\u200b`x`\u200b\u548c\u200b`y`\u200b\u7684\u200b\u66ff\u4ee3\u200b\u5b57\u200b\u6bb5\u200b\uff0c\u200b\u5e76\u200b\u5141\u8bb8\u200b\u6307\u5b9a\u200b\u5750\u6807\u200b\u53c2\u8003\u200b\u7cfb\u7edf\u200b\u3002\u200b\u4f8b\u5982\u200b\uff1a\n\n    ```python\n    uri = \"file:///some/path/file.csv?delimiter={}&amp;crs=epsg:4723&amp;wktField={}\".format(\";\", \"shape\")\n    ```\n</code></pre> <ul> <li>GPX\u200b\u6587\u4ef6\u200b\u2014\u2014\u201cgpx\u201d\u200b\u6570\u636e\u200b\u63d0\u4f9b\u8005\u200b\u4ece\u200bgpx\u200b\u6587\u4ef6\u200b\u4e2d\u200b\u8bfb\u53d6\u200b\u8f68\u8ff9\u200b\uff0c\u200b\u8def\u7ebf\u200b\u548c\u200b\u8def\u70b9\u200b\u3002\u200b\u8981\u200b\u6253\u5f00\u200b\u6587\u4ef6\u200b\uff0c\u200b\u9700\u8981\u200b\u5728\u200burl\u200b\u4e2d\u200b\u6307\u5b9a\u200b\u7c7b\u578b\u200b\uff08track / route / waypoint\uff09\uff1a</li> </ul> <pre><code>uri = \"path/to/gpx/file.gpx?type=track\"\nvlayer = QgsVectorLayer(uri, \"layer name you like\", \"gpx\")\nQgsProject.instance().addMapLayer(vlayer)\n</code></pre> <ul> <li>SpatiaLite\u200b\u6570\u636e\u5e93\u200b\u2014\u2014\u200b\u4e0e\u200bPostGIS\u200b\u6570\u636e\u5e93\u200b\u7c7b\u4f3c\u200b\uff0c <code>QgsDataSourceUri</code>\u200b\u53ef\u200b\u7528\u4e8e\u200b\u751f\u6210\u200b\u6570\u636e\u6e90\u200b\u6807\u8bc6\u200b\uff1a</li> </ul> <pre><code>uri = QgsDataSourceUri()\nuri.setDatabase('/home/martin/test-2.3.sqlite')\nschema = ''\ntable = 'Towns'\ngeom_column = 'Geometry'\nuri.setDataSource(schema, table, geom_column)\ndisplay_name = 'Towns'\nvlayer = QgsVectorLayer(uri.uri(), display_name, 'spatialite')\nQgsProject.instance().addMapLayer(vlayer)\n</code></pre> <ul> <li>\u200b\u57fa\u4e8e\u200bMySQL WKB\u200b\u7684\u200b\u51e0\u4f55\u200b\uff0c\u200b\u901a\u8fc7\u200bGDAL\u2014\u2014\u200b\u6570\u636e\u6e90\u200b\u662f\u200b\u8fde\u63a5\u200b\u8868\u200b\u7684\u200b\u5b57\u7b26\u4e32\u200b\uff1a</li> </ul> <pre><code>uri = \"MySQL:dbname,host=localhost,port=3306,user=root,password=xxx|layername=my_table\"\nvlayer = QgsVectorLayer( uri, \"my table\", \"ogr\" )\nQgsProject.instance().addMapLayer(vlayer)\n</code></pre> <ul> <li>WFS\u200b\u8fde\u63a5\u200b\uff1a\u200b\u8fde\u63a5\u200b\u4f7f\u7528\u200bURI\u200b\u5b9a\u4e49\u200b\u5e76\u200b\u4f7f\u7528\u200b<code>WFS</code>\u200b\u63d0\u4f9b\u8005\u200b\uff1a</li> </ul> <p><pre><code>uri = \"https://demo.geo-solutions.it/geoserver/ows?service=WFS&amp;version=1.1.0&amp;request=GetFeature&amp;typename=geosolutions:regioni\"\nvlayer = QgsVectorLayer(uri, \"my wfs layer\", \"WFS\")\n</code></pre>   \u200b\u53ef\u4ee5\u200b\u4f7f\u7528\u200b\u6807\u51c6\u200b\u5e93\u200b<code>urllib</code>\u200b\u521b\u5efa\u200buri\uff1a   <pre><code>import urllib\n\nparams = {\n    'service': 'WFS',\n    'version': '1.1.0',\n    'request': 'GetFeature',\n    'typename': 'geosolutions:regioni',\n    'srsname': \"EPSG:4326\"\n}\nuri2 = 'https://demo.geo-solutions.it/geoserver/ows?' + urllib.parse.unquote(urllib.parse.urlencode(params))\n</code></pre></p> <p>:   !!! \u200b\u63d0\u793a\u200b</p> <pre><code>     \u200b\u53ef\u4ee5\u200b\u901a\u8fc7\u200b\u8c03\u7528\u200b[`QgsVectorLayer`](https://qgis.org/pyqgis/master/core/QgsVectorLayer.html#qgis.core.QgsVectorLayer)\u200b\u7684\u200b [`setDataSource()`](https://qgis.org/pyqgis/master/core/QgsMapLayer.html#qgis.core.QgsMapLayer.setDataSource) \u200b\u65b9\u6cd5\u200b\u66f4\u6539\u200b\u73b0\u6709\u200b\u56fe\u5c42\u200b\u7684\u200b\u6570\u636e\u6e90\u200b\uff0c\u200b\u5982\u200b\u4e0b\u9762\u200b\u4f8b\u5b50\u200b\uff1a\n\n    ```python\n    uri = \"https://demo.geo-solutions.it/geoserver/ows?service=WFS&amp;version=1.1.0&amp;request=GetFeature&amp;typename=geosolutions:regioni\"\n    provider_options = QgsDataProvider.ProviderOptions()\n    # \u200b\u4f7f\u7528\u200b\u9879\u76ee\u200b\u7684\u200b\u8f6c\u6362\u200b\u4e0a\u4e0b\u6587\u200b\n    provider_options.transformContext = QgsProject.instance().transformContext()\n    vlayer.setDataSource(uri, \"layer name you like\", \"WFS\", provider_options)\n\n    del(vlayer)\n    ```\n</code></pre>"},{"location":"3-%E5%8A%A0%E8%BD%BD%E5%9B%BE%E5%B1%82/#32","title":"3.2 \u200b\u6805\u683c\u200b\u56fe\u5c42","text":"<p>\u200b\u8bbf\u95ee\u200b\u6805\u683c\u200b\u6587\u4ef6\u200b\uff0c\u200b\u7528\u5230\u200b\u4e86\u200bGDAL\u200b\u5e93\u200b\u3002\u200b\u5b83\u200b\u652f\u6301\u200b\u591a\u79cd\u200b\u6587\u4ef6\u683c\u5f0f\u200b\u3002\u200b\u5982\u679c\u200b\u4f60\u200b\u5728\u200b\u6253\u5f00\u200b\u67d0\u4e9b\u200b\u6587\u4ef6\u200b\u65f6\u200b\u9047\u5230\u200b\u95ee\u9898\u200b\uff0c\u200b\u8bf7\u200b\u68c0\u67e5\u200b\u4f60\u200b\u7684\u200bGDAL\u200b\u662f\u5426\u200b\u652f\u6301\u200b\uff08\u200b\u9ed8\u8ba4\u200b\u60c5\u51b5\u200b\u4e0b\u200b\u5e76\u975e\u200b\u6240\u6709\u200b\u683c\u5f0f\u200b\u90fd\u200b\u53ef\u7528\u200b\uff09\u3002\u200b\u4ece\u6587\u4ef6\u200b\u52a0\u8f7d\u200b\u6805\u683c\u200b\uff0c\u200b\u9700\u8981\u200b\u6307\u5b9a\u200b\u5176\u200b\u6587\u4ef6\u540d\u200b\u548c\u200b\u663e\u793a\u200b\u540d\u79f0\u200b\uff1a</p> <pre><code># \u200b\u83b7\u53d6\u200btif\u200b\u6587\u4ef6\u200b\u7684\u200b\u8def\u5f84\u200b\uff0c\u200b\u4f8b\u5982\u200b\uff1a/home/project/data/srtm.tif \npath_to_tif = \"qgis-projects/python_cookbook/data/srtm.tif\"\nrlayer = QgsRasterLayer(path_to_tif, \"SRTM layer name\")\nif not rlayer.isValid():\n    print(\"\u200b\u56fe\u5c42\u200b\u52a0\u8f7d\u200b\u5931\u8d25\u200b\uff01\")\n</code></pre> <p>\u200b\u4ece\u200b<code>geopackage</code>\u200b\u4e2d\u200b\u52a0\u8f7d\u200b\u6805\u683c\u200b\uff1a</p> <pre><code># \u200b\u83b7\u53d6\u200bgeopackage\u200b\u7684\u200b\u8def\u5f84\u200b\uff0c\u200b\u4f8b\u5982\u200b\uff1a/home/project/data/data.gpkg \npath_to_gpkg = os.path.join(os.getcwd(), \"testdata\", \"sublayers.gpkg\")\n# gpkg_raster_layer = \"GPKG:/home/project/data/data.gpkg:srtm\"\ngpkg_raster_layer = \"GPKG:\" + path_to_gpkg + \":srtm\"\nrlayer = QgsRasterLayer(gpkg_raster_layer, \"layer name you like\", \"gdal\")\nif not rlayer.isValid():\n    print(\"\u200b\u56fe\u5c42\u200b\u52a0\u8f7d\u200b\u5931\u8d25\u200b\uff01\")\n</code></pre> <p>\u200b\u4e0e\u200b\u77e2\u91cf\u56fe\u200b\u5c42\u200b\u7c7b\u4f3c\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u4f7f\u7528\u200b<code>QgisInterface</code>\u200b\u5bf9\u8c61\u200b\u7684\u200b<code>addRasterLayer</code>\u200b\u51fd\u6570\u200b\u52a0\u8f7d\u200b\u6805\u683c\u200b\u56fe\u5c42\u200b\uff1a</p> <pre><code>iface.addRasterLayer(\"/path/to/raster/file.tif\", \"layer name you like\")\n</code></pre> <p>\u200b\u8fd9\u200b\u5c06\u200b\u521b\u5efa\u200b\u4e00\u4e2a\u200b\u65b0\u200b\u56fe\u5c42\u200b\uff0c\u200b\u5e76\u200b\u5c06\u200b\u5176\u200b\u6dfb\u52a0\u200b\u5230\u200b\u5f53\u524d\u200b\u9879\u76ee\u200b\u4e2d\u200b\uff08\u200b\u4f7f\u200b\u5176\u200b\u663e\u793a\u200b\u5728\u200b\u56fe\u5c42\u200b\u5217\u8868\u200b\u4e2d\u200b\uff09\u3002</p>"},{"location":"3-%E5%8A%A0%E8%BD%BD%E5%9B%BE%E5%B1%82/#321-postgis","title":"3.2.1 \u200b\u52a0\u8f7d\u200bPostGIS\u200b\u6805\u683c\u200b\u56fe\u5c42","text":"<p>PostGIS\u200b\u6805\u683c\u200b\u56fe\u5c42\u200b\uff0c\u200b\u7c7b\u4f3c\u200b\u4e8e\u200bPostGIS\u200b\u77e2\u91cf\u56fe\u200b\u5c42\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u4f7f\u7528\u200bURI\u200b\u5b57\u7b26\u4e32\u200b\u6dfb\u52a0\u200b\u5230\u200b\u9879\u76ee\u200b\u4e2d\u200b\u3002\u200b\u4e3a\u200b\u6570\u636e\u5e93\u200b\u8fde\u63a5\u200b\u53c2\u6570\u200b\u4fdd\u7559\u200b\u53ef\u200b\u590d\u7528\u200b\u5b57\u5178\u200b\u662f\u200b\u6709\u6548\u200b\u7684\u200b\u3002\u200b\u8fd9\u6837\u200b\u53ef\u4ee5\u200b\u8f7b\u677e\u200b\u7f16\u8f91\u200b\u9002\u7528\u200b\u8fde\u63a5\u200b\u7684\u200b\u5b57\u5178\u200b\u3002\u200b\u4f7f\u7528\u200b<code>postgresraster</code>\u200b\u63d0\u4f9b\u8005\u200b\u7684\u200b\u5143\u200b\u6570\u636e\u200b\u5bf9\u8c61\u200b\u5c06\u200b\u5b57\u5178\u200b\u7f16\u7801\u200b\u4e3a\u200bURI\u3002\u200b\u4e4b\u540e\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u5c06\u200b\u6805\u683c\u200b\u56fe\u5c42\u200b\u6dfb\u52a0\u200b\u5230\u200b\u9879\u76ee\u200b\u4e2d\u200b\u3002</p> <pre><code>uri_config = {\n    # \u200b\u6570\u636e\u5e93\u200b\u53c2\u6570\u200b\n    'dbname':'gis_db',      # \u200b\u6570\u636e\u5e93\u200b\u540d\u79f0\u200b\n    'host':'localhost',     # IP\u200b\u5730\u5740\u200b\u6216\u8005\u200blocalhost\n    'port':'5432',          # \u200b\u7aef\u53e3\u200b\n    'sslmode':QgsDataSourceUri.SslDisable, # SslAllow, SslPrefer, SslRequire, SslVerifyCa, SslVerifyFull\n    # \u200b\u5982\u679c\u200b\u5b58\u50a8\u200b\u5728\u200bauthcfg\u200b\u6216\u200b\u670d\u52a1\u200b\u4e2d\u200b\uff0c\u200b\u5219\u200b\u4e0d\u200b\u9700\u8981\u200b\u7528\u6237\u540d\u200b\u548c\u200b\u5bc6\u7801\u200b\n    'authcfg':'QconfigId',  # QGIS\u200b\u8ba4\u8bc1\u200b\u6570\u636e\u5e93\u200bID\u200b\u5305\u542b\u200b\u8fde\u63a5\u200b\u4fe1\u606f\u200b\n    'service': None,         # \u200b\u8fde\u63a5\u200b\u6570\u636e\u5e93\u200b\u7684\u200b\u670d\u52a1\u200b\n    'username':None,        # \u200b\u7528\u6237\u540d\u200b\n    'password':None,        # \u200b\u5bc6\u7801\u200b\n    # \u200b\u6570\u636e\u5e93\u200b\u8868\u200b\u548c\u200b\u6805\u683c\u200b\u5b57\u200b\u6bb5\u200b\u4fe1\u606f\u200b\n    'schema':'public',      # \u200b\u6570\u636e\u5e93\u200b\u67b6\u6784\u200b\n    'table':'my_rasters',   # \u200b\u6570\u636e\u5e93\u200b\u8868\u200b\u540d\u79f0\u200b\n    'geometrycolumn':'rast',# \u200b\u6805\u683c\u200b\u5b57\u6bb5\u540d\u200b\u79f0\u200b\n    'sql':None,             # WHERE\u200b\u67e5\u8be2\u200b\u8bed\u53e5\u200b\uff0c\u200b\u5e94\u8be5\u200b\u653e\u5728\u200b\u5b57\u7b26\u4e32\u200b\u672b\u5c3e\u200b\u3002\n    'key':None,             # \u200b\u6570\u636e\u5e93\u200b\u8868\u200b\u4e3b\u952e\u200b\n    'srid':None,            # \u200b\u5b57\u7b26\u4e32\u200b\uff0c\u200b\u6307\u5b9a\u200b\u5750\u6807\u200b\u53c2\u8003\u7cfb\u200b\n    'estimatedmetadata':'False', # A boolean value telling if the metadata is estimated.\n    'type':None,            # WKT\u200b\u5b57\u7b26\u4e32\u200b\uff0c\u200b\u6307\u5b9a\u200bWKB\u200b\u7c7b\u578b\u200b\n    'selectatid':None,      # \u200b\u8bbe\u7f6e\u200b\u4e3a\u200bTrue\u200b\u53ef\u200b\u7981\u7528\u200b\u6309\u200b\u8981\u7d20\u200bID\u200b\u8fdb\u884c\u200b\u7684\u200b\u9009\u62e9\u200b\u3002\n    'options':None,         # \u200b\u4e0d\u5728\u6b64\u5217\u200b\u8868\u4e2d\u200b\u7684\u200b\u5176\u4ed6\u200bPostgreSQL\u200b\u8fde\u63a5\u200b\u9009\u9879\u200b\u3002\n    'enableTime': None,\n    'temporalDefaultTime': None,\n    'temporalFieldIndex': None,\n    'mode':'2',             # GDAL\u200b\u53c2\u6570\u200b, 2 unions raster tiles, 1 adds tiles separately (may require user input)\n}\n# \u200b\u5220\u9664\u200b\u7a7a\u200b\u53c2\u6570\u200b\nuri_config = {key:val for key, val in uri_config.items() if val is not None}\n# \u200b\u83b7\u53d6\u6570\u636e\u200b\u63d0\u4f9b\u8005\u200b\u548c\u200b\u914d\u7f6e\u200b\u7684\u200b\u5143\u200b\u6570\u636e\u200b\nmd = QgsProviderRegistry.instance().providerMetadata('postgresraster')\nuri = QgsDataSourceUri(md.encodeUri(uri_config))\n\n# \u200b\u52a0\u8f7d\u200b\u6805\u683c\u200b\u56fe\u5c42\u200b\u5230\u200b\u9879\u76ee\u200b\nrlayer = iface.addRasterLayer(uri.uri(False), \"raster layer name\", \"postgresraster\")\n</code></pre>"},{"location":"3-%E5%8A%A0%E8%BD%BD%E5%9B%BE%E5%B1%82/#322-wcs","title":"3.2.2 \u200b\u52a0\u8f7d\u200bWCS\u200b\u670d\u52a1\u200b\u6805\u683c\u200b\u56fe\u5c42\u200b\uff1a","text":"<pre><code>layer_name = 'nurc:mosaic'\nuri = \"https://demo.geo-solutions.it/geoserver/ows?identifier={}\".format(layer_name)\nrlayer = QgsRasterLayer(uri, 'my wcs layer', 'wcs')\n</code></pre> <p>\u200b\u4ee5\u4e0b\u200b\u662f\u200bWCS URI\u200b\u53ef\u4ee5\u200b\u5305\u542b\u200b\u7684\u200b\u53c2\u6570\u200b\u8bf4\u660e\u200b\uff1a</p> <p>WCS URI\u200b\u7531\u200b \u200b\u952e\u200b=\u200b\u503c\u200b \u200b\u5bf9\u200b\u7ec4\u6210\u200b\uff0c\u200b\u5206\u9694\u7b26\u200b\uff1a<code>&amp;</code>\u3002\u200b\u5b83\u200b\u4e0e\u200bURL\u200b\u4e2d\u200b\u7684\u200b\u67e5\u8be2\u200b\u5b57\u7b26\u4e32\u200b\u683c\u5f0f\u200b\u76f8\u540c\u200b\uff0c\u200b\u7f16\u7801\u65b9\u5f0f\u200b\u76f8\u540c\u200b\u3002<code>QgsDataSourceUri</code> \u200b\u53ef\u4ee5\u200b\u7528\u4e8e\u200b\u6784\u9020\u200bURI\u200b\u4ee5\u200b\u786e\u4fdd\u200b\u6b63\u786e\u200b\u7f16\u7801\u200b\u7279\u6b8a\u5b57\u7b26\u200b\u3002</p> <ul> <li>url\uff08\u200b\u5fc5\u586b\u200b\uff09\uff1aWCS\u200b\u670d\u52a1\u5668\u200bURL\u3002\u200b\u4e0d\u8981\u200b\u5728\u200bURL\u200b\u4e2d\u200b\u4f7f\u7528\u200bVERSION\uff0c\u200b\u56e0\u4e3a\u200b\u6bcf\u4e2a\u200b\u7248\u672c\u200b\u7684\u200bWCS\u200b\u5bf9\u200b GetCapabilities \u200b\u7248\u672c\u200b\u4f7f\u7528\u200b\u4e0d\u540c\u200b\u7684\u200b\u53c2\u6570\u200b\u540d\u79f0\u200b\uff0c\u200b\u8bf7\u53c2\u9605\u200bparam\u200b\u7248\u672c\u200b\u3002</li> <li>identifier\uff08\u200b\u5fc5\u586b\u200b\uff09\uff1a\u200b\u8986\u76d6\u8303\u56f4\u200b\u540d\u79f0\u200b</li> <li>time\uff08\u200b\u53ef\u200b\u9009\u200b\uff09\uff1a\u200b\u65f6\u95f4\u200b\u4f4d\u7f6e\u200b\u6216\u200b\u65f6\u95f4\u6bb5\u200b\uff08beginPosition / endPosition / timeResolution\uff09</li> <li>format\uff08\u200b\u53ef\u200b\u9009\u200b\uff09\uff1a\u200b\u652f\u6301\u200b\u7684\u200b\u683c\u5f0f\u200b\u540d\u79f0\u200b\u3002\u200b\u9ed8\u8ba4\u200b\u662f\u200b\u7b2c\u4e00\u4e2a\u200b\u652f\u6301\u200b\u7684\u200b\u683c\u5f0f\u200b\uff0c\u200b\u5176\u200b\u540d\u79f0\u200b\u4e3a\u200btif\u200b\u6216\u200b\u7b2c\u4e00\u4e2a\u200b\u652f\u6301\u200b\u7684\u200b\u683c\u5f0f\u200b\u3002</li> <li>crs\uff08\u200b\u53ef\u200b\u9009\u200b\uff09\uff1aCRS\u200b\u683c\u5f0f\u200b\u4e3a\u200bAUTHORITY:ID\uff0c\u200b\u4f8b\u5982\u200b\uff0cEPSG:4326\u3002\u200b\u9ed8\u8ba4\u200b\u4e3a\u200bEPSG:4326\uff08\u200b\u5982\u679c\u200b\u652f\u6301\u200b\uff09\u200b\u6216\u200b\u7b2c\u4e00\u4e2a\u200b\u652f\u6301\u200b\u7684\u200bCRS\u3002</li> <li>username\uff08\u200b\u53ef\u200b\u9009\u200b\uff09\uff1a\u200b\u57fa\u672c\u200b\u8eab\u4efd\u9a8c\u8bc1\u200b\u7684\u200b\u7528\u6237\u540d\u200b\u3002</li> <li>password\uff08\u200b\u53ef\u200b\u9009\u200b\uff09\uff1a\u200b\u57fa\u672c\u200b\u8eab\u4efd\u9a8c\u8bc1\u200b\u7684\u200b\u5bc6\u7801\u200b\u3002</li> <li>IgnoreGetMapUrl\uff08\u200b\u53ef\u200b\u9009\u200b\uff0chack\uff09\uff1a\u200b\u5982\u679c\u200b\u6307\u5b9a\u200b\uff08\u200b\u8bbe\u7f6e\u200b\u4e3a\u200b1\uff09\uff0c\u200b\u5219\u200b\u5ffd\u7565\u200bGetCapabilities\u200b\u516c\u5e03\u200b\u7684\u200bGetCoverage URL\u3002\u200b\u5982\u679c\u200b\u672a\u200b\u6b63\u786e\u200b\u914d\u7f6e\u200b\u670d\u52a1\u5668\u200b\uff0c\u200b\u5219\u200b\u53ef\u80fd\u200b\u9700\u8981\u200b\u3002</li> <li>InvertAxisOrientation\uff08\u200b\u53ef\u200b\u9009\u200b\uff0chack\uff09\uff1a\u200b\u5982\u679c\u200b\u6307\u5b9a\u200b\uff08\u200b\u8bbe\u7f6e\u200b\u4e3a\u200b1\uff09\uff0c\u200b\u5219\u200b\u5728\u200bGetCoverage\u200b\u8bf7\u6c42\u200b\u4e2d\u200b\u5207\u6362\u200b\u8f74\u200b\u3002\u200b\u5982\u679c\u200b\u670d\u52a1\u5668\u200b\u4f7f\u7528\u200b\u9519\u8bef\u200b\u7684\u200b\u8f74\u200b\u987a\u5e8f\u200b\uff0c\u200b\u5219\u200b\u53ef\u80fd\u200b\u9700\u8981\u200b\u5730\u7406\u200bCRS\u3002</li> <li>IgnoreAxisOrientation\uff08\u200b\u53ef\u200b\u9009\u200b\uff0chack\uff09\uff1a\u200b\u5982\u679c\u200b\u6307\u5b9a\u200b\uff08\u200b\u8bbe\u7f6e\u200b\u4e3a\u200b1\uff09\uff0c\u200b\u5219\u200b\u4e0d\u8981\u200b\u6839\u636e\u200b\u5730\u7406\u200bCRS\u200b\u7684\u200bWCS\u200b\u6807\u51c6\u200b\u53cd\u200b\u8f6c\u8f74\u200b\u65b9\u5411\u200b\u3002</li> <li>cache\uff08\u200b\u53ef\u200b\u9009\u200b\uff09\uff1a\u200b\u7f13\u5b58\u200b\u52a0\u8f7d\u200b\u63a7\u5236\u200b\uff0c\u200b\u5982\u200bQNetworkRequest :: CacheLoadControl\u200b\u4e2d\u200b\u6240\u8ff0\u200b\uff0c\u200b\u4f46\u200b\u5982\u679c\u200b\u4f7f\u7528\u200bAlwaysCache\u200b\u5931\u8d25\u200b\uff0c\u200b\u8bf7\u6c42\u200b\u5c06\u200b\u91cd\u65b0\u200b\u53d1\u9001\u200b\u4e3a\u200bPreferCache\u3002\u200b\u5141\u8bb8\u200b\u7684\u200b\u503c\u200b\uff1aAlwaysCache\uff0cPreferCache\uff0cPreferNetwork\uff0cAlwaysNetwork\u3002\u200b\u9ed8\u8ba4\u200b\u4e3a\u200bAlwaysCache\u3002</li> </ul> <p>\u200b\u53e6\u5916\u200b\uff0c\u200b\u4f60\u200b\u53ef\u4ee5\u200b\u4ece\u200bWMS\u200b\u670d\u52a1\u5668\u200b\u52a0\u8f7d\u200b\u6805\u683c\u200b\u56fe\u5c42\u200b\u3002\u200b\u4f46\u662f\u200b\u76ee\u524d\u200b\u65e0\u6cd5\u200b\u4ece\u200bAPI\u200b\u8bbf\u95ee\u200bGetCapabilities\u200b\u54cd\u5e94\u200b\u2014\u2014\u200b\u4f60\u200b\u5fc5\u987b\u200b\u77e5\u9053\u200b\u6240\u200b\u9700\u200b\u7684\u200b\u56fe\u5c42\u200b\uff1a</p> <pre><code>urlWithParams = 'url=http://irs.gis-lab.info/?layers=landsat&amp;styles=&amp;format=image/jpeg&amp;crs=EPSG:4326'\nrlayer = QgsRasterLayer(urlWithParams, 'some layer name', 'wms')\nif not rlayer.isValid():\n    print(\"\u200b\u56fe\u5c42\u200b\u52a0\u8f7d\u200b\u5931\u8d25\u200b\uff01\")\n</code></pre>"},{"location":"3-%E5%8A%A0%E8%BD%BD%E5%9B%BE%E5%B1%82/#33-qgsproject","title":"3.3 QgsProject \u200b\u5b9e\u4f8b","text":"<p>\u200b\u5982\u679c\u200b\u4f60\u200b\u60f3\u200b\u4f7f\u7528\u200b\u6253\u5f00\u200b\u7684\u200b\u56fe\u5c42\u200b\u8fdb\u884c\u200b\u6e32\u67d3\u200b\uff0c\u200b\u8bf7\u200b\u4e0d\u8981\u200b\u5fd8\u8bb0\u200b\u5c06\u200b\u5b83\u4eec\u200b\u6dfb\u52a0\u200b\u5230\u200b<code>QgsProject</code>\u200b\u5b9e\u4f8b\u200b\u4e2d\u200b\u3002<code>QgsProject</code>\u200b\u5b9e\u4f8b\u200b\u62e5\u6709\u200b\u56fe\u5c42\u200b\u7684\u200b\u6240\u6709\u6743\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u901a\u8fc7\u200b\u5176\u200b\u552f\u4e00\u200bID\u200b\u4ece\u200b\u5e94\u7528\u7a0b\u5e8f\u200b\u7684\u200b\u4efb\u4f55\u200b\u90e8\u5206\u200b\u8bbf\u95ee\u200b\u5b83\u4eec\u200b\u3002\u200b\u4ece\u200b\u9879\u76ee\u200b\u4e2d\u200b\u5220\u9664\u200b\u56fe\u5c42\u200b\u65f6\u200b\uff0c\u200b\u5b83\u200b\u4e5f\u200b\u4f1a\u200b\u88ab\u200b\u5220\u9664\u200b\u3002\u200b\u7528\u6237\u200b\u53ef\u4ee5\u200b\u5728\u200bQGIS\u200b\u63a5\u53e3\u200b\u4e2d\u200b\u5220\u9664\u200b\u56fe\u5c42\u200b\uff0c\u200b\u4e5f\u200b\u53ef\u4ee5\u200b\u901a\u8fc7\u200bPython\u200b\u4f7f\u7528\u200b<code>removeMapLayer()</code>\u200b\u65b9\u6cd5\u200b\u5220\u9664\u200b\u56fe\u5c42\u200b\u3002</p> <p>\u200b\u4f7f\u7528\u200b<code>addMapLayer()</code>\u200b\u65b9\u6cd5\u200b\u5c06\u200b\u56fe\u5c42\u200b\u6dfb\u52a0\u200b\u5230\u200b\u5f53\u524d\u200b\u9879\u76ee\u200b\uff1a</p> <pre><code>QgsProject.instance().addMapLayer(rlayer)\n</code></pre> <p>\u200b\u5728\u200b\u7edd\u5bf9\u200b\u4f4d\u7f6e\u200b\u6dfb\u52a0\u200b\u56fe\u5c42\u200b\uff1a</p> <pre><code># \u200b\u9996\u5148\u200b\u6dfb\u52a0\u200b\u56fe\u5c42\u200b\u4f46\u200b\u4e0d\u200b\u663e\u793a\u200b\nQgsProject.instance().addMapLayer(rlayer, False)\n# \u200b\u5728\u200b\u9879\u76ee\u200b\u4e2d\u200b\u83b7\u53d6\u200b\u56fe\u5c42\u200b\u6811\u200b\u7684\u200b\u6839\u200b\u56fe\u5c42\u200b\u7ec4\u200b\nlayerTree = iface.layerTreeCanvasBridge().rootGroup()\n# \u200b\u7b2c\u4e00\u4e2a\u200b\u53c2\u6570\u200b\u662f\u200b\u4e00\u4e2a\u200b\u4ece\u200b0\u200b\u5f00\u59cb\u200b\u7684\u200b\u6570\u5b57\u200b\uff0c-1\u200b\u8868\u793a\u200b\u7ed3\u675f\u200b\nlayerTree.insertChildNode(-1, QgsLayerTreeLayer(rlayer))\n</code></pre> <p>\u200b\u5982\u679c\u200b\u8981\u200b\u5220\u9664\u200b\u56fe\u5c42\u200b\uff0c\u200b\u4f7f\u7528\u200b<code>removeMapLayer()</code>\u200b\u65b9\u6cd5\u200b\uff1a</p> <pre><code>QgsProject.instance().removeMapLayer(rlayer.id())\n</code></pre> <p>\u200b\u5728\u200b\u4e0a\u9762\u200b\u7684\u200b\u4ee3\u7801\u200b\u4e2d\u200b\uff0c\u200b\u4f20\u9012\u200b\u4e86\u200b\u56fe\u5c42\u200bID\uff08\u200b\u4f60\u200b\u53ef\u4ee5\u200b\u8c03\u7528\u200b\u56fe\u5c42\u200b\u7684\u200b<code>id()</code>\u200b\u65b9\u6cd5\u200b\uff09\uff0c\u200b\u4f46\u662f\u200b\u4f60\u200b\u4e5f\u200b\u53ef\u4ee5\u200b\u4f20\u9012\u200b\u56fe\u5c42\u200b\u5bf9\u8c61\u200b\u672c\u8eab\u200b\u3002</p> <p>\u200b\u83b7\u53d6\u200b\u5df2\u200b\u52a0\u8f7d\u200b\u56fe\u5c42\u200b\u548c\u200b\u56fe\u5c42\u200bID\u200b\u7684\u200b\u5217\u8868\u200b\uff0c\u200b\u4f7f\u7528\u200b<code>mapLayers()</code>\u200b\u65b9\u6cd5\u200b\uff1a</p> <pre><code>QgsProject.instance().mapLayers()\n</code></pre>"},{"location":"4-%E8%AE%BF%E9%97%AE%E5%9B%BE%E5%B1%82%E7%9B%AE%E5%BD%95%E6%A0%91/","title":"4 \u200b\u8bbf\u95ee\u200b\u56fe\u5c42\u200b\u76ee\u5f55\u200b\u6811","text":"<p>\u200b\u6b64\u200b\u9875\u9762\u200b\u4e0a\u200b\u7684\u200b\u4ee3\u7801\u200b\u7247\u6bb5\u200b\u9700\u8981\u200b\u5bfc\u5165\u200b\u4ee5\u4e0b\u200b\u6a21\u5757\u200b\uff1a</p> <pre><code>from qgis.core import (\n    QgsProject,\n    QgsVectorLayer,\n)\n</code></pre>"},{"location":"4-%E8%AE%BF%E9%97%AE%E5%9B%BE%E5%B1%82%E7%9B%AE%E5%BD%95%E6%A0%91/#41-qgsproject","title":"4.1 QgsProject\u200b\u7c7b","text":"<p>\u200b\u53ef\u4ee5\u200b\u4f7f\u7528\u200bQgsProject\u200b\u68c0\u7d22\u200b\u6709\u5173\u200b\u76ee\u5f55\u200b\u548c\u200b\u6240\u6709\u200b\u5df2\u200b\u52a0\u8f7d\u200b\u56fe\u5c42\u200b\u7684\u200b\u4fe1\u606f\u200b\u3002</p> <p>\u200b\u5fc5\u987b\u200b\u521b\u5efa\u200bQgsProject\u200b\u7684\u200b\u5b9e\u4f8b\u200b<code>instance</code>\uff0c\u200b\u5e76\u200b\u4f7f\u7528\u200b\u5176\u200b\u65b9\u6cd5\u200b\uff08\u200b\u51fd\u6570\u200b\uff09\u200b\u6765\u200b\u83b7\u53d6\u200b\u5df2\u200b\u52a0\u8f7d\u200b\u7684\u200b\u56fe\u5c42\u200b\u3002</p> <p>mapLayers\u200b\u65b9\u6cd5\u200b\u8fd4\u56de\u200b\u5df2\u200b\u52a0\u8f7d\u200b\u56fe\u5c42\u200b\u7684\u200b\u5b57\u5178\u200b\uff1a</p> <pre><code>layers = QgsProject.instance().mapLayers()\nprint(layers)\n\n# {'countries_89ae1b0f_f41b_4f42_bca4_caf55ddbe4b6': &lt;QgsMapLayer: 'countries' (ogr)&gt;}\n</code></pre> <p>\u200b\u5b57\u5178\u200b\u7684\u200b<code>keys</code>\u200b\u662f\u200b\u56fe\u5c42\u200b\u7684\u200b\u552f\u4e00\u200bid\uff0c\u200b\u800c\u200b<code>values</code>\u200b\u662f\u200b\u56fe\u5c42\u200b\u7684\u200b\u5bf9\u8c61\u200b\u3002</p> <p>\u200b\u73b0\u5728\u200b\u76f4\u63a5\u200b\u53bb\u200b\u83b7\u5f97\u200b\u6709\u5173\u200b\u56fe\u5c42\u200b\u7684\u200b\u4efb\u4f55\u200b\u5176\u4ed6\u200b\u4fe1\u606f\u200b\uff1a</p> <pre><code># \u200b\u4f7f\u7528\u200b\u5217\u8868\u200b\u8868\u8fbe\u5f0f\u200b\u83b7\u5f97\u200b\u56fe\u5c42\u200b\u540d\u79f0\u200b\nl = [layer.name() for layer in QgsProject.instance().mapLayers().values()]\n# \u200b\u952e\u503c\u200b\u5bf9\u200b\u5b58\u50a8\u200b\u56fe\u5c42\u200b\u540d\u79f0\u200b\u548c\u200b\u56fe\u5c42\u200b\u5bf9\u8c61\u200b\nlayers_list = {}\nfor l in QgsProject.instance().mapLayers().values():\n  layers_list[l.name()] = l\n\nprint(layers_list)\n\n# {'countries': &lt;QgsMapLayer: 'countries' (ogr)&gt;}\n</code></pre> <p>\u200b\u8fd8\u200b\u53ef\u4ee5\u200b\u4f7f\u7528\u200b\u56fe\u5c42\u200b\u540d\u79f0\u200b\u67e5\u8be2\u200b\u76ee\u5f55\u200b\uff1a</p> <pre><code>country_layer = QgsProject.instance().mapLayersByName(\"countries\")[0]\n</code></pre> <p>\u200b\u63d0\u793a\u200b</p> <p>\u200b\u8fd4\u56de\u200b\u6240\u6709\u200b\u5339\u914d\u200b\u56fe\u5c42\u200b\u7684\u200b\u5217\u8868\u200b\uff0c\u200b\u56e0\u6b64\u200b\u6211\u4eec\u200b\u4f7f\u7528\u200b\u7d22\u5f15\u200b[0]\u200b\u83b7\u53d6\u200b\u7b2c\u4e00\u4e2a\u200b\u56fe\u5c42\u200b\u3002</p>"},{"location":"4-%E8%AE%BF%E9%97%AE%E5%9B%BE%E5%B1%82%E7%9B%AE%E5%BD%95%E6%A0%91/#42-qgslayertreegroup","title":"4.2 QgsLayerTreeGroup\u200b\u7c7b","text":"<p>\u200b\u56fe\u5c42\u200b\u6811\u662f\u200b\u7531\u200b\u8282\u70b9\u200b\u6784\u5efa\u200b\u7684\u200b\u7ecf\u5178\u200b\u6811\u7ed3\u6784\u200b\u3002\u200b\u5f53\u524d\u200b\u6709\u200b\u4e24\u79cd\u200b\u7c7b\u578b\u200b\u7684\u200b\u8282\u70b9\u200b\uff1a\u200b\u56fe\u5c42\u200b\u7ec4\u200b\u8282\u70b9\u200b\uff08QgsLayerTreeGroup\uff09\u200b\u548c\u200b\u56fe\u5c42\u200b\u8282\u70b9\u200b\uff08QgsLayerTreeLayer\uff09\u3002</p> <p>\u200b\u63d0\u793a\u200b</p> <p>\u200b\u66f4\u200b\u591a\u200b\u4fe1\u606f\u200b\u8bf7\u200b\u8bbf\u95ee\u200bMartin Dobias\u200b\u7684\u200b\u535a\u5ba2\u200b\u3002</p> <p>\u200b\u53ef\u4ee5\u200b\u4f7f\u7528\u200bQgsProject\u200b\u7c7b\u200b\u7684\u200blayerLayerRoot()\u200b\u65b9\u6cd5\u200b\u8f7b\u677e\u200b\u8bbf\u95ee\u200b\u9879\u76ee\u200b\u56fe\u5c42\u200b\u6811\u200b\uff1a</p> <pre><code>root = QgsProject.instance().layerTreeRoot()\n</code></pre> <p><code>root</code>\u200b\u662f\u200b\u4e00\u4e2a\u200b\u56fe\u5c42\u200b\u7ec4\u200b\u8282\u70b9\u200b\uff0c\u200b\u5177\u6709\u200b\u5b50\u200b\u8282\u70b9\u200b\uff1a</p> <pre><code>root.children()\n</code></pre> <p>\u200b\u8fd4\u56de\u200b\u76f4\u63a5\u200b\u5b50\u200b\u8282\u70b9\u200b\u5217\u8868\u200b\u3002\u200b\u5b50\u7ec4\u200b\u8282\u70b9\u200b\u53ef\u4ee5\u200b\u4ece\u200b\u4ed6\u4eec\u200b\u81ea\u5df1\u200b\u7684\u200b\u76f4\u63a5\u200b\u7236\u7ea7\u200b\u8bbf\u95ee\u200b\u3002</p> <p>\u200b\u6211\u4eec\u200b\u53ef\u4ee5\u200b\u68c0\u7d22\u200b\u5176\u4e2d\u200b\u4e00\u4e2a\u200b\u5b50\u200b\u8282\u70b9\u200b\uff1a</p> <pre><code>child0 = root.children()[0]\nprint(child0)\n\n# &lt;qgis._core.QgsLayerTreeLayer object at 0x7f1e1ea54168&gt;\n</code></pre> <p>\u200b\u53ef\u4ee5\u200b\u4f7f\u7528\u200b\u5b83\u4eec\u200b\u7684\u200b\u552f\u4e00\u200b<code>id</code>\u200b\u6765\u200b\u68c0\u7d22\u200b\uff1a</p> <pre><code>ids = root.findLayerIds()\n#  \u200b\u8bbf\u95ee\u200b\u7b2c\u4e00\u4e2a\u200b\u56fe\u5c42\u200b\nroot.findLayer(ids[0])\n</code></pre> <p>\u200b\u53ef\u4ee5\u200b\u4f7f\u7528\u200b\u56fe\u5c42\u200b\u7ec4\u200b\u540d\u79f0\u200b\u68c0\u7d22\u200b\uff1a</p> <pre><code>root.findGroup('Group Name')\n</code></pre> <p>QgsLayerTreeGroup\u200b\u8fd8\u6709\u200b\u8bb8\u591a\u200b\u5176\u4ed6\u200b\u6709\u7528\u200b\u7684\u200b\u65b9\u6cd5\u200b\uff0c\u200b\u53ef\u200b\u7528\u4e8e\u200b\u83b7\u53d6\u200b\u6709\u5173\u200b\u76ee\u5f55\u200b\u6811\u200b\u7684\u200b\u66f4\u200b\u591a\u200b\u4fe1\u606f\u200b\uff1a</p> <pre><code># \u200b\u83b7\u5f97\u200b\u6240\u6709\u200b\u5df2\u9009\u200b\u56fe\u5c42\u200b\nchecked_layers = root.checkedLayers()\nprint(checked_layers)\n\n# [&lt;QgsMapLayer: 'countries' (ogr)&gt;]\n</code></pre> <p>\u200b\u73b0\u5728\u200b\uff0c\u200b\u6211\u4eec\u200b\u628a\u200b\u4e00\u4e9b\u200b\u56fe\u5c42\u200b\u6dfb\u52a0\u200b\u5230\u200b\u9879\u76ee\u200b\u7684\u200b\u56fe\u5c42\u200b\u6811\u4e2d\u200b\uff0c\u200b\u6709\u200b\u4e24\u79cd\u200b\u65b9\u6cd5\u200b\u53ef\u4ee5\u200b\u505a\u5230\u200b\uff1a</p> <ol> <li>\u200b\u663e\u5f0f\u200b\u6dfb\u52a0\u200b\uff1a \u200b\u4f7f\u7528\u200baddLayer()\u200b\u6216\u8005\u200binsertLayer()\u200b\u65b9\u6cd5\u200b\uff1a</li> </ol> <pre><code># \u200b\u521b\u5efa\u200b\u4e34\u65f6\u200b\u56fe\u5c42\u200b\nlayer1 = QgsVectorLayer(\"path_to_layer\", \"Layer 1\", \"memory\")\n# \u200b\u6dfb\u52a0\u200b\u56fe\u5c42\u200b\u5230\u200b\u56fe\u5c42\u200b\u6811\u200b\u672b\u5c3e\u200b\nroot.addLayer(layer1)\n# \u200b\u63d2\u5165\u200b\u56fe\u5c42\u200b\u5230\u200b\u6307\u5b9a\u200b\u4f4d\u7f6e\u200b\nroot.insertLayer(5, layer1)\n</code></pre> <ol> <li>\u200b\u9690\u5f0f\u200b\u6dfb\u52a0\u200b\uff1a \u200b\u7531\u4e8e\u200b\u9879\u76ee\u200b\u7684\u200b\u56fe\u5c42\u200b\u6811\u200b\u5df2\u200b\u8fde\u63a5\u200b\u5230\u200b\u56fe\u5c42\u200b\u6ce8\u518c\u8868\u200b\uff0c\u200b\u56e0\u6b64\u200b\u53ef\u4ee5\u200b\u5728\u200b\u56fe\u5c42\u200b\u6ce8\u518c\u8868\u200b\u4e2d\u200b\u6dfb\u52a0\u200b\u56fe\u5c42\u200b\uff1a</li> </ol> <pre><code>QgsProject.instance().addMapLayer(layer1)\n</code></pre> <p>\u200b\u4f60\u200b\u53ef\u4ee5\u200b\u8f7b\u677e\u200b\u5730\u200b\u5728\u200bQgsVectorLayer\u200b\u548c\u200bQgsLayerTreeLayer\u200b\u4e4b\u95f4\u200b\u5207\u6362\u200b\uff1a</p> <pre><code>node_layer = root.findLayer(country_layer.id())\nprint(\"Layer node:\", node_layer)\nprint(\"Map layer:\", node_layer.layer())\n\n# Layer node: &lt;qgis._core.QgsLayerTreeLayer object at 0x7fecceb46ca8&gt;\n# Map layer: &lt;QgsMapLayer: 'countries' (ogr)&gt;\n</code></pre> <p>\u200b\u53ef\u4ee5\u200b\u4f7f\u7528\u200baddGroup()\u200b\u65b9\u6cd5\u200b\u6dfb\u52a0\u200b\u7ec4\u200b\u3002\u200b\u5728\u200b\u4e0b\u9762\u200b\u7684\u200b\u793a\u4f8b\u200b\u4e2d\u200b\uff0c\u200b\u524d\u8005\u200b\u5c06\u200b\u5728\u200b\u76ee\u5f55\u200b\u6811\u200b\u7684\u200b\u672b\u5c3e\u200b\u6dfb\u52a0\u200b\u4e00\u4e2a\u7ec4\u200b\uff0c\u200b\u800c\u200b\u540e\u8005\u200b\u5219\u200b\u53ef\u4ee5\u200b\u5728\u200b\u73b0\u6709\u200b\u7684\u200b\u7ec4\u4e2d\u200b\u6dfb\u52a0\u200b\u53e6\u200b\u4e00\u4e2a\u7ec4\u200b\uff1a</p> <pre><code>node_group1 = root.addGroup('Simple Group')\n# \u200b\u5728\u200b\u56fe\u5c42\u200b\u7ec4\u4e2d\u200b\u6dfb\u52a0\u200b\u5b50\u7ec4\u200b\nnode_subgroup1 = node_group1.addGroup(\"I'm a sub group\")\n</code></pre> <p>\u200b\u79fb\u52a8\u200b\u8282\u70b9\u200b\u548c\u200b\u7ec4\u6709\u200b\u8bb8\u591a\u200b\u6709\u7528\u200b\u7684\u200b\u65b9\u6cd5\u200b\u3002</p> <p>\u200b\u79fb\u52a8\u200b\u73b0\u6709\u200b\u8282\u70b9\u200b\u5206\u200b\u4e09\u4e2a\u200b\u6b65\u9aa4\u200b\uff1a</p> <ol> <li>\u200b\u514b\u9686\u200b\u5df2\u200b\u5b58\u5728\u200b\u7684\u200b\u8282\u70b9\u200b</li> <li>\u200b\u79fb\u52a8\u200b\u514b\u9686\u200b\u7684\u200b\u8282\u70b9\u200b\u5230\u200b\u60f3\u8981\u200b\u7684\u200b\u4f4d\u7f6e\u200b</li> <li>\u200b\u5220\u9664\u200b\u539f\u59cb\u200b\u8282\u70b9\u200b</li> </ol> <pre><code># \u200b\u514b\u9686\u200b\u56fe\u5c42\u200b\u7ec4\u200b\ncloned_group1 = node_group1.clone()\n# \u200b\u79fb\u52a8\u200b\u56fe\u5c42\u200b\u7ec4\u200b\uff08\u200b\u5305\u62ec\u200b\u5b50\u7ec4\u200b\u548c\u200b\u56fe\u5c42\u200b\uff09\u200b\u5230\u200b\u9876\u5c42\u200b\nroot.insertChildNode(0, cloned_group1)\n# \u200b\u5220\u9664\u200b\u539f\u59cb\u200b\u56fe\u5c42\u200b\u7ec4\u200b\u8282\u70b9\u200b\nroot.removeChildNode(node_group1)\n</code></pre> <p>\u200b\u79fb\u52a8\u200b\u4e00\u4e2a\u200b\u56fe\u5c42\u200b\u8981\u200b\u7a0d\u5fae\u200b\u590d\u6742\u200b\u4e00\u70b9\u200b\uff1a</p> <pre><code># \u200b\u83b7\u5f97\u200b\u4e00\u4e2a\u200b\u56fe\u5c42\u200b\nvl = QgsProject.instance().mapLayersByName(\"countries\")[0]\n# \u200b\u4ece\u200b\u56fe\u5c42\u200b\u6811\u4e2d\u200b\u83b7\u53d6\u200b\nmyvl = root.findLayer(vl.id())\n# \u200b\u514b\u9686\u200b\nmyvlclone = myvl.clone()\n# \u200b\u83b7\u53d6\u200b\u7236\u7ea7\u200b\uff0c\u200b\u5982\u679c\u200b\u56fe\u5c42\u200b\u4e0d\u200b\u5728\u200b\u56fe\u5c42\u200b\u7ec4\u4e2d\u200b\u8fd4\u56de\u200b\u7a7a\u200b\u5b57\u7b26\u4e32\u200b\nparent = myvl.parent()\n# \u200b\u79fb\u52a8\u200b\u56fe\u5c42\u200b\u8282\u70b9\u200b\u5230\u200b\u9876\u5c42\u200b\nparent.insertChildNode(0, myvlclone)\n# \u200b\u5220\u9664\u200b\u539f\u6709\u200b\u8282\u70b9\u200b\nroot.removeChildNode(myvl)\n</code></pre> <p>\u200b\u6216\u8005\u200b\u79fb\u52a8\u200b\u5230\u200b\u5df2\u200b\u5b58\u5728\u200b\u7684\u200b\u56fe\u5c42\u200b\u7ec4\u4e2d\u200b\uff1a</p> <pre><code># \u200b\u83b7\u5f97\u200b\u4e00\u4e2a\u200b\u56fe\u5c42\u200b\nvl = QgsProject.instance().mapLayersByName(\"countries\")[0]\n# \u200b\u4ece\u200b\u56fe\u5c42\u200b\u6811\u4e2d\u200b\u83b7\u53d6\u200b\nmyvl = root.findLayer(vl.id())\n# \u200b\u514b\u9686\u200b\nmyvlclone = myvl.clone()\n# \u200b\u521b\u5efa\u200b\u4e00\u4e2a\u200b\u65b0\u7ec4\u200b\ngroup1 = root.addGroup(\"Group1\")\n# \u200b\u83b7\u53d6\u200b\u7236\u7ea7\u200b\uff0c\u200b\u5982\u679c\u200b\u56fe\u5c42\u200b\u4e0d\u200b\u5728\u200b\u56fe\u5c42\u200b\u7ec4\u4e2d\u200b\u8fd4\u56de\u200b\u7a7a\u200b\u5b57\u7b26\u4e32\u200b\nparent = myvl.parent()\n# \u200b\u79fb\u52a8\u200b\u56fe\u5c42\u200b\u8282\u70b9\u200b\u5230\u200b\u9876\u5c42\u200b\ngroup1.insertChildNode(0, myvlclone)\n# \u200b\u4ece\u200b\u539f\u6709\u200b\u7ec4\u4e2d\u200b\u5220\u9664\u200b\nparent.removeChildNode(myvl)\n</code></pre> <p>\u200b\u53ef\u200b\u7528\u4e8e\u200b\u4fee\u6539\u200b\u7ec4\u548c\u200b\u56fe\u5c42\u200b\u7684\u200b\u5176\u4ed6\u200b\u4e00\u4e9b\u200b\u65b9\u6cd5\u200b\uff1a</p> <pre><code>node_group1 = root.findGroup(\"Group1\")\n# \u200b\u4fee\u6539\u200b\u56fe\u5c42\u200b\u7ec4\u200b\u540d\u79f0\u200b\nnode_group1.setName(\"Group X\")\nnode_layer2 = root.findLayer(country_layer.id())\n# \u200b\u4fee\u6539\u200b\u56fe\u5c42\u200b\u540d\u79f0\u200b\nnode_layer2.setName(\"Layer X\")\n# \u200b\u6539\u53d8\u200b\u56fe\u5c42\u200b\u53ef\u89c1\u200b\u72b6\u6001\u200b\nnode_group1.setItemVisibilityChecked(True)\nnode_layer2.setItemVisibilityChecked(False)\n# \u200b\u6298\u53e0\u200b/\u200b\u5c55\u5f00\u200b\u56fe\u5c42\u200b\u7ec4\u200b\nnode_group1.setExpanded(True)\nnode_group1.setExpanded(False)\n</code></pre>"},{"location":"5-%E4%BD%BF%E7%94%A8%E6%A0%85%E6%A0%BC%E5%9B%BE%E5%B1%82/","title":"5 \u200b\u4f7f\u7528\u200b\u6805\u683c\u200b\u56fe\u5c42","text":"<p>\u200b\u6b64\u200b\u9875\u9762\u200b\u4e0a\u200b\u7684\u200b\u4ee3\u7801\u6bb5\u200b\u9700\u8981\u200b\u5bfc\u5165\u200b\u4ee5\u4e0b\u200b\u6a21\u5757\u200b\uff1a</p> <pre><code>from qgis.core import (\n    Qgis,\n    QgsRasterLayer,\n    QgsProject,\n    QgsPointXY,\n    QgsRaster,\n    QgsRasterBlock,\n    QgsRasterShader,\n    QgsColorRampShader,\n    QgsSingleBandPseudoColorRenderer,\n    QgsSingleBandColorDataRenderer,\n    QgsSingleBandGrayRenderer,\n)\n\nfrom qgis.PyQt.QtGui import (\n    QColor,\n)\n</code></pre>"},{"location":"5-%E4%BD%BF%E7%94%A8%E6%A0%85%E6%A0%BC%E5%9B%BE%E5%B1%82/#51","title":"5.1 \u200b\u56fe\u5c42\u200b\u7ec6\u8282","text":"<p>\u200b\u6805\u683c\u200b\u56fe\u5c42\u200b\u7531\u200b\u4e00\u4e2a\u200b\u6216\u200b\u591a\u4e2a\u200b\u6805\u683c\u200b\u6ce2\u6bb5\u200b\u7ec4\u6210\u200b\u2014\u2014\u200b\u79f0\u4e3a\u200b\u5355\u200b\u6ce2\u6bb5\u200b\u548c\u200b\u591a\u200b\u6ce2\u6bb5\u200b\u6805\u683c\u200b\u3002\u200b\u4e00\u4e2a\u200b\u6ce2\u6bb5\u200b\u4ee3\u8868\u200b\u4e00\u4e2a\u200b\u77e9\u9635\u200b\u3002\u200b\u5f69\u8272\u56fe\u50cf\u200b\uff08\u200b\u4f8b\u5982\u200b\u822a\u62cd\u200b\u7167\u7247\u200b\uff09\u200b\u662f\u200b\u7531\u200b\u7ea2\u8272\u200b\uff0c\u200b\u84dd\u8272\u200b\u548c\u200b\u7eff\u8272\u200b\u6ce2\u6bb5\u200b\u7ec4\u6210\u200b\u3002\u200b\u5355\u200b\u6ce2\u6bb5\u200b\u6805\u683c\u200b\u901a\u5e38\u200b\u8868\u793a\u200b\u8fde\u7eed\u53d8\u91cf\u200b\uff08\u200b\u4f8b\u5982\u200b\u9ad8\u7a0b\u200b\uff09\u200b\u6216\u200b\u79bb\u6563\u200b\u53d8\u91cf\u200b\uff08\u200b\u4f8b\u5982\u200b\u571f\u5730\u200b\u4f7f\u7528\u200b\uff09\u3002\u200b\u5728\u200b\u67d0\u4e9b\u200b\u60c5\u51b5\u200b\u4e0b\u200b\uff0c\u200b\u6805\u683c\u200b\u56fe\u5c42\u200b\u5e26\u6709\u200b\u8c03\u8272\u677f\u200b\uff0c\u200b\u6805\u683c\u200b\u503c\u6307\u200b\u7684\u200b\u662f\u200b\u8c03\u8272\u677f\u200b\u4e2d\u200b\u5b58\u50a8\u200b\u7684\u200b\u989c\u8272\u200b\u3002</p> <p>\u200b\u4ee5\u4e0b\u200b\u4ee3\u7801\u200b\u5047\u5b9a\u200b<code>rlayer</code>\u200b\u662f\u200b\u4e00\u4e2a\u200b <code>QgsRasterLayer</code>\u200b\u5bf9\u8c61\u200b\u3002</p> <pre><code>rlayer = QgsProject.instance().mapLayersByName('srtm')[0]\n# \u200b\u83b7\u53d6\u200b\u56fe\u5c42\u200b\u5206\u8fa8\u7387\u200b\nrlayer.width(), rlayer.height()\n(919, 619)\n# \u200b\u83b7\u53d6\u200b\u56fe\u5c42\u200b\u8303\u56f4\u200b\uff0c\u200b\u8fd4\u56de\u200bQgsRectangle\u200b\u5bf9\u8c61\u200b\nrlayer.extent()\n# &lt;QgsRectangle: 20.06856808199999875 -34.27001076999999896, 20.83945284300000012,-33.75077500700000144&gt;\n# \u200b\u83b7\u53d6\u200b\u56fe\u5c42\u200b\u8303\u56f4\u200b\u5e76\u200b\u8f6c\u6362\u200b\u4e3a\u200b\u5b57\u7b26\u4e32\u200b\nrlayer.extent().toString()\n# '20.0685680819999988,-34.2700107699999990 : 20.8394528430000001,-33.7507750070000014'\n# \u200b\u83b7\u53d6\u200b\u6805\u683c\u200b\u7c7b\u578b\u200b: 0 = \u200b\u7070\u5ea6\u200b\u503c\u200b\uff08\u200b\u5355\u200b\u6ce2\u6bb5\u200b\uff09, 1 = \u200b\u8c03\u8272\u677f\u200b\uff08\u200b\u5355\u200b\u6ce2\u6bb5\u200b\uff09, 2 = \u200b\u591a\u200b\u6ce2\u6bb5\u200b\nrlayer.rasterType()\n# 0\n# \u200b\u83b7\u53d6\u200b\u6ce2\u6bb5\u200b\u4e2a\u6570\u200b\nrlayer.bandCount()\n# 1\n# \u200b\u83b7\u53d6\u200b\u7b2c\u4e00\u4e2a\u200b\u6ce2\u6bb5\u200b\u540d\u79f0\u200b\nprint(rlayer.bandName(1))\n# Band 1: Height\n# \u200b\u83b7\u53d6\u200b\u6240\u6709\u200b\u53ef\u7528\u200b\u7684\u200b\u5143\u200b\u6570\u636e\u200b\uff0c\u200b\u8fd4\u56de\u200bQgsLayerMetadata\u200b\u5bf9\u8c61\u200b\nrlayer.metadata()\n# '&lt;qgis._core.QgsLayerMetadata object at 0x13711d558&gt;'\n</code></pre>"},{"location":"5-%E4%BD%BF%E7%94%A8%E6%A0%85%E6%A0%BC%E5%9B%BE%E5%B1%82/#52","title":"5.2 \u200b\u6e32\u67d3","text":"<p>\u200b\u52a0\u8f7d\u200b\u6805\u683c\u200b\u56fe\u5c42\u200b\u65f6\u200b\uff0c\u200b\u5b83\u4f1a\u200b\u6839\u636e\u200b\u5176\u200b\u7c7b\u578b\u200b\u83b7\u53d6\u200b\u9ed8\u8ba4\u200b\u6e32\u67d3\u5668\u200b\u3002\u200b\u5b83\u200b\u53ef\u4ee5\u200b\u5728\u200b\u56fe\u5c42\u200b\u5c5e\u6027\u200b\u4e2d\u200b\u66f4\u6539\u200b\uff0c\u200b\u4e5f\u200b\u53ef\u4ee5\u200b\u901a\u8fc7\u200b\u7f16\u7a0b\u200b\u65b9\u5f0f\u200b\u66f4\u6539\u200b\u3002</p> <p>\u200b\u67e5\u8be2\u200b\u5f53\u524d\u200b\u6e32\u67d3\u5668\u200b\uff1a</p> <pre><code>rlayer.renderer()\n# &lt;qgis._core.QgsSingleBandGrayRenderer object at 0x7f471c1da8a0&gt;\nrlayer.renderer().type()\n# 'singlebandgray'\n</code></pre> <p>\u200b\u8bbe\u7f6e\u200b\u6e32\u67d3\u5668\u200b\uff0c\u200b\u4f7f\u7528\u200b<code>QgsRasterLayer</code>\u200b\u7684\u200b<code>setRenderer</code> \u200b\u65b9\u6cd5\u200b\u3002\u200b\u4e0b\u9762\u200b\u6709\u200b\u8bb8\u591a\u200b\u6e32\u67d3\u5668\u200b\u7c7b\u200b\uff08\u200b\u6d3e\u751f\u200b\u81ea\u200b<code>QgsRasterRenderer</code>\uff09\uff1a</p> <ul> <li><code>QgsHillshadeRenderer</code></li> <li><code>QgsMultiBandColorRenderer</code></li> <li><code>QgsPalettedRasterRenderer</code></li> <li><code>QgsRasterContourRenderer</code></li> <li><code>QgsSingleBandColorDataRenderer</code></li> <li><code>QgsSingleBandGrayRenderer</code></li> <li><code>QgsSingleBandPseudoColorRenderer</code></li> </ul> <p>\u200b\u5355\u200b\u6ce2\u6bb5\u200b\u6805\u683c\u200b\u56fe\u5c42\u200b\u53ef\u4ee5\u200b\u4ee5\u200b\u7070\u8272\u200b\uff08\u200b\u4f4e\u503c\u200b=\u200b\u9ed1\u8272\u200b\uff0c\u200b\u9ad8\u503c\u200b=\u200b\u767d\u8272\u200b\uff09\u200b\u6216\u200b\u4f7f\u7528\u200b\u4f2a\u200b\u5f69\u8272\u200b\u7b97\u6cd5\u200b\u7ed8\u5236\u200b\uff0c\u200b\u8be5\u200b\u7b97\u6cd5\u200b\u4e3a\u503c\u200b\u6307\u5b9a\u200b\u989c\u8272\u200b\u3002\u200b\u4e5f\u200b\u53ef\u4ee5\u200b\u4f7f\u7528\u200b\u8c03\u8272\u677f\u200b\u7ed8\u5236\u200b\u5e26\u200b\u8c03\u8272\u677f\u200b\u7684\u200b\u5355\u200b\u6ce2\u6bb5\u200b\u6805\u683c\u200b\u3002\u200b\u591a\u200b\u6ce2\u6bb5\u200b\u56fe\u5c42\u200b\u901a\u5e38\u200b\u901a\u8fc7\u200b\u5c06\u200b\u6ce2\u6bb5\u200b\u6620\u5c04\u200b\u5230\u200bRGB\u200b\u6765\u200b\u7ed8\u5236\u200b\u989c\u8272\u200b\u3002\u200b\u53e6\u200b\u4e00\u79cd\u200b\u53ef\u80fd\u200b\u662f\u200b\u4ec5\u200b\u4f7f\u7528\u200b\u4e00\u4e2a\u200b\u6ce2\u6bb5\u200b\u6765\u200b\u7ed8\u56fe\u200b\u3002</p>"},{"location":"5-%E4%BD%BF%E7%94%A8%E6%A0%85%E6%A0%BC%E5%9B%BE%E5%B1%82/#521","title":"5.2.1 \u200b\u5355\u200b\u6ce2\u6bb5\u200b\u6805\u683c","text":"<p>\u200b\u5047\u8bbe\u200b\u6211\u4eec\u200b\u60f3\u8981\u200b\u6e32\u67d3\u200b\u4e00\u4e2a\u200b\u5355\u200b\u6ce2\u6bb5\u200b\u6805\u683c\u200b\u56fe\u5c42\u200b\uff0c\u200b\u989c\u8272\u200b\u8303\u56f4\u200b\u4ece\u200b\u7eff\u8272\u200b\u5230\u200b\u9ec4\u8272\u200b\uff08\u200b\u5bf9\u5e94\u200b\u4e8e\u200b0\u200b\u5230\u200b255\u200b\u4e4b\u95f4\u200b\u7684\u200b\u50cf\u7d20\u200b\u503c\u200b\uff09\u3002\u200b\u5728\u200b\u7b2c\u4e00\u9636\u6bb5\u200b\uff0c\u200b\u6211\u4eec\u200b\u5c06\u200b\u51c6\u5907\u200b\u4e00\u4e2a\u200b\uff1aQgsRasterShader\u200b\u5bf9\u8c61\u200b\u5e76\u200b\u914d\u7f6e\u200b\u5176\u200b\u7740\u8272\u5668\u200b\u51fd\u6570\u200b\uff1a</p> <pre><code>fcn = QgsColorRampShader()\nfcn.setColorRampType(QgsColorRampShader.Interpolated)\nlst = [ QgsColorRampShader.ColorRampItem(0, QColor(0,255,0)),QgsColorRampShader.ColorRampItem(255, QColor(255,255,0)) ]\nfcn.setColorRampItemList(lst)\nshader = QgsRasterShader()\nshader.setRasterShaderFunction(fcn)\n</code></pre> <p>\u200b\u7740\u8272\u5668\u200b\u6309\u200b\u5176\u200b\u989c\u8272\u200b\u6620\u5c04\u200b\u6307\u5b9a\u200b\u7684\u200b\u989c\u8272\u200b\u3002\u200b\u5f69\u8272\u200b\u5730\u56fe\u200b\u88ab\u200b\u63d0\u4f9b\u200b\u4e3a\u200b\u5177\u6709\u200b\u76f8\u5173\u200b\u989c\u8272\u200b\u7684\u200b\u50cf\u7d20\u200b\u503c\u200b\u5217\u8868\u200b\u3002\u200b\u63d2\u503c\u200b\u6709\u200b\u4e09\u79cd\u200b\u6a21\u5f0f\u200b\uff1a</p> <ul> <li>\u200b\u7ebf\u6027\u200b\uff08<code>Interpolated</code>\uff09\uff1a\u200b\u4ece\u200b\u50cf\u7d20\u200b\u503c\u200b\u4e0a\u65b9\u200b\u548c\u200b\u4e0b\u65b9\u200b\u7684\u200b\u989c\u8272\u200b\u8868\u200b\u6761\u5e26\u200b\u4e2d\u200b\u7ebf\u6027\u63d2\u503c\u200b\u989c\u8272\u200b</li> <li>\u200b\u79bb\u6563\u200b\uff08<code>Discrete</code>\uff09\uff1a\u200b\u989c\u8272\u200b\u53d6\u81ea\u200b\u5177\u6709\u200b\u76f8\u540c\u200b\u6216\u200b\u66f4\u200b\u9ad8\u503c\u200b\u7684\u200b\u6700\u200b\u63a5\u8fd1\u200b\u7684\u200b\u989c\u8272\u200b\u8868\u200b\u6761\u5e26\u200b</li> <li>\u200b\u7cbe\u786e\u200b\uff08<code>Exact</code>\uff09\uff1a\u200b\u4e0d\u200b\u63d2\u503c\u200b\u989c\u8272\u200b\uff0c\u200b\u53ea\u200b\u7ed8\u5236\u200b\u503c\u200b\u7b49\u4e8e\u200b\u989c\u8272\u200b\u8868\u200b\u6761\u5e26\u200b\u7684\u200b\u50cf\u7d20\u200b</li> </ul> <p>\u200b\u5728\u200b\u7b2c\u4e8c\u6b65\u200b\u4e2d\u200b\uff0c\u200b\u6211\u4eec\u200b\u5c06\u200b\u6b64\u200b\u7740\u8272\u5668\u200b\u4e0e\u200b\u6805\u683c\u200b\u56fe\u5c42\u200b\u76f8\u5173\u8054\u200b\uff1a</p> <pre><code>renderer = QgsSingleBandPseudoColorRenderer(rlayer.dataProvider(), 1, shader)\nrlayer.setRenderer(renderer)\n</code></pre> <p>\u200b\u4e0a\u9762\u200b\u4ee3\u7801\u200b\u4e2d\u200b\u6570\u503c\u200b<code>1</code>\u200b\u662f\u200b\u6ce2\u6bb5\u200b\u53f7\u200b\uff08\u200b\u6805\u683c\u200b\u6ce2\u6bb5\u200b\u7684\u200b\u4e00\u4e2a\u200b\u7d22\u5f15\u200b\uff09\u3002</p> <p>\u200b\u6700\u540e\u200b\u6211\u4eec\u200b\u5fc5\u987b\u200b\u4f7f\u7528\u200b <code>triggerRepaint</code>\u200b\u65b9\u6cd5\u200b\u6765\u200b\u67e5\u770b\u200b\u7ed3\u679c\u200b\uff1a</p> <pre><code>rlayer.triggerRepaint()\n</code></pre>"},{"location":"5-%E4%BD%BF%E7%94%A8%E6%A0%85%E6%A0%BC%E5%9B%BE%E5%B1%82/#522","title":"5.2.2 \u200b\u591a\u200b\u6ce2\u6bb5\u200b\u6805\u683c","text":"<p>\u200b\u9ed8\u8ba4\u200b\u60c5\u51b5\u200b\u4e0b\u200b\uff0cQGIS\u200b\u5c06\u200b\u524d\u200b\u4e09\u4e2a\u200b\u6ce2\u6bb5\u200b\u6620\u5c04\u200b\u4e3a\u200b\u7ea2\u8272\u200b\uff0c\u200b\u7eff\u8272\u200b\u548c\u200b\u84dd\u8272\u200b\u6765\u200b\u521b\u5efa\u200b\u5f69\u8272\u56fe\u50cf\u200b\uff08\u200b\u8fd9\u662f\u200b<code>MultiBandColor</code>\u200b\u7ed8\u56fe\u200b\u6837\u5f0f\u200b\u3002\u200b\u5728\u200b\u67d0\u4e9b\u200b\u60c5\u51b5\u200b\u4e0b\u200b\uff0c\u200b\u4f60\u200b\u53ef\u80fd\u200b\u5e0c\u671b\u200b\u8986\u76d6\u200b\u8fd9\u4e9b\u200b\u8bbe\u7f6e\u200b\u3002\u200b\u4ee5\u4e0b\u200b\u4ee3\u7801\u200b\u4e92\u6362\u200b\u7ea2\u8272\u200b\u6ce2\u6bb5\u200b\uff081\uff09\u200b\u548c\u200b\u7eff\u8272\u200b\u6ce2\u6bb5\u200b\uff082\uff09\uff1a</p> <pre><code>rlayer_multi = QgsProject.instance().mapLayersByName('multiband')[0]\nrlayer_multi.renderer().setGreenBand(1)\nrlayer_multi.renderer().setRedBand(2)\n</code></pre> <p>\u200b\u5982\u679c\u200b\u53ea\u200b\u9700\u8981\u200b\u4e00\u4e2a\u200b\u6ce2\u6bb5\u200b\u6765\u200b\u5b9e\u73b0\u200b\u5149\u6805\u200b\u7684\u200b\u53ef\u89c6\u5316\u200b\uff0c\u200b\u5219\u200b\u53ef\u4ee5\u200b\u9009\u62e9\u200b\u5355\u200b\u6ce2\u6bb5\u200b\u7ed8\u5236\u200b\uff0c\u200b\u7070\u5ea6\u7ea7\u200b\u6216\u200b\u4f2a\u200b\u5f69\u8272\u200b\u3002</p> <p>\u200b\u6211\u4eec\u200b\u5fc5\u987b\u200b\u4f7f\u7528\u200b<code>triggerRepaint</code> \u200b\u66f4\u65b0\u200b\u5730\u56fe\u200b\u5e76\u200b\u67e5\u770b\u200b\u7ed3\u679c\u200b\uff1a</p> <pre><code>rlayer.triggerRepaint()\n</code></pre>"},{"location":"5-%E4%BD%BF%E7%94%A8%E6%A0%85%E6%A0%BC%E5%9B%BE%E5%B1%82/#53","title":"5.3 \u200b\u67e5\u8be2\u200b\u503c","text":"<p>\u200b\u67e5\u8be2\u200b\u6805\u683c\u200b\u503c\u200b\u7684\u200b\u7b2c\u4e00\u79cd\u200b\u65b9\u6cd5\u200b\u662f\u200b\u4f7f\u7528\u200b <code>QgsRasterDataProvider</code>\u200b\u7684\u200b<code>sample()</code>\u200b\u65b9\u6cd5\u200b\u67e5\u8be2\u200b\u3002\u200b\u4f60\u200b\u5fc5\u987b\u200b\u6307\u5b9a\u200b\u6805\u683c\u200b\u56fe\u5c42\u200b\u7684\u200b<code>QgsPointXY</code>\u200b\u7684\u200b\u548c\u200b\u6ce2\u6bb5\u200b\u53f7\u200b\u3002\u200b\u8be5\u200b\u65b9\u6cd5\u200b\u8fd4\u56de\u200b\u4e00\u4e2a\u200bvalue\u200b\u548c\u200bresult\uff08true\u200b\u6216\u200bfalse\uff09\uff1a</p> <pre><code>val, res = rlayer.dataProvider().sample(QgsPointXY(20.50, -34), 1)\n</code></pre> <p>\u200b\u67e5\u8be2\u200b\u6805\u683c\u200b\u503c\u200b\u7684\u200b\u53e6\u200b\u4e00\u79cd\u200b\u65b9\u6cd5\u200b\u662f\u200b\u4f7f\u7528\u200b<code>identify()</code>\u200b\u65b9\u6cd5\u200b\uff0c\u200b\u8fd4\u56de\u200b<code>QgsRasterIdentifyResult</code>\u200b\u5bf9\u8c61\u200b \u3002</p> <pre><code>ident = rlayer.dataProvider().identify(QgsPointXY(20.5, -34), QgsRaster.IdentifyFormatValue)\nif ident.isValid():\n    print(ident.results())\n\n# {1: 323.0}\n</code></pre> <p>\u200b\u5728\u200b\u8fd9\u79cd\u200b\u60c5\u51b5\u200b\u4e0b\u200b\uff0c<code>results()</code> \u200b\u65b9\u6cd5\u200b\u8fd4\u56de\u200b\u4e00\u4e2a\u200b\u5b57\u5178\u200b\uff0c\u200b\u6ce2\u6bb5\u200b\u7d22\u5f15\u200b\u4f5c\u4e3a\u200b\u5b57\u5178\u200b\u952e\u200b\uff0c\u200b\u6ce2\u6bb5\u200b\u503c\u200b\u4f5c\u4e3a\u200b\u5b57\u5178\u200b\u503c\u200b\u3002\u200b\u4f8b\u5982\u200b<code>{1: 323.0}</code>\u3002</p>"},{"location":"5-%E4%BD%BF%E7%94%A8%E6%A0%85%E6%A0%BC%E5%9B%BE%E5%B1%82/#54","title":"5.4 \u200b\u7f16\u8f91\u200b\u6805\u683c\u6570\u636e","text":"<p>\u200b\u53ef\u4ee5\u200b\u4f7f\u7528\u200b<code>QgsRasterBlock</code>\u200b\u7c7b\u200b\u521b\u5efa\u200b\u6805\u683c\u200b\u56fe\u5c42\u200b\u3002\u200b\u4f8b\u5982\u200b\uff0c\u200b\u521b\u5efa\u200b\u6bcf\u200b\u50cf\u7d20\u200b\u4e00\u200b\u5b57\u8282\u200b\u7684\u200b2x2\u200b\u6805\u683c\u200b\u5757\u200b\uff1a</p> <pre><code>block = QgsRasterBlock(Qgis.Byte, 2, 2)\nblock.setData(b'\\xaa\\xbb\\xcc\\xdd')\n</code></pre> <p>\u200b\u4f7f\u7528\u200b<code>writeBlock()</code>\u200b\u65b9\u6cd5\u200b\u53ef\u4ee5\u200b\u8986\u76d6\u200b\u6805\u683c\u200b\u50cf\u7d20\u200b\u3002\u200b\u7528\u200b2x2\u200b\u5757\u200b\u8986\u76d6\u200b\u4f4d\u7f6e\u200b0,0\u200b\u5904\u200b\u7684\u200b\u73b0\u6709\u200b\u6805\u683c\u6570\u636e\u200b\uff1a</p> <pre><code>provider = rlayer.dataProvider()\nprovider.setEditable(True)\nprovider.writeBlock(block, 1, 0, 0)\nprovider.setEditable(False)\n</code></pre>"},{"location":"6-%E4%BD%BF%E7%94%A8%E7%9F%A2%E9%87%8F%E5%9B%BE%E5%B1%82/","title":"6-\u200b\u4f7f\u7528\u200b\u77e2\u91cf\u56fe\u200b\u5c42","text":"<p>\u200b\u672c\u200b\u8282\u200b\u4ee3\u7801\u200b\u7247\u6bb5\u200b\u9700\u8981\u200b\u5bfc\u5165\u200b\u4ee5\u4e0b\u200b\u6a21\u5757\u200b\uff1a</p> <pre><code>from qgis.core import (\n  QgsApplication,\n  QgsDataSourceUri,\n  QgsCategorizedSymbolRenderer,\n  QgsClassificationRange,\n  QgsPointXY,\n  QgsProject,\n  QgsExpression,\n  QgsField,\n  QgsFields,\n  QgsFeature,\n  QgsFeatureRequest,\n  QgsFeatureRenderer,\n  QgsGeometry,\n  QgsGraduatedSymbolRenderer,\n  QgsMarkerSymbol,\n  QgsMessageLog,\n  QgsRectangle,\n  QgsRendererCategory,\n  QgsRendererRange,\n  QgsSymbol,\n  QgsVectorDataProvider,\n  QgsVectorLayer,\n  QgsVectorFileWriter,\n  QgsWkbTypes,\n  QgsSpatialIndex,\n  QgsVectorLayerUtils\n)\n\nfrom qgis.core.additions.edit import edit\n\nfrom qgis.PyQt.QtGui import (\n    QColor,\n)\n</code></pre>"},{"location":"6-%E4%BD%BF%E7%94%A8%E7%9F%A2%E9%87%8F%E5%9B%BE%E5%B1%82/#6","title":"6 \u200b\u4f7f\u7528\u200b\u77e2\u91cf\u56fe\u200b\u5c42","text":"<p>\u200b\u672c\u200b\u8282\u200b\u603b\u7ed3\u200b\u4e86\u200b\u4f7f\u7528\u200b\u77e2\u91cf\u56fe\u200b\u5c42\u200b\u6267\u884c\u200b\u5404\u79cd\u200b\u64cd\u4f5c\u200b\u3002</p> <p>\u200b\u8fd9\u91cc\u200b\u7684\u200b\u5927\u90e8\u5206\u200b\u5de5\u4f5c\u200b\u90fd\u200b\u662f\u200b\u57fa\u4e8e\u200b<code>QgsVectorLayer</code>\u200b\u7c7b\u200b\u7684\u200b\u65b9\u6cd5\u200b\u3002</p>"},{"location":"6-%E4%BD%BF%E7%94%A8%E7%9F%A2%E9%87%8F%E5%9B%BE%E5%B1%82/#61","title":"6.1 \u200b\u68c0\u7d22\u200b\u76f8\u5173\u200b\u5c5e\u6027\u200b\u4fe1\u606f","text":"<p>\u200b\u4f60\u200b\u53ef\u4ee5\u200b\u901a\u8fc7\u200b\u8c03\u7528\u200b<code>QgsVectorLayer</code>\u200b\u5bf9\u8c61\u200b\u7684\u200b<code>fields()</code>\u200b\u65b9\u6cd5\u200b\u68c0\u7d22\u200b\u4e00\u4e2a\u200b\u77e2\u91cf\u56fe\u200b\u5c42\u200b\u76f8\u5173\u200b\u5b57\u6bb5\u200b\u7684\u200b\u4fe1\u606f\u200b\uff1a</p> <pre><code>vlayer = QgsVectorLayer(\"testdata/airports.shp\", \"airports\", \"ogr\")\nfor field in vlayer.fields():\n    print(field.name(), field.typeName())\n\n# ID Integer64\n# fk_region Integer64\n# ELEV Real\n# NAME String\n# USE String\n</code></pre> <p><code>displayField()</code> \u200b\u548c\u200b <code>mapTipTemplate()</code> \u200b\u65b9\u6cd5\u200b\u63d0\u4f9b\u200b\u6709\u5173\u200b\u663e\u793a\u200b\u5c5e\u6027\u200b\u9009\u9879\u5361\u200b\u4e2d\u200b\u4f7f\u7528\u200b\u7684\u200b\u5b57\u200b\u6bb5\u200b\u548c\u200b\u6a21\u677f\u200b\u7684\u200b\u4fe1\u606f\u200b\u3002 </p> <p>\u200b\u52a0\u8f7d\u200b\u77e2\u91cf\u200b\u5c42\u65f6\u200b\uff0cQGIS\u200b\u59cb\u7ec8\u200b\u9009\u62e9\u200b\u4e00\u4e2a\u200b\u5b57\u200b\u6bb5\u200b\u4f5c\u4e3a\u200b<code>\u200b\u663e\u793a\u200b\u540d\u79f0\u200b</code>\uff0c\u200b\u800c\u200b<code>HTML\u200b\u5730\u56fe\u200b\u63d0\u793a\u200b</code>\u200b\u9ed8\u8ba4\u200b\u60c5\u51b5\u200b\u4e0b\u4e3a\u200b\u7a7a\u200b\u3002\u200b\u4f7f\u7528\u200b\u8fd9\u4e9b\u200b\u65b9\u6cd5\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u8f7b\u677e\u200b\u5730\u200b\u540c\u65f6\u200b\u83b7\u5f97\u200b\uff1a </p> <pre><code>vlayer = QgsVectorLayer(\"testdata/airports.shp\", \"airports\", \"ogr\")\nprint(vlayer.displayField())\n# NAME\n</code></pre> <p>\u200b\u63d0\u793a\u200b</p> <p>\u200b\u5982\u679c\u200b\u5c06\u200b\u663e\u793a\u200b\u540d\u79f0\u200b\u4ece\u5b57\u200b\u6bb5\u200b\u66f4\u200b\u6539\u4e3a\u200b\u8868\u8fbe\u5f0f\u200b\uff0c\u200b\u5219\u200b\u5fc5\u987b\u200b\u4f7f\u7528\u200b <code>displayExpression()</code>  \u200b\u800c\u200b\u4e0d\u662f\u200b  <code>displayField()</code> \u3002 </p>"},{"location":"6-%E4%BD%BF%E7%94%A8%E7%9F%A2%E9%87%8F%E5%9B%BE%E5%B1%82/#62","title":"6.2 \u200b\u904d\u5386\u200b\u77e2\u91cf\u56fe\u200b\u5c42","text":"<p>\u200b\u904d\u5386\u200b\u77e2\u91cf\u56fe\u200b\u5c42\u200b\u8981\u7d20\u200b\u662f\u200b\u6700\u200b\u5e38\u89c1\u200b\u7684\u200b\u4efb\u52a1\u200b\u4e4b\u4e00\u200b\u3002\u200b\u4e0b\u9762\u200b\u662f\u200b\u6267\u884c\u200b\u6b64\u200b\u4efb\u52a1\u200b\u7684\u200b\u7b80\u5355\u200b\u57fa\u672c\u200b\u4ee3\u7801\u200b\u793a\u4f8b\u200b\uff0c\u200b\u5e76\u200b\u663e\u793a\u200b\u6709\u5173\u200b\u6bcf\u4e2a\u200b\u8981\u7d20\u200b\u7684\u200b\u4e00\u4e9b\u200b\u4fe1\u606f\u200b\u3002<code>layer</code>\u200b\u53d8\u91cf\u200b\u88ab\u200b\u5047\u5b9a\u200b\u4e3a\u200b\u4e00\u4e2a\u200b<code>QgsVectorLayer</code>\u200b\u5bf9\u8c61\u200b\u3002</p> <pre><code>layer = iface.activeLayer()\nfeatures = layer.getFeatures()\n\nfor feature in features:\n    # \u200b\u68c0\u7d22\u200b\u6bcf\u200b\u4e00\u4e2a\u200b\u8981\u7d20\u200b\u7684\u200b\u51e0\u4f55\u200b\u548c\u200b\u5c5e\u6027\u200b\n    print(\"Feature ID: \", feature.id())\n    # \u200b\u83b7\u53d6\u200b\u51e0\u4f55\u200b\n    geom = feature.geometry()\n    geomSingleType = QgsWkbTypes.isSingleType(geom.wkbType())\n    if geom.type() == QgsWkbTypes.PointGeometry:\n        # \u200b\u51e0\u4f55\u200b\u7c7b\u578b\u200b\u53ef\u4ee5\u200b\u662f\u200b\u5355\u4e2a\u200b\u6216\u200b\u591a\u4e2a\u200b\u7c7b\u578b\u200b\uff0c\n        if geomSingleType:\n            x = geom.asPoint()\n            print(\"Point: \", x)\n        else:\n            x = geom.asMultiPoint()\n            print(\"MultiPoint: \", x)\n    elif geom.type() == QgsWkbTypes.LineGeometry:\n        if geomSingleType:\n            x = geom.asPolyline()\n            print(\"Line: \", x, \"length: \", geom.length())\n        else:\n            x = geom.asMultiPolyline()\n            print(\"MultiLine: \", x, \"length: \", geom.length())\n    elif geom.type() == QgsWkbTypes.PolygonGeometry:\n        if geomSingleType:\n            x = geom.asPolygon()\n            print(\"Polygon: \", x, \"Area: \", geom.area())\n        else:\n            x = geom.asMultiPolygon()\n            print(\"MultiPolygon: \", x, \"Area: \", geom.area())\n    else:\n        print(\"Unknown or invalid geometry\")\n    # \u200b\u83b7\u53d6\u200b\u5c5e\u6027\u200b\n    attrs = feature.attributes()\n    # attrs\u200b\u662f\u200b\u4e00\u4e2a\u200b\u5217\u8868\u200b\u3002\u200b\u5b83\u200b\u5305\u542b\u200b\u8981\u7d20\u200b\u7684\u200b\u6240\u6709\u200b\u5c5e\u6027\u200b\u503c\u200b\n    print(attrs)\n    # \u200b\u672c\u200b\u6d4b\u8bd5\u200b\u53ea\u200b\u6253\u5370\u200b\u7b2c\u4e00\u4e2a\u200b\u8981\u7d20\u200b\n    break\n\n\n    # Feature ID:  1\n    # Point:  &lt;QgsPointXY: POINT(7 45)&gt;\n    # [1, 'First feature']\n</code></pre>"},{"location":"6-%E4%BD%BF%E7%94%A8%E7%9F%A2%E9%87%8F%E5%9B%BE%E5%B1%82/#63","title":"6.3 \u200b\u9009\u62e9\u200b\u8981\u7d20","text":"<p>\u200b\u5728\u200bQGIS\u200b\u684c\u9762\u200b\u4e2d\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u901a\u8fc7\u200b\u4e0d\u540c\u200b\u65b9\u5f0f\u200b\u9009\u62e9\u200b\u8981\u7d20\u200b\uff1a\u200b\u7528\u6237\u200b\u53ef\u4ee5\u200b\u5355\u51fb\u200b\u8981\u7d20\u200b\u3001\u200b\u5728\u200b\u5730\u56fe\u200b\u753b\u5e03\u200b\u4e0a\u200b\u7ed8\u5236\u200b\u77e9\u5f62\u200b\u6216\u200b\u4f7f\u7528\u200b\u8868\u8fbe\u5f0f\u200b\u8fc7\u6ee4\u5668\u200b\u3002\u200b\u6240\u200b\u9009\u200b\u8981\u7d20\u200b\u901a\u5e38\u200b\u4ee5\u200b\u4e0d\u540c\u200b\u989c\u8272\u200b\u7a81\u51fa\u200b\u663e\u793a\u200b\uff08\u200b\u9ed8\u8ba4\u200b\u4e3a\u200b\u9ec4\u8272\u200b\uff09\uff0c\u200b\u4ee5\u200b\u5f15\u8d77\u200b\u7528\u6237\u200b\u5bf9\u200b\u5df2\u9009\u200b\u8981\u7d20\u200b\u7684\u200b\u6ce8\u610f\u200b\u3002</p> <p>\u200b\u6709\u65f6\u200b\uff0c\u200b\u4ee5\u200b\u7f16\u7a0b\u200b\u65b9\u5f0f\u200b\u9009\u62e9\u200b\u8981\u7d20\u200b\u6216\u200b\u66f4\u6539\u200b\u9ed8\u8ba4\u200b\u989c\u8272\u200b\u4f1a\u200b\u5f88\u200b\u6709\u7528\u200b\u3002</p> <p>\u200b\u9009\u62e9\u200b\u6240\u6709\u200b\u8981\u7d20\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u4f7f\u7528\u200b<code>selectAll()</code>\u200b\u65b9\u6cd5\u200b\uff1a</p> <pre><code># \u200b\u83b7\u53d6\u200b\u5f53\u524d\u200b\u56fe\u5c42\u200b\uff08\u200b\u5fc5\u987b\u200b\u662f\u200b\u77e2\u91cf\u56fe\u200b\u5c42\u200b\uff09\nlayer = iface.activeLayer()\nlayer.selectAll()\n</code></pre> <p>\u200b\u4f7f\u7528\u200b\u8868\u8fbe\u5f0f\u200b\u8fdb\u884c\u200b\u9009\u62e9\u200b\uff0c\u200b\u4f7f\u7528\u200bselectByExpression()\u200b\u65b9\u6cd5\u200b\uff1a</p> <pre><code># \u200b\u5047\u8bbe\u200b\u5f53\u524d\u200b\u56fe\u5c42\u200b\u662f\u200b\u6765\u81ea\u200bQGIS\u200b\u6d4b\u8bd5\u200b\u5957\u4ef6\u200b\u7684\u200bpoints.shp\u200b\u6587\u4ef6\u200b\n#\uff08Class\uff08\u200b\u5b57\u7b26\u4e32\u200b\uff09\u200b\u548c\u200bHeading\uff08\u200b\u6570\u5b57\u200b\uff09\u200b\u662f\u200bpoints.shp\u200b\u4e2d\u200b\u7684\u200b\u5c5e\u6027\u200b\uff09\nlayer = iface.activeLayer()\nlayer.selectByExpression('\"Class\"=\\'B52\\' and \"Heading\" &gt; 10 and \"Heading\" &lt;70', QgsVectorLayer.SetSelection)\n</code></pre> <p>\u200b\u66f4\u6539\u200b\u9009\u62e9\u200b\u989c\u8272\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u4f7f\u7528\u200b<code>QgsMapCanvas</code>\u200b\u7684\u200b<code>setSelectionColor()</code>\u200b\u65b9\u6cd5\u200b \uff1a</p> <pre><code>iface.mapCanvas().setSelectionColor(QColor(\"red\"))\n</code></pre> <p>\u200b\u7ed9\u200b\u56fe\u5c42\u200b\u7684\u200b\u6240\u9009\u200b\u8981\u7d20\u200b\u5217\u8868\u200b\u6dfb\u52a0\u200b\u8981\u7d20\u200b\uff0c\u200b\u4f60\u200b\u53ef\u4ee5\u200b\u8c03\u7528\u200b<code>select()</code>\u200b\u6dfb\u52a0\u200b\u5230\u200b\u8981\u7d20\u200bID\u200b\u5217\u8868\u200b\uff1a</p> <pre><code>selected_fid  =  []\n\n# \u200b\u83b7\u53d6\u200b\u56fe\u5c42\u200b\u7684\u200b\u7b2c\u4e00\u4e2a\u200b\u8981\u7d20\u200bID \nfeature = next(layer.getFeatures())\nif feature:\n    selected_fid.append(feature.id())\n# \u200b\u5c06\u200b\u8fd9\u4e9b\u200b\u8981\u7d20\u200b\u6dfb\u52a0\u200b\u5230\u200b\u9009\u5b9a\u200b\u7684\u200b\u5217\u8868\u200b\nlayer.select(selected_fid)\n</code></pre> <p>\u200b\u6e05\u9664\u200b\u9009\u62e9\u200b\uff1a</p> <pre><code>layer.removeSelection()\n</code></pre>"},{"location":"6-%E4%BD%BF%E7%94%A8%E7%9F%A2%E9%87%8F%E5%9B%BE%E5%B1%82/#631","title":"6.3.1 \u200b\u8bbf\u95ee\u200b\u5c5e\u6027","text":"<p>\u200b\u5c5e\u6027\u200b\u53ef\u4ee5\u200b\u901a\u8fc7\u200b\u540d\u79f0\u200b\u6765\u200b\u83b7\u5f97\u200b\uff1a</p> <pre><code>print(feature['name'])\n\n# First feature\n</code></pre> <p>\u200b\u6216\u8005\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u901a\u8fc7\u200b\u7d22\u5f15\u200b\u5f15\u7528\u200b\u5c5e\u6027\u200b\u3002\u200b\u8fd9\u6bd4\u200b\u4f7f\u7528\u200b\u540d\u79f0\u200b\u5feb\u200b\u4e00\u70b9\u200b\u3002\u200b\u4f8b\u5982\u200b\uff0c\u200b\u83b7\u53d6\u200b\u7b2c\u4e8c\u4e2a\u200b\u5c5e\u6027\u200b\uff1a</p> <pre><code>print(feature[1])\n\n# Second feature\n</code></pre>"},{"location":"6-%E4%BD%BF%E7%94%A8%E7%9F%A2%E9%87%8F%E5%9B%BE%E5%B1%82/#632","title":"6.3.2 \u200b\u904d\u5386\u200b\u9009\u4e2d\u200b\u7684\u200b\u8981\u7d20","text":"<p>\u200b\u5982\u679c\u200b\u4f60\u200b\u53ea\u200b\u9700\u8981\u200b\u9009\u4e2d\u200b\u7684\u200b\u8981\u7d20\u200b\uff0c\u200b\u5219\u200b\u53ef\u4ee5\u200b\u4f7f\u7528\u200b\u77e2\u91cf\u56fe\u200b\u5c42\u200b\u7684\u200b<code>selectedFeatures()</code>\u200b\u65b9\u6cd5\u200b\uff1a</p> <pre><code>selection = layer.selectedFeatures()\nprint(len(selection))\nfor feature in selection:\n    # \u200b\u4f7f\u7528\u200b\u8981\u7d20\u200b\u6267\u884c\u200b\u4efb\u4f55\u200b\u64cd\u4f5c\u200b\n    pass\n</code></pre>"},{"location":"6-%E4%BD%BF%E7%94%A8%E7%9F%A2%E9%87%8F%E5%9B%BE%E5%B1%82/#633","title":"6.3.3 \u200b\u904d\u5386\u200b\u4e00\u90e8\u5206\u200b\u8981\u7d20","text":"<p>\u200b\u5982\u679c\u200b\u8981\u200b\u904d\u5386\u200b\u56fe\u5c42\u200b\u4e2d\u200b\u7279\u5b9a\u200b\u7684\u200b\u8981\u7d20\u200b\u5b50\u96c6\u200b\uff08\u200b\u4f8b\u5982\u200b\u7ed9\u5b9a\u200b\u533a\u57df\u200b\u5185\u200b\u7684\u200b\u8981\u7d20\u200b\uff09\uff0c\u200b\u5219\u200b\u5fc5\u987b\u200b\u6dfb\u52a0\u200b<code>QgsFeatureRequest</code>\u200b\u5bf9\u8c61\u200b\u5230\u200b<code>getFeatures()</code>\u200b\u65b9\u6cd5\u200b\u3002\u200b\u4e0b\u9762\u200b\u662f\u200b\u4e00\u4e2a\u200b\u4f8b\u5b50\u200b\uff1a</p> <pre><code>areaOfInterest = QgsRectangle(450290,400520, 450750,400780)\n\nrequest = QgsFeatureRequest().setFilterRect(areaOfInterest)\n\nfor feature in layer.getFeatures(request):\n    # \u200b\u4f7f\u7528\u200b\u8981\u7d20\u200b\u6267\u884c\u200b\u4efb\u4f55\u200b\u64cd\u4f5c\u200b\n    pass\n</code></pre> <p>\u200b\u4e3a\u4e86\u200b\u901f\u5ea6\u200b\uff0c\u200b\u76f8\u4ea4\u200b\u901a\u5e38\u200b\u4ec5\u200b\u4f7f\u7528\u200b\u8981\u7d20\u200b\u7684\u200b\u8303\u56f4\u200b(bbox)\u200b\u6765\u200b\u5b8c\u6210\u200b\u3002\u200b\u4f46\u662f\u200b\u6709\u200b\u4e00\u4e2a\u200b\u6807\u5fd7\u200b<code>ExactIntersect</code>\u200b\u53ef\u4ee5\u200b\u786e\u4fdd\u200b\u53ea\u200b\u8fd4\u56de\u200b\u76f8\u4ea4\u200b\u7684\u200b\u8981\u7d20\u200b\uff1a</p> <pre><code>request = QgsFeatureRequest().setFilterRect(areaOfInterest).setFlags(QgsFeatureRequest.ExactIntersect)\n</code></pre> <p>\u200b\u4f7f\u7528\u200b<code>setLimit()</code>\u200b\u4f60\u200b\u53ef\u4ee5\u200b\u9650\u5236\u200b\u8981\u7d20\u200b\u7684\u200b\u6570\u91cf\u200b\u3002\u200b\u4e0b\u9762\u200b\u662f\u200b\u4e00\u4e2a\u200b\u4f8b\u5b50\u200b\uff1a</p> <pre><code>request = QgsFeatureRequest()\nrequest.setLimit(2)\nfor feature in layer.getFeatures(request):\n    print(feature)\n    # &lt;qgis._core.QgsFeature object at 0x7f9b78590948&gt;\n</code></pre> <p>\u200b\u5982\u679c\u200b\u4f60\u200b\u9700\u8981\u200b\u4e00\u4e2a\u200b\u57fa\u4e8e\u200b\u5c5e\u6027\u200b\u7684\u200b\u8fc7\u6ee4\u5668\u200b\u6765\u200b\u4ee3\u66ff\u200b\uff08\u200b\u6216\u200b\u589e\u52a0\u200b\uff09\u200b\u4e00\u4e2a\u200b\u7a7a\u95f4\u200b\u8fc7\u6ee4\u5668\u200b\uff0c\u200b\u5982\u200b\u4e0a\u9762\u200b\u7684\u200b\u4f8b\u5b50\u200b\u6240\u793a\u200b\uff0c\u200b\u4f60\u200b\u53ef\u4ee5\u200b\u6784\u5efa\u200b\u4e00\u4e2a\u200b<code>QgsExpression</code>\u200b\u5bf9\u8c61\u200b\u5e76\u200b\u5c06\u200b\u5176\u200b\u4f20\u9012\u200b\u7ed9\u200b<code>QgsFeatureRequest</code>\u200b\u51fd\u6570\u200b\u3002\u200b\u4e0b\u9762\u200b\u662f\u200b\u4e00\u4e2a\u200b\u4f8b\u5b50\u200b\uff1a</p> <pre><code># \u200b\u8868\u8fbe\u5f0f\u200b\u5c06\u200b\u8fc7\u6ee4\u200b\u5b57\u200b\u6bb5\u200b\u201clocation_name\u201d \n# \u200b\u5305\u542b\u200b\u5355\u8bcd\u200b\u201cLake\u201d\uff08\u200b\u4e0d\u200b\u533a\u5206\u200b\u5927\u5c0f\u5199\u200b\uff09\nexp = QgsExpression(\"location_name ILIKE \\'%Lake%\\'\")\nrequest = QgsFeatureRequest(exp)\n</code></pre> <p>\u200b\u6709\u5173\u200b\u652f\u6301\u200b\u8bed\u6cd5\u200b\uff08<code>QgsExpression</code>\uff09\u200b\u7684\u200b\u8be6\u7ec6\u4fe1\u606f\u200b\uff0c\u200b\u8bf7\u53c2\u9605\u200b11-\u200b\u8868\u8fbe\u5f0f\u200b\uff0c\u200b\u8fc7\u6ee4\u200b\u548c\u200b\u8ba1\u7b97\u200b\u503c\u200b\u3002</p> <p>\u200b\u8be5\u200b\u8bf7\u6c42\u200b\u53ef\u200b\u7528\u4e8e\u200b\u68c0\u7d22\u200b\u6bcf\u4e2a\u200b\u8981\u7d20\u200b\uff0c\u200b\u56e0\u6b64\u200b\u8fed\u4ee3\u200b\u5668\u200b\u8fd4\u56de\u200b\u6240\u6709\u200b\u8981\u7d20\u200b\uff0c\u200b\u4f46\u200b\u8fd4\u56de\u200b\u6bcf\u4e2a\u200b\u8981\u7d20\u200b\u7684\u200b\u90e8\u5206\u200b\u6570\u636e\u200b\u3002</p> <pre><code># \u200b\u4ec5\u200b\u8fd4\u56de\u200b\u9009\u5b9a\u200b\u7684\u200b\u5b57\u200b\u6bb5\u200b\u4ee5\u200b\u589e\u52a0\u200b\u8bf7\u6c42\u200b\u901f\u5ea6\u200b\nrequest.setSubsetOfAttributes([0,2])\n\n# \u200b\u66f4\u52a0\u200b\u53cb\u597d\u200b\u7684\u200b\u65b9\u5f0f\u200b\nrequest.setSubsetOfAttributes(['name','id'],layer.fields())\n\n# \u200b\u4e0d\u200b\u8fd4\u56de\u200b\u51e0\u4f55\u200b\u5bf9\u8c61\u200b\u4ee5\u200b\u589e\u52a0\u200b\u8bf7\u6c42\u200b\u901f\u5ea6\u200b\nrequest.setFlags(QgsFeatureRequest.NoGeometry)\n\n# \u200b\u4ec5\u200b\u83b7\u53d6\u200bID\u200b\u4e3a\u200b45\u200b\u7684\u200b\u8981\u7d20\u200b\nrequest.setFilterFid(45)\n\n# \u200b\u8fd9\u4e9b\u200b\u9009\u9879\u200b\u53ef\u4ee5\u200b\u662f\u200b\u94fe\u5f0f\u200b\u7684\u200b\nrequest.setFilterRect(areaOfInterest).setFlags(QgsFeatureRequest.NoGeometry).setFilterFid(45).setSubsetOfAttributes([0,2])\n</code></pre>"},{"location":"6-%E4%BD%BF%E7%94%A8%E7%9F%A2%E9%87%8F%E5%9B%BE%E5%B1%82/#64","title":"6.4 \u200b\u4fee\u6539\u200b\u77e2\u91cf\u56fe\u200b\u5c42","text":"<p>\u200b\u5927\u591a\u6570\u200b\u77e2\u91cf\u200b\u6570\u636e\u200b\u63d0\u4f9b\u8005\u200b\u90fd\u200b\u652f\u6301\u200b\u7f16\u8f91\u200b\u56fe\u5c42\u200b\u6570\u636e\u200b\u3002\u200b\u6709\u65f6\u200b\u5b83\u4eec\u200b\u4ec5\u200b\u652f\u6301\u200b\u7f16\u8f91\u200b\u5b50\u96c6\u200b\u3002\u200b\u4f7f\u7528\u200b<code>capabilities()</code>\u200b\u529f\u80fd\u200b\u53ef\u4ee5\u200b\u627e\u51fa\u200b\u652f\u6301\u200b\u7684\u200b\u529f\u80fd\u96c6\u200b\u3002</p> <pre><code>caps = layer.dataProvider().capabilities()\n# \u200b\u68c0\u67e5\u200b\u662f\u5426\u200b\u652f\u6301\u200b\u7279\u5b9a\u200b\u529f\u80fd\u200b\uff1a\nif caps &amp; QgsVectorDataProvider.DeleteFeatures:\n    print('\u200b\u56fe\u5c42\u200b\u652f\u6301\u200b\u5220\u9664\u200b\u8981\u7d20\u200b')\n</code></pre> <p>\u200b\u6709\u5173\u200b\u6240\u6709\u200b\u53ef\u7528\u200b\u529f\u80fd\u200b\u7684\u200b\u5217\u8868\u200b\uff0c\u200b\u8bf7\u53c2\u9605\u200b \uff1a<code>QgsVectorDataProvider\u200b\u63a5\u53e3\u200b\u6587\u6863\u200b</code></p> <p>\u200b\u6253\u5370\u200b\u56fe\u5c42\u200b\u529f\u80fd\u200b\u7684\u200b\u6587\u672c\u200b\u63cf\u8ff0\u200b\uff0c\u200b\u7ed3\u679c\u200b\u662f\u200b\u4ee5\u200b\u9017\u53f7\u200b\u5206\u9694\u200b\u7684\u200b\u5217\u8868\u200b\uff0c\u200b\u4f60\u200b\u53ef\u4ee5\u200b\u4f7f\u7528\u200b<code>capabilitiesString()</code> \u200b\u65b9\u6cd5\u200b\uff0c\u200b\u5982\u4e0b\u200b\u4f8b\u200b\u6240\u793a\u200b\uff1a</p> <pre><code>caps_string = layer.dataProvider().capabilitiesString()\n# Print:\n# 'Add Features, Delete Features, Change Attribute Values, Add Attributes,\n# Delete Attributes, Rename Attributes, Fast Access to Features at ID,\n# Presimplify Geometries, Presimplify Geometries with Validity Check,\n# Transactions, Curved Geometries'\n</code></pre> <p>\u200b\u901a\u8fc7\u200b\u4f7f\u7528\u200b\u4ee5\u4e0b\u200b\u4efb\u4f55\u200b\u65b9\u6cd5\u200b\u8fdb\u884c\u200b\u77e2\u91cf\u56fe\u200b\u5c42\u200b\u7f16\u8f91\u200b\uff0c\u200b\u66f4\u6539\u200b\u5c06\u200b\u76f4\u63a5\u200b\u63d0\u4ea4\u200b\u5230\u200b\u57fa\u7840\u200b\u6570\u636e\u200b\u5b58\u50a8\u200b\uff08\u200b\u6587\u4ef6\u200b\uff0c\u200b\u6570\u636e\u5e93\u200b\u7b49\u200b\uff09\u3002\u200b\u5982\u679c\u200b\u4f60\u200b\u53ea\u200b\u60f3\u200b\u8fdb\u884c\u200b\u4e34\u65f6\u200b\u4fee\u6539\u200b\uff0c\u200b\u8bf7\u200b\u8df3\u200b\u5230\u200b\u4e0b\u200b\u4e00\u8282\u200b6.4.4 \u200b\u4f7f\u7528\u200b\u7f16\u8f91\u200b\u7f13\u51b2\u533a\u200b\u4fee\u6539\u200b\u77e2\u91cf\u56fe\u200b\u5c42\u200b\u3002</p> <p>\u200b\u63d0\u793a\u200b</p> <p>\u200b\u5982\u679c\u200b\u4f60\u200b\u5728\u200bQGIS\u200b\u5185\u90e8\u200b\uff08\u200b\u4ece\u200b\u63a7\u5236\u53f0\u200b\u6216\u200b\u4ece\u200b\u63d2\u4ef6\u200b\u4e2d\u200b\uff09\uff0c\u200b\u53ef\u80fd\u200b\u9700\u8981\u200b\u5f3a\u5236\u200b\u91cd\u7ed8\u200b\u5730\u56fe\u200b\u753b\u5e03\u200b\uff0c\u200b\u4ee5\u4fbf\u200b\u67e5\u770b\u200b\u4f60\u200b\u5bf9\u200b\u51e0\u4f55\u200b\u3001\u200b\u6837\u5f0f\u200b\u6216\u200b\u5c5e\u6027\u200b\u6240\u200b\u505a\u200b\u7684\u200b\u66f4\u6539\u200b\uff1a</p> <pre><code># \u200b\u5982\u679c\u200b\u542f\u7528\u200b\u4e86\u200b\u7f13\u5b58\u200b\uff0c\u200b\u7b80\u5355\u200b\u7684\u200b\u753b\u5e03\u200b\u5237\u65b0\u200b\u53ef\u80fd\u200b\u4e0d\u8db3\u4ee5\u200b\u89e6\u53d1\u200b\u91cd\u7ed8\u200b\uff0c\u200b\u5e76\u4e14\u200b\u5fc5\u987b\u200b\u6e05\u9664\u200b\u56fe\u5c42\u200b\u7684\u200b\u7f13\u5b58\u200b\u56fe\u50cf\u200b\u3002\nif iface.mapCanvas().isCachingEnabled():\n    layer.triggerRepaint()\nelse:\n    iface.mapCanvas().refresh()\n</code></pre>"},{"location":"6-%E4%BD%BF%E7%94%A8%E7%9F%A2%E9%87%8F%E5%9B%BE%E5%B1%82/#641","title":"6.4.1 \u200b\u6dfb\u52a0\u200b\u8981\u7d20","text":"<p>\u200b\u521b\u5efa\u200b\u4e00\u4e9b\u200b<code>QgsFeature</code>\u200b\u5b9e\u4f8b\u200b\u5e76\u200b\u5c06\u200b\u5b83\u4eec\u200b\u7684\u200b\u5217\u8868\u200b\u4f20\u9012\u200b\u7ed9\u200b\u63d0\u4f9b\u8005\u200b\u7684\u200b <code>addFeatures()</code>\u200b\u65b9\u6cd5\u200b\u3002\u200b\u5b83\u200b\u5c06\u200b\u8fd4\u56de\u200b\u4e24\u4e2a\u200b\u503c\u200b\uff1aresult\uff08true / false\uff09\u200b\u548c\u200b\u6dfb\u52a0\u200b\u7684\u200b\u8981\u7d20\u200b\u5217\u8868\u200b\uff08\u200b\u5b83\u4eec\u200b\u7684\u200bID\u200b\u7531\u200b\u6570\u636e\u200b\u5b58\u50a8\u200b\u8bbe\u7f6e\u200b\uff09\u3002</p> <p>\u200b\u8bbe\u7f6e\u200b\u8981\u7d20\u200b\u7684\u200b\u5c5e\u6027\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u901a\u8fc7\u200b\u4f20\u9012\u200b<code>QgsFields</code>\u200b\u5bf9\u8c61\u200b\uff08\u200b\u53ef\u4ee5\u200b\u4ece\u200b<code>fields()</code>\u200b\u77e2\u91cf\u56fe\u200b\u5c42\u200b\u7684\u200b\u65b9\u6cd5\u200b\u83b7\u53d6\u200b \uff09\u200b\u6216\u200b\u8c03\u7528\u200b<code>initAttributes()</code>\u200b\u4f20\u9012\u200b\u8981\u200b\u6dfb\u52a0\u200b\u7684\u200b\u5b57\u200b\u6bb5\u200b\u6570\u6765\u200b\u521d\u59cb\u5316\u200b\u8981\u7d20\u200b\u3002</p> <pre><code>if caps &amp; QgsVectorDataProvider.AddFeatures:\n    feat = QgsFeature(layer.fields())\n    feat.setAttributes([0, 'hello'])\n    # \u200b\u6216\u200b\u6309\u200bkey\u200b\u6216\u200bindex\u200b\u8bbe\u7f6e\u200b\u5355\u4e2a\u200b\u5c5e\u6027\u200b\uff1a\n    feat.setAttribute('name', 'hello')\n    feat.setAttribute(0, 'hello')\n    feat.setGeometry(QgsGeometry.fromPointXY(QgsPointXY(123, 456)))\n    (res, outFeats) = layer.dataProvider().addFeatures([feat])\n</code></pre>"},{"location":"6-%E4%BD%BF%E7%94%A8%E7%9F%A2%E9%87%8F%E5%9B%BE%E5%B1%82/#642","title":"6.4.2 \u200b\u5220\u9664\u200b\u8981\u7d20","text":"<p>\u200b\u5220\u9664\u200b\u67d0\u4e9b\u200b\u8981\u7d20\u200b\uff0c\u200b\u53ea\u200b\u9700\u200b\u63d0\u4f9b\u200b\u5176\u200b\u8981\u7d20\u200bID\u200b\u5217\u8868\u200b\u5373\u53ef\u200b\u3002</p> <pre><code>if caps &amp; QgsVectorDataProvider.DeleteFeatures:\n    res = layer.dataProvider().deleteFeatures([5, 10])\n</code></pre>"},{"location":"6-%E4%BD%BF%E7%94%A8%E7%9F%A2%E9%87%8F%E5%9B%BE%E5%B1%82/#643","title":"6.4.3 \u200b\u4fee\u6539\u200b\u8981\u7d20","text":"<p>\u200b\u53ef\u4ee5\u200b\u66f4\u6539\u200b\u8981\u7d20\u200b\u7684\u200b\u51e0\u4f55\u56fe\u5f62\u200b\u6216\u200b\u66f4\u6539\u200b\u67d0\u4e9b\u200b\u5c5e\u6027\u200b\u3002\u200b\u4ee5\u4e0b\u200b\u793a\u4f8b\u200b\u9996\u5148\u200b\u66f4\u6539\u200b\u7d22\u5f15\u200b\u4e3a\u200b0\u200b\u548c\u200b1\u200b\u7684\u200b\u5c5e\u6027\u200b\u503c\u200b\uff0c\u200b\u7136\u540e\u200b\u66f4\u6539\u200b\u8981\u7d20\u200b\u7684\u200b\u51e0\u4f55\u200b\u3002</p> <pre><code>fid = 100  # \u200b\u6211\u4eec\u200b\u5c06\u200b\u4fee\u6539\u200b\u7684\u200b\u8981\u7d20\u200bID\n\nif caps &amp; QgsVectorDataProvider.ChangeAttributeValues:\n    attrs = { 0 : \"hello\", 1 : 123 }\n    layer.dataProvider().changeAttributeValues({ fid : attrs })\n\nif caps &amp; QgsVectorDataProvider.ChangeGeometries:\n    geom = QgsGeometry.fromPointXY(QgsPointXY(111,222))\n    layer.dataProvider().changeGeometryValues({ fid : geom })\n</code></pre> <p>\u200b\u63d0\u793a\u200b</p> <p>QgsVectorLayerEditUtils\u200b\u7c7b\u200b\u8fdb\u884c\u200b\u4ec5\u200b\u51e0\u4f55\u200b\u7f16\u8f91\u200b</p> <p>\u200b\u5982\u679c\u200b\u4f60\u200b\u53ea\u200b\u9700\u8981\u200b\u66f4\u6539\u200b\u51e0\u4f55\u56fe\u5f62\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u8003\u8651\u200b\u4f7f\u7528\u200b<code>QgsVectorLayerEditUtils</code>\uff0c\u200b\u5b83\u200b\u63d0\u4f9b\u200b\u4e00\u4e9b\u200b\u6709\u7528\u200b\u7684\u200b\u65b9\u6cd5\u200b\u6765\u200b\u7f16\u8f91\u200b\u51e0\u4f55\u56fe\u5f62\u200b\uff08\u200b\u5e73\u79fb\u200b\u3001\u200b\u63d2\u5165\u200b\u6216\u200b\u79fb\u52a8\u200b\u9876\u70b9\u200b\u7b49\u200b\uff09\u3002</p>"},{"location":"6-%E4%BD%BF%E7%94%A8%E7%9F%A2%E9%87%8F%E5%9B%BE%E5%B1%82/#644","title":"6.4.4 \u200b\u4f7f\u7528\u200b\u7f16\u8f91\u200b\u7f13\u51b2\u533a\u200b\u4fee\u6539\u200b\u77e2\u91cf\u56fe\u200b\u5c42","text":"<p>\u200b\u5728\u200bQGIS\u200b\u5e94\u7528\u7a0b\u5e8f\u200b\u4e2d\u200b\u7f16\u8f91\u200b\u77e2\u91cf\u200b\u65f6\u200b\uff0c\u200b\u5fc5\u987b\u200b\u9996\u5148\u200b\u4e3a\u200b\u7279\u5b9a\u200b\u56fe\u5c42\u200b\u8bbe\u7f6e\u200b\u5f00\u59cb\u200b\u7f16\u8f91\u200b\u6a21\u5f0f\u200b\uff0c\u200b\u7136\u540e\u200b\u8fdb\u884c\u200b\u4e00\u4e9b\u200b\u4fee\u6539\u200b\uff0c\u200b\u6700\u540e\u200b\u63d0\u4ea4\u200b\uff08\u200b\u6216\u200b\u56de\u6eda\u200b\uff09\u200b\u66f4\u6539\u200b\u3002\u200b\u4f60\u200b\u6240\u200b\u505a\u200b\u7684\u200b\u6240\u6709\u200b\u66f4\u6539\u200b\u5728\u200b\u4f60\u200b\u63d0\u4ea4\u200b\u4e4b\u524d\u200b\u90fd\u200b\u4e0d\u4f1a\u200b\u5199\u5165\u200b\u2014\u2014\u200b\u5b83\u4eec\u200b\u4fdd\u7559\u200b\u5728\u200b\u56fe\u5c42\u200b\u7684\u200b\u5185\u5b58\u200b\u7f16\u8f91\u200b\u7f13\u51b2\u533a\u200b\u4e2d\u200b\u3002\u200b\u4e5f\u200b\u53ef\u4ee5\u200b\u901a\u8fc7\u200b\u7f16\u7a0b\u200b\u65b9\u5f0f\u200b\u4f7f\u7528\u200b\u6b64\u200b\u529f\u80fd\u200b\u2014\u2014\u200b\u5b83\u200b\u4ec5\u4ec5\u200b\u662f\u200b\u662f\u200b\u77e2\u91cf\u56fe\u200b\u5c42\u200b\u7f16\u8f91\u200b\u7684\u200b\u53e6\u200b\u4e00\u79cd\u200b\u65b9\u6cd5\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u8865\u5145\u200b\u76f4\u63a5\u200b\u4f7f\u7528\u200b\u6570\u636e\u200b\u63d0\u4f9b\u8005\u200b\u3002\u200b\u5728\u200b\u4e3a\u200b\u77e2\u91cf\u56fe\u200b\u5c42\u200b\u7f16\u8f91\u200b\u63d0\u4f9b\u200b\u4e00\u4e9b\u200bGUI\u200b\u5de5\u5177\u200b\u65f6\u200b\u4f7f\u7528\u200b\u6b64\u200b\u9009\u9879\u200b\uff0c\u200b\u56e0\u4e3a\u200b\u8fd9\u200b\u5c06\u200b\u5141\u8bb8\u200b\u7528\u6237\u200b\u51b3\u5b9a\u200b\u662f\u5426\u200b\u63d0\u4ea4\u200b/\u200b\u56de\u6eda\u200b\uff0c\u200b\u5e76\u200b\u5141\u8bb8\u200b\u4f7f\u7528\u200b\u64a4\u9500\u200b/\u200b\u91cd\u505a\u200b\u3002\u200b\u63d0\u4ea4\u200b\u66f4\u6539\u200b\u540e\u200b\uff0c\u200b\u7f16\u8f91\u200b\u7f13\u51b2\u533a\u200b\u4e2d\u200b\u7684\u200b\u6240\u6709\u200b\u66f4\u6539\u200b\u90fd\u200b\u5c06\u200b\u4fdd\u5b58\u200b\u5230\u200b\u6570\u636e\u200b\u63d0\u4f9b\u8005\u200b\u4e2d\u200b\u3002</p> <p>\u200b\u8fd9\u4e9b\u200b\u65b9\u6cd5\u200b\u7c7b\u4f3c\u200b\u4e8e\u200b\u6211\u4eec\u200b\u5728\u200b\u63d0\u4f9b\u8005\u200b\u4e2d\u200b\u770b\u5230\u200b\u7684\u200b\u65b9\u6cd5\u200b\uff0c\u200b\u4f46\u200b\u5b83\u4eec\u200b\u5728\u200b<code>QgsVectorLayer</code> \u200b\u5bf9\u8c61\u200b\u4e0a\u200b\u8c03\u7528\u200b\u3002</p> <p>\u200b\u4f7f\u200b\u8fd9\u4e9b\u200b\u65b9\u6cd5\u200b\u8d77\u200b\u4f5c\u7528\u200b\uff0c\u200b\u56fe\u5c42\u200b\u5fc5\u987b\u200b\u5904\u4e8e\u200b\u7f16\u8f91\u200b\u6a21\u5f0f\u200b\u3002\u200b\u5f00\u59cb\u200b\u7f16\u8f91\u200b\u6a21\u5f0f\u200b\uff0c\u200b\u4f7f\u7528\u200b<code>startEditing()</code>\u200b\u65b9\u6cd5\u200b\u3002\u200b\u505c\u6b62\u200b\u7f16\u8f91\u200b\uff0c\u200b\u4f7f\u7528\u200b<code>commitChanges()</code> \u200b\u6216\u200b<code>rollBack()</code>\u200b\u65b9\u6cd5\u200b\u3002\u200b\u7b2c\u4e00\u4e2a\u200b\u65b9\u6cd5\u200b\u5c06\u200b\u63d0\u4ea4\u200b\u5bf9\u200b\u6570\u636e\u6e90\u200b\u7684\u200b\u6240\u6709\u200b\u66f4\u6539\u200b\uff0c\u200b\u800c\u200b\u7b2c\u4e8c\u4e2a\u200b\u65b9\u6cd5\u200b\u5c06\u200b\u4e22\u5f03\u200b\u5b83\u4eec\u200b\uff0c\u200b\u5e76\u4e14\u200b\u4e0d\u4f1a\u200b\u4fee\u6539\u200b\u6570\u636e\u6e90\u200b\u3002</p> <p>\u200b\u786e\u5b9a\u200b\u56fe\u5c42\u200b\u662f\u5426\u200b\u5904\u4e8e\u200b\u7f16\u8f91\u200b\u6a21\u5f0f\u200b\uff0c\u200b\u4f7f\u7528\u200b<code>isEditable()</code>\u200b\u65b9\u6cd5\u200b\u3002</p> <p>\u200b\u8fd9\u91cc\u200b\u6709\u200b\u4e00\u4e9b\u200b\u793a\u4f8b\u200b\u6f14\u793a\u200b\uff0c\u200b\u5982\u4f55\u200b\u4f7f\u7528\u200b\u8fd9\u4e9b\u200b\u7f16\u8f91\u200b\u65b9\u6cd5\u200b\u3002</p> <pre><code>from qgis.PyQt.QtCore import QMetaType\n\nfeat1 = feat2 = QgsFeature(layer.fields())\nfid = 99\nfeat1.setId(fid)\n\n# \u200b\u6dfb\u52a0\u200b\u4e24\u4e2a\u200b\u8981\u7d20\u200b\uff08QgsFeature\u200b\u5b9e\u4f8b\u200b\uff09\nlayer.addFeatures([feat1,feat2])\n# \u200b\u5220\u9664\u200b\u6307\u5b9a\u200bID\u200b\u7684\u200b\u8981\u7d20\u200b \nlayer.deleteFeature(fid)\n\n# \u200b\u4e3a\u200b\u8981\u7d20\u200b\u8bbe\u7f6e\u200b\u65b0\u200b\u51e0\u4f55\u200b\uff08QgsGeometry\u200b\u5b9e\u4f8b\u200b\uff09\u3002\nlayer.changeGeometry(fid, geometry)\n# \u200b\u5c06\u200b\u7ed9\u5b9a\u200b\u5b57\u200b\u6bb5\u200b\u7d22\u5f15\u200b\uff08int\uff09\u200b\u7684\u200b\u5c5e\u6027\u200b\u66f4\u65b0\u200b\u4e3a\u200b\u7ed9\u5b9a\u200b\u503c\u200b\nfieldIndex =1\nvalue ='My new name'\nlayer.changeAttributeValue(fid, fieldIndex, value)\n\n# \u200b\u6dfb\u52a0\u200b\u65b0\u200b\u7684\u200b\u5b57\u200b\u6bb5\u200b\nlayer.addAttribute(QgsField(\"mytext\", QMetaType.Type.QString))\n# \u200b\u5220\u9664\u200b\u5b57\u200b\u6bb5\u200b\nlayer.deleteAttribute(fieldIndex)\n</code></pre> <p>\u200b\u4e3a\u4e86\u200b\u4f7f\u200b\u64a4\u6d88\u200b/\u200b\u91cd\u505a\u200b\u6b63\u5e38\u200b\u5de5\u4f5c\u200b\uff0c\u200b\u4e0a\u8ff0\u200b\u8c03\u7528\u200b\u5fc5\u987b\u200b\u5305\u542b\u200b\u5728\u200b\u64a4\u6d88\u200b\u547d\u4ee4\u200b\u4e2d\u200b\u3002\uff08\u200b\u5982\u679c\u200b\u4f60\u200b\u4e0d\u200b\u5173\u5fc3\u200b\u64a4\u6d88\u200b/\u200b\u91cd\u505a\u200b\u5e76\u200b\u5e0c\u671b\u200b\u7acb\u5373\u200b\u5b58\u50a8\u200b\u66f4\u6539\u200b\uff0c\u200b\u90a3\u4e48\u200b\u901a\u8fc7\u200b6.4 \u200b\u4fee\u6539\u200b\u77e2\u91cf\u56fe\u200b\u5c42\u200b\uff0c\u200b\u4f60\u200b\u5c06\u200b\u53ef\u4ee5\u200b\u66f4\u200b\u8f7b\u677e\u200b\u5730\u200b\u5b8c\u6210\u200b\u5de5\u4f5c\u200b \u3002\uff09</p> <p>\u200b\u4ee5\u4e0b\u200b\u662f\u200b\u4f7f\u7528\u200b\u64a4\u6d88\u200b\u529f\u80fd\u200b\u7684\u200b\u65b9\u6cd5\u200b\uff1a</p> <pre><code>layer.beginEditCommand(\"Feature triangulation\")\n\n# ...\u200b\u8c03\u7528\u200b\u56fe\u5c42\u200b\u7684\u200b\u7f16\u8f91\u200b\u65b9\u6cd5\u200b......\n\nif problem_occurred:\n  layer.destroyEditCommand()\n  return\n\n# ...\u200b\u66f4\u200b\u591a\u200b\u7f16\u8f91\u200b...\n\nlayer.endEditCommand()\n</code></pre> <p><code>beginEditCommand()</code>\u200b\u65b9\u6cd5\u200b\u5c06\u200b\u521b\u5efa\u200b\u4e00\u4e2a\u200b\u5185\u90e8\u200b\u201c\u200b\u6d3b\u52a8\u200b\u201d\u200b\u547d\u4ee4\u200b\uff0c\u200b\u5e76\u200b\u8bb0\u5f55\u200b\u77e2\u91cf\u56fe\u200b\u5c42\u4e2d\u200b\u7684\u200b\u540e\u7eed\u200b\u66f4\u6539\u200b\u3002\u200b\u968f\u7740\u200b\u5bf9\u200b<code>endEditCommand()</code> \u200b\u547d\u4ee4\u200b\u7684\u200b\u8c03\u7528\u200b\u88ab\u200b\u63a8\u9001\u200b\u5230\u200b\u64a4\u9500\u200b\u6808\u200b\uff0c\u200b\u7528\u6237\u200b\u5c06\u200b\u80fd\u591f\u200b\u4ece\u200bGUI\u200b\u64a4\u6d88\u200b/\u200b\u91cd\u505a\u200b\u5b83\u200b\u3002\u200b\u5982\u679c\u200b\u5728\u200b\u6267\u884c\u200b\u66f4\u6539\u200b\u65f6\u200b\u51fa\u73b0\u200b\u95ee\u9898\u200b\uff0c <code>destroyEditCommand()</code>\u200b\u65b9\u6cd5\u200b\u5c06\u200b\u5220\u9664\u200b\u8be5\u200b\u547d\u4ee4\u200b\u5e76\u200b\u56de\u6eda\u6b64\u200b\u547d\u4ee4\u200b\u5904\u4e8e\u200b\u6d3b\u52a8\u72b6\u6001\u200b\u65f6\u200b\u6240\u200b\u505a\u200b\u7684\u200b\u6240\u6709\u200b\u66f4\u6539\u200b\u3002</p> <p>\u200b\u4f60\u200b\u8fd8\u200b\u53ef\u4ee5\u200b\u4f7f\u7528\u200b<code>with edit(layer)</code>\u2014\u2014\u200b\u5c06\u200b\u63d0\u4ea4\u200b\u548c\u200b\u56de\u6eda\u200b\u5305\u88c5\u200b\u5728\u200b\u66f4\u5177\u200b\u8bed\u4e49\u200b\u7684\u200b\u4ee3\u7801\u200b\u5757\u200b\u4e2d\u200b\uff0c\u200b\u5982\u4e0b\u200b\u4f8b\u200b\u6240\u793a\u200b\uff1a</p> <pre><code>with edit(layer):\n  feat = next(layer.getFeatures())\n  feat[0] = 5\n  layer.updateFeature(feat)\n</code></pre> <p>\u200b\u7ed3\u675f\u200b\u540e\u200b\u5c06\u200b\u81ea\u52a8\u200b\u8c03\u7528\u200b<code>commitChanges()</code>\u3002\u200b\u5982\u679c\u200b\u53d1\u751f\u200b\u4efb\u4f55\u200b\u5f02\u5e38\u200b\uff0c\u200b\u5b83\u200b\u5c06\u200b\u8fdb\u884c\u200b<code>rollBack()</code>\u200b\u6240\u6709\u200b\u66f4\u6539\u200b\u3002\u200b\u5982\u679c\u200b<code>commitChanges()</code>\uff08\u200b\u5f53\u8be5\u200b\u65b9\u6cd5\u200b\u8fd4\u56de\u200bFalse\u200b\u65f6\u200b\uff09\u200b\u9047\u5230\u200b\u95ee\u9898\u200b\u5c06\u200b\u5f15\u53d1\u200b<code>QgsEditError</code>\u200b\u5f02\u5e38\u200b\u3002</p>"},{"location":"6-%E4%BD%BF%E7%94%A8%E7%9F%A2%E9%87%8F%E5%9B%BE%E5%B1%82/#645","title":"6.4.5 \u200b\u6dfb\u52a0\u200b\u548c\u200b\u5220\u9664\u200b\u5b57\u200b\u6bb5","text":"<p>\u200b\u6dfb\u52a0\u200b\u5b57\u200b\u6bb5\u200b\uff08\u200b\u5c5e\u6027\u200b\uff09\uff0c\u200b\u4f60\u200b\u9700\u8981\u200b\u6307\u5b9a\u200b\u5b57\u200b\u6bb5\u200b\u5b9a\u4e49\u200b\u5217\u8868\u200b\u3002\u200b\u5220\u9664\u200b\u5b57\u200b\u6bb5\u200b\uff0c\u200b\u53ea\u200b\u9700\u200b\u63d0\u4f9b\u200b\u5b57\u200b\u6bb5\u200b\u7d22\u5f15\u200b\u5217\u8868\u200b\u3002</p> <pre><code>from qgis.PyQt.QtCore import QMetaType\n\nif caps &amp; QgsVectorDataProvider.AddAttributes:\n    res = layer.dataProvider().addAttributes(\n        [QgsField(\"mytext\", QMetaType.Type.QString),\n        QgsField(\"myint\", QMetaType.Type.Int)])\n\nif caps &amp; QgsVectorDataProvider.DeleteAttributes:\n    res = layer.dataProvider().deleteAttributes([0])\n</code></pre> <pre><code># \u200b\u5220\u9664\u200b\u5b57\u6bb5\u200b\u7684\u200b\u5907\u7528\u200b\u65b9\u6cd5\u200b\n# \u200b\u9996\u5148\u200b\u521b\u5efa\u200b\u8981\u200b\u5220\u9664\u200b\u7684\u200b\u4e34\u65f6\u200b\u5b57\u200b\u6bb5\u200b (f1-3)\nlayer.dataProvider().addAttributes([QgsField(\"f1\", QMetaType.Type.Int),\n                                    QgsField(\"f2\", QMetaType.Type.Int),\n                                    QgsField(\"f3\", QMetaType.Type.Int)])\nlayer.updateFields()\ncount=layer.fields().count() # \u200b\u56fe\u5c42\u200b\u5b57\u200b\u6bb5\u200b\u4e2a\u6570\u200b\nind_list=list((count-3, count-2)) # \u200b\u521b\u5efa\u200b\u5217\u8868\u200b\n\n# \u200b\u4f7f\u7528\u200b\u7d22\u5f15\u200b\u5220\u9664\u200b\u5b57\u200b\u6bb5\u200b\nlayer.dataProvider().deleteAttributes([count-1])\n\n# \u200b\u4f7f\u7528\u200b\u7d22\u5f15\u200b\u5217\u8868\u200b\u5220\u9664\u200b\u591a\u4e2a\u200b\u5b57\u200b\u6bb5\u200b\nlayer.dataProvider().deleteAttributes(ind_list)\n</code></pre> <p>\u200b\u5728\u200b\u6570\u636e\u200b\u63d0\u4f9b\u200b\u7a0b\u8005\u200b\u4e2d\u200b\u6dfb\u52a0\u200b\u6216\u200b\u5220\u9664\u200b\u5b57\u6bb5\u200b\u540e\u200b\uff0c\u200b\u9700\u8981\u200b\u66f4\u65b0\u200b\u56fe\u5c42\u200b\u7684\u200b\u5b57\u200b\u6bb5\u200b\uff0c\u200b\u56e0\u4e3a\u200b\u66f4\u6539\u200b\u4e0d\u4f1a\u200b\u81ea\u52a8\u200b\u4f20\u64ad\u200b\u3002</p> <pre><code>layer.updateFields()\n</code></pre> <p>\u200b\u63d0\u793a\u200b</p> <p>\u200b\u4f7f\u7528\u200b<code>with</code>\u200b\u8bed\u53e5\u200b\u76f4\u63a5\u200b\u4fdd\u5b58\u200b\u66f4\u6539\u200b</p> <p>\u200b\u4f7f\u7528\u200b<code>with edit(layer):</code> \u200b\u66f4\u6539\u200b\u5c06\u200b\u5728\u200b\u7ed3\u675f\u200b\u540e\u200b\u8c03\u7528\u200b<code>commitChanges()</code>\u200b\u81ea\u52a8\u200b\u63d0\u4ea4\u200b\u3002\u200b\u5982\u679c\u200b\u53d1\u751f\u200b\u4efb\u4f55\u200b\u5f02\u5e38\u200b\uff0c\u200b\u5b83\u200b\u5c06\u200b<code>rollBack()</code>\u200b\u6240\u6709\u200b\u66f4\u6539\u200b\u3002\u200b\u8bf7\u200b\u53c2\u89c1\u200b6.4.4 \u200b\u4f7f\u7528\u200b\u7f16\u8f91\u200b\u7f13\u51b2\u533a\u200b\u4fee\u6539\u200b\u77e2\u91cf\u56fe\u200b\u5c42\u200b</p>"},{"location":"6-%E4%BD%BF%E7%94%A8%E7%9F%A2%E9%87%8F%E5%9B%BE%E5%B1%82/#65","title":"6.5 \u200b\u4f7f\u7528\u200b\u7a7a\u95f4\u200b\u7d22\u5f15","text":"<p>\u200b\u5982\u679c\u200b\u9700\u8981\u200b\u5bf9\u200b\u77e2\u91cf\u56fe\u200b\u5c42\u200b\u8fdb\u884c\u200b\u9891\u7e41\u200b\u67e5\u8be2\u200b\uff0c\u200b\u7a7a\u95f4\u200b\u7d22\u5f15\u200b\u53ef\u4ee5\u200b\u663e\u8457\u200b\u63d0\u9ad8\u200b\u4ee3\u7801\u200b\u7684\u200b\u6027\u80fd\u200b\u3002\u200b\u4f8b\u5982\u200b\uff0c\u200b\u60f3\u8c61\u200b\u4e00\u4e0b\u200b\uff0c\u200b\u4f60\u200b\u6b63\u5728\u200b\u7f16\u5199\u200b\u63d2\u503c\u200b\u7b97\u6cd5\u200b\uff0c\u200b\u5e76\u4e14\u200b\u5bf9\u4e8e\u200b\u7ed9\u5b9a\u200b\u4f4d\u7f6e\u200b\u4f60\u200b\u9700\u8981\u200b\u77e5\u9053\u200b\u70b9\u200b\u56fe\u5c42\u200b\u4e2d\u200b\u6700\u8fd1\u200b\u7684\u200b10\u200b\u4e2a\u70b9\u200b\uff0c\u200b\u4ee5\u4fbf\u200b\u4f7f\u7528\u200b\u8fd9\u4e9b\u200b\u70b9\u6765\u200b\u8ba1\u7b97\u200b\u63d2\u503c\u200b\u3002\u200b\u5982\u679c\u200b\u6ca1\u6709\u200b\u7a7a\u95f4\u200b\u7d22\u5f15\u200b\uff0cQGIS\u200b\u627e\u5230\u200b\u8fd9\u200b10\u200b\u4e2a\u70b9\u200b\u7684\u200b\u552f\u4e00\u200b\u65b9\u6cd5\u200b\u662f\u200b\u8ba1\u7b97\u200b\u4ece\u200b\u6bcf\u4e2a\u200b\u70b9\u5230\u200b\u6307\u5b9a\u200b\u4f4d\u7f6e\u200b\u7684\u200b\u8ddd\u79bb\u200b\uff0c\u200b\u7136\u540e\u200b\u6bd4\u8f83\u200b\u8fd9\u4e9b\u200b\u8ddd\u79bb\u200b\u3002\u200b\u8fd9\u200b\u53ef\u80fd\u200b\u662f\u200b\u4e00\u9879\u200b\u975e\u5e38\u200b\u8017\u65f6\u200b\u7684\u200b\u4efb\u52a1\u200b\uff0c\u200b\u7279\u522b\u200b\u662f\u200b\u5982\u679c\u200b\u9700\u8981\u200b\u5728\u200b\u591a\u4e2a\u200b\u4f4d\u7f6e\u200b\u91cd\u590d\u200b\u8fd9\u9879\u200b\u4efb\u52a1\u200b\u3002\u200b\u5982\u679c\u200b\u56fe\u5c42\u200b\u5b58\u5728\u200b\u7a7a\u95f4\u200b\u7d22\u5f15\u200b\uff0c\u200b\u5219\u200b\u64cd\u4f5c\u200b\u66f4\u200b\u6709\u6548\u200b\u3002</p> <p>\u200b\u53ef\u4ee5\u200b\u5c06\u200b\u6ca1\u6709\u200b\u7a7a\u95f4\u200b\u7d22\u5f15\u200b\u7684\u200b\u56fe\u5c42\u200b\u89c6\u4e3a\u200b\u7535\u8bdd\u7c3f\u200b\uff0c\u200b\u5176\u4e2d\u200b\u4e0d\u200b\u5bf9\u200b\u7535\u8bdd\u53f7\u7801\u200b\u8fdb\u884c\u200b\u6392\u5e8f\u200b\u6216\u200b\u7d22\u5f15\u200b\u3002\u200b\u627e\u5230\u200b\u7ed9\u5b9a\u200b\u4eba\u5458\u200b\u7684\u200b\u7535\u8bdd\u53f7\u7801\u200b\u7684\u200b\u552f\u4e00\u200b\u65b9\u6cd5\u200b\u662f\u200b\u4ece\u5934\u5f00\u59cb\u200b\u9605\u8bfb\u200b\uff0c\u200b\u76f4\u5230\u200b\u627e\u5230\u200b\u5b83\u200b\u4e3a\u6b62\u200b\u3002</p> <p>\u200b\u9ed8\u8ba4\u200b\u60c5\u51b5\u200b\u4e0b\u200b\uff0cQGIS\u200b\u77e2\u91cf\u56fe\u200b\u5c42\u200b\u4e0d\u4f1a\u200b\u521b\u5efa\u200b\u7a7a\u95f4\u200b\u7d22\u5f15\u200b\uff0c\u200b\u4f46\u200b\u4f60\u200b\u53ef\u4ee5\u200b\u8f7b\u677e\u200b\u521b\u5efa\u200b\u5b83\u4eec\u200b\u3002\u200b\u8fd9\u200b\u662f\u200b\u4f60\u200b\u8981\u200b\u505a\u200b\u7684\u200b\uff1a</p> <ul> <li>\u200b\u4f7f\u7528\u200b<code>QgsSpatialIndex</code>\u200b\u7c7b\u200b\u521b\u5efa\u200b\u7a7a\u95f4\u200b\u7d22\u5f15\u200b\uff1a</li> </ul> <pre><code>index = QgsSpatialIndex()\n</code></pre> <ul> <li>\u200b\u5411\u200b\u7d22\u5f15\u200b\u6dfb\u52a0\u200b\u8981\u7d20\u200b\u2014\u2014\u200b\u7d22\u5f15\u200b\u83b7\u53d6\u200b<code>QgsFeature</code>\u200b\u5bf9\u8c61\u200b\u5e76\u200b\u5c06\u200b\u5176\u200b\u6dfb\u52a0\u200b\u5230\u200b\u5185\u90e8\u200b\u6570\u636e\u7ed3\u6784\u200b\u3002\u200b\u4f60\u200b\u53ef\u4ee5\u200b\u624b\u52a8\u200b\u521b\u5efa\u5bf9\u8c61\u200b\uff0c\u200b\u4e5f\u200b\u53ef\u4ee5\u200b\u4f7f\u7528\u200b\u5148\u524d\u200b\u63d0\u4f9b\u8005\u200b\u7684\u200b<code>getFeatures()</code>\u200b\u65b9\u6cd5\u200b\u3002</li> </ul> <pre><code>index.insertFeature(feat)\n</code></pre> <ul> <li>\u200b\u6216\u8005\u200b\uff0c\u200b\u4f60\u200b\u53ef\u4ee5\u200b\u6279\u91cf\u200b\u52a0\u8f7d\u200b\u56fe\u5c42\u200b\u7684\u200b\u6240\u6709\u200b\u8981\u7d20\u200b</li> </ul> <pre><code>index = QgsSpatialIndex(layer.getFeatures())\n</code></pre> <ul> <li>\u200b\u4e00\u65e6\u200b\u7a7a\u95f4\u200b\u7d22\u5f15\u200b\u586b\u5145\u200b\u4e86\u200b\u4e00\u4e9b\u200b\u503c\u200b\uff0c\u200b\u4f60\u200b\u5c31\u200b\u53ef\u4ee5\u200b\u8fdb\u884c\u200b\u4e00\u4e9b\u200b\u67e5\u8be2\u200b</li> </ul> <pre><code># \u200b\u4ee5\u200b\u6570\u7ec4\u200b\u5f62\u5f0f\u200b\u8fd4\u56de\u200b\u4e94\u4e2a\u200b\u6700\u8fd1\u200b\u8981\u7d20\u200b\u7684\u200bID\nnearest = index.nearestNeighbor(QgsPointXY(25.4, 12.7), 5)\n\n# \u200b\u4ee5\u200b\u6570\u7ec4\u200b\u5f62\u5f0f\u200b\u8fd4\u56de\u200b\u4e0e\u200b\u77e9\u5f62\u200b\u76f8\u4ea4\u200b\u7684\u200b\u8981\u7d20\u200b\nintersect = index.intersects(QgsRectangle(22.5, 15.3, 23.1, 17.2))\n</code></pre> <p>\u200b\u4f60\u200b\u53ef\u4ee5\u200b\u4f7f\u7528\u200b<code>QgsSpatialIndexKDBush</code>\u200b\u7a7a\u95f4\u200b\u7d22\u5f15\u200b\u3002\u200b\u8fd9\u4e2a\u200b\u7a7a\u95f4\u200b\u7d22\u5f15\u200b\u4e0e\u200b\u6807\u51c6\u200b\u7a7a\u95f4\u200b\u5e93\u200b<code>QgsSpatialIndex</code>\u200b\u76f8\u4f3c\u200b\uff0c\u200b\u4f46\u662f\u200b\u6709\u200b\u4ee5\u4e0b\u200b\u7279\u6027\u200b\uff1a</p> <ul> <li>\u200b\u4ec5\u200b \u200b\u652f\u6301\u200b\u652f\u6301\u200b\u5355\u70b9\u200b\u8981\u7d20\u200b</li> <li>\u200b\u9759\u6001\u200b \uff08\u200b\u6784\u9020\u200b\u540e\u200b\u65e0\u6cd5\u200b\u5c06\u200b\u5176\u4ed6\u200b\u8981\u7d20\u200b\u6dfb\u52a0\u200b\u5230\u200b\u7d22\u5f15\u200b\uff09</li> <li>\u200b\u66f4\u200b\u5feb\u200b </li> <li>\u200b\u5141\u8bb8\u200b\u76f4\u63a5\u200b\u68c0\u7d22\u200b\u539f\u59cb\u200b\u8981\u7d20\u200b\u7684\u200b\u70b9\u200b\uff0c\u200b\u800c\u200b\u65e0\u9700\u200b\u5176\u4ed6\u200b\u8981\u7d20\u200b\u8bf7\u6c42\u200b</li> <li>\u200b\u652f\u6301\u200b\u57fa\u4e8e\u200b\u771f\u5b9e\u200b\u8ddd\u79bb\u200b\u7684\u200b\u641c\u7d22\u200b\uff0c\u200b\u5373\u200b\u8fd4\u56de\u200b\u641c\u7d22\u200b\u534a\u5f84\u200b\u8303\u56f4\u200b\u5185\u200b\u7684\u200b\u6240\u6709\u200b\u70b9\u200b</li> </ul>"},{"location":"6-%E4%BD%BF%E7%94%A8%E7%9F%A2%E9%87%8F%E5%9B%BE%E5%B1%82/#66-qgsvectorlayerutils","title":"6.6 QgsVectorLayerUtils\u200b\u7c7b","text":"<p><code>QgsVectorLayerUtils</code> \u200b\u7c7b\u200b\u5305\u542b\u200b\u4e00\u4e9b\u200b\u975e\u5e38\u200b\u6709\u7528\u200b\u7684\u200b\u65b9\u6cd5\u200b\uff0c\u200b\u4f60\u200b\u53ef\u4ee5\u200b\u5728\u200b\u77e2\u91cf\u56fe\u200b\u5c42\u4e2d\u200b\u4f7f\u7528\u200b\u3002</p> <p>\u200b\u4f8b\u5982\u200b\uff0c <code>createFeature()</code>\u200b\u65b9\u6cd5\u200b\u51c6\u5907\u200b\u5c06\u200b <code>QgsFeature</code>\u200b\u6dfb\u52a0\u200b\u5230\u200b\u77e2\u91cf\u200b\u5c42\u200b\uff0c\u200b\u5e76\u200b\u4fdd\u7559\u200b\u6bcf\u4e2a\u200b\u5b57\u6bb5\u200b\u7684\u200b\u6240\u6709\u200b\u6700\u7ec8\u200b\u7ea6\u675f\u200b\u548c\u200b\u9ed8\u8ba4\u503c\u200b </p> <pre><code>vlayer = QgsVectorLayer(\"testdata/airports.shp\", \"airports\", \"ogr\")\nfeat = QgsVectorLayerUtils.createFeature(vlayer)\n</code></pre> <p>\u200b\u4f7f\u7528\u200b<code>getValues()</code>\u200b\u65b9\u6cd5\u200b\u53ef\u4ee5\u200b\u5feb\u901f\u200b\u83b7\u53d6\u200b\u5b57\u6bb5\u200b\u6216\u200b\u8868\u8fbe\u5f0f\u200b\u7684\u200b\u503c\u200b\uff1a</p> <pre><code>vlayer = QgsVectorLayer(\"testdata/airports.shp\", \"airports\", \"ogr\")\n# \u200b\u53ea\u200b\u9009\u62e9\u200b\u7b2c\u4e00\u4e2a\u200b\u8981\u7d20\u200b\nvlayer.selectByIds([1])\nval = QgsVectorLayerUtils.getValues(vlayer, \"NAME\", selectedOnly=True)\nprint(val)\n\n# (['AMBLER'], True)\n</code></pre>"},{"location":"6-%E4%BD%BF%E7%94%A8%E7%9F%A2%E9%87%8F%E5%9B%BE%E5%B1%82/#67","title":"6.7 \u200b\u521b\u5efa\u200b\u77e2\u91cf\u56fe\u200b\u5c42","text":"<p>\u200b\u6709\u200b\u51e0\u79cd\u200b\u65b9\u6cd5\u200b\u53ef\u4ee5\u200b\u751f\u6210\u200b\u77e2\u91cf\u56fe\u200b\u5c42\u200b\u6570\u636e\u200b\u96c6\u200b\uff1a</p> <ul> <li><code>QgsVectorFileWriter</code>\u200b\u7c7b\u200b\uff1a\u200b\u7528\u4e8e\u200b\u5c06\u200b\u77e2\u91cf\u200b\u6587\u4ef6\u200b\u5199\u5165\u200b\u786c\u76d8\u200b\uff0c\u200b\u901a\u8fc7\u200b\u9759\u6001\u200b\u8c03\u7528\u200b<code>writeAsVectorFormatV3()</code>\u200b\u4fdd\u5b58\u200b\u6574\u4e2a\u200b\u77e2\u91cf\u56fe\u200b\u5c42\u200b\uff0c\u200b\u6216\u200b\u521b\u5efa\u200b\u8be5\u7c7b\u200b\u7684\u200b\u5b9e\u4f8b\u200b\u5e76\u200b\u8c03\u7528\u200b<code>addFeature()</code>\u200b\u65b9\u6cd5\u200b\u3002\u200b\u8be5\u7c7b\u200b\u652f\u6301\u200b GDAL \u200b\u652f\u6301\u200b\u7684\u200b\u6240\u6709\u200b\u77e2\u91cf\u200b\u683c\u5f0f\u200b\uff08GeoPackage\uff0cShapefile\uff0cGeoJSON\uff0cKML\u200b\u7b49\u200b\uff09\u3002</li> <li><code>QgsVectorLayer</code>\u200b\u7c7b\u200b\uff1a\u200b\u5b9e\u4f8b\u200b\u5316\u200b\u4e00\u4e2a\u200b\u6570\u636e\u200b\u63d0\u4f9b\u8005\u200b\uff0c\u200b\u63d0\u4f9b\u200b\u7684\u200b\u6570\u636e\u6e90\u200b\u8def\u5f84\u200b\uff08url\uff09\u200b\u4ee5\u200b\u8fde\u63a5\u200b\u548c\u200b\u8bbf\u95ee\u200b\u6570\u636e\u200b\u3002\u200b\u5b83\u200b\u53ef\u4ee5\u200b\u7528\u6765\u200b\u521b\u5efa\u200b\u4e34\u65f6\u200b\u7684\u200b\u3001\u200b\u57fa\u4e8e\u200b\u5185\u5b58\u200b\u5b58\u50a8\u200b\u7684\u200b\u56fe\u5c42\u200b\uff08<code>memory</code>\uff09\uff0c\u200b\u8fd8\u200b\u53ef\u4ee5\u200b\u8fde\u63a5\u200b\u5230\u200bGDAL\u200b\u6570\u636e\u200b\u96c6\u200b\uff08 <code>ogr</code>\uff09\uff0c\u200b\u6570\u636e\u5e93\u200b\uff08<code>postgres</code>\uff0c<code>spatialite</code>\uff0c<code>mysql</code>\uff0c<code>mssql</code>\uff09\uff0c\u200b\u66f4\u200b\u591a\u200b\uff08<code>wfs</code>\uff0c<code>gpx</code>\uff0c<code>delimitedtext</code>...\uff09\u3002</li> </ul>"},{"location":"6-%E4%BD%BF%E7%94%A8%E7%9F%A2%E9%87%8F%E5%9B%BE%E5%B1%82/#671-qgsvectorfilewriter","title":"6.7.1 \u200b\u4ece\u200b<code>QgsVectorFileWriter</code>\u200b\u5b9e\u4f8b\u200b\u521b\u5efa","text":"<pre><code># SaveVectorOptions\u200b\u5305\u542b\u200b\u5f88\u591a\u200b\u8bbe\u7f6e\u200b\u9879\u200b\nsave_options = QgsVectorFileWriter.SaveVectorOptions()\ntransform_context = QgsProject.instance().transformContext()\n# \u200b\u5199\u5165\u200bGeoPackage (\u200b\u9ed8\u8ba4\u200b)\nerror = QgsVectorFileWriter.writeAsVectorFormatV3(layer,\n                                                  \"testdata/my_new_file.gpkg\",\n                                                  transform_context,\n                                                  save_options)\nif error[0] == QgsVectorFileWriter.NoError:\n    print(\"success!\")\nelse:\n  print(error)\n</code></pre> <pre><code># \u200b\u4f7f\u7528\u200butf-8\u200b\u7f16\u7801\u200b\u5199\u5165\u200bESRI Shapefile\nsave_options = QgsVectorFileWriter.SaveVectorOptions()\nsave_options.driverName = \"ESRI Shapefile\"\nsave_options.fileEncoding = \"UTF-8\"\ntransform_context = QgsProject.instance().transformContext()\nerror = QgsVectorFileWriter.writeAsVectorFormatV3(layer,\n                                                  \"testdata/my_new_shapefile\",\n                                                  transform_context,\n                                                  save_options)\nif error[0] == QgsVectorFileWriter.NoError:\n    print(\"success again!\")\nelse:\n  print(error)\n</code></pre> <pre><code># \u200b\u5199\u5165\u200bESRI GDB\u200b\u6587\u4ef6\u200b\nsave_options = QgsVectorFileWriter.SaveVectorOptions()\nsave_options.driverName = \"FileGDB\" # \u200b\u8bd1\u8005\u200b\u6ce8\u200b\uff1a\u200b\u9ed8\u8ba4\u200b\u60c5\u51b5\u200b\u4e0b\u200b\u6ca1\u6709\u200bFileGDB\u200b\u9a71\u52a8\u200b\n# \u200b\u5982\u679c\u200b\u6ca1\u6709\u200b\u51e0\u4f55\u200b\nsave_options.overrideGeometryType = QgsWkbTypes.Unknown\nsave_options.actionOnExistingFile = QgsVectorFileWriter.CreateOrOverwriteLayer\nsave_options.layerName = 'my_new_layer_name'\ntransform_context = QgsProject.instance().transformContext()\ngdb_path = \"testdata/my_example.gdb\"\nerror = QgsVectorFileWriter.writeAsVectorFormatV3(layer,\n                                                gdb_path,\n                                                transform_context,\n                                                save_options)\nif error[0] == QgsVectorFileWriter.NoError:\n  print(\"success!\")\nelse:\n  print(error)\n</code></pre> <p>\u200b\u4f60\u200b\u8fd8\u200b\u53ef\u4ee5\u200b\u4f7f\u7528\u200b <code>FieldValueConverter</code> \u200b\u8f6c\u6362\u200b\u5b57\u6bb5\u200b\u4f7f\u200b\u5176\u200b\u4e0e\u200b\u4e0d\u540c\u200b\u683c\u5f0f\u200b\u517c\u5bb9\u200b\u3002\u200b\u4f8b\u5982\u200b\uff0c\u200b\u8981\u200b\u5c06\u200b\u6570\u7ec4\u200b\u53d8\u91cf\u200b\u7c7b\u578b\u200b\uff08\u200b\u4f8b\u5982\u200b\u5728\u200bPostgres\u200b\u4e2d\u200b\uff09\u200b\u8f6c\u6362\u200b\u4e3a\u200b\u6587\u672c\u200b\u7c7b\u578b\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u6267\u884c\u200b\u4ee5\u4e0b\u200b\u64cd\u4f5c\u200b :</p> <pre><code>LIST_FIELD_NAME = 'xxxx'\n\n\nclass ESRIValueConverter(QgsVectorFileWriter.FieldValueConverter):\n\n  def __init__(self, layer, list_field):\n    QgsVectorFileWriter.FieldValueConverter.__init__(self)\n    self.layer = layer\n    self.list_field_idx = self.layer.fields().indexFromName(list_field)\n\n  def convert(self, fieldIdxInLayer, value):\n    if fieldIdxInLayer == self.list_field_idx:\n      return QgsListFieldFormatter().representValue(layer=vlayer,\n                                                    fieldIndex=self.list_field_idx,\n                                                    config={},\n                                                    cache=None,\n                                                    value=value)\n    else:\n      return value\n\n  def fieldDefinition(self, field):\n    idx = self.layer.fields().indexFromName(field.name())\n    if idx == self.list_field_idx:\n      return QgsField(LIST_FIELD_NAME, QMetaType.Type.QString)\n    else:\n      return self.layer.fields()[idx]\n\nconverter = ESRIValueConverter(vlayer, LIST_FIELD_NAME)\nopts = QgsVectorFileWriter.SaveVectorOptions()\nopts.fieldValueConverter = converter\n</code></pre> <p>\u200b\u8fd8\u200b\u53ef\u4ee5\u200b\u6307\u5b9a\u200b\u76ee\u6807\u200bCRS\u2014\u2014\u200b\u5982\u679c\u200b\u5c06\u200b\u4e00\u4e2a\u200b\u6709\u6548\u200b\u7684\u200b<code>QgsCoordinateReferenceSystem</code>\u200b\u5b9e\u4f8b\u200b\u4f5c\u4e3a\u200b\u7b2c\u56db\u4e2a\u200b\u53c2\u6570\u200b\uff0c\u200b\u5219\u200b\u5c06\u200b\u8be5\u200b\u56fe\u5c42\u200b\u8f6c\u6362\u200b\u4e3a\u200b\u8fd9\u4e2a\u200bCRS\u3002</p> <p>\u200b\u6709\u5173\u200b\u6709\u6548\u200b\u7684\u200b\u9a71\u52a8\u7a0b\u5e8f\u200b\u7684\u200b\u540d\u79f0\u200b\uff0c\u200b\u8bf7\u200b\u8c03\u7528\u200b<code>supportedFiltersAndFormats</code>\u200b\u65b9\u6cd5\u200b\u6216\u200b\u67e5\u9605\u200bGDAL\u200b\u652f\u6301\u200b\u7684\u200b\u683c\u5f0f\u200b\u2014\u2014\u200b\u4f60\u200b\u5e94\u8be5\u200b\u5c06\u200b\u201cCode\u201d\u200b\u5217\u4e2d\u200b\u7684\u200b\u503c\u200b\u4f5c\u4e3a\u200b\u9a71\u52a8\u7a0b\u5e8f\u200b\u540d\u79f0\u200b\u4f20\u9012\u200b\u3002</p> <p>\uff08\u200b\u53ef\u200b\u9009\u200b\uff09\u200b\u4f60\u200b\u53ef\u4ee5\u200b\u8bbe\u7f6e\u200b\u662f\u200b\u4ec5\u200b\u5bfc\u51fa\u200b\u9009\u4e2d\u200b\u7684\u200b\u8981\u7d20\u200b\uff0c\u200b\u4f20\u9012\u200b\u66f4\u200b\u591a\u200b\u9a71\u52a8\u7a0b\u5e8f\u200b\u7279\u5b9a\u200b\u7684\u200b\u9009\u9879\u200b\u8fdb\u884c\u200b\u521b\u5efa\u200b\uff0c\u200b\u6216\u8005\u200b\u544a\u8bc9\u200b\u6570\u636e\u200b\u5199\u5165\u200b\u7c7b\u200b\u4e0d\u8981\u200b\u521b\u5efa\u200b\u5c5e\u6027\u200b...\u200b\u8fd8\u6709\u200b\u8bb8\u591a\u200b\u5176\u4ed6\u200b\uff08\u200b\u53ef\u200b\u9009\u200b\uff09\u200b\u53c2\u6570\u200b; \u200b\u8bf7\u53c2\u9605\u200b<code>QgsVectorFileWriter</code>\u200b\u7684\u200b\u8be6\u7ec6\u4fe1\u606f\u200b</p>"},{"location":"6-%E4%BD%BF%E7%94%A8%E7%9F%A2%E9%87%8F%E5%9B%BE%E5%B1%82/#672","title":"6.7.2 \u200b\u76f4\u63a5\u200b\u4ece\u200b\u8981\u7d20\u200b\u521b\u5efa","text":"<pre><code>from qgis.PyQt.QtCore import QMetaType\n\n# \u200b\u4e3a\u200b\u8981\u7d20\u200b\u5c5e\u6027\u200b\u5b9a\u4e49\u200b\u5b57\u200b\u6bb5\u200b\u3002\u200b\u9700\u8981\u200bQgsFields\u200b\u5bf9\u8c61\u200b\nfields = QgsFields()\nfields.append(QgsField(\"first\", QMetaType.Type.Int))\nfields.append(QgsField(\"second\", QMetaType.Type.QString))\n\n\"\"\"\n\u200b\u521b\u5efa\u200b\u4e00\u4e2a\u200b\u77e2\u91cf\u200b\u6587\u4ef6\u200b\u7f16\u5199\u200b\u5668\u200b\u7684\u200b\u5b9e\u4f8b\u200b\uff0c\u200b\u5b83\u200b\u5c06\u200b\u521b\u5efa\u200b\u77e2\u91cf\u200b\u6587\u4ef6\u200b\n\u200b\u53c2\u6570\u200b\uff1a\n1. \u200b\u65b0\u200b\u6587\u4ef6\u200b\u7684\u200b\u8def\u5f84\u200b\uff08\u200b\u5982\u679c\u200b\u5df2\u200b\u5b58\u5728\u200b\u5219\u200b\u5931\u8d25\u200b\uff09\n2. \u200b\u5b57\u200b\u6bb5\u200b\u6620\u5c04\u200b\n3. \u200b\u51e0\u4f55\u200b\u7c7b\u578b\u200b - WKBTYPE\u200b\u679a\u4e3e\u200b\n4. \u200b\u56fe\u5c42\u200b\u7684\u200b\u7a7a\u95f4\u200b\u53c2\u8003\u200b\uff08QgsCoordinateReferenceSystem\u200b\u7684\u200b\u5b9e\u4f8b\u200b\uff09\n5. \u200b\u5750\u6807\u200b\u8f6c\u6362\u200b\u4e0a\u4e0b\u6587\u200b\n6. \u200b\u8f93\u51fa\u200b\u9009\u9879\u200b\uff08\u200b\u9a71\u52a8\u200b\u540d\u79f0\u200b\uff0c\u200b\u7f16\u7801\u200b\u7b49\u200b\uff09\n\"\"\"\n\ncrs = QgsProject.instance().crs()\ntransform_context = QgsProject.instance().transformContext()\nsave_options = QgsVectorFileWriter.SaveVectorOptions()\nsave_options.driverName = \"ESRI Shapefile\"\nsave_options.fileEncoding = \"UTF-8\"\n\nwriter = QgsVectorFileWriter.create(\n  \"testdata/my_new_shapefile.shp\",\n  fields,\n  QgsWkbTypes.Point,\n  crs,\n  transform_context,\n  save_options\n)\n\nif writer.hasError() != QgsVectorFileWriter.NoError:\n    print(\"Error when creating shapefile: \",  writer.errorMessage())\n\n# \u200b\u6dfb\u52a0\u200b\u4e00\u4e2a\u200b\u8981\u7d20\u200b\nfet = QgsFeature()\n\nfet.setGeometry(QgsGeometry.fromPointXY(QgsPointXY(10,10)))\nfet.setAttributes([1, \"text\"])\nwriter.addFeature(fet)\n\n# \u200b\u5220\u9664\u200bwriter\u200b\u5199\u5165\u200b\u5230\u200b\u78c1\u76d8\u200b\ndel writer\n</code></pre>"},{"location":"6-%E4%BD%BF%E7%94%A8%E7%9F%A2%E9%87%8F%E5%9B%BE%E5%B1%82/#673-qgsvectorlayer","title":"6.7.3 \u200b\u4ece\u200b<code>QgsVectorLayer</code>\u200b\u5b9e\u4f8b\u200b\u521b\u5efa","text":"<p>\u200b\u5728\u200b<code>QgsVectorLayer</code>\u200b\u7c7b\u200b\u652f\u6301\u200b\u7684\u200b\u6240\u6709\u200b\u6570\u636e\u200b\u63d0\u4f9b\u8005\u200b\u4e2d\u200b\uff0c\u200b\u8ba9\u200b\u6211\u4eec\u200b\u5173\u6ce8\u200b\u57fa\u4e8e\u200b\u5185\u5b58\u200b\u7684\u200b\u56fe\u5c42\u200b\u3002\u200b\u5185\u5b58\u200b\u63d0\u4f9b\u8005\u200b\u4e3b\u8981\u200b\u4f9b\u200b\u63d2\u4ef6\u200b\u6216\u200b\u7b2c\u4e09\u65b9\u200b\u5e94\u7528\u7a0b\u5e8f\u200b\u5f00\u53d1\u4eba\u5458\u200b\u4f7f\u7528\u200b\u3002\u200b\u5b83\u200b\u4e0d\u4f1a\u200b\u5c06\u200b\u6570\u636e\u200b\u5b58\u50a8\u200b\u5728\u200b\u78c1\u76d8\u200b\u4e2d\u200b\uff0c\u200b\u5141\u8bb8\u200b\u5f00\u53d1\u4eba\u5458\u200b\u5feb\u901f\u200b\u5728\u200b\u540e\u53f0\u200b\u4f7f\u7528\u200b\u4e34\u65f6\u200b\u56fe\u5c42\u200b\u3002</p> <p>\u200b\u63d0\u4f9b\u8005\u200b\u652f\u6301\u200bstring\uff0cint\u200b\u548c\u200bdouble\u200b\u5b57\u200b\u6bb5\u200b\u3002</p> <p>\u200b\u5185\u5b58\u200b\u63d0\u4f9b\u8005\u200b\u8fd8\u200b\u652f\u6301\u200b\u7a7a\u95f4\u200b\u7d22\u5f15\u200b\uff0c\u200b\u901a\u8fc7\u200b\u8c03\u7528\u200b\u63d0\u4f9b\u8005\u200b\u7684\u200b<code>createSpatialIndex()</code>\u200b\u65b9\u6cd5\u200b\u6765\u200b\u542f\u7528\u200b\u3002\u200b\u521b\u5efa\u200b\u7a7a\u95f4\u200b\u7d22\u5f15\u200b\u540e\u200b\uff0c\u200b\u4f60\u200b\u5c06\u200b\u80fd\u591f\u200b\u66f4\u5feb\u200b\u5730\u200b\u8fed\u4ee3\u200b\u8f83\u200b\u5c0f\u200b\u533a\u57df\u200b\u5185\u200b\u7684\u200b\u8981\u7d20\u200b\uff08\u200b\u56e0\u4e3a\u200b\u6ca1\u6709\u200b\u5fc5\u8981\u200b\u904d\u5386\u200b\u6240\u6709\u200b\u8981\u7d20\u200b\uff0c\u200b\u53ea\u200b\u904d\u5386\u200b\u6307\u5b9a\u200b\u77e9\u5f62\u200b\u5185\u200b\u7684\u200b\u8981\u7d20\u200b\uff09\u3002</p> <p>\u200b\u901a\u8fc7\u200b\u5c06\u200b<code>\"memory\"</code>\u200b\u4f5c\u4e3a\u200b<code>QgsVectorLayer</code>\u200b\u6784\u9020\u51fd\u6570\u200b\u7684\u200b\u53c2\u6570\u200b\u6765\u200b\u521b\u5efa\u200b\u5185\u5b58\u200b\u63d0\u4f9b\u8005\u200b\u3002</p> <p>\u200b\u8fd9\u4e2a\u200b\u6784\u9020\u51fd\u6570\u200b\u4e5f\u200b\u9700\u8981\u200b\u5b9a\u4e49\u200b\u56fe\u5c42\u200b\u51e0\u4f55\u200b\u7c7b\u578b\u200b\u7684\u200bURI\uff0c\u200b\u5305\u62ec\u200b\uff1a<code>\"Point\"</code>\uff0c<code>\"LineString\"</code>\uff0c<code>\"Polygon\"</code>\uff0c<code>\"MultiPoint\"</code>\uff0c <code>\"MultiLineString\"</code>\uff0c<code>\"MultiPolygon\"</code> or <code>\"None\"</code>\u3002</p> <p>URI\u200b\u8fd8\u200b\u53ef\u4ee5\u200b\u6307\u5b9a\u200b\u5750\u6807\u200b\u53c2\u8003\u200b\u7cfb\u7edf\u200b\u3001\u200b\u5b57\u6bb5\u200b\u548c\u200b\u7d22\u5f15\u200b\u3002\u200b\u8bed\u6cd5\u200b\u662f\u200b\uff1a</p> <ul> <li>crs=definition</li> </ul> <p>\u200b\u6307\u5b9a\u200b\u5750\u6807\u200b\u53c2\u8003\u200b\u7cfb\u7edf\u200b\uff0c\u200b\u5176\u4e2d\u200b\u5b9a\u4e49\u200b\u53ef\u4ee5\u200b\u662f\u200b\u63a5\u53d7\u200b\u7684\u200b\u4efb\u4f55\u200b\u5f62\u5f0f\u200b <code>QgsCoordinateReferenceSystem.createFromString()</code></p> <ul> <li>index=yes</li> </ul> <p>\u200b\u6307\u5b9a\u200b\u63d0\u4f9b\u8005\u200b\u5c06\u200b\u4f7f\u7528\u200b\u7a7a\u95f4\u200b\u7d22\u5f15\u200b</p> <ul> <li>field=name:type(length,precision)</li> </ul> <p>\u200b\u6307\u5b9a\u200b\u56fe\u5c42\u200b\u7684\u200b\u5c5e\u6027\u200b\u3002\u200b\u8be5\u200b\u5c5e\u6027\u200b\u5177\u6709\u200b\u540d\u79f0\u200b\uff0c\u200b\u53ef\u9009\u200b\u7684\u200b\u7c7b\u578b\u200b\uff08integer, double, or string\uff09\uff0c\u200b\u957f\u5ea6\u200b\u548c\u200b\u7cbe\u5ea6\u200b\u3002\u200b\u53ef\u80fd\u200b\u6709\u200b\u591a\u4e2a\u200b\u5b57\u200b\u6bb5\u200b\u5b9a\u4e49\u200b\u3002</p> <p>\u200b\u4ee5\u4e0b\u200bURI\u200b\u793a\u4f8b\u200b\u5305\u542b\u200b\u6240\u6709\u200b\u8fd9\u4e9b\u200b\u9009\u9879\u200b</p> <pre><code>\"Point?crs=epsg:4326&amp;field=id:integer&amp;field=name:string(20)&amp;index=yes\"\n</code></pre> <p>\u200b\u4ee5\u4e0b\u200b\u793a\u4f8b\u200b\u4ee3\u7801\u200b\u8bf4\u660e\u200b\u4e86\u200b\u5982\u4f55\u200b\u521b\u5efa\u200b\u548c\u200b\u586b\u5145\u200b\u5185\u5b58\u200b\u63d0\u4f9b\u8005\u200b</p> <pre><code>from qgis.PyQt.QtCore import QMetaType\n\n\n# \u200b\u521b\u5efa\u200b\u56fe\u5c42\u200b\nvl = QgsVectorLayer(\"Point\", \"temporary_points\", \"memory\")\npr = vl.dataProvider()\n\n\n# \u200b\u6dfb\u52a0\u200b\u5b57\u200b\u6bb5\u200b\npr.addAttributes([QgsField(\"name\", QMetaType.Type.QString),\n                    QgsField(\"age\",  QMetaType.Type.Int),\n                    QgsField(\"size\", QMetaType.Type.Double)])\nvl.updateFields() # \u200b\u544a\u8bc9\u200b\u77e2\u91cf\u56fe\u200b\u5c42\u200b\u4ece\u200b\u63d0\u4f9b\u8005\u200b\u83b7\u53d6\u200b\u66f4\u6539\u200b\n\n# \u200b\u6dfb\u52a0\u200b\u4e00\u4e2a\u200b\u8981\u7d20\u200b\nfet = QgsFeature()\nfet.setGeometry(QgsGeometry.fromPointXY(QgsPointXY(10,10)))\nfet.setAttributes([\"Johnny\", 2, 0.3])\npr.addFeatures([fet])\n\n# \u200b\u5728\u200b\u6dfb\u52a0\u200b\u65b0\u200b\u8981\u7d20\u200b\u65f6\u200b\u66f4\u65b0\u200b\u56fe\u5c42\u200b\u7684\u200b\u8303\u56f4\u200b\uff0c\u200b\u56e0\u4e3a\u200b\u63d0\u4f9b\u8005\u200b\u4e2d\u200b\u7684\u200b\u8303\u56f4\u200b\u66f4\u6539\u200b\u4e0d\u4f1a\u200b\u4f20\u64ad\u200b\u5230\u200b\u56fe\u5c42\u200b\nvl.updateExtents()\n</code></pre> <p>\u200b\u6700\u540e\u200b\uff0c\u200b\u8ba9\u200b\u6211\u4eec\u200b\u68c0\u67e5\u200b\u4e00\u5207\u200b\u662f\u5426\u200b\u987a\u5229\u200b</p> <pre><code># \u200b\u663e\u793a\u200b\u4e00\u4e9b\u200b\u7edf\u8ba1\u200b\nprint(\"fields:\", len(pr.fields()))\nprint(\"features:\", pr.featureCount())\ne = vl.extent()\nprint(\"extent:\", e.xMinimum(), e.yMinimum(), e.xMaximum(), e.yMaximum())\n\n# \u200b\u904d\u5386\u200b\u8981\u7d20\u200b\nfeatures = vl.getFeatures()\nfor fet in features:\n    print(\"F:\", fet.id(), fet.attributes(), fet.geometry().asPoint())\n\n# fields: 3\n# features: 1\n# extent: 10.0 10.0 10.0 10.0\n# F: 1 ['Johny', 2, 0.3] &lt;QgsPointXY: POINT(10 10)&gt;\n</code></pre>"},{"location":"6-%E4%BD%BF%E7%94%A8%E7%9F%A2%E9%87%8F%E5%9B%BE%E5%B1%82/#68","title":"6.8 \u200b\u77e2\u91cf\u56fe\u200b\u5c42\u200b\u7684\u200b\u5916\u89c2\u200b\uff08\u200b\u7b26\u53f7\u200b\u7cfb\u7edf\u200b\uff09","text":"<p>\u200b\u6e32\u67d3\u200b\u77e2\u91cf\u56fe\u200b\u5c42\u65f6\u200b\uff0c\u200b\u6570\u636e\u200b\u7684\u200b\u5916\u89c2\u200b\u7531\u200b \u200b\u6e32\u67d3\u5668\u200b \u200b\u548c\u200b\u4e0e\u200b\u56fe\u5c42\u200b\u76f8\u5173\u8054\u200b\u7684\u200b \u200b\u7b26\u53f7\u200b \u200b\u63d0\u4f9b\u200b \u3002\u200b\u7b26\u53f7\u200b\u662f\u200b\u4e00\u4e2a\u200b\u7c7b\u200b\u2014\u2014\u200b\u8d1f\u8d23\u200b\u7ed8\u5236\u200b\u8981\u7d20\u200b\u7684\u200b\u53ef\u89c6\u5316\u200b\uff0c\u200b\u800c\u200b\u6e32\u67d3\u5668\u200b\u786e\u5b9a\u200b\u7528\u4e8e\u200b\u7279\u5b9a\u200b\u8981\u7d20\u200b\u7684\u200b\u7b26\u53f7\u200b\u3002</p> <p>\u200b\u83b7\u5f97\u200b\u56fe\u5c42\u200b\u7684\u200b\u6e32\u67d3\u5668\u200b\uff0c\u200b\u5982\u4e0b\u200b\u6240\u793a\u200b\uff1a</p> <pre><code>renderer = layer.renderer()\n</code></pre> <p>\u200b\u6709\u200b\u4e86\u200b\u8fd9\u4e2a\u200b\u53c2\u8003\u200b\uff0c\u200b\u8ba9\u200b\u6211\u4eec\u200b\u6765\u200b\u63a2\u8ba8\u200b\u4e00\u4e0b\u200b</p> <pre><code>print(\"Type:\", renderer.type())\n# Type: singleSymbol\n</code></pre> <p>QGIS\u200b\u6838\u5fc3\u200b\u5e93\u4e2d\u200b\u6709\u200b\u51e0\u79cd\u200b\u5df2\u77e5\u200b\u7684\u200b\u6e32\u67d3\u5668\u200b\u7c7b\u578b\u200b\uff1a</p> \u200b\u7c7b\u578b\u200b \u200b\u7c7b\u200b \u200b\u63cf\u8ff0\u200b singleSymbol <code>QgsSingleSymbolRenderer</code> \u200b\u4f7f\u7528\u200b\u76f8\u540c\u200b\u7684\u200b\u7b26\u53f7\u200b\u5448\u73b0\u200b\u6240\u6709\u200b\u8981\u7d20\u200b categorizedSymbol <code>QgsCategorizedSymbolRenderer</code> \u200b\u4f7f\u7528\u200b\u6bcf\u4e2a\u200b\u7c7b\u522b\u200b\u7684\u200b\u4e0d\u540c\u200b\u7b26\u53f7\u200b\u5448\u73b0\u200b\u8981\u7d20\u200b graduatedSymbol <code>QgsGraduatedSymbolRenderer</code> \u200b\u4e3a\u200b\u6bcf\u4e2a\u200b\u503c\u200b\u8303\u56f4\u200b\u4f7f\u7528\u200b\u4e0d\u540c\u200b\u7684\u200b\u7b26\u53f7\u200b\u5448\u73b0\u200b\u8981\u7d20\u200b <p>\u200b\u53ef\u80fd\u200b\u8fd8\u6709\u200b\u4e00\u4e9b\u200b\u81ea\u5b9a\u4e49\u200b\u6e32\u67d3\u5668\u200b\u7c7b\u578b\u200b\uff0c\u200b\u6240\u4ee5\u200b\u6c38\u8fdc\u200b\u4e0d\u8981\u200b\u5047\u8bbe\u200b\u53ea\u6709\u200b\u8fd9\u4e9b\u200b\u7c7b\u578b\u200b\u3002\u200b\u4f60\u200b\u53ef\u4ee5\u200b\u67e5\u8be2\u200b<code>QgsApplication</code>\u200b\u7684\u200b<code>QgsRendererRegistry</code>\u200b\u65b9\u6cd5\u200b\u67e5\u627e\u200b\u5f53\u524d\u200b\u53ef\u7528\u200b\u7684\u200b\u6e32\u67d3\u5668\u200b\uff1a</p> <pre><code>print(QgsApplication.rendererRegistry().renderersList())\n# Print:\n['nullSymbol',\n'singleSymbol',\n'categorizedSymbol',\n'graduatedSymbol',\n'RuleRenderer',\n'pointDisplacement',\n'pointCluster',\n'invertedPolygonRenderer',\n'heatmapRenderer',\n'25dRenderer']\n</code></pre> <p>\u200b\u53ef\u4ee5\u200b\u4ee5\u200b\u6587\u672c\u200b\u5f62\u5f0f\u200b\u83b7\u53d6\u200b\u6e32\u67d3\u5668\u200b\u7684\u200b\u5185\u5bb9\u200b\u2014\u2014\u200b\u53ef\u200b\u7528\u4e8e\u200b\u8c03\u8bd5\u200b</p> <pre><code>print(renderer.dump())\n# SINGLE: MARKER SYMBOL (1 layers) color 190,207,80,255\n</code></pre>"},{"location":"6-%E4%BD%BF%E7%94%A8%E7%9F%A2%E9%87%8F%E5%9B%BE%E5%B1%82/#681","title":"6.8.1 \u200b\u5355\u4e00\u200b\u7b26\u53f7\u200b\u6e32\u67d3\u5668","text":"<p>\u200b\u4f60\u200b\u53ef\u4ee5\u200b\u901a\u8fc7\u200b\u8c03\u7528\u200b<code>symbol()</code>\u200b\u65b9\u6cd5\u200b\u83b7\u53d6\u200b\u7528\u4e8e\u200b\u6e32\u67d3\u200b\u7684\u200b\u7b26\u53f7\u200b\uff0c\u200b\u4f7f\u7528\u200b<code>setSymbol()</code>\u200b\u65b9\u6cd5\u200b\u66f4\u6539\u200b\u5b83\u200b\uff08C ++\u200b\u5f00\u53d1\u4eba\u5458\u200b\u6ce8\u610f\u200b\uff1a\u200b\u6e32\u67d3\u5668\u200b\u5c06\u200b\u83b7\u53d6\u200b\u7b26\u53f7\u200b\u7684\u200b\u6240\u6709\u6743\u200b\u3002\uff09</p> <p>\u200b\u4f60\u200b\u53ef\u4ee5\u200b\u901a\u8fc7\u200b\u8c03\u7528\u200b<code>setSymbol()</code>\u200b\u5e76\u200b\u4f20\u9012\u200b\u9002\u5f53\u200b\u7684\u200b\u7b26\u53f7\u200b\u5b9e\u4f8b\u200b\u6765\u200b\u66f4\u6539\u200b\u77e2\u91cf\u56fe\u200b\u5c42\u200b\u7684\u200b\u7b26\u53f7\u200b\u3002\u200b\u70b9\u200b\uff0c\u200b\u7ebf\u200b\u548c\u200b\u591a\u8fb9\u5f62\u200b\u56fe\u5c42\u200b\u7684\u200b\u7b26\u53f7\u200b\u53ef\u4ee5\u200b\u901a\u8fc7\u200b\u8c03\u7528\u200b\u76f8\u5e94\u200b\u7684\u200b\u7c7b\u200b<code>QgsMarkerSymbol</code>\uff0c<code>QgsLineSymbol</code>\u200b\u548c\u200b <code>QgsFillSymbol</code>\u200b\u7684\u200b<code>createSimple()</code>\u200b\u65b9\u6cd5\u200b\u6765\u200b\u521b\u5efa\u200b\u3002</p> <p>\u200b\u7ed9\u200b\u4f20\u9012\u200b<code>createSimple()</code>\u200b\u7684\u200b\u5b57\u5178\u200b\u53c2\u6570\u200b\u6765\u200b\u8bbe\u7f6e\u200b\u7b26\u53f7\u200b\u7684\u200b\u6837\u5f0f\u200b\u5c5e\u6027\u200b\u3002</p> <p>\u200b\u4f8b\u5982\u200b\uff0c\u200b\u4f60\u200b\u53ef\u4ee5\u200b\u901a\u8fc7\u200b\u8c03\u7528\u200b<code>setSymbol()</code>\u200b\u5e76\u200b\u4f20\u9012\u200b<code>QgsMarkerSymbol</code>\u200b\u5b9e\u4f8b\u200b, \u200b\u6765\u200b\u66ff\u6362\u200b\u7279\u5b9a\u200b \u200b\u70b9\u200b \u200b\u56fe\u5c42\u200b\u7684\u200b\u7b26\u53f7\u200b\uff0c\u200b\u5982\u200b\u4e0b\u9762\u200b\u7684\u200b\u4ee3\u7801\u200b\u793a\u4f8b\u200b\u6240\u793a\u200b\uff1a</p> <pre><code>symbol = QgsMarkerSymbol.createSimple({'name': 'square', 'color': 'red'})\nlayer.renderer().setSymbol(symbol)\n# \u200b\u663e\u793a\u200b\u66f4\u6539\u200b\nlayer.triggerRepaint()\n</code></pre> <p><code>name</code> \u200b\u8868\u793a\u200b\u7b26\u53f7\u200b\u7684\u200b\u5f62\u72b6\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u662f\u200b\u4ee5\u4e0b\u200b\u4efb\u4f55\u200b\u4e00\u79cd\u200b\uff1a</p> <ul> <li><code>circle</code></li> <li><code>square</code></li> <li><code>cross</code></li> <li><code>rectangle</code></li> <li><code>diamond</code></li> <li><code>pentagon</code></li> <li><code>triangle</code></li> <li><code>equilateral_triangle</code></li> <li><code>star</code></li> <li><code>regular_star</code></li> <li><code>arrow</code></li> <li><code>filled_arrowhead</code></li> <li><code>x</code></li> </ul> <p>\u200b\u83b7\u53d6\u200b\u7b26\u53f7\u200b\u5b9e\u4f8b\u200b\u7684\u200b\u7b2c\u4e00\u4e2a\u200b\u7b26\u53f7\u200b\u56fe\u5c42\u200b\u7684\u200b\u5b8c\u6574\u200b\u5c5e\u6027\u200b\u5217\u8868\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u6309\u7167\u200b\u4ee5\u4e0b\u200b\u793a\u4f8b\u200b\u4ee3\u7801\u200b\u8fdb\u884c\u200b\u64cd\u4f5c\u200b\uff1a</p> <pre><code>print(layer.renderer().symbol().symbolLayers()[0].properties())\n# Prints\n{'angle': '0', 'cap_style': 'square', 'color': '255,0,0,255,rgb:1,0,0,1', 'horizontal_anchor_point': '1', 'joinstyle': 'bevel', 'name': 'square', 'offset': '0,0', 'offset_map_unit_scale': '3x:0,0,0,0,0,0', 'offset_unit': 'MM', 'outline_color': '35,35,35,255,rgb:0.13725490196078433,0.13725490196078433,0.13725490196078433,1', 'outline_style': 'solid', 'outline_width': '0', 'outline_width_map_unit_scale': '3x:0,0,0,0,0,0', 'outline_width_unit': 'MM', 'scale_method': 'diameter', 'size': '2', 'size_map_unit_scale': '3x:0,0,0,0,0,0', 'size_unit': 'MM', 'vertical_anchor_point': '1'}\n</code></pre> <p>\u200b\u5982\u679c\u200b\u8981\u200b\u66f4\u6539\u200b\u67d0\u4e9b\u200b\u5c5e\u6027\u200b\uff0c\u200b\u8fd9\u200b\u53ef\u80fd\u200b\u5f88\u200b\u6709\u7528\u200b\uff1a</p> <pre><code># \u200b\u4f60\u200b\u53ef\u4ee5\u200b\u66f4\u6539\u200b\u5355\u4e2a\u200b\u5c5e\u6027\u200b... \nlayer.renderer().symbol().symbolLayer(0).setSize(3)\n# ...\u200b\u4f46\u200b\u5e76\u975e\u200b\u6240\u6709\u200b\u5c5e\u6027\u200b\u90fd\u200b\u53ef\u4ee5\u200b\u4ece\u200b\u65b9\u6cd5\u200b\u8bbf\u95ee\u200b\uff0c\n# \u200b\u4f60\u200b\u4e5f\u200b\u53ef\u4ee5\u200b\u5b8c\u5168\u200b\u66ff\u6362\u200b\u7b26\u53f7\u200b\uff1a\nprops = layer.renderer().symbol().symbolLayer(0).properties()\nprops['color'] = 'yellow'\nprops['name'] = 'square'\nlayer.renderer().setSymbol(QgsMarkerSymbol.createSimple(props))\n# \u200b\u663e\u793a\u200b\u66f4\u6539\u200b\nlayer.triggerRepaint()\n</code></pre>"},{"location":"6-%E4%BD%BF%E7%94%A8%E7%9F%A2%E9%87%8F%E5%9B%BE%E5%B1%82/#682","title":"6.8.2 \u200b\u5206\u7c7b\u200b\u7b26\u53f7\u200b\u6e32\u67d3\u5668","text":"<p>\u200b\u4f7f\u7528\u200b\u5206\u7c7b\u200b\u6e32\u67d3\u5668\u200b\u65f6\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u67e5\u8be2\u200b\u548c\u200b\u8bbe\u7f6e\u200b\u7528\u4e8e\u200b\u5206\u7c7b\u200b\u7684\u200b\u5c5e\u6027\u200b\uff1a\u200b\u4f7f\u7528\u200b <code>classAttribute()</code>\u200b\u548c\u200b<code>setClassAttribute()</code>\u200b\u65b9\u6cd5\u200b\u3002</p> <p>\u200b\u83b7\u53d6\u200b\u7c7b\u522b\u200b\u5217\u8868\u200b\uff1a</p> <pre><code>categorized_renderer = QgsCategorizedSymbolRenderer()\n# \u200b\u6dfb\u52a0\u200b\u4e00\u4e9b\u200b\u7c7b\u522b\u200b\ncat1 = QgsRendererCategory('1', QgsMarkerSymbol(), 'category 1')\ncat2 = QgsRendererCategory('2', QgsMarkerSymbol(), 'category 2')\ncategorized_renderer.addCategory(cat1)\ncategorized_renderer.addCategory(cat2)\n\nfor cat in categorized_renderer.categories():\n    print(\"{}: {} :: {}\".format(cat.value(), cat.label(), cat.symbol()))\n\n# 1: category 1 :: &lt;qgis._core.QgsMarkerSymbol object at 0x7f378ffcd9d8&gt;\n# 2: category 2 :: &lt;qgis._core.QgsMarkerSymbol object at 0x7f378ffcd9d8&gt;\n</code></pre> <p>\u200b\u5176\u4e2d\u200b<code>value()</code>\u200b\u662f\u200b\u7c7b\u522b\u200b\u4e4b\u95f4\u200b\u7528\u4e8e\u200b\u533a\u522b\u200b\u7684\u200b\u503c\u200b\uff0c <code>label()</code>\u200b\u662f\u200b\u7528\u4e8e\u200b\u7c7b\u522b\u200b\u63cf\u8ff0\u200b\u7684\u200b\u6587\u672c\u200b\uff0c<code>symbol()</code>\u200b\u65b9\u6cd5\u200b\u8fd4\u56de\u200b\u6240\u200b\u5206\u914d\u200b\u7684\u200b\u7b26\u53f7\u200b\u3002</p> <p>\u200b\u6e32\u67d3\u5668\u200b\u901a\u5e38\u200b\u8fd8\u200b\u5b58\u50a8\u200b\u7528\u4e8e\u200b\u5206\u7c7b\u200b\u7684\u200b\u539f\u59cb\u200b\u7b26\u53f7\u200b\u548c\u200b\u8272\u5e26\u200b\uff1a<code>sourceColorRamp()</code>\u200b\u548c\u200b<code>sourceSymbol()</code>\u200b\u65b9\u6cd5\u200b\u3002</p>"},{"location":"6-%E4%BD%BF%E7%94%A8%E7%9F%A2%E9%87%8F%E5%9B%BE%E5%B1%82/#683","title":"6.8.3 \u200b\u6e10\u53d8\u200b\u7b26\u53f7\u200b\u6e32\u67d3\u5668","text":"<p>\u200b\u6b64\u200b\u6e32\u67d3\u5668\u200b\u4e0e\u200b\u4e0a\u9762\u200b\u63cf\u8ff0\u200b\u7684\u200b\u5206\u7c7b\u200b\u7b26\u53f7\u200b\u6e32\u67d3\u5668\u200b\u975e\u5e38\u200b\u76f8\u4f3c\u200b\uff0c\u200b\u4f46\u200b\u5b83\u200b\u4e0d\u662f\u200b\u6bcf\u4e2a\u200b\u7c7b\u200b\u7684\u200b\u4e00\u4e2a\u200b\u5c5e\u6027\u200b\u503c\u200b\uff0c\u200b\u800c\u662f\u200b\u4f7f\u7528\u200b\u503c\u200b\u8303\u56f4\u200b\uff0c\u200b\u56e0\u6b64\u200b\u53ea\u80fd\u200b\u7528\u4e8e\u200b\u6570\u5b57\u200b\u5c5e\u6027\u200b\u3002</p> <p>\u200b\u4e86\u89e3\u200b\u6709\u5173\u200b\u6e32\u67d3\u5668\u200b\u4e2d\u200b\u4f7f\u7528\u200b\u8303\u56f4\u200b\u7684\u200b\u66f4\u200b\u591a\u200b\u4fe1\u606f\u200b</p> <pre><code>graduated_renderer = QgsGraduatedSymbolRenderer()\n# \u200b\u6dfb\u52a0\u200b\u4e00\u4e9b\u200b\u7c7b\u522b\u200b\ngraduated_renderer.addClassRange(QgsRendererRange(QgsClassificationRange('class 0-100', 0, 100), QgsMarkerSymbol()))\ngraduated_renderer.addClassRange(QgsRendererRange(QgsClassificationRange('class 101-200', 101, 200), QgsMarkerSymbol()))\n\nfor ran in renderer.ranges():\n    print(\"{} - {}: {} {}\".format(\n        ran.lowerValue(),\n        ran.upperValue(),\n        ran.label(),\n        ran.symbol()\n      ))\n# 0.0 - 100.0: class 0-100 &lt;qgis._core.QgsMarkerSymbol object at 0x7f8bad281b88&gt;\n# 101.0 - 200.0: class 101-200 &lt;qgis._core.QgsMarkerSymbol object at 0x7f8bad281b88&gt;\n</code></pre> <p>\u200b\u4f60\u200b\u53ef\u4ee5\u200b\u518d\u6b21\u200b\u4f7f\u7528\u200b <code>classAttribute()</code> \uff08\u200b\u67e5\u627e\u200b\u5206\u7c7b\u200b\u5c5e\u6027\u200b\u540d\u79f0\u200b\uff09 <code>sourceSymbol()</code>\u200b\u548c\u200b<code>sourceColorRamp()</code>\u200b\u65b9\u6cd5\u200b\u3002\u200b\u6b64\u5916\u200b\uff0c\u200b\u8fd8\u6709\u200b\u4e00\u79cd\u200b<code>mode()</code>\u200b\u65b9\u6cd5\u200b\u53ef\u4ee5\u200b\u786e\u5b9a\u200b\u8303\u56f4\u200b\u7684\u200b\u521b\u5efa\u200b\u65b9\u5f0f\u200b\uff1a\u200b\u4f7f\u7528\u200b\u7b49\u200b\u95f4\u9694\u200b\uff0c\u200b\u5206\u200b\u4f4d\u6570\u200b\u6216\u200b\u5176\u4ed6\u200b\u65b9\u6cd5\u200b\u3002</p> <p>\u200b\u5982\u679c\u200b\u4f60\u200b\u5e0c\u671b\u200b\u521b\u5efa\u200b\u81ea\u5df1\u200b\u7684\u200b\u6e10\u53d8\u200b\u7b26\u53f7\u200b\u6e32\u67d3\u5668\u200b\uff0c\u200b\u5219\u200b\u53ef\u4ee5\u200b\u6267\u884c\u200b\u6b64\u200b\u64cd\u4f5c\u200b\uff0c\u200b\u5982\u200b\u4e0b\u9762\u200b\u7684\u200b\u793a\u4f8b\u200b\u4ee3\u7801\u6bb5\u200b\u6240\u793a\u200b\uff08\u200b\u8fd9\u200b\u5c06\u200b\u521b\u5efa\u200b\u4e00\u4e2a\u200b\u7b80\u5355\u200b\u7684\u200b\u4e24\u4e2a\u200b\u7c7b\u522b\u200b\uff09</p> <pre><code>from qgis.PyQt import QtGui\n\nmyVectorLayer = QgsVectorLayer(myVectorPath, myName, 'ogr')\nmyTargetField = 'target_field'\nmyRangeList = []\nmyOpacity = 1\n# \u200b\u521b\u5efa\u200b\u6211\u4eec\u200b\u7684\u200b\u7b2c\u4e00\u200b\u7b26\u53f7\u200b\u548c\u200b\u8303\u56f4\u200b... \nmyMin = 0.0\nmyMax = 50.0\nmyLabel = 'Group 1'\nmyColour = QtGui.QColor('#ffee00')\nmySymbol1 = QgsSymbol.defaultSymbol(myVectorLayer.geometryType())\nmySymbol1.setColor(myColour)\nmySymbol1.setOpacity(myOpacity)\nmyRange1 = QgsRendererRange(myMin, myMax, mySymbol1, myLabel)\nmyRangeList.append(myRange1)\n# \u200b\u73b0\u5728\u200b\u521b\u5efa\u200b\u53e6\u200b\u4e00\u4e2a\u200b\u7b26\u53f7\u200b\u548c\u200b\u8303\u56f4\u200b... \nmyMin = 50.1\nmyMax = 100\nmyLabel = 'Group 2'\nmyColour = QtGui.QColor('#00eeff')\nmySymbol2 = QgsSymbol.defaultSymbol(\n     myVectorLayer.geometryType())\nmySymbol2.setColor(myColour)\nmySymbol2.setOpacity(myOpacity)\nmyRange2 = QgsRendererRange(myMin, myMax, mySymbol2, myLabel)\nmyRangeList.append(myRange2)\nmyRenderer = QgsGraduatedSymbolRenderer('', myRangeList)\nmyRenderer.setMode(QgsGraduatedSymbolRenderer.EqualInterval)\nmyRenderer.setClassAttribute(myTargetField)\n\nmyVectorLayer.setRenderer(myRenderer)\nQgsProject.instance().addMapLayer(myVectorLayer)\n</code></pre>"},{"location":"6-%E4%BD%BF%E7%94%A8%E7%9F%A2%E9%87%8F%E5%9B%BE%E5%B1%82/#684","title":"6.8.4 \u200b\u4f7f\u7528\u200b\u7b26\u53f7","text":"<p>\u200b\u5bf9\u4e8e\u200b\u7b26\u53f7\u200b\u7684\u200b\u8868\u793a\u200b\uff0c<code>QgsSymbol</code>\u200b\u57fa\u7c7b\u200b\u6709\u200b\u4e09\u4e2a\u200b\u6d3e\u751f\u7c7b\u200b\uff1a</p> <ul> <li><code>QgsMarkerSymbol</code>\u2014\u2014\u200b\u7528\u4e8e\u200b\u70b9\u200b\u8981\u7d20\u200b</li> <li><code>QgsLineSymbol</code>\u2014\u2014\u200b\u7528\u4e8e\u200b\u7ebf\u200b\u8981\u7d20\u200b</li> <li><code>QgsFillSymbol</code>\u2014\u2014\u200b\u7528\u4e8e\u200b\u9762\u200b\u8981\u7d20\u200b</li> </ul> <p>\u200b\u6bcf\u4e2a\u200b\u7b26\u53f7\u200b\u7531\u200b\u4e00\u4e2a\u200b\u6216\u200b\u591a\u4e2a\u200b\u7b26\u53f7\u200b\u56fe\u5c42\u200b \uff08\u200b\u4ece\u200b<code>QgsSymbolLayer</code>\u200b\u6d3e\u751f\u200b\u7684\u200b\u7c7b\u200b\uff09\u3002\u200b\u7b26\u53f7\u200b\u56fe\u5c42\u200b\u6267\u884c\u200b\u5b9e\u9645\u200b\u6e32\u67d3\u200b\uff0c\u200b\u7b26\u53f7\u200b\u7c7b\u200b\u672c\u8eab\u200b\u4ec5\u200b\u7528\u4f5c\u200b\u7b26\u53f7\u200b\u56fe\u5c42\u200b\u7684\u200b\u5bb9\u5668\u200b\u3002</p> <p>\u200b\u62e5\u6709\u200b\u4e00\u4e2a\u200b\u7b26\u53f7\u200b\u5b9e\u4f8b\u200b\uff08\u200b\u4f8b\u5982\u200b\u6765\u81ea\u200b\u6e32\u67d3\u5668\u200b\uff09\uff0c\u200b\u53ef\u4ee5\u200b\u63a2\u7d22\u200b\u5b83\u200b\uff1a<code>type()</code>\u200b\u65b9\u6cd5\u200b\u8bf4\u660e\u200b\u5b83\u200b\u662f\u200b\u6807\u8bb0\u200b\u3001\u200b\u7ebf\u200b\u8fd8\u662f\u200b\u586b\u5145\u200b\u7b26\u53f7\u200b\u3002<code>dump()</code> \u200b\u65b9\u6cd5\u200b\u53ef\u4ee5\u200b\u8fd4\u56de\u200b\u7b26\u53f7\u200b\u7684\u200b\u7b80\u77ed\u200b\u63cf\u8ff0\u200b\u3002\u200b\u83b7\u53d6\u200b\u7b26\u53f7\u200b\u56fe\u5c42\u200b\u5217\u8868\u200b\uff1a</p> <pre><code>marker_symbol = QgsMarkerSymbol()\nfor i in range(marker_symbol.symbolLayerCount()):\n    lyr = marker_symbol.symbolLayer(i)\n    print(\"{}: {}\".format(i, lyr.layerType()))\n\n# 0: SimpleMarker\n</code></pre> <p>\u200b\u627e\u51fa\u200b\u7b26\u53f7\u200b\u7684\u200b\u989c\u8272\u200b\u4f7f\u7528\u200b<code>color()</code>\u200b\u65b9\u6cd5\u200b\uff0c<code>setColor()</code>\u200b\u6539\u53d8\u200b\u5176\u200b\u989c\u8272\u200b\u3002\u200b\u4f7f\u7528\u200b\u6807\u8bb0\u7b26\u53f7\u200b\uff0c\u200b\u4f60\u200b\u8fd8\u200b\u53ef\u4ee5\u200b\u4f7f\u7528\u200b<code>size()</code>\u200b\u548c\u200b<code>angle()</code>\u200b\u65b9\u6cd5\u200b\u67e5\u8be2\u200b\u7b26\u53f7\u200b\u5927\u5c0f\u200b\u548c\u200b\u65cb\u8f6c\u200b\u3002\u200b\u5bf9\u4e8e\u200b\u7ebf\u200b\u7b26\u53f7\u200b\uff0c<code>width()</code>\u200b\u65b9\u6cd5\u200b\u8fd4\u56de\u200b\u7ebf\u5bbd\u200b\u3002</p> <p>\u200b\u9ed8\u8ba4\u200b\u60c5\u51b5\u200b\u4e0b\u200b\uff0c\u200b\u5927\u5c0f\u200b\u548c\u200b\u5bbd\u5ea6\u200b\u4ee5\u200b\u6beb\u7c73\u200b\u4e3a\u200b\u5355\u4f4d\u200b\uff0c\u200b\u89d2\u5ea6\u200b\u4ee5\u5ea6\u200b\u4e3a\u200b\u5355\u4f4d\u200b\u3002</p>"},{"location":"6-%E4%BD%BF%E7%94%A8%E7%9F%A2%E9%87%8F%E5%9B%BE%E5%B1%82/#6841","title":"6.8.4.1 \u200b\u4f7f\u7528\u200b\u7b26\u53f7\u200b\u56fe\u5c42","text":"<p>\u200b\u5982\u524d\u6240\u8ff0\u200b\uff0c\u200b\u7b26\u53f7\u200b\u5c42\u200b\uff08<code>QgsSymbolLayer</code>\u200b\u7684\u200b\u5b50\u7c7b\u200b\uff09\u200b\u51b3\u5b9a\u200b\u8981\u7d20\u200b\u7684\u200b\u5916\u89c2\u200b\u3002\u200b\u6709\u200b\u4e00\u4e9b\u200b\u57fa\u672c\u200b\u7684\u200b\u7b26\u53f7\u200b\u56fe\u5c42\u200b\u7c7b\u200b\u7528\u4e8e\u200b\u4e00\u822c\u200b\u7528\u9014\u200b\u3002\u200b\u53ef\u4ee5\u200b\u5b9e\u73b0\u200b\u65b0\u200b\u7684\u200b\u7b26\u53f7\u200b\u56fe\u5c42\u200b\u7c7b\u578b\u200b\uff0c\u200b\u4efb\u610f\u200b\u5b9a\u5236\u200b\u8981\u7d20\u200b\u7684\u200b\u5448\u73b0\u200b\u65b9\u5f0f\u200b\u3002<code>layerType()</code> \u200b\u65b9\u6cd5\u200b\u552f\u4e00\u200b\u6807\u8bc6\u7b26\u200b\u53f7\u200b\u56fe\u5c42\u200b\u7c7b\u200b\u2014\u2014\u200b\u57fa\u672c\u200b\u7c7b\u200b\u548c\u200b\u9ed8\u8ba4\u200b\u7c7b\u200b<code>SimpleMarker</code>\uff0c<code>SimpleLine</code>\u200b\u4ee5\u53ca\u200b<code>SimpleFill</code>\u200b\u7b26\u53f7\u200b\u56fe\u5c42\u200b\u7c7b\u578b\u200b\u3002</p> <p>\u200b\u4f60\u200b\u53ef\u4ee5\u200b\u4f7f\u7528\u200b\u4ee5\u4e0b\u200b\u4ee3\u7801\u200b\u83b7\u53d6\u200b\u53ef\u4ee5\u200b\u4e3a\u200b\u7b26\u53f7\u200b\u56fe\u5c42\u200b\u521b\u5efa\u200b\u7b26\u53f7\u200b\u56fe\u5c42\u200b\u7c7b\u578b\u200b\u7684\u200b\u5b8c\u6574\u200b\u5217\u8868\u200b\uff1a</p> <pre><code>from qgis.core import QgsSymbolLayerRegistry\nmyRegistry = QgsApplication.symbolLayerRegistry()\nmyMetadata = myRegistry.symbolLayerMetadata(\"SimpleFill\")\nfor item in myRegistry.symbolLayersForType(QgsSymbol.Marker):\n    print(item)\n</code></pre> <p>\u200b\u8f93\u51fa\u200b\uff1a</p> <pre><code>AnimatedMarker\nEllipseMarker\nFilledMarker\nFontMarker\nGeometryGenerator\nMaskMarker\nRasterMarker\nSimpleMarker\nSvgMarker\nVectorField\n</code></pre> <p><code>QgsSymbolLayerRegistry</code>\u200b\u7c7b\u200b\u7ba1\u7406\u200b\u4e00\u4e2a\u200b\u6240\u6709\u200b\u53ef\u7528\u200b\u7b26\u53f7\u200b\u5c42\u200b\u7c7b\u578b\u200b\u7684\u200b\u6570\u636e\u5e93\u200b\u3002</p> <p>\u200b\u8bbf\u95ee\u200b\u7b26\u53f7\u200b\u56fe\u5c42\u200b\u6570\u636e\u200b\uff0c\u200b\u4f7f\u7528\u200b<code>properties()</code>\u200b\u65b9\u6cd5\u200b\u8fd4\u56de\u200b\u5c5e\u6027\u200b\u7684\u200b\u952e\u503c\u200b\u5b57\u5178\u200b\uff0c\u200b\u8be5\u200b\u5b57\u5178\u200b\u51b3\u5b9a\u200b\u5916\u89c2\u200b\u3002\u200b\u6bcf\u4e2a\u200b\u7b26\u53f7\u200b\u56fe\u5c42\u200b\u7c7b\u578b\u200b\u90fd\u200b\u6709\u200b\u4e00\u7ec4\u200b\u7279\u5b9a\u200b\u7684\u200b\u5c5e\u6027\u200b\u3002\u200b\u6b64\u5916\u200b\uff0c\u200b\u8fd8\u6709\u200b\u901a\u7528\u200b\u7684\u200b\u65b9\u6cd5\u200b<code>color()</code>\uff0c<code>size()</code>\uff0c<code>angle()</code>\u200b\u548c\u200b <code>width()</code>\u3002\u200b\u5f53\u7136\u200b\uff0c\u200b\u5c3a\u5bf8\u200b\u548c\u200b\u89d2\u5ea6\u200b\u4ec5\u200b\u9002\u7528\u200b\u4e8e\u200b\u6807\u8bb0\u7b26\u53f7\u200b\u56fe\u5c42\u200b\uff0c\u200b\u5bbd\u5ea6\u200b\u9002\u7528\u200b\u4e8e\u7ebf\u200b\u7b26\u53f7\u200b\u56fe\u5c42\u200b\u3002</p>"},{"location":"6-%E4%BD%BF%E7%94%A8%E7%9F%A2%E9%87%8F%E5%9B%BE%E5%B1%82/#6842","title":"6.8.4.2 \u200b\u521b\u5efa\u200b\u81ea\u5b9a\u4e49\u200b\u7b26\u53f7\u200b\u56fe\u5c42\u200b\u7c7b\u578b","text":"<p>\u200b\u60f3\u8c61\u200b\u4e00\u4e0b\u200b\uff0c\u200b\u4f60\u200b\u60f3\u8981\u200b\u81ea\u200b\u5b9a\u4e49\u6570\u636e\u200b\u7684\u200b\u5448\u73b0\u200b\u65b9\u5f0f\u200b\u3002\u200b\u4f60\u200b\u53ef\u4ee5\u200b\u521b\u5efa\u200b\u81ea\u5df1\u200b\u7684\u200b\u7b26\u53f7\u200b\u56fe\u5c42\u200b\u7c7b\u200b\uff0c\u200b\u5b8c\u5168\u200b\u6309\u7167\u200b\u4f60\u200b\u7684\u200b\u610f\u613f\u200b\u7ed8\u5236\u200b\u8981\u7d20\u200b\u3002\u200b\u4ee5\u4e0b\u200b\u662f\u200b\u7ed8\u5236\u200b\u5177\u6709\u200b\u6307\u5b9a\u200b\u534a\u5f84\u200b\u7684\u200b\u7ea2\u8272\u200b\u5706\u5708\u200b\u7684\u200b\u6807\u8bb0\u200b\u793a\u4f8b\u200b\uff1a</p> <pre><code>from qgis.core import QgsMarkerSymbolLayer\nfrom qgis.PyQt.QtGui import QColor\n\nclass FooSymbolLayer(QgsMarkerSymbolLayer):\n\n  def __init__(self, radius=4.0):\n      QgsMarkerSymbolLayer.__init__(self)\n      self.radius = radius\n      self.color = QColor(255,0,0)\n\n  def layerType(self):\n     return \"FooMarker\"\n\n  def properties(self):\n      return { \"radius\" : str(self.radius) }\n\n  def startRender(self, context):\n    pass\n\n  def stopRender(self, context):\n      pass\n\n  def renderPoint(self, point, context):\n      # \u200b\u6e32\u67d3\u200b\u53d6\u51b3\u4e8e\u200b\u662f\u5426\u200b\u9009\u62e9\u200b\u4e86\u200b\u7b26\u53f7\u200b (QGIS &gt;= 1.5)\n      color = context.selectionColor() if context.selected() else self.color\n      p = context.renderContext().painter()\n      p.setPen(color)\n      p.drawEllipse(point, self.radius, self.radius)\n\n  def clone(self):\n      return FooSymbolLayer(self.radius)\n</code></pre> <p><code>layerType()</code>\u200b\u65b9\u6cd5\u200b\u786e\u5b9a\u200b\u7b26\u53f7\u200b\u56fe\u5c42\u200b\u7684\u200b\u540d\u79f0\u200b\uff0c\u200b\u5b83\u200b\u5fc5\u987b\u200b\u5728\u200b\u6240\u6709\u200b\u7b26\u53f7\u200b\u5c42\u4e2d\u200b\u662f\u200b\u552f\u4e00\u200b\u7684\u200b\u3002<code>properties()</code>\u200b\u65b9\u6cd5\u200b\u7528\u4e8e\u200b\u5c5e\u6027\u200b\u7684\u200b\u6301\u4e45\u200b\u5316\u200b\u3002<code>clone()</code> \u200b\u65b9\u6cd5\u200b\u5fc5\u987b\u200b\u8fd4\u56de\u200b\u7b26\u53f7\u200b\u56fe\u5c42\u200b\u7684\u200b\u526f\u672c\u200b\uff0c\u200b\u5176\u4e2d\u200b\u6240\u6709\u200b\u5c5e\u6027\u200b\u5b8c\u5168\u76f8\u540c\u200b\u3002\u200b\u6700\u540e\u200b\uff0c\u200b\u6e32\u67d3\u200b\u65b9\u6cd5\u200b\uff1a <code>startRender()</code>\u200b\u5728\u200b\u6e32\u67d3\u200b\u7b2c\u4e00\u4e2a\u200b\u8981\u7d20\u200b\u4e4b\u524d\u200b\u88ab\u200b\u8c03\u7528\u200b\uff0c<code>stopRender()</code> \u200b\u6e32\u67d3\u200b\u5b8c\u6210\u200b\u65f6\u200b\u88ab\u200b\u8c03\u7528\u200b\uff0c<code>renderPoint()</code>\u200b\u6e32\u67d3\u200b\u65f6\u200b\u88ab\u200b\u8c03\u7528\u200b\u3002\u200b\u70b9\u200b\u7684\u200b\u5750\u6807\u200b\u5df2\u7ecf\u200b\u8f6c\u6362\u200b\u4e3a\u200b\u8f93\u51fa\u200b\u5750\u6807\u200b\u3002</p> <p>\u200b\u5bf9\u4e8e\u200b\u7ebf\u200b\u548c\u200b\u591a\u8fb9\u5f62\u200b\uff0c\u200b\u552f\u4e00\u200b\u7684\u200b\u533a\u522b\u200b\u5728\u4e8e\u200b\u6e32\u67d3\u200b\u65b9\u6cd5\u200b\uff1a\u200b\u4f60\u200b\u5c06\u200b\u4f7f\u7528\u200b <code>renderPolyline()</code>\u200b\u63a5\u6536\u200b\u7ebf\u200b\u5217\u8868\u200b\uff0c<code>renderPolygon()</code>\u200b\u63a5\u6536\u200b\u5916\u73af\u200b\u4e0a\u200b\u7684\u200b\u70b9\u200b\u5217\u8868\u200b\u4f5c\u4e3a\u200b\u7b2c\u4e00\u4e2a\u200b\u53c2\u6570\u200b\u548c\u200b\u5185\u73af\u200b\u5217\u8868\u200b\uff08\u200b\u6216\u200bNone\uff09\u200b\u4f5c\u4e3a\u200b\u7b2c\u4e8c\u4e2a\u200b\u53c2\u6570\u200b\u3002</p> <p>\u200b\u901a\u5e38\u200b\u53ef\u4ee5\u200b\u4fbf\u5229\u200b\u5730\u200b\u6dfb\u52a0\u200b\u7528\u4e8e\u200b\u8bbe\u7f6e\u200b\u7b26\u53f7\u200b\u56fe\u5c42\u200b\u7c7b\u578b\u200b\u5c5e\u6027\u200b\u7684\u200bGUI\uff0c\u200b\u4ee5\u200b\u5141\u8bb8\u200b\u7528\u6237\u200b\u81ea\u5b9a\u4e49\u200b\u5916\u89c2\u200b\uff1a\u200b\u5728\u200b\u4e0a\u9762\u200b\u7684\u200b\u793a\u4f8b\u200b\u4e2d\u200b\uff0c\u200b\u6211\u4eec\u200b\u53ef\u4ee5\u200b\u8ba9\u200b\u7528\u6237\u200b\u8bbe\u7f6e\u200b\u5706\u200b\u534a\u5f84\u200b\u3002\u200b\u4ee5\u4e0b\u200b\u4ee3\u7801\u200b\u5b9e\u73b0\u200b\u4e86\u200b\u8fd9\u6837\u200b\u7684\u200b\u63a7\u4ef6\u200b</p> <pre><code>from qgis.gui import QgsSymbolLayerWidget\n\nclass FooSymbolLayerWidget(QgsSymbolLayerWidget):\n    def __init__(self, parent=None):\n        QgsSymbolLayerWidget.__init__(self, parent)\n\n        self.layer = None\n\n        # \u200b\u8bbe\u7f6e\u200b\u7b80\u5355\u200b\u7684\u200bUI \n        self.label = QLabel(\"Radius:\")\n        self.spinRadius = QDoubleSpinBox()\n        self.hbox = QHBoxLayout()\n        self.hbox.addWidget(self.label)\n        self.hbox.addWidget(self.spinRadius)\n        self.setLayout(self.hbox)\n        self.connect(self.spinRadius, SIGNAL(\"valueChanged(double)\"), \\\n            self.radiusChanged)\n\n    def setSymbolLayer(self, layer):\n        if layer.layerType() != \"FooMarker\":\n            return\n        self.layer = layer\n        self.spinRadius.setValue(layer.radius)\n\n    def symbolLayer(self):\n        return self.layer\n\n    def radiusChanged(self, value):\n        self.layer.radius = value\n        self.emit(SIGNAL(\"changed()\"))\n</code></pre> <p>\u200b\u6b64\u200b\u7a97\u53e3\u200b\u63a7\u4ef6\u200b\u53ef\u4ee5\u200b\u5d4c\u5165\u200b\u5230\u200b\u7b26\u53f7\u200b\u5c5e\u6027\u200b\u5bf9\u8bdd\u6846\u200b\u4e2d\u200b\u3002\u200b\u5728\u200b\u7b26\u53f7\u200b\u5c5e\u6027\u200b\u5bf9\u8bdd\u6846\u200b\u4e2d\u200b\u9009\u62e9\u200b\u7b26\u53f7\u200b\u56fe\u5c42\u200b\u7c7b\u578b\u200b\u65f6\u200b\uff0c\u200b\u5b83\u4f1a\u200b\u521b\u5efa\u200b\u7b26\u53f7\u200b\u56fe\u5c42\u200b\u7684\u200b\u5b9e\u4f8b\u200b\u548c\u200b\u7b26\u53f7\u200b\u56fe\u200b\u7a97\u53e3\u200b\u63a7\u4ef6\u200b\u7684\u200b\u5b9e\u4f8b\u200b\u3002\u200b\u7136\u540e\u200b\u5b83\u200b\u8c03\u7528\u200b<code>setSymbolLayer()</code>\u200b\u65b9\u6cd5\u200b\u5c06\u200b\u7b26\u53f7\u200b\u56fe\u5c42\u200b\u5206\u914d\u200b\u7ed9\u200b\u7a97\u53e3\u200b\u63a7\u4ef6\u200b\u3002\u200b\u5728\u200b\u8be5\u200b\u65b9\u6cd5\u200b\u4e2d\u200b\uff0c\u200b\u63a7\u4ef6\u200b\u5e94\u8be5\u200b\u66f4\u65b0\u200bUI\u200b\u4ee5\u200b\u53cd\u6620\u200b\u7b26\u53f7\u200b\u5c42\u200b\u7684\u200b\u5c5e\u6027\u200b\u3002<code>symbolLayer()</code>\u200b\u65b9\u6cd5\u200b\u7528\u4e8e\u200b\u901a\u8fc7\u200b\u5c5e\u6027\u200b\u5bf9\u8bdd\u6846\u200b\u518d\u6b21\u200b\u68c0\u7d22\u200b\u7b26\u53f7\u200b\u56fe\u5c42\u200b\uff0c\u200b\u5c06\u200b\u5176\u200b\u7528\u4e8e\u200b\u7b26\u53f7\u200b\u3002</p> <p>\u200b\u5728\u200b\u6bcf\u6b21\u200b\u66f4\u6539\u200b\u5c5e\u6027\u200b\u65f6\u200b\uff0c\u200b\u7a97\u53e3\u200b\u63a7\u4ef6\u200b\u90fd\u200b\u5e94\u200b\u53d1\u51fa\u200b<code>changed()</code>\u200b\u4fe1\u53f7\u200b\uff0c\u200b\u8ba9\u200b\u5c5e\u6027\u200b\u5bf9\u8bdd\u6846\u200b\u66f4\u65b0\u200b\u7b26\u53f7\u200b\u9884\u89c8\u200b\u3002</p> <p>\u200b\u73b0\u5728\u200b\u6211\u4eec\u200b\u53ea\u200b\u7f3a\u5c11\u200b\u6700\u540e\u200b\u7684\u200b\u7c98\u5408\u5242\u200b\uff1a\u200b\u8ba9\u200bQGIS\u200b\u4e86\u89e3\u200b\u8fd9\u4e9b\u200b\u65b0\u7c7b\u200b\u3002\u200b\u8fd9\u662f\u200b\u901a\u8fc7\u200b\u5c06\u200b\u7b26\u53f7\u200b\u56fe\u5c42\u200b\u6dfb\u52a0\u200b\u5230\u200b\u6ce8\u518c\u8868\u200b\u6765\u200b\u5b8c\u6210\u200b\u7684\u200b\u3002\u200b\u4e5f\u200b\u53ef\u4ee5\u200b\u5728\u200b\u4e0d\u200b\u5c06\u200b\u5176\u200b\u6dfb\u52a0\u200b\u5230\u200b\u6ce8\u518c\u8868\u200b\u7684\u200b\u60c5\u51b5\u200b\u4e0b\u200b\u4f7f\u7528\u200b\u7b26\u53f7\u200b\u56fe\u5c42\u200b\uff0c\u200b\u4f46\u200b\u67d0\u4e9b\u200b\u529f\u80fd\u200b\u4e0d\u8d77\u4f5c\u7528\u200b\uff1a\u200b\u4f8b\u5982\u200b\uff0c\u200b\u4f7f\u7528\u200b\u81ea\u5b9a\u4e49\u200b\u7b26\u53f7\u200b\u56fe\u5c42\u200b\u52a0\u8f7d\u200b\u9879\u76ee\u200b\u6587\u4ef6\u200b\u6216\u200b\u65e0\u6cd5\u200b\u5728\u200bGUI\u200b\u4e2d\u200b\u7f16\u8f91\u200b\u56fe\u5c42\u200b\u7684\u200b\u5c5e\u6027\u200b\u3002</p> <p>\u200b\u6211\u4eec\u200b\u5fc5\u987b\u200b\u4e3a\u200b\u7b26\u53f7\u200b\u56fe\u5c42\u200b\u521b\u5efa\u200b\u5143\u200b\u6570\u636e\u200b</p> <pre><code>from qgis.core import QgsSymbol, QgsSymbolLayerAbstractMetadata, QgsSymbolLayerRegistry\n\n\nclass FooSymbolLayerMetadata(QgsSymbolLayerAbstractMetadata):\n\n    def __init__(self):\n        QgsSymbolLayerAbstractMetadata.__init__(self, \"FooMarker\", QgsSymbol.Marker)\n\n    def createSymbolLayer(self, props):\n        radius = float(props[\"radius\"]) if \"radius\" in props else 4.0\n        return FooSymbolLayer(radius)\n\n    def createSymbolLayer(self, props):\n        radius = float(props[\"radius\"]) if \"radius\" in props else 4.0\n        return FooSymbolLayer(radius)\n\n\nfslmetadata = FooSymbolLayerMetadata()\nQgsApplication.symbolLayerRegistry().addSymbolLayerType(fslmetadata)\n</code></pre> <p>\u200b\u4f60\u200b\u5e94\u8be5\u200b\u5c06\u200b\u56fe\u5c42\u200b\u7c7b\u578b\u200b\uff08\u200b\u4e0e\u200b\u56fe\u5c42\u200b\u8fd4\u56de\u200b\u7684\u200b\u76f8\u540c\u200b\uff09\u200b\u548c\u200b\u7b26\u53f7\u200b\u7c7b\u578b\u200b\uff08marker/line/fill\uff09\u200b\u4f20\u9012\u200b\u7ed9\u200b\u7236\u7c7b\u200b\u7684\u200b\u6784\u9020\u51fd\u6570\u200b\u3002<code>createSymbolLayer()</code>\u200b\u65b9\u6cd5\u200b\u8d1f\u8d23\u200b\u4f7f\u7528\u200bprops\u200b\u5b57\u5178\u200b\u4e2d\u200b\u6307\u5b9a\u200b\u7684\u200b\u5c5e\u6027\u200b\u521b\u5efa\u200b\u7b26\u53f7\u200b\u56fe\u5c42\u200b\u7684\u200b\u5b9e\u4f8b\u200b\u3002<code>createSymbolLayerWidget()</code>\u200b\u65b9\u6cd5\u200b\u53ef\u4ee5\u200b\u8fd4\u56de\u200b\u6b64\u200b\u7b26\u53f7\u200b\u56fe\u5c42\u200b\u7c7b\u578b\u200b\u7684\u200b\u8bbe\u7f6e\u200b\u63a7\u4ef6\u200b\u3002</p> <p>\u200b\u6700\u540e\u200b\u4e00\u6b65\u200b\u662f\u200b\u5c06\u200b\u6b64\u200b\u7b26\u53f7\u200b\u56fe\u5c42\u200b\u6dfb\u52a0\u200b\u5230\u200b\u6ce8\u518c\u8868\u200b\u4e2d\u200b\u2014\u2014\u200b\u6211\u4eec\u200b\u5b8c\u6210\u200b\u4e86\u200b\u3002</p>"},{"location":"6-%E4%BD%BF%E7%94%A8%E7%9F%A2%E9%87%8F%E5%9B%BE%E5%B1%82/#685","title":"6.8.5 \u200b\u521b\u5efa\u200b\u81ea\u5b9a\u4e49\u200b\u6e32\u67d3\u5668","text":"<p>\u200b\u5982\u679c\u200b\u8981\u200b\u81ea\u5b9a\u4e49\u200b\u5982\u4f55\u200b\u9009\u62e9\u200b\u7b26\u53f7\u200b\u5448\u73b0\u200b\u8981\u7d20\u200b\u7684\u200b\u89c4\u5219\u200b\uff0c\u200b\u5219\u200b\u521b\u5efa\u200b\u65b0\u200b\u7684\u200b\u6e32\u67d3\u5668\u200b\u53ef\u80fd\u200b\u5f88\u200b\u6709\u7528\u200b\u3002\u200b\u4f60\u200b\u53ef\u80fd\u200b\u5e0c\u671b\u200b\u505a\u200b\u4e00\u4e9b\u200b\u7528\u4f8b\u200b\uff1a\u200b\u7b26\u53f7\u200b\u7531\u5b57\u6bb5\u200b\u7ec4\u5408\u200b\u786e\u5b9a\u200b\uff0c\u200b\u7b26\u53f7\u200b\u5927\u5c0f\u200b\u6839\u636e\u200b\u5f53\u524d\u200b\u6bd4\u4f8b\u200b\u800c\u200b\u53d8\u5316\u200b\u7b49\u200b\u3002</p> <p>\u200b\u4e0b\u9762\u200b\u7684\u200b\u4ee3\u7801\u200b\u663e\u793a\u200b\u4e86\u200b\u4e00\u4e2a\u200b\u7b80\u5355\u200b\u7684\u200b\u81ea\u5b9a\u4e49\u200b\u6e32\u67d3\u5668\u200b\uff0c\u200b\u5b83\u200b\u53ef\u4ee5\u200b\u521b\u5efa\u200b\u4e24\u4e2a\u200b\u6807\u8bb0\u7b26\u53f7\u200b\uff0c\u200b\u5e76\u200b\u4e3a\u200b\u6bcf\u4e2a\u200b\u8981\u7d20\u200b\u968f\u673a\u200b\u9009\u62e9\u200b\u5176\u4e2d\u200b\u4e00\u4e2a\u200b</p> <pre><code>import random\nfrom qgis.core import QgsWkbTypes, QgsSymbol, QgsFeatureRenderer\n\n\nclass RandomRenderer(QgsFeatureRenderer):\n  def __init__(self, syms=None):\n    QgsFeatureRenderer.__init__(self, \"RandomRenderer\")\n    self.syms = syms if syms else [QgsSymbol.defaultSymbol(QgsWkbTypes.geometryType(QgsWkbTypes.Point))]\n\n  def symbolForFeature(self, feature):\n    return random.choice(self.syms)\n\n  def startRender(self, context, vlayer):\n    for s in self.syms:\n      s.startRender(context)\n\n  def stopRender(self, context):\n    for s in self.syms:\n      s.stopRender(context)\n\n  def usedAttributes(self):\n    return []\n\n  def clone(self):\n    return RandomRenderer(self.syms)\n</code></pre> <p>\u200b\u7236\u7c7b\u200b<code>QgsFeatureRenderer</code> \u200b\u7684\u200b\u6784\u9020\u51fd\u6570\u200b\u9700\u8981\u200b\u4e00\u4e2a\u200b\u6e32\u67d3\u5668\u200b\u540d\u79f0\u200b\uff08\u200b\u5728\u200b\u6e32\u67d3\u5668\u200b\u4e2d\u200b\u5fc5\u987b\u200b\u662f\u200b\u552f\u4e00\u200b\u7684\u200b\uff09\u3002<code>symbolForFeature()</code>\u200b\u65b9\u6cd5\u200b\u51b3\u5b9a\u200b\u4ec0\u4e48\u200b\u7b26\u53f7\u200b\u7528\u4e8e\u200b\u7279\u5b9a\u200b\u7684\u200b\u8981\u7d20\u200b\u3002 <code>startRender()</code>\u200b\u548c\u200b<code>stopRender()</code>\u200b\u8d1f\u8d23\u200b\u7b26\u53f7\u200b\u6e32\u67d3\u200b\u7684\u200b\u521d\u59cb\u5316\u200b/\u200b\u5b8c\u6210\u200b\u3002<code>usedAttributes()</code> \u200b\u65b9\u6cd5\u200b\u8fd4\u56de\u200b\u6e32\u67d3\u5668\u200b\u7684\u200b\u5b57\u6bb5\u540d\u200b\u79f0\u200b\u5217\u8868\u200b\u3002\u200b\u6700\u540e\u200b\uff0c<code>clone()</code>\u200b\u65b9\u6cd5\u200b\u5e94\u200b\u8fd4\u56de\u200b\u6e32\u67d3\u5668\u200b\u7684\u200b\u526f\u672c\u200b\u3002</p> <p>\u200b\u4e0e\u200b\u7b26\u53f7\u200b\u56fe\u5c42\u200b\u4e00\u6837\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u9644\u52a0\u200bGUI\u200b\u914d\u7f6e\u200b\u6e32\u67d3\u5668\u200b\uff0c\u200b\u5b83\u200b\u5fc5\u987b\u200b\u6765\u6e90\u4e8e\u200b<code>QgsRendererWidget</code>\u3002\u200b\u4ee5\u4e0b\u200b\u793a\u4f8b\u200b\u4ee3\u7801\u200b\u521b\u5efa\u200b\u4e00\u4e2a\u200b\u5141\u8bb8\u200b\u7528\u6237\u200b\u8bbe\u7f6e\u200b\u7b2c\u4e00\u4e2a\u200b\u7b26\u53f7\u200b\u7684\u200b\u6309\u94ae\u200b</p> <pre><code>from qgis.gui import QgsRendererWidget, QgsColorButton\n\n\nclass RandomRendererWidget(QgsRendererWidget):\n    def __init__(self, layer, style, renderer):\n        QgsRendererWidget.__init__(self, layer, style)\n        if renderer is None or renderer.type() != \"RandomRenderer\":\n            self.r = RandomRenderer()\n        else:\n            self.r = renderer\n        # setup UI\n        self.btn1 = QgsColorButton()\n        self.btn1.setColor(self.r.syms[0].color())\n        self.vbox = QVBoxLayout()\n        self.vbox.addWidget(self.btn1)\n        self.setLayout(self.vbox)\n        self.connect(self.btn1, SIGNAL(\"clicked()\"), self.setColor1)\n\n    def setColor1(self):\n        color = QColorDialog.getColor(self.r.syms[0].color(), self)\n        if not color.isValid(): return\n        self.r.syms[0].setColor(color)\n        self.btn1.setColor(self.r.syms[0].color())\n\n    def renderer(self):\n        return self.r\n</code></pre> <p>\u200b\u6784\u9020\u51fd\u6570\u200b\u63a5\u6536\u200b\u5f53\u524d\u200b\u56fe\u5c42\u200b\uff08<code>QgsVectorLayer</code>\uff09\uff0c\u200b\u5168\u5c40\u200b\u6837\u5f0f\u200b\uff08<code>QgsStyle</code>\uff09\u200b\u548c\u200b\u5f53\u524d\u200b\u6e32\u67d3\u5668\u200b\u7684\u200b\u5b9e\u4f8b\u200b\u3002\u200b\u5982\u679c\u200b\u6ca1\u6709\u200b\u6e32\u67d3\u5668\u200b\u6216\u200b\u6e32\u67d3\u5668\u200b\u5177\u6709\u200b\u4e0d\u540c\u200b\u7684\u200b\u7c7b\u578b\u200b\uff0c\u200b\u5b83\u200b\u5c06\u200b\u88ab\u200b\u6211\u4eec\u200b\u7684\u200b\u65b0\u200b\u6e32\u67d3\u5668\u200b\u66ff\u6362\u200b\uff0c\u200b\u5426\u5219\u200b\u6211\u4eec\u200b\u5c06\u200b\u4f7f\u7528\u200b\u5f53\u524d\u200b\u6e32\u67d3\u5668\u200b\uff08\u200b\u5df2\u7ecf\u200b\u662f\u200b\u6211\u4eec\u200b\u9700\u8981\u200b\u7684\u200b\u7c7b\u578b\u200b\uff09\u3002\u200b\u5e94\u8be5\u200b\u66f4\u65b0\u200b\u7a97\u53e3\u200b\u63a7\u4ef6\u200b\u5185\u5bb9\u200b\u4ee5\u200b\u663e\u793a\u200b\u6e32\u67d3\u5668\u200b\u7684\u200b\u5f53\u524d\u200b\u72b6\u6001\u200b\u3002\u200b\u5f53\u200b\u63a5\u53d7\u200b\u6e32\u67d3\u5668\u200b\u5bf9\u8bdd\u6846\u200b\u65f6\u200b\uff0c\u200b\u5c06\u200b\u8c03\u7528\u200b\u7a97\u53e3\u200b\u63a7\u4ef6\u200b\u7684\u200b<code>renderer()</code>\u200b\u65b9\u6cd5\u200b\u83b7\u53d6\u200b\u5f53\u524d\u200b\u6e32\u67d3\u5668\u200b\u2014\u2014\u200b\u5b83\u200b\u5c06\u200b\u88ab\u200b\u5206\u914d\u200b\u7ed9\u200b\u8be5\u200b\u56fe\u5c42\u200b\u3002</p> <p>\u200b\u6700\u540e\u200b\u4e00\u4e2a\u200b\u7f3a\u5931\u200b\u7684\u200b\u662f\u200b\u6e32\u67d3\u5668\u200b\u5143\u200b\u6570\u636e\u200b\u548c\u200b\u6ce8\u518c\u8868\u200b\u4e2d\u200b\u7684\u200b\u6ce8\u518c\u9879\u200b\uff0c\u200b\u5426\u5219\u200b\u4f7f\u7528\u200b\u6e32\u67d3\u5668\u200b\u52a0\u8f7d\u200b\u56fe\u5c42\u200b\u5c06\u200b\u4e0d\u8d77\u4f5c\u7528\u200b\uff0c\u200b\u7528\u6237\u200b\u5c06\u200b\u65e0\u6cd5\u200b\u4ece\u200b\u6e32\u67d3\u5668\u200b\u5217\u8868\u200b\u4e2d\u200b\u9009\u62e9\u200b\u5b83\u200b\u3002<code>RandomRenderer</code>\u200b\u793a\u4f8b\u200b\uff1a</p> <pre><code>from qgis.core import QgsRendererAbstractMetadata, QgsRendererRegistry, QgsApplication\n\n\nclass RandomRendererMetadata(QgsRendererAbstractMetadata):\n    def __init__(self):\n        QgsRendererAbstractMetadata.__init__(self, \"RandomRenderer\", \"Random renderer\")\n\n    def createRenderer(self, element):\n        return RandomRenderer()\n\n    def createRendererWidget(self, layer, style, renderer):\n        return RandomRendererWidget(layer, style, renderer)\n\n\nrrmetadata = RandomRendererMetadata()\nQgsApplication.rendererRegistry().addRenderer(rrmetadata)\n</code></pre> <p>\u200b\u4e0e\u200b\u7b26\u53f7\u200b\u56fe\u5c42\u200b\u7c7b\u4f3c\u200b\uff0c\u200b\u62bd\u8c61\u200b\u5143\u200b\u6570\u636e\u200b\u6784\u9020\u51fd\u6570\u200b\u7b49\u5f85\u200b\u6e32\u67d3\u5668\u200b\u540d\u79f0\u200b\uff0c\u200b\u5bf9\u200b\u7528\u6237\u200b\u53ef\u89c1\u200b\u7684\u200b\u540d\u79f0\u200b\u4ee5\u53ca\u200b\u6e32\u67d3\u5668\u200b\u56fe\u6807\u200b\u7684\u200b\u53ef\u9009\u200b\u540d\u79f0\u200b\u3002<code>createRenderer()</code> \u200b\u65b9\u6cd5\u200b\u4f20\u9012\u200b\u4e00\u4e2a\u200b<code>QDomElement</code>\u200b\u5b9e\u4f8b\u200b\uff0c\u200b\u8be5\u200b\u5b9e\u4f8b\u200b\u53ef\u200b\u7528\u4e8e\u200b\u4ece\u200bDOM\u200b\u6811\u200b\u6062\u590d\u200b\u6e32\u67d3\u5668\u200b\u7684\u200b\u72b6\u6001\u200b\u3002<code>createRendererWidget()</code> \u200b\u65b9\u6cd5\u200b\u521b\u5efa\u200b\u914d\u7f6e\u200b\u63a7\u4ef6\u200b\u3002\u200b\u5982\u679c\u200b\u6e32\u67d3\u5668\u200b\u6ca1\u6709\u200bGUI\uff0c\u200b\u5b83\u200b\u4e0d\u5fc5\u200b\u5b58\u5728\u200b\u6216\u200b\u53ef\u4ee5\u200b\u8fd4\u56de\u200b<code>None</code>\u3002</p> <p>\u200b\u8981\u200b\u5c06\u200b\u56fe\u6807\u200b\u4e0e\u200b\u6e32\u67d3\u5668\u200b\u5173\u8054\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u5728\u200b<code>QgsRendererAbstractMetadata</code> \u200b\u6784\u9020\u51fd\u6570\u200b\u4e2d\u5c06\u200b\u5176\u200b\u6307\u5b9a\u200b\u4e3a\u200b\u7b2c\u4e09\u4e2a\u200b\uff08\u200b\u53ef\u200b\u9009\u200b\uff09\u200b\u53c2\u6570\u200b</p> <pre><code>QgsRendererAbstractMetadata.__init__(self,\n       \"RandomRenderer\",\n       \"Random renderer\",\n       QIcon(QPixmap(\"RandomRendererIcon.png\", \"png\")))\n</code></pre> <p>\u200b\u4e5f\u200b\u53ef\u4ee5\u200b\u4f7f\u7528\u200b\u5143\u200b\u6570\u636e\u200b\u7c7b\u200b\u7684\u200b<code>setIcon</code>\u200b\u65b9\u6cd5\u200b\u5173\u8054\u200b\u8be5\u200b\u56fe\u6807\u200b\u3002\u200b\u56fe\u6807\u200b\u53ef\u4ee5\u200b\u4ece\u6587\u4ef6\u200b\u52a0\u8f7d\u200b\uff08\u200b\u5982\u200b\u4e0a\u200b\u6240\u793a\u200b\uff09\uff0c\u200b\u4e5f\u200b\u53ef\u4ee5\u200b\u4ece\u200bQt\u200b\u8d44\u6e90\u200b\u52a0\u8f7d\u200b \uff08PyQt5\u200b\u5305\u542b\u200bPython\u200b\u7684\u200b.qrc\u200b\u7f16\u8bd1\u200b\u6587\u4ef6\u200b\uff09\u3002</p>"},{"location":"6-%E4%BD%BF%E7%94%A8%E7%9F%A2%E9%87%8F%E5%9B%BE%E5%B1%82/#69","title":"6.9 \u200b\u66f4\u200b\u591a\u200b\u8bdd\u9898","text":"<p>TODO:</p> <ul> <li>\u200b\u521b\u5efa\u200b/\u200b\u4fee\u6539\u200b\u7b26\u53f7\u200b</li> <li>\u200b\u4f7f\u7528\u200b\u6837\u5f0f\u200b\uff08<code>QgsStyle</code>\uff09</li> <li>\u200b\u4f7f\u7528\u200b\u8272\u5e26\u200b\uff08<code>QgsColorRamp</code>\uff09</li> <li>\u200b\u63a2\u7d22\u200b\u7b26\u53f7\u200b\u56fe\u5c42\u200b\u548c\u200b\u6e32\u67d3\u5668\u200b\u6ce8\u518c\u8868\u200b</li> </ul>"},{"location":"7-%E5%87%A0%E4%BD%95%E5%A4%84%E7%90%86/","title":"7 \u200b\u51e0\u4f55\u200b\u5904\u7406","text":"<p>\u200b\u6b64\u200b\u9875\u9762\u200b\u4e0a\u200b\u7684\u200b\u4ee3\u7801\u200b\u7247\u6bb5\u200b\u9700\u8981\u200b\u5bfc\u5165\u200b\u4ee5\u4e0b\u200b\u6a21\u5757\u200b\uff1a</p> <pre><code>from qgis.core import (\n  QgsGeometry,\n  QgsGeometryCollection\n  QgsPoint,\n  QgsPointXY,\n  QgsWkbTypes,\n  QgsProject,\n  QgsFeatureRequest,\n  QgsVectorLayer,\n  QgsDistanceArea,\n  QgsUnitTypes,\n  QgsCoordinateTransform,\n  QgsCoordinateReferenceSystem\n)\n</code></pre> <p>\u200b\u8868\u793a\u200b\u7a7a\u95f4\u200b\u8981\u7d20\u200b\u7684\u200b\u70b9\u200b\u3001\u200b\u7ebf\u200b\u548c\u200b\u591a\u8fb9\u5f62\u200b\u901a\u5e38\u200b\u79f0\u4e3a\u200b\u51e0\u4f55\u200b\u3002\u200b\u5728\u200bQGIS\u200b\u4e2d\u200b\uff0c\u200b\u5b83\u4eec\u200b\u7528\u200b<code>QgsGeometry</code>\u200b\u7c7b\u6765\u200b\u8868\u793a\u200b \u3002</p> <p>\u200b\u6709\u65f6\u200b\uff0c\u200b\u4e00\u79cd\u200b\u51e0\u4f55\u200b\u5b9e\u9645\u4e0a\u200b\u662f\u200b\u7b80\u5355\u200b\uff08\u200b\u5355\u200b\u90e8\u4ef6\u200b\uff09\u200b\u51e0\u4f55\u200b\u7684\u200b\u96c6\u5408\u200b\u3002\u200b\u53e6\u200b\u4e00\u79cd\u200b\u51e0\u4f55\u200b\u5f62\u72b6\u200b\u79f0\u4e3a\u200b\u591a\u200b\u90e8\u4ef6\u200b\u51e0\u4f55\u200b\u3002\u200b\u5982\u679c\u200b\u5b83\u200b\u53ea\u200b\u5305\u542b\u200b\u4e00\u79cd\u200b\u7c7b\u578b\u200b\u7684\u200b\u7b80\u5355\u200b\u51e0\u4f55\u200b\uff0c\u200b\u6211\u4eec\u200b\u79f0\u4e4b\u4e3a\u200b\u591a\u70b9\u200b\u3001\u200b\u591a\u200b\u7ebf\u6216\u200b\u591a\u200b\u591a\u8fb9\u5f62\u200b\u3002\u200b\u4f8b\u5982\u200b\uff0c\u200b\u7531\u200b\u591a\u4e2a\u200b\u5c9b\u200b\u7ec4\u6210\u200b\u7684\u200b\u56fd\u5bb6\u200b\u53ef\u4ee5\u200b\u8868\u793a\u200b\u4e3a\u200b\u591a\u200b\u591a\u8fb9\u5f62\u200b\u3002</p> <p>\u200b\u51e0\u4f55\u200b\u7684\u200b\u5750\u6807\u200b\u53ef\u4ee5\u200b\u5728\u200b\u4efb\u4f55\u200b\u5750\u6807\u200b\u53c2\u8003\u200b\u7cfb\u7edf\u200b\uff08CRS\uff09\u200b\u4e2d\u200b\u3002\u200b\u4ece\u200b\u56fe\u5c42\u200b\u4e2d\u200b\u63d0\u53d6\u200b\u8981\u7d20\u200b\u65f6\u200b\uff0c\u200b\u5173\u8054\u200b\u7684\u200b\u51e0\u4f55\u56fe\u5f62\u200b\u5c06\u200b\u5728\u200b\u56fe\u5c42\u200b\u7684\u200bCRS\u200b\u4e2d\u200b\u5177\u6709\u200b\u5750\u6807\u200b\u3002</p> <p>\u200b\u6709\u5173\u200b\u6240\u6709\u200b\u53ef\u200b\u8bbf\u95ee\u200b\u7684\u200b\u51e0\u4f55\u200b\u7ed3\u6784\u200b\u548c\u200b\u5173\u7cfb\u200b\u8bf4\u660e\u200b\uff0c\u200b\u8bf7\u53c2\u9605\u200bOGC\u200b\u7b80\u5355\u200b\u8981\u7d20\u200b\u8bbf\u95ee\u200b\u6807\u51c6\u200b\uff0c\u200b\u4ee5\u200b\u83b7\u53d6\u200b\u66f4\u200b\u8be6\u7ec6\u200b\u7684\u200b\u4fe1\u606f\u200b\u3002</p>"},{"location":"7-%E5%87%A0%E4%BD%95%E5%A4%84%E7%90%86/#71","title":"7.1 \u200b\u51e0\u4f55\u200b\u6784\u9020","text":"<p>PyQGIS\u200b\u63d0\u4f9b\u200b\u4e86\u200b\u51e0\u79cd\u200b\u521b\u5efa\u200b\u51e0\u4f55\u200b\u7684\u200b\u9009\u9879\u200b\uff1a</p> <ul> <li>\u200b\u5750\u6807\u200b</li> </ul> <pre><code>gPnt = QgsGeometry.fromPointXY(QgsPointXY(1,1))\nprint(gPnt)\ngLine = QgsGeometry.fromPolyline([QgsPoint(1, 1), QgsPoint(2, 2)])\nprint(gLine)\ngPolygon = QgsGeometry.fromPolygonXY([[QgsPointXY(1, 1),\n    QgsPointXY(2, 2), QgsPointXY(2, 1)]])\nprint(gPolygon)\n</code></pre> <p>\u200b\u4f7f\u7528\u200b<code>QgsPoint</code>\u200b\u7c7b\u200b\u6216\u200b<code>QgsPointXY</code> \u200b\u7c7b\u200b\u521b\u5efa\u200b\u5750\u6807\u200b\u3002\u200b\u8fd9\u4e9b\u200b\u7c7b\u200b\u4e4b\u95f4\u200b\u7684\u200b\u533a\u522b\u200b\u5728\u4e8e\u200b<code>QgsPoint</code>\u200b\u652f\u6301\u200bM\u200b\u548c\u200bZ\u200b\u7ef4\u5ea6\u200b\u3002</p> <p>\u200b\u6298\u7ebf\u200b\uff08Linestring\uff09\u200b\u7531\u200b\u4e00\u7cfb\u5217\u200b\u70b9\u200b\u8868\u793a\u200b\u3002</p> <p>\u200b\u591a\u8fb9\u5f62\u200b\u7531\u7ebf\u200b\u73af\u200b\u5217\u8868\u200b\uff08\u200b\u5373\u200b\u95ed\u5408\u200b\u7684\u200b\u7ebf\u6bb5\u200b\uff09\u200b\u8868\u793a\u200b\u3002\u200b\u7b2c\u4e00\u4e2a\u200b\u73af\u662f\u200b\u5916\u73af\u200b\uff08\u200b\u8fb9\u754c\u200b\uff09\uff0c\u200b\u7b2c\u4e8c\u4e2a\u200b\u53ef\u9009\u9879\u200b\u7ebf\u73af\u200b\u662f\u200b\u591a\u8fb9\u5f62\u200b\u4e2d\u200b\u7684\u200b\u5b54\u200b\u3002\u200b\u8bf7\u200b\u6ce8\u610f\u200b\uff0c\u200b\u4e0e\u200b\u67d0\u4e9b\u200b\u7a0b\u5e8f\u200b\u4e0d\u540c\u200b\uff0cQGIS\u200b\u4f1a\u4e3a\u200b\u4f60\u200b\u95ed\u5408\u200b\u73af\u200b\uff0c\u200b\u56e0\u6b64\u200b\u65e0\u9700\u200b\u5c06\u200b\u7b2c\u4e00\u4e2a\u200b\u70b9\u200b\u590d\u5236\u200b\u4e3a\u200b\u6700\u540e\u200b\u4e00\u4e2a\u200b\u3002</p> <p>\u200b\u591a\u200b\u90e8\u4ef6\u200b\u51e0\u4f55\u56fe\u5f62\u200b\u66f4\u8fdb\u4e00\u6b65\u200b\uff1a\u200b\u591a\u70b9\u200b\u662f\u200b\u4e00\u4e2a\u70b9\u200b\u5217\u8868\u200b\uff0c\u200b\u591a\u7ebf\u200b\u662f\u200b\u4e00\u4e2a\u200b\u7ebf\u200b\u5217\u8868\u200b\uff0c\u200b\u591a\u200b\u591a\u8fb9\u5f62\u200b\u662f\u200b\u4e00\u4e2a\u200b\u591a\u8fb9\u5f62\u200b\u5217\u8868\u200b\u3002</p> <ul> <li>WKT</li> </ul> <pre><code>gem = QgsGeometry.fromWkt(\"POINT(3 4)\")\nprint(geom)\n</code></pre> <ul> <li>WKB</li> </ul> <pre><code>g = QgsGeometry()\nwkb = bytes.fromhex(\"010100000000000000000045400000000000001440\")\ng.fromWkb(wkb)\n\n#\u200b\u4f7f\u7528\u200bWKT\u200b\u6253\u5370\u200b\u51e0\u4f55\u200b\nprint(g.asWkt())\n</code></pre>"},{"location":"7-%E5%87%A0%E4%BD%95%E5%A4%84%E7%90%86/#72","title":"7.2 \u200b\u8bbf\u95ee\u200b\u51e0\u4f55","text":"<p>\u200b\u9996\u5148\u200b\uff0c\u200b\u4f60\u200b\u5e94\u8be5\u200b\u627e\u51fa\u200b\u51e0\u4f55\u200b\u7c7b\u578b\u200b\u3002<code>wkbType()</code> \u200b\u65b9\u6cd5\u200b\u662f\u200b\u5176\u4e2d\u200b\u4e00\u79cd\u200b\u65b9\u6cd5\u200b\u3002\u200b\u5b83\u200b\u4ece\u200b<code>QgsWkbTypes.Type</code> \u200b\u679a\u4e3e\u200b\u4e2d\u200b\u8fd4\u56de\u200b\u4e00\u4e2a\u200b\u503c\u200b\u3002</p> <pre><code>if gPnt.wkbType() == QgsWkbTypes.Point:\n  print(gPnt.wkbType())\n  # output: 1 for Point\nif gLine.wkbType() == QgsWkbTypes.LineString:\n  print(gLine.wkbType())\n  # output: 2 for LineString\nif gPolygon.wkbType() == QgsWkbTypes.Polygon:\n  print(gPolygon.wkbType())\n  # output: 3 for Polygon\n</code></pre> <p>\u200b\u4f5c\u4e3a\u200b\u66ff\u4ee3\u200b\u65b9\u6848\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u4f7f\u7528\u200b<code>type()</code> \uff0c\u200b\u4ece\u200b<code>QgsWkbTypes.GeometryType</code> \u200b\u679a\u4e3e\u200b\u4e2d\u200b\u8fd4\u56de\u503c\u200b\u3002</p> <p>\u200b\u4f60\u200b\u53ef\u4ee5\u200b\u4f7f\u7528\u200b<code>displayString()</code> \u200b\u51fd\u6570\u200b\u6765\u200b\u83b7\u53d6\u200b\u4eba\u7c7b\u200b\u53ef\u8bfb\u200b\u7684\u200b\u51e0\u4f55\u200b\u7c7b\u578b\u200b\u3002</p> <pre><code>print(QgsWkbTypes.displayString(gPnt.wkbType()))\n# output: 'Point'\nprint(QgsWkbTypes.displayString(gLine.wkbType()))\n# output: 'LineString'\nprint(QgsWkbTypes.displayString(gPolygon.wkbType()))\n# output: 'Polygon'\n</code></pre> <p>\u200b\u8fd8\u6709\u200b\u4e00\u4e2a\u200b\u8f85\u52a9\u200b\u51fd\u6570\u200b <code>isMultipart()</code>\u200b\u53ef\u4ee5\u200b\u786e\u5b9a\u200b\u51e0\u4f55\u200b\u662f\u5426\u662f\u200b\u591a\u200b\u90e8\u4ef6\u200b \u3002</p> <p>\u200b\u4ece\u200b\u51e0\u4f55\u200b\u4e2d\u200b\u63d0\u53d6\u200b\u4fe1\u606f\u200b\uff0c\u200b\u6bcf\u79cd\u200b\u77e2\u91cf\u200b\u7c7b\u578b\u200b\u90fd\u200b\u6709\u200b\u8bbf\u95ee\u200b\u5668\u200b\u51fd\u6570\u200b\u3002\u200b\u4ee5\u4e0b\u200b\u662f\u200b\u5982\u4f55\u200b\u4f7f\u7528\u200b\u8fd9\u4e9b\u200b\u8bbf\u95ee\u200b\u5668\u200b\u7684\u200b\u793a\u4f8b\u200b\uff1a</p> <pre><code>gPnt.asPoint()\n# output: &lt;QgsPointXY: POINT(1 1)&gt;\ngLine.asPolyline()\n# output: [&lt;QgsPointXY: POINT(1 1)&gt;, &lt;QgsPointXY: POINT(2 2)&gt;]\ngPolygon.asPolygon()\n# output: [[&lt;QgsPointXY: POINT(1 1)&gt;, &lt;QgsPointXY: POINT(2 2)&gt;, &lt;QgsPointXY: POINT(2 1)&gt;, &lt;QgsPointXY: POINT(1 1)&gt;]]\n</code></pre> <p>\u200b\u63d0\u793a\u200b</p> <p>\u200b\u5143\u7ec4\u200b\uff08x\uff0cy\uff09\u200b\u4e0d\u662f\u200b\u771f\u6b63\u200b\u7684\u200b\u5143\u7ec4\u200b\uff0c\u200b\u5b83\u4eec\u200b\u662f\u200b<code>QgsPoint</code> \u200b\u5bf9\u8c61\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u4f7f\u7528\u200b<code>x()</code> \u200b\u548c\u200b<code>y()</code>\u200b\u65b9\u6cd5\u200b\u8bbf\u95ee\u200b\u8fd9\u4e9b\u200b\u503c\u200b\u3002</p> <p>\u200b\u5bf9\u4e8e\u200b\u591a\u200b\u90e8\u4ef6\u200b\u51e0\u4f55\u200b\u4e5f\u200b\u6709\u200b\u7c7b\u4f3c\u200b\u7684\u200b\u8bbf\u95ee\u200b\u51fd\u6570\u200b\uff1a <code>asMultiPoint()</code>\uff0c<code>asMultiPolyline()</code>\u200b\u548c\u200b<code>asMultiPolygon()</code>\u3002</p> <p>\u200b\u4e0d\u7528\u200b\u7ba1\u200b\u51e0\u4f55\u200b\u7684\u200b\u7c7b\u578b\u200b\uff0c\u200b\u76f4\u63a5\u200b\u904d\u5386\u200b\u6240\u6709\u200b\u51e0\u4f55\u200b\u662f\u200b\u53ef\u4ee5\u200b\u7684\u200b\uff0c\u200b\u4f8b\u5982\u200b\uff1a</p> <pre><code>geom = QgsGeometry.fromWkt( 'MultiPoint( 0 0, 1 1, 2 2)' )\nfor part in geom.parts():\n  print(part.asWkt())\n\n# Point (0 0)\n# Point (1 1)\n# Point (2 2)\n</code></pre> <pre><code>geom = QgsGeometry.fromWkt( 'LineString( 0 0, 10 10 )' )\nfor part in geom.parts():\n  print(part.asWkt())\n\n# LineString (0 0, 10 10)\n</code></pre> <pre><code>gc = QgsGeometryCollection()\ngc.fromWkt('GeometryCollection( Point(1 2), Point(11 12), LineString(33 34, 44 45))')\nprint(gc[1].asWkt())\n\n# Point (11 12)\n</code></pre> <p>\u200b\u4f7f\u7528\u200b <code>QgsGeometry.parts()</code> \u200b\u65b9\u6cd5\u200b\u4fee\u6539\u200b\u6240\u6709\u200b\u51e0\u4f55\u200b\u3002</p> <pre><code>geom = QgsGeometry.fromWkt( 'MultiPoint( 0 0, 1 1, 2 2)' )\nfor part in geom.parts():\n  part.transform(QgsCoordinateTransform(\n    QgsCoordinateReferenceSystem(\"EPSG:4326\"),\n    QgsCoordinateReferenceSystem(\"EPSG:3111\"),\n    QgsProject.instance())\n  )\n\nprint(geom.asWkt())\n\n# MultiPoint ((-10334728.12541878595948219 -5360106.25905461423099041),(-10462135.16126426123082638 -5217485.4735023295506835),(-10589399.84444035589694977 -5072021.45942386891692877))\n</code></pre>"},{"location":"7-%E5%87%A0%E4%BD%95%E5%A4%84%E7%90%86/#73","title":"7.3 \u200b\u51e0\u4f55\u200b\u8c13\u8bcd\u200b\u4e0e\u200b\u64cd\u4f5c","text":"<p>QGIS\u200b\u4f7f\u7528\u200bGEOS\u200b\u5e93\u200b\u8fdb\u884c\u200b\u9ad8\u7ea7\u200b\u51e0\u4f55\u200b\u64cd\u4f5c\u200b\uff0c\u200b\u5982\u200b\u51e0\u4f55\u200b\u8c13\u8bcd\u200b\uff08<code>contains()</code>\uff0c<code>intersects()</code>\uff0c...\uff09\uff0c\u200b\u64cd\u4f5c\u200b\uff08<code>combine()</code>\uff0c<code>difference()</code>\uff0c...\uff09\u3002\u200b\u5b83\u200b\u8fd8\u200b\u53ef\u4ee5\u200b\u8ba1\u7b97\u200b\u51e0\u4f55\u200b\u7684\u200b\u51e0\u4f55\u200b\u5c5e\u6027\u200b\uff0c\u200b\u4f8b\u5982\u200b\u9762\u79ef\u200b\uff08\u200b\u591a\u8fb9\u5f62\u200b\uff09\u200b\u6216\u200b\u957f\u5ea6\u200b\uff08\u200b\u591a\u8fb9\u5f62\u200b\u548c\u200b\u7ebf\u200b\uff09\u3002</p> <p>\u200b\u8ba9\u200b\u6211\u4eec\u200b\u770b\u200b\u4e00\u4e2a\u200b\u7ed3\u5408\u200b\u904d\u5386\u200b\u6307\u5b9a\u200b\u56fe\u5c42\u200b\u8981\u7d20\u200b\uff0c\u200b\u5e76\u200b\u57fa\u4e8e\u200b\u5b83\u4eec\u200b\u7684\u200b\u51e0\u4f55\u200b\u6267\u884c\u200b\u4e00\u4e9b\u200b\u51e0\u4f55\u200b\u8ba1\u7b97\u200b\u7684\u200b\u793a\u4f8b\u200b\u3002\u200b\u4e0b\u9762\u200b\u7684\u200b\u4ee3\u7801\u200b\u8ba1\u7b97\u200b\u5e76\u6253\u5370\u200b<code>countries</code> \u200b\u56fe\u5c42\u200b\u4e2d\u200b\u6bcf\u4e2a\u200b\u56fd\u5bb6\u200b\u7684\u200b\u9762\u79ef\u200b\u548c\u200b\u5468\u957f\u200b\u3002</p> <p>\u200b\u4ee5\u4e0b\u200b\u4ee3\u7801\u200b\u5047\u5b9a\u200b<code>layer</code>\u200b\u662f\u200b\u5177\u6709\u200b\u591a\u8fb9\u5f62\u200b\u8981\u7d20\u200b\u7c7b\u578b\u200b\u7684\u200b<code>QgsVectorLayer</code>\u200b\u5bf9\u8c61\u200b\u3002</p> <pre><code># \u200b\u8bbf\u95ee\u200b'countries'\u200b\u56fe\u5c42\u200b\nlayer = QgsProject.instance().mapLayersByName('countries')[0]\n\n# \u200b\u8fc7\u6ee4\u200b\u4ee5\u200bZ\u200b\u5f00\u5934\u200b\u7684\u200b\u56fd\u5bb6\u200b\uff0c\u200b\u7136\u540e\u200b\u83b7\u53d6\u200b\u5176\u200b\u8981\u7d20\u200b\nquery = '\"name\" LIKE \\'Z%\\''\nfeatures = layer.getFeatures(QgsFeatureRequest().setFilterExpression(query))\n\n\n# \u200b\u73b0\u5728\u200b\u904d\u5386\u200b\u8981\u7d20\u200b\uff0c\u200b\u6267\u884c\u200b\u51e0\u4f55\u200b\u8ba1\u7b97\u200b\u5e76\u6253\u5370\u200b\u7ed3\u679c\u200b\nfor f in features:\n  geom = f.geometry()\n  name = f.attribute('NAME')\n  print(name)\n  print('Area: ', geom.area())\n  print('Perimeter: ', geom.length())\n\n\n# Zambia\n# Area:  62.822790653431205\n# Perimeter:  50.65232014052552\n# Zimbabwe\n# Area:  33.41113559136521\n# Perimeter:  26.608288555013935\n</code></pre> <p>\u200b\u73b0\u5728\u200b\uff0c\u200b\u4f60\u200b\u5df2\u7ecf\u200b\u8ba1\u7b97\u200b\u5e76\u6253\u5370\u200b\u4e86\u200b\u51e0\u4f55\u56fe\u5f62\u200b\u7684\u200b\u9762\u79ef\u200b\u548c\u200b\u5468\u957f\u200b\u3002\u200b\u4f46\u662f\u200b\uff0c\u200b\u4f60\u200b\u53ef\u80fd\u200b\u4f1a\u200b\u5f88\u5feb\u200b\u6ce8\u610f\u200b\u5230\u200b\u8fd9\u4e9b\u200b\u503c\u200b\u5f88\u200b\u5947\u602a\u200b\u3002\u200b\u8fd9\u200b\u662f\u56e0\u4e3a\u200b\u5f53\u200b\u4f7f\u7528\u200b <code>QgsGeometry</code>\u200b\u7c7b\u4e2d\u200b\u7684\u200b<code>area()</code>\u200b\u548c\u200b<code>length()</code> \u200b\u65b9\u6cd5\u200b\u8ba1\u7b97\u200b\u65f6\u200b\uff0c\u200b\u9762\u79ef\u200b\u548c\u200b\u5468\u957f\u200b\u4e0d\u4f1a\u200b\u8003\u8651\u200bCRS\u3002\u200b\u53ef\u4ee5\u200b\u4f7f\u7528\u200b\u66f4\u200b\u5f3a\u5927\u200b\u7684\u200b<code>QgsDistanceArea</code> \u200b\u7c7b\u200b\u8ba1\u7b97\u200b\u9762\u79ef\u200b\u548c\u200b\u5468\u957f\u200b\uff0c\u200b\u5b83\u200b\u53ef\u4ee5\u200b\u6267\u884c\u200b\u57fa\u4e8e\u200b\u692d\u7403\u200b\u7684\u200b\u8ba1\u7b97\u200b\uff1a</p> <p>\u200b\u4ee5\u4e0b\u200b\u4ee3\u7801\u200b\u5047\u5b9a\u200b<code>layer</code>\u200b\u662f\u200b\u5177\u6709\u200b\u591a\u8fb9\u5f62\u200b\u8981\u7d20\u200b\u7c7b\u578b\u200b\u7684\u200b<code>QgsVectorLayer</code>\u200b\u5bf9\u8c61\u200b\u3002</p> <pre><code>d = QgsDistanceArea()\nd.setEllipsoid('WGS84')\n\nlayer = QgsProject.instance().mapLayersByName('countries')[0]\n\n# \u200b\u8fc7\u6ee4\u200b\u4ee5\u200bZ\u200b\u5f00\u5934\u200b\u7684\u200b\u56fd\u5bb6\u200b\uff0c\u200b\u7136\u540e\u200b\u83b7\u53d6\u200b\u5176\u200b\u8981\u7d20\u200b\nquery = '\"name\" LIKE \\'Z%\\''\nfeatures = layer.getFeatures(QgsFeatureRequest().setFilterExpression(query))\n\nfor f in features:\n  geom = f.geometry()\n  name = f.attribute('NAME')\n  print(name)\n  print(\"Perimeter (m):\", d.measurePerimeter(geom))\n  print(\"Area (m2):\", d.measureArea(geom)) \uff09\uff09\n  # \u200b\u6253\u5370\u200b\uff08\u201c\u200b\u9762\u79ef\u200b\uff08m2\uff09\uff1a\u201d \uff0c d \u3002measureArea \uff08GEOM \uff09\uff09\n\n  # \u200b\u8ba1\u7b97\u200b\u5e76\u200b\u91cd\u65b0\u200b\u6253\u5370\u200b\u9762\u79ef\u200b\uff0c\u200b\u5355\u4f4d\u200b\u4e3a\u200b\u5e73\u65b9\u516c\u91cc\u200b\n  print(\"Area (km2):\", d.convertAreaMeasurement(d.measureArea(geom), QgsUnitTypes.AreaSquareKilometers))\n\n# Zambia\n# Perimeter (m): 5539361.250294601\n# Area (m2): 751989035032.9031\n# Area (km2): 751989.0350329031\n# Zimbabwe\n# Perimeter (m): 2865021.3325076113\n# Area (m2): 389267821381.6008\n# Area (km2): 389267.8213816008\n</code></pre> <p>\u200b\u6216\u8005\u200b\uff0c\u200b\u4f60\u200b\u53ef\u80fd\u200b\u60f3\u200b\u77e5\u9053\u200b\u4e24\u70b9\u200b\u4e4b\u95f4\u200b\u7684\u200b\u8ddd\u79bb\u200b\u3002</p> <pre><code>d = QgsDistanceArea()\nd.setEllipsoid('WGS84')\n\n# \u200b\u8ba9\u200b\u6211\u4eec\u200b\u521b\u9020\u200b\u4e24\u4e2a\u200b\u70b9\u200b\n# \u200b\u5723\u8bde\u8001\u4eba\u200b\u662f\u200b\u4e00\u4e2a\u200b\u5de5\u4f5c\u72c2\u200b\uff0c\u200b\u4ed6\u200b\u9700\u8981\u200b\u653e\u4e2a\u200b\u6691\u5047\u200b\uff0c\u200b\u8ba9\u200b\u6211\u4eec\u200b\u770b\u200b\u4e00\u4e0b\u200b\u4ed6\u5bb6\u200b\u79bb\u7279\u200b\u5185\u91cc\u8d39\u200b\u6709\u591a\u8fdc\u200b\nsanta = QgsPointXY(25.847899, 66.543456)\ntenerife = QgsPointXY(-16.5735, 28.0443)\n\nprint(\"Distance in meters: \", d.measureLine(santa, tenerife))\n</code></pre> <p>\u200b\u4f60\u200b\u53ef\u4ee5\u200b\u5728\u200bQGIS\u200b\u4e2d\u200b\u627e\u5230\u200b\u8bb8\u591a\u200b\u7b97\u6cd5\u200b\u793a\u4f8b\u200b\uff0c\u200b\u5e76\u200b\u4f7f\u7528\u200b\u8fd9\u4e9b\u200b\u65b9\u6cd5\u200b\u6765\u200b\u5206\u6790\u200b\u548c\u200b\u8f6c\u6362\u200b\u77e2\u91cf\u200b\u6570\u636e\u200b\u3002\u200b\u4ee5\u4e0b\u200b\u662f\u200b\u4e00\u4e9b\u200b\u4ee3\u7801\u200b\u7684\u200b\u94fe\u63a5\u200b\u3002</p> <ul> <li>\u200b\u4f7f\u7528\u200b<code>QgsDistanceArea</code>\u200b\u7c7b\u200b\u7684\u200b\u8ddd\u79bb\u200b\u548c\u200b\u9762\u79ef\u200b\uff1a \u200b\u8ddd\u79bb\u200b\u77e9\u9635\u200b\u7b97\u6cd5\u200b</li> <li>\u200b\u7ebf\u5230\u200b\u591a\u8fb9\u5f62\u200b\u7b97\u6cd5\u200b</li> </ul>"},{"location":"8-%E6%8A%95%E5%BD%B1%E6%94%AF%E6%8C%81/","title":"8 \u200b\u6295\u5f71\u200b\u652f\u6301","text":"<p>\u200b\u6b64\u200b\u9875\u9762\u200b\u4e0a\u200b\u7684\u200b\u4ee3\u7801\u200b\u7247\u6bb5\u200b\u9700\u8981\u200b\u5bfc\u5165\u200b\u4ee5\u4e0b\u200b\u6a21\u5757\u200b\uff1a</p> <pre><code>from qgis.core import (\n    QgsCoordinateReferenceSystem,\n    QgsCoordinateTransform,\n    QgsProject,\n    QgsPointXY,\n)\n</code></pre>"},{"location":"8-%E6%8A%95%E5%BD%B1%E6%94%AF%E6%8C%81/#81","title":"8.1 \u200b\u5750\u6807\u200b\u53c2\u8003\u200b\u7cfb\u7edf","text":"<p>\u200b\u5750\u6807\u200b\u53c2\u8003\u200b\u7cfb\u7edf\u200b\uff08CRS\uff09\u200b\u7531\u200b<code>QgsCoordinateReferenceSystem</code> \u200b\u7c7b\u200b\u5c01\u88c5\u200b \u3002\u200b\u53ef\u4ee5\u200b\u901a\u8fc7\u200b\u51e0\u79cd\u200b\u4e0d\u540c\u200b\u7684\u200b\u65b9\u5f0f\u200b\u521b\u5efa\u200b\u6b64\u7c7b\u200b\u7684\u200b\u5b9e\u4f8b\u200b\uff1a</p> <ul> <li>ID</li> </ul> <pre><code># WGS84\uff1a4326\ncrs = QgsCoordinateReferenceSystem(\"EPSG:4326\")\nprint(crs.isValid())\n# True\n</code></pre> <p>QGIS\u200b\u652f\u6301\u200b\u4e0d\u540c\u200b\u7684\u200bCRS\u200b\u8bc6\u522b\u200b\u7b26\u200b\uff0c\u200b\u652f\u6301\u200b\u4ee5\u4e0b\u200b\u683c\u5f0f\u200b\uff1a</p> <ul> <li><code>EPSG:&lt;code&gt;</code>\u2014\u2014EPSG\u200b\u7ec4\u7ec7\u200b\u5206\u914d\u200b\u7684\u200bID\u2014\u2014\u200b\u4f7f\u7528\u200b <code>createFromOgcWms()</code></li> <li><code>POSTGIS:&lt;srid&gt;</code>\u2014\u2014PostGIS\u200b\u6570\u636e\u5e93\u200b\u4f7f\u7528\u200b\u7684\u200bID\u2014\u2014\u200b\u4f7f\u7528\u200b<code>createFromSrid()</code></li> <li><code>INTERNAL:&lt;srsid&gt;</code>\u2014\u2014QGIS\u200b\u5185\u90e8\u200b\u6570\u636e\u5e93\u200b\u4e2d\u200b\u4f7f\u7528\u200b\u7684\u200bID\uff0c\u200b\u4f7f\u7528\u200b<code>createFromSrsId()</code></li> <li><code>PROJ:&lt;proj&gt;</code>\u2014\u2014\u200b\u4f7f\u7528\u200b<code>createFromProj()</code></li> <li><code>WKT:&lt;wkt&gt;</code>\u2014\u2014\u200b\u4f7f\u7528\u200b<code>createFromWkt()</code></li> </ul> <p>\u200b\u5982\u679c\u200b\u672a\u6307\u5b9a\u200b\u524d\u7f00\u200b\uff0c\u200b\u5219\u200b\u9ed8\u8ba4\u200b\u4f7f\u7528\u200bWKT\u200b\u5b9a\u4e49\u200b\u3002</p> <ul> <li>\u200b\u901a\u8fc7\u200bWKT\u200b\u6307\u5b9a\u200bCRS</li> </ul> <pre><code>wkt = 'GEOGCS[\"WGS84\", DATUM[\"WGS84\", SPHEROID[\"WGS84\", 6378137.0, 298.257223563]],' \\\n      'PRIMEM[\"Greenwich\", 0.0], UNIT[\"degree\",0.017453292519943295],' \\\n      'AXIS[\"Longitude\",EAST], AXIS[\"Latitude\",NORTH]]'\ncrs = QgsCoordinateReferenceSystem(wkt)\nprint(crs.isValid())\n# True\n</code></pre> <ul> <li>\u200b\u521b\u5efa\u200b\u4e00\u4e2a\u200b\u65e0\u6548\u200b\u7684\u200bCRS\uff0c\u200b\u7136\u540e\u200b\u4f7f\u7528\u200b\u5176\u4e2d\u200b\u4e00\u4e2a\u200b<code>create*</code>\u200b\u51fd\u6570\u200b\u8fdb\u884c\u200b\u521d\u59cb\u5316\u200b\u3002\u200b\u5728\u200b\u4e0b\u9762\u200b\u7684\u200b\u793a\u4f8b\u200b\u4e2d\u200b\uff0c\u200b\u6211\u4eec\u200b\u4f7f\u7528\u200bProj\u200b\u5b57\u7b26\u4e32\u200b\u521d\u59cb\u5316\u200b\u6295\u5f71\u200b\u3002</li> </ul> <pre><code>crs = QgsCoordinateReferenceSystem()\ncrs.createFromProj(\"+proj=longlat +ellps=WGS84 +datum=WGS84 +no_defs\")\nprint(crs.isValid())\n# True\n</code></pre> <p>\u200b\u68c0\u67e5\u200bCRS\u200b\u7684\u200b\u521b\u5efa\u200b\uff08\u200b\u5373\u200b\u5728\u200b\u6570\u636e\u5e93\u200b\u4e2d\u200b\u67e5\u627e\u200b\uff09\u200b\u662f\u5426\u200b\u6210\u529f\u200b\u662f\u200b\u660e\u667a\u200b\u7684\u200b\uff1a<code>isValid()</code>\u200b\u5fc5\u987b\u200b\u8fd4\u56de\u200b<code>True</code>\u3002</p> <p>\u200b\u8bf7\u200b\u6ce8\u610f\u200b\uff0c\u200b\u5bf9\u4e8e\u200b\u7a7a\u95f4\u200b\u53c2\u8003\u200b\u7cfb\u7edf\u200b\u7684\u200b\u521d\u59cb\u5316\u200b\uff0cQGIS\u200b\u9700\u8981\u200b\u5728\u200b\u5176\u200b\u5185\u90e8\u200b\u6570\u636e\u5e93\u200b<code>srs.db</code>\u200b\u4e2d\u200b\u67e5\u627e\u200b\u9002\u5f53\u200b\u7684\u200b\u503c\u200b\u3002\u200b\u56e0\u6b64\u200b\uff0c\u200b\u5982\u679c\u200b\u4f60\u200b\u521b\u5efa\u200b\u4e00\u4e2a\u200b\u72ec\u7acb\u200b\u7684\u200b\u5e94\u7528\u7a0b\u5e8f\u200b\uff0c\u200b\u4f60\u200b\u9700\u8981\u200b\u4f7f\u7528\u200b<code>QgsApplication.setPrefixPath()</code>\u200b\u6b63\u786e\u200b\u8bbe\u7f6e\u200b\u8def\u5f84\u200b \uff0c\u200b\u5426\u5219\u200b\u5c06\u200b\u65e0\u6cd5\u200b\u627e\u5230\u200b\u6570\u636e\u5e93\u200b\u3002\u200b\u5982\u679c\u200b\u4f60\u200b\u5728\u200bQGIS Python\u200b\u63a7\u5236\u53f0\u200b\u4e2d\u200b\u8fd0\u884c\u200b\u547d\u4ee4\u200b\u6216\u200b\u5f00\u53d1\u200b\u63d2\u4ef6\u200b\uff0c\u200b\u5219\u200b\u65e0\u9700\u200b\u5173\u6ce8\u200b\uff1a\u200b\u4e00\u5207\u200b\u90fd\u200b\u5df2\u7ecf\u200b\u4e3a\u200b\u4f60\u200b\u51c6\u5907\u200b\u597d\u200b\u4e86\u200b\u3002</p> <p>\u200b\u8bbf\u95ee\u200b\u7a7a\u95f4\u200b\u53c2\u8003\u200b\u7cfb\u7edf\u200b\u4fe1\u606f\u200b\uff1a</p> <pre><code>crs = QgsCoordinateReferenceSystem(4326)\n\nprint(\"QGIS CRS ID:\", crs.srsid())\nprint(\"PostGIS SRID:\", crs.postgisSrid())\nprint(\"Description:\", crs.description())\nprint(\"Projection Acronym:\", crs.projectionAcronym())\nprint(\"Ellipsoid Acronym:\", crs.ellipsoidAcronym())\nprint(\"Proj4 String:\", crs.toProj4())\n# \u200b\u68c0\u67e5\u200b\u662f\u200b\u5730\u7406\u5750\u6807\u200b\u7cfb\u7edf\u200b\u8fd8\u662f\u200b\u6295\u5f71\u200b\u5750\u6807\u200b\u7cfb\u7edf\u200b\nprint(\"Is geographic:\", crs.isGeographic())\n# \u200b\u68c0\u67e5\u200bCRS\u200b\u7684\u200b\u5730\u56fe\u200b\u5355\u4f4d\u200b\u7c7b\u578b\u200b\uff08\u200b\u5728\u200bQGis::units\u200b\u679a\u4e3e\u200b\u4e2d\u200b\u5b9a\u4e49\u200b\uff09\nprint(\"Map units:\", crs.mapUnits())\n</code></pre> <p>\u200b\u8f93\u51fa\u200b:</p> <pre><code>QGIS CRS ID: 3452\nPostGIS SRID: 4326\nDescription: WGS 84\nProjection Acronym: longlat\nEllipsoid Acronym: WGS84\nProj4 String: +proj=longlat +datum=WGS84 +no_defs\nIs geographic: True\nMap units: DistanceUnit.Degrees\n</code></pre>"},{"location":"8-%E6%8A%95%E5%BD%B1%E6%94%AF%E6%8C%81/#82","title":"8.2 \u200b\u5750\u6807\u200b\u53c2\u8003\u200b\u7cfb\u7edf\u200b\u8f6c\u6362","text":"<p>\u200b\u4f60\u200b\u53ef\u4ee5\u200b\u4f7f\u7528\u200b<code>QgsCoordinateTransform</code>\u200b\u7c7b\u200b\u5728\u200b\u4e0d\u540c\u200b\u7684\u200b\u7a7a\u95f4\u200b\u53c2\u8003\u7cfb\u200b\u4e4b\u95f4\u200b\u8fdb\u884c\u200b\u8f6c\u6362\u200b\u3002\u200b\u4f7f\u7528\u200b\u5b83\u200b\u7684\u200b\u6700\u200b\u7b80\u5355\u200b\u65b9\u6cd5\u200b\u662f\u200b\u521b\u5efa\u200b\u539f\u59cb\u200b\u548c\u200b\u76ee\u6807\u200bCRS\uff0c\u200b\u5e76\u200b\u5728\u200b\u5f53\u524d\u200b\u9879\u76ee\u200b\u4e2d\u200b\u6784\u9020\u200b<code>QgsCoordinateTransform</code>\u200b\u5b9e\u4f8b\u200b\u3002\u200b\u7136\u540e\u200b\u53ea\u200b\u9700\u200b\u53cd\u590d\u200b\u8c03\u7528\u200b <code>transform()</code>\u200b\u51fd\u6570\u200b\u8fdb\u884c\u200b\u8f6c\u6362\u200b\u3002\u200b\u9ed8\u8ba4\u200b\u60c5\u51b5\u200b\u4e0b\u200b\uff0c\u200b\u5b83\u4f1a\u200b\u6b63\u5411\u200b\u8f6c\u6362\u200b\uff0c\u200b\u4f46\u200b\u4e5f\u200b\u53ef\u4ee5\u200b\u9006\u5411\u200b\u8f6c\u6362\u200b\u3002</p> <pre><code>crsSrc = QgsCoordinateReferenceSystem(4326)    # WGS 84\ncrsDest = QgsCoordinateReferenceSystem(32633)  # WGS 84 / UTM zone 33N\nxform = QgsCoordinateTransform(crsSrc, crsDest, QgsProject.instance())\n\n# \u200b\u6b63\u5411\u200b\u8f6c\u6362\u200b: src -&gt; dest\npt1 = xform.transform(QgsPointXY(18,5))\nprint(\"Transformed point:\", pt1)\n\n# \u200b\u9006\u5411\u200b\u8f6c\u6362\u200b: dest -&gt; src\npt2 = xform.transform(pt1, QgsCoordinateTransform.ReverseTransform)\nprint(\"Transformed back:\", pt2)\n</code></pre> <p>\u200b\u8f93\u51fa\u200b:</p> <pre><code>Transformed point: &lt;QgsPointXY: POINT(832713.79873844375833869 553423.98688333143945783)&gt;\nTransformed back: &lt;QgsPointXY: POINT(18 4.99999999999999911)&gt;\n</code></pre>"},{"location":"9-%E4%BD%BF%E7%94%A8%E5%9C%B0%E5%9B%BE%E7%94%BB%E5%B8%83/","title":"9-\u200b\u4f7f\u7528\u200b\u5730\u56fe\u200b\u753b\u5e03","text":"<p>\u200b\u672c\u200b\u8282\u200b\u4ee3\u7801\u200b\u7247\u6bb5\u200b\u9700\u8981\u200b\u5bfc\u5165\u200b\u4ee5\u4e0b\u200b\u6a21\u5757\u200b\uff1a</p> <pre><code>from qgis.PyQt.QtGui import (\n    QColor,\n)\n\nfrom qgis.PyQt.QtCore import Qt, QRectF\n\nfrom qgis.PyQt.QtWidgets import QMenu\n\nfrom qgis.core import (\n    QgsVectorLayer,\n    QgsPoint,\n    QgsPointXY,\n    QgsProject,\n    QgsGeometry,\n    QgsMapRendererJob,\n    QgsWkbTypes,\n)\n\nfrom qgis.gui import (\n    QgsMapCanvas,\n    QgsVertexMarker,\n    QgsMapCanvasItem,\n    QgsMapMouseEvent,\n    QgsRubberBand,\n)\n</code></pre>"},{"location":"9-%E4%BD%BF%E7%94%A8%E5%9C%B0%E5%9B%BE%E7%94%BB%E5%B8%83/#9","title":"9 \u200b\u4f7f\u7528\u200b\u5730\u56fe\u200b\u753b\u5e03","text":"<p>\u200b\u5730\u56fe\u200b\u753b\u5e03\u200b\u63a7\u4ef6\u200b\u53ef\u80fd\u200b\u662f\u200bQGIS\u200b\u4e2d\u200b\u6700\u200b\u91cd\u8981\u200b\u7684\u200b\u63a7\u4ef6\u200b\uff0c\u200b\u56e0\u4e3a\u200b\u5b83\u200b\u663e\u793a\u200b\u4e86\u200b\u7531\u200b\u91cd\u53e0\u200b\u5730\u56fe\u200b\u56fe\u5c42\u200b\u7ec4\u6210\u200b\u7684\u200b\u5730\u56fe\u200b\uff0c\u200b\u5e76\u200b\u5141\u8bb8\u200b\u4e0e\u200b\u5730\u56fe\u200b\u548c\u200b\u56fe\u5c42\u200b\u8fdb\u884c\u200b\u4ea4\u4e92\u200b\u3002\u200b\u753b\u5e03\u200b\u59cb\u7ec8\u200b\u663e\u793a\u200b\u7531\u200b\u5f53\u524d\u200b\u753b\u5e03\u200b\u8303\u56f4\u200b\u5b9a\u4e49\u200b\u5730\u56fe\u200b\u7684\u200b\u4e00\u90e8\u5206\u200b\u3002\u200b\u901a\u8fc7\u200b\u4f7f\u7528\u200b \u200b\u5730\u56fe\u200b\u5de5\u5177\u200b \u200b\u5b8c\u6210\u200b\u4ea4\u4e92\u200b\uff1a\u200b\u6709\u200b\u5e73\u79fb\u200b\uff0c\u200b\u7f29\u653e\u200b\uff0c\u200b\u8bc6\u522b\u200b\u56fe\u5c42\u200b\uff0c\u200b\u6d4b\u91cf\u200b\uff0c\u200b\u77e2\u91cf\u200b\u7f16\u8f91\u200b\u7b49\u200b\u5de5\u5177\u200b\u3002\u200b\u4e0e\u200b\u5176\u4ed6\u200b\u56fe\u5f62\u200b\u7a0b\u5e8f\u200b\u7c7b\u4f3c\u200b\uff0c\u200b\u603b\u6709\u200b\u4e00\u4e2a\u200b\u5de5\u5177\u200b\u5904\u4e8e\u200b\u6d3b\u52a8\u72b6\u6001\u200b\uff0c\u200b\u7528\u6237\u200b\u53ef\u4ee5\u200b\u5728\u200b\u53ef\u7528\u200b\u5de5\u5177\u200b\u4e4b\u95f4\u200b\u5207\u6362\u200b\u3002</p> <p>\u200b\u5730\u56fe\u200b\u753b\u5e03\u200b\u7531\u200b<code>qgis.gui</code>\u200b\u6a21\u5757\u200b\u4e2d\u200b\u7684\u200b<code>QgsMapCanvas</code>\u200b\u7c7b\u200b\u5b9e\u73b0\u200b\u3002\u200b\u8be5\u7c7b\u200b\u57fa\u4e8e\u200bQt Graphics View\u200b\u6846\u67b6\u200b\u3002\u200b\u8be5\u200b\u6846\u67b6\u200b\u901a\u5e38\u200b\u63d0\u4f9b\u200b\u573a\u666f\u200b\u548c\u200b\u89c6\u56fe\u200b\uff0c\u200b\u5176\u4e2d\u200b\u653e\u7f6e\u200b\u81ea\u5b9a\u4e49\u200b\u56fe\u5f62\u200b\u9879\u200b\uff0c\u200b\u5e76\u4e14\u200b\u7528\u6237\u200b\u53ef\u4ee5\u200b\u4e0e\u200b\u5b83\u4eec\u200b\u4ea4\u4e92\u200b\u3002\u200b\u6211\u4eec\u200b\u5047\u8bbe\u200b\u4f60\u200b\u5bf9\u200bQt\u200b\u8db3\u591f\u200b\u719f\u6089\u200b\uff0c\u200b\u4e86\u89e3\u200b\u56fe\u5f62\u200b\u573a\u666f\u200b\uff0c\u200b\u89c6\u56fe\u200b\u548c\u200b\u9879\u200b\u7684\u200b\u6982\u5ff5\u200b\u3002\u200b\u5982\u679c\u200b\u6ca1\u6709\u200b\uff0c\u200b\u8bf7\u200b\u9605\u8bfb\u200b\u6846\u67b6\u200b\u6982\u8ff0\u200b\u3002</p> <p>\u200b\u65e0\u8bba\u200b\u4f55\u65f6\u200b\u5e73\u79fb\u200b\uff0c\u200b\u653e\u5927\u200b/\u200b\u7f29\u5c0f\u200b\uff08\u200b\u6216\u200b\u89e6\u53d1\u200b\u5237\u65b0\u200b\u7684\u200b\u5176\u4ed6\u200b\u64cd\u4f5c\u200b\uff09\u200b\u5730\u56fe\u200b\uff0c\u200b\u5730\u56fe\u200b\u90fd\u200b\u4f1a\u200b\u5728\u200b\u5f53\u524d\u200b\u8303\u56f4\u200b\u5185\u200b\u518d\u6b21\u200b\u6e32\u67d3\u200b\u3002\u200b\u56fe\u5c42\u200b\u5c06\u200b\u6e32\u67d3\u200b\u4e3a\u200b\u56fe\u50cf\u200b\uff08\u200b\u4f7f\u7528\u200b<code>QgsMapRendererJob</code>\u200b\u7c7b\u200b\uff09\uff0c\u200b\u5e76\u200b\u663e\u793a\u200b\u5728\u200b\u753b\u5e03\u200b\u4e0a\u200b\u3002<code>QgsMapCanvas</code>\u200b\u7c7b\u200b\u8fd8\u200b\u63a7\u5236\u200b\u6e32\u67d3\u200b\u56fe\u200b\u7684\u200b\u5237\u65b0\u200b\u3002\u200b\u9664\u4e86\u200b\u4f5c\u4e3a\u200b\u80cc\u666f\u200b\u7684\u200b\u9879\u200b\uff0c\u200b\u53ef\u80fd\u200b\u8fd8\u6709\u200b\u66f4\u200b\u591a\u200b\u7684\u200b \u200b\u5730\u56fe\u200b\u753b\u5e03\u200b\u9879\u200b \u3002</p> <p>\u200b\u5178\u578b\u200b\u7684\u200b\u5730\u56fe\u200b\u753b\u5e03\u200b\u9879\u662f\u200b\u6a61\u76ae\u200b\u6761\u200b\uff08\u200b\u7528\u4e8e\u200b\u6d4b\u91cf\u200b\uff0c\u200b\u77e2\u91cf\u200b\u7f16\u8f91\u200b\u7b49\u200b\uff09\u200b\u6216\u200b\u9876\u70b9\u200b\u6807\u8bb0\u200b\u3002\u200b\u753b\u5e03\u200b\u9879\u200b\u901a\u5e38\u200b\u7528\u4e8e\u200b\u7ed9\u200b\u5730\u56fe\u200b\u5de5\u5177\u200b\u63d0\u4f9b\u200b\u89c6\u89c9\u200b\u53cd\u9988\u200b\uff0c\u200b\u4f8b\u5982\u200b\uff0c\u200b\u5728\u200b\u521b\u5efa\u200b\u65b0\u200b\u591a\u8fb9\u5f62\u200b\u65f6\u200b\uff0c\u200b\u5730\u56fe\u200b\u5de5\u5177\u200b\u4f1a\u200b\u521b\u5efa\u200b\u4e00\u4e2a\u200b\u6a61\u76ae\u200b\u6761\u200b\u753b\u5e03\u200b\u9879\u200b\uff0c\u200b\u663e\u793a\u200b\u591a\u8fb9\u5f62\u200b\u7684\u200b\u5f53\u524d\u200b\u5f62\u72b6\u200b\u3002\u200b\u6240\u6709\u200b\u5730\u56fe\u200b\u753b\u5e03\u200b\u9879\u200b\u90fd\u200b\u662f\u200b<code>QgsMapCanvasItem</code> \u200b\u7684\u200b\u5b50\u7c7b\u200b\uff0c\u200b\u5b83\u200b\u4e3a\u200b\u57fa\u7c7b\u200b<code>QGraphicsItem</code>\u200b\u5bf9\u8c61\u200b\u6dfb\u52a0\u200b\u4e86\u200b\u66f4\u200b\u591a\u529f\u80fd\u200b\u3002</p> <p>\u200b\u603b\u800c\u8a00\u4e4b\u200b\uff0c\u200b\u5730\u56fe\u200b\u753b\u5e03\u200b\u67b6\u6784\u200b\u5305\u542b\u200b\u4e09\u4e2a\u200b\u6982\u5ff5\u200b\uff1a</p> <ul> <li>\u200b\u5730\u56fe\u200b\u753b\u5e03\u200b\u2014\u2014\u200b\u7528\u4e8e\u200b\u6d4f\u89c8\u200b\u5730\u56fe\u200b</li> <li>\u200b\u5730\u56fe\u200b\u753b\u5e03\u200b\u9879\u200b\u2014\u2014\u200b\u53ef\u4ee5\u200b\u5728\u200b\u5730\u56fe\u200b\u753b\u5e03\u200b\u4e0a\u200b\u663e\u793a\u200b\u7684\u200b\u5176\u4ed6\u200b\u9879\u200b</li> <li>\u200b\u5730\u56fe\u200b\u5de5\u5177\u200b\u2014\u2014\u200b\u7528\u4e8e\u200b\u4e0e\u200b\u5730\u56fe\u200b\u753b\u5e03\u200b\u4ea4\u4e92\u200b</li> </ul>"},{"location":"9-%E4%BD%BF%E7%94%A8%E5%9C%B0%E5%9B%BE%E7%94%BB%E5%B8%83/#91","title":"9.1 \u200b\u5d4c\u5165\u200b\u5730\u56fe\u200b\u753b\u5e03","text":"<p>\u200b\u5730\u56fe\u200b\u753b\u5e03\u200b\u662f\u200b\u4e00\u4e2a\u200b\u63a7\u4ef6\u200b\uff0c\u200b\u5c31\u200b\u50cf\u200b\u4efb\u4f55\u200b\u5176\u4ed6\u200bQt\u200b\u63a7\u4ef6\u200b\u4e00\u6837\u200b\uff0c\u200b\u56e0\u6b64\u200b\u4f7f\u7528\u200b\u5b83\u200b\u5c31\u200b\u50cf\u200b\u521b\u5efa\u200b\u548c\u200b\u663e\u793a\u200b\u5b83\u200b\u4e00\u6837\u200b\u7b80\u5355\u200b</p> <pre><code>canvas = QgsMapCanvas()\ncanvas.show()\n</code></pre> <p>\u200b\u8fd9\u200b\u5c06\u200b\u751f\u6210\u200b\u4e00\u4e2a\u200b\u5e26\u6709\u200b\u5730\u56fe\u200b\u753b\u5e03\u200b\u7684\u200b\u72ec\u7acb\u200b\u7a97\u53e3\u200b\u3002\u200b\u5b83\u200b\u4e5f\u200b\u53ef\u4ee5\u200b\u5d4c\u5165\u200b\u5230\u200b\u73b0\u6709\u200b\u7684\u200b\u63a7\u4ef6\u200b\u6216\u200b\u7a97\u53e3\u200b\u4e2d\u200b\u3002\u200b\u4f7f\u7528\u200b<code>.ui</code>\u200b\u6587\u4ef6\u200b\u548c\u200bQt\u200b\u8bbe\u8ba1\u5e08\u200b\u65f6\u200b\uff0c\u200b\u5728\u200b\u8868\u5355\u200b\u4e0a\u200b\u653e\u7f6e\u200b\u4e00\u4e2a\u200b<code>QWidget</code>\u200b\u5e76\u200b\u5c06\u200b\u5176\u200b\u63d0\u5347\u200b\u4e3a\u200b\u65b0\u7c7b\u200b\uff1a\u200b\u8bbe\u7f6e\u200b<code>QgsMapCanvas</code>\u200b\u4e3a\u200b\u7c7b\u540d\u200b\u5e76\u200b\u8bbe\u7f6e\u200b<code>qgis.gui</code>\u200b\u4e3a\u200b\u5934\u6587\u4ef6\u200b\u3002<code>pyuic5</code>\u200b\u5de5\u5177\u200b\u5c06\u200b\u641e\u5b9a\u200b\u5b83\u200b\uff08\u200b\u8bd1\u8005\u200b\u6ce8\u200b\uff1a\u200b\u7f16\u8bd1\u200b\u4e3a\u200bpy\u200b\u811a\u672c\u200b\u6587\u4ef6\u200b\uff09\u3002\u200b\u8fd9\u662f\u200b\u5d4c\u5165\u200b\u753b\u5e03\u200b\u7684\u200b\u4e00\u79cd\u200b\u975e\u5e38\u200b\u65b9\u4fbf\u200b\u7684\u200b\u65b9\u6cd5\u200b\u3002\u200b\u53e6\u200b\u4e00\u79cd\u200b\u53ef\u80fd\u6027\u200b\u662f\u200b\u624b\u52a8\u200b\u7f16\u5199\u200b\u4ee3\u7801\u200b\u6784\u9020\u200b\u5730\u56fe\u200b\u753b\u5e03\u200b\u548c\u200b\u5176\u4ed6\u200b\u63a7\u4ef6\u200b\uff08\u200b\u4f5c\u4e3a\u200b\u4e3b\u200b\u7a97\u53e3\u200b\u6216\u200b\u5bf9\u8bdd\u6846\u200b\u7684\u200b\u5b50\u200b\u7a97\u53e3\u200b\uff09\u200b\u5e76\u200b\u521b\u5efa\u200b\u5e03\u5c40\u200b\u3002</p> <p>\u200b\u9ed8\u8ba4\u200b\u60c5\u51b5\u200b\u4e0b\u200b\uff0c\u200b\u5730\u56fe\u200b\u753b\u5e03\u200b\u5177\u6709\u200b\u9ed1\u8272\u200b\u80cc\u666f\u200b\uff0c\u200b\u4e0d\u200b\u4f7f\u7528\u200b\u6d88\u9664\u200b\u952f\u9f7f\u200b\u3002\u200b\u8bbe\u7f6e\u200b\u767d\u8272\u200b\u80cc\u666f\u200b\u5e76\u200b\u542f\u7528\u200b\u6297\u952f\u9f7f\u200b\u6765\u200b\u5b9e\u73b0\u200b\u5e73\u6ed1\u200b\u6e32\u67d3\u200b</p> <pre><code>canvas.setCanvasColor(Qt.white)\ncanvas.enableAntiAliasing(True)\n</code></pre> <p>\uff08\u200b\u5982\u679c\u200b\u4f60\u200b\u60f3\u200b\u77e5\u9053\u200b\uff0c<code>Qt</code>\u200b\u6765\u81ea\u200b<code>PyQt.QtCore</code>\u200b\u6a21\u5757\u200b\uff0c\u200b\u5e76\u4e14\u200b <code>Qt.white</code>\u200b\u662f\u200b\u9884\u5b9a\u200b\u4e49\u200b\u7684\u200b<code>QColor</code>\u200b\u5b9e\u4f8b\u200b\u4e4b\u4e00\u200b\u3002\uff09</p> <p>\u200b\u73b0\u5728\u200b\u662f\u200b\u65f6\u5019\u200b\u6dfb\u52a0\u200b\u4e00\u4e9b\u200b\u5730\u56fe\u200b\u56fe\u5c42\u200b\u4e86\u200b\u3002\u200b\u6211\u4eec\u200b\u9996\u5148\u200b\u6253\u5f00\u200b\u4e00\u4e2a\u200b\u56fe\u5c42\u200b\u5e76\u200b\u5c06\u200b\u5176\u200b\u6dfb\u52a0\u200b\u5230\u200b\u5f53\u524d\u200b\u9879\u76ee\u200b\u4e2d\u200b\u3002\u200b\u7136\u540e\u200b\u6211\u4eec\u200b\u5c06\u200b\u8bbe\u7f6e\u200b\u753b\u5e03\u200b\u8303\u56f4\u200b\u5e76\u200b\u8bbe\u7f6e\u200b\u753b\u5e03\u200b\u7684\u200b\u56fe\u5c42\u200b\u5217\u8868\u200b</p> <pre><code>vlayer = QgsVectorLayer(\"testdata/airports.shp\", \"Airports layer\", \"ogr\")\nif not vlayer.isValid():\n    print(\"\u200b\u56fe\u5c42\u200b\u52a0\u8f7d\u200b\u5931\u8d25\u200b\uff01\")\n\n# \u200b\u5c06\u200b\u56fe\u5c42\u200b\u6dfb\u52a0\u200b\u5230\u200b\u6ce8\u518c\u8868\u200b\nQgsProject.instance().addMapLayer(vlayer)\n\n# \u200b\u7f29\u200b\u653e\u5230\u200b\u56fe\u5c42\u200b\ncanvas.setExtent(vlayer.extent())\n\n# \u200b\u8bbe\u7f6e\u200b\u5730\u56fe\u200b\u753b\u5e03\u200b\u7684\u200b\u56fe\u5c42\u200b\u96c6\u200b\ncanvas.setLayers([vlayer])\n</code></pre> <p>\u200b\u6267\u884c\u200b\u8fd9\u4e9b\u200b\u547d\u4ee4\u200b\u540e\u200b\uff0c\u200b\u753b\u5e03\u200b\u5c06\u200b\u663e\u793a\u200b\u5df2\u200b\u52a0\u8f7d\u200b\u7684\u200b\u56fe\u5c42\u200b\u3002</p>"},{"location":"9-%E4%BD%BF%E7%94%A8%E5%9C%B0%E5%9B%BE%E7%94%BB%E5%B8%83/#92","title":"9.2 \u200b\u6a61\u76ae\u200b\u6761\u200b\u548c\u200b\u9876\u70b9\u200b\u6807\u8bb0","text":"<p>\u200b\u5728\u200b\u753b\u5e03\u200b\u4e0a\u200b\u7684\u200b\u5730\u56fe\u200b\u9876\u90e8\u200b\u663e\u793a\u200b\u4e00\u4e9b\u200b\u5176\u4ed6\u200b\u6570\u636e\u200b\uff0c\u200b\u4f7f\u7528\u200b\u5730\u56fe\u200b\u753b\u5e03\u200b\u9879\u200b\u3002\u200b\u53ef\u4ee5\u200b\u521b\u5efa\u200b\u81ea\u5b9a\u4e49\u200b\u753b\u5e03\u200b\u9879\u7c7b\u200b\uff08\u200b\u5982\u4e0b\u200b\u6240\u8ff0\u200b\uff09\uff0c\u200b\u4f46\u200b\u4e3a\u200b\u65b9\u4fbf\u200b\u8d77\u200b\u89c1\u200b\uff0c\u200b\u6709\u200b\u4e24\u4e2a\u200b\u6709\u7528\u200b\u7684\u200b\u753b\u5e03\u200b\u9879\u7c7b\u200b\uff1a<code>QgsRubberBand</code>\u200b\u7528\u4e8e\u200b\u7ed8\u5236\u200b\u6298\u7ebf\u200b\u6216\u200b\u591a\u8fb9\u5f62\u200b\uff0c<code>QgsVertexMarker</code>\u200b\u7ed8\u5236\u200b\u70b9\u200b\u3002\u200b\u5b83\u4eec\u200b\u90fd\u200b\u4f7f\u7528\u200b\u5730\u56fe\u200b\u5750\u6807\u200b\uff0c\u200b\u56e0\u6b64\u200b\u5728\u200b\u5e73\u79fb\u200b\u6216\u200b\u7f29\u653e\u200b\u753b\u5e03\u200b\u65f6\u4f1a\u200b\u81ea\u52a8\u200b\u79fb\u52a8\u200b/\u200b\u7f29\u653e\u200b\u5f62\u72b6\u200b\u3002</p> <p>\u200b\u663e\u793a\u200b\u6298\u7ebf\u200b</p> <pre><code>r = QgsRubberBand(canvas, QgsWkbTypes.LineGeometry)  # \u200b\u7ebf\u200b\npoints = [QgsPointXY(-100, 45), QgsPointXY(10, 60), QgsPointXY(120, 45)]\nr.setToGeometry(QgsGeometry.fromPolyline(points), None)\n</code></pre> <p>\u200b\u663e\u793a\u200b\u591a\u8fb9\u5f62\u200b</p> <pre><code>r = QgsRubberBand(canvas, QgsWkbTypes.PolygonGeometry)  # \u200b\u591a\u8fb9\u5f62\u200b\npoints = [[QgsPointXY(-100, 35), QgsPointXY(10, 50), QgsPointXY(120, 35)]]\nr.setToGeometry(QgsGeometry.fromPolygonXY(points), None)\n</code></pre> <p>\u200b\u8bf7\u200b\u6ce8\u610f\u200b\uff0c\u200b\u591a\u8fb9\u5f62\u200b\u7684\u200b\u70b9\u200b\u4e0d\u662f\u200b\u666e\u901a\u200b\u5217\u8868\u200b\uff1a\u200b\u5b9e\u9645\u4e0a\u200b\uff0c\u200b\u5b83\u200b\u662f\u200b\u5305\u542b\u200b\u591a\u8fb9\u5f62\u200b\u7ebf\u73af\u200b\u7684\u200b\u73af\u200b\u5217\u8868\u200b\uff1a\u200b\u7b2c\u4e00\u4e2a\u200b\u73af\u662f\u200b\u5916\u200b\u8fb9\u6846\u200b\uff0c\u200b\u7b2c\u4e8c\u4e2a\u200b\uff08\u200b\u53ef\u200b\u9009\u200b\uff09\u200b\u73af\u200b\u5bf9\u5e94\u200b\u4e8e\u200b\u591a\u8fb9\u5f62\u200b\u4e2d\u200b\u7684\u200b\u5b54\u200b\u3002</p> <p>\u200b\u6a61\u76ae\u200b\u6761\u200b\u5141\u8bb8\u200b\u4e00\u4e9b\u200b\u5b9a\u5236\u200b\uff0c\u200b\u5373\u200b\u6539\u53d8\u200b\u5b83\u4eec\u200b\u7684\u200b\u989c\u8272\u200b\u548c\u200b\u7ebf\u5bbd\u200b</p> <pre><code>r.setColor(QColor(0, 0, 255))\nr.setWidth(3)\n</code></pre> <p>\u200b\u753b\u5e03\u200b\u9879\u200b\u7ed1\u5b9a\u200b\u5230\u200b\u753b\u5e03\u200b\u573a\u666f\u200b\u3002\u200b\u8981\u200b\u6682\u65f6\u200b\u9690\u85cf\u200b\u5b83\u4eec\u200b\uff08\u200b\u5e76\u200b\u518d\u6b21\u200b\u663e\u793a\u200b\u5b83\u4eec\u200b\uff09\uff0c\u200b\u8bf7\u200b\u4f7f\u7528\u200b<code>hide()</code>\u200b\u548c\u200b<code>show()</code>\u200b\u7ec4\u5408\u200b\u3002\u200b\u5b8c\u5168\u200b\u5220\u9664\u200b\u8be5\u9879\u200b\uff0c\u200b\u4f60\u200b\u5fc5\u987b\u200b\u5c06\u200b\u5176\u200b\u4ece\u200b\u753b\u5e03\u200b\u7684\u200b\u573a\u666f\u200b\u4e2d\u200b\u5220\u9664\u200b</p> <pre><code>canvas.scene().removeItem(r)\n</code></pre> <p>\uff08\u200b\u5728\u200bC ++\u200b\u4e2d\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u53ea\u200b\u5220\u9664\u200b\u8be5\u9879\u200b\uff0c\u200b\u4f46\u662f\u200b\u5728\u200bPython<code>del r</code>\u200b\u4e2d\u200b \u200b\u53ea\u200b\u5220\u9664\u200b\u5f15\u7528\u200b\uff0c\u200b\u5e76\u4e14\u200b\u8be5\u200b\u5bf9\u8c61\u200b\u4ecd\u7136\u200b\u5b58\u5728\u200b\uff0c\u200b\u56e0\u4e3a\u200b\u5b83\u200b\u7531\u200b\u753b\u5e03\u200b\u62e5\u6709\u200b\uff09</p> <p>\u200b\u6a61\u76ae\u200b\u6761\u200b\u4e5f\u200b\u53ef\u200b\u7528\u4e8e\u200b\u7ed8\u5236\u200b\u70b9\u200b\uff0c\u200b\u4f46\u200b <code>QgsVertexMarker</code>\u200b\u7c7b\u200b\u66f4\u200b\u9002\u5408\u200b\u4e8e\u200b\u6b64\u200b\uff08<code>QgsRubberBand</code>\u200b\u4ec5\u200b\u5728\u200b\u6240\u200b\u9700\u70b9\u200b\u5468\u56f4\u200b\u7ed8\u5236\u200b\u4e00\u4e2a\u200b\u77e9\u5f62\u200b\uff09\u3002</p> <p>\u200b\u4f60\u200b\u53ef\u4ee5\u200b\u50cf\u200b\u8fd9\u6837\u200b\u4f7f\u7528\u200b\u9876\u70b9\u200b\u6807\u8bb0\u200b\uff1a</p> <pre><code>m = QgsVertexMarker(canvas)\nm.setCenter(QgsPointXY(10,40))\n</code></pre> <p>\u200b\u8fd9\u200b\u5c06\u200b\u5728\u200b\u4f4d\u7f6e\u200b [10,45] \u200b\u4e0a\u200b\u7ed8\u5236\u200b\u4e00\u4e2a\u200b\u7ea2\u5341\u5b57\u200b\u3002\u200b\u53ef\u4ee5\u200b\u81ea\u5b9a\u4e49\u200b\u56fe\u6807\u200b\u7c7b\u578b\u200b\uff0c\u200b\u5927\u5c0f\u200b\uff0c\u200b\u989c\u8272\u200b\u548c\u200b\u5bbd\u5ea6\u200b</p> <pre><code>m.setColor(QColor(0, 255, 0))\nm.setIconSize(5)\nm.setIconType(QgsVertexMarker.ICON_BOX) # or ICON_CROSS, ICON_X\nm.setPenWidth(3)\n</code></pre> <p>\u200b\u4e34\u65f6\u200b\u9690\u85cf\u200b\u9876\u70b9\u200b\u6807\u8bb0\u200b\u5e76\u200b\u4ece\u200b\u753b\u5e03\u200b\u4e2d\u200b\u5220\u9664\u200b\u5b83\u4eec\u200b\uff0c\u200b\u4f7f\u7528\u200b\u4e0e\u200b\u6a61\u76ae\u200b\u6761\u200b\u76f8\u540c\u200b\u7684\u200b\u65b9\u6cd5\u200b\u3002</p>"},{"location":"9-%E4%BD%BF%E7%94%A8%E5%9C%B0%E5%9B%BE%E7%94%BB%E5%B8%83/#93","title":"9.3 \u200b\u5728\u200b\u753b\u5e03\u200b\u4e2d\u200b\u4f7f\u7528\u200b\u5730\u56fe\u200b\u5de5\u5177","text":"<p>\u200b\u4ee5\u4e0b\u200b\u793a\u4f8b\u200b\u6784\u9020\u200b\u4e00\u4e2a\u200b\u7a97\u53e3\u200b\uff0c\u200b\u5176\u4e2d\u200b\u5305\u542b\u200b\u7528\u4e8e\u200b\u5730\u56fe\u200b\u5e73\u79fb\u200b\u548c\u200b\u7f29\u653e\u200b\u7684\u200b\u5730\u56fe\u200b\u753b\u5e03\u200b\u548c\u200b\u57fa\u672c\u200b\u5730\u56fe\u200b\u5de5\u5177\u200b\u3002\u200b\u6fc0\u6d3b\u200b\u6bcf\u4e2a\u200b\u5de5\u5177\u200b\uff1a\u200b\u5e73\u79fb\u200b\u5de5\u5177\u200b<code>QgsMapToolPan</code>\uff0c\u200b\u653e\u5927\u200b\u7f29\u5c0f\u200b\u5de5\u5177\u200b<code>QgsMapToolZoom</code>\u3002\u200b\u8bbe\u7f6e\u200b\u4e3a\u200b\u53ef\u200b\u88ab\u200b\u9009\u4e2d\u200b\uff0c\u200b\u5141\u8bb8\u200b\u81ea\u52a8\u200b\u5904\u7406\u200b\u9009\u4e2d\u200b/\u200b\u672a\u200b\u9009\u4e2d\u200b\u7684\u200b\u64cd\u4f5c\u200b\u72b6\u6001\u200b\u2014\u2014\u200b\u5f53\u200b\u6fc0\u6d3b\u200b\u5730\u56fe\u200b\u5de5\u5177\u200b\u65f6\u200b\uff0c\u200b\u4e00\u4e2a\u200b\u5de5\u5177\u200b\u88ab\u200b\u9009\u4e2d\u200b\u65f6\u200b\uff0c\u200b\u53d6\u6d88\u200b\u9009\u4e2d\u200b\u4e0a\u200b\u4e00\u4e2a\u200b\u5de5\u5177\u200b\u3002\u200b\u4f7f\u7528\u200b<code>setMapTool()</code>\u200b\u65b9\u6cd5\u200b\u6fc0\u6d3b\u200b\u5730\u56fe\u200b\u5de5\u5177\u200b\u3002</p> <pre><code>from qgis.gui import *\nfrom qgis.PyQt.QtWidgets import QAction, QMainWindow\nfrom qgis.PyQt.QtCore import Qt\n\n\nclass MyWnd(QMainWindow):\n    def __init__(self, layer):\n        QMainWindow.__init__(self)\n\n        self.canvas = QgsMapCanvas()\n        self.canvas.setCanvasColor(Qt.white)\n\n        self.canvas.setExtent(layer.extent())\n        self.canvas.setLayers([layer])\n\n        self.setCentralWidget(self.canvas)\n\n        self.actionZoomIn = QAction(\"Zoom in\", self)\n        self.actionZoomOut = QAction(\"Zoom out\", self)\n        self.actionPan = QAction(\"Pan\", self)\n\n        self.actionZoomIn.setCheckable(True)\n        self.actionZoomOut.setCheckable(True)\n        self.actionPan.setCheckable(True)\n\n        self.actionZoomIn.triggered.connect(self.zoomIn)\n        self.actionZoomOut.triggered.connect(self.zoomOut)\n        self.actionPan.triggered.connect(self.pan)\n\n        self.toolbar = self.addToolBar(\"Canvas actions\")\n        self.toolbar.addAction(self.actionZoomIn)\n        self.toolbar.addAction(self.actionZoomOut)\n        self.toolbar.addAction(self.actionPan)\n\n        # \u200b\u521b\u5efa\u200b\u5730\u56fe\u200b\u5de5\u5177\u200b\n        self.toolPan = QgsMapToolPan(self.canvas)\n        self.toolPan.setAction(self.actionPan)\n        self.toolZoomIn = QgsMapToolZoom(self.canvas, False)  # false = in\n        self.toolZoomIn.setAction(self.actionZoomIn)\n        self.toolZoomOut = QgsMapToolZoom(self.canvas, True)  # true = out\n        self.toolZoomOut.setAction(self.actionZoomOut)\n\n        self.pan()\n\n    def zoomIn(self):\n        self.canvas.setMapTool(self.toolZoomIn)\n\n    def zoomOut(self):\n        self.canvas.setMapTool(self.toolZoomOut)\n\n    def pan(self):\n        self.canvas.setMapTool(self.toolPan)\n</code></pre> <p>\u200b\u4f60\u200b\u53ef\u4ee5\u200b\u5728\u200bPython\u200b\u63a7\u5236\u53f0\u200b\u7f16\u8f91\u5668\u200b\u4e2d\u200b\u5c1d\u8bd5\u200b\u4e0a\u8ff0\u200b\u4ee3\u7801\u200b\u3002\u200b\u8c03\u7528\u200b\u753b\u5e03\u200b\u7a97\u53e3\u200b\uff0c\u200b\u6dfb\u52a0\u200b\u4ee5\u4e0b\u200b\u4ee3\u7801\u200b\u4ee5\u200b\u5b9e\u4f8b\u200b\u5316\u200b<code>MyWnd</code>\u200b\u7c7b\u200b\u3002\u200b\u5b83\u4eec\u200b\u5c06\u200b\u5728\u200b\u65b0\u521b\u5efa\u200b\u7684\u200b\u753b\u5e03\u200b\u4e0a\u200b\u6e32\u67d3\u200b\u5f53\u524d\u200b\u9009\u5b9a\u200b\u7684\u200b\u56fe\u5c42\u200b</p> <pre><code>w = MyWnd(iface.activeLayer())\nw.show()\n</code></pre>"},{"location":"9-%E4%BD%BF%E7%94%A8%E5%9C%B0%E5%9B%BE%E7%94%BB%E5%B8%83/#931-qgsmaptoolidentifyfeature","title":"9.3.1 \u200b\u4f7f\u7528\u200bQgsMapToolIdentifyFeature\u200b\u9009\u62e9\u200b\u8981\u7d20","text":"<p>\u200b\u4f60\u200b\u53ef\u4ee5\u200b\u4f7f\u7528\u200b\u5730\u56fe\u200b\u5de5\u5177\u200b<code>QgsMapToolIdentifyFeature</code>\u200b\u4e3a\u200b\u7528\u6237\u200b\u9009\u62e9\u200b\u4e00\u4e2a\u200b\u8981\u7d20\u200b\uff0c\u200b\u8fd9\u4e2a\u200b\u8981\u7d20\u200b\u5c06\u200b\u88ab\u200b\u4f20\u9012\u200b\u7ed9\u200b\u56de\u8c03\u200b\u51fd\u6570\u200b\u3002</p> <pre><code>def callback(feature):\n    \"\"\"\u200b\u5f53\u200b\u7528\u6237\u200b\u9009\u62e9\u200b\u8981\u7d20\u200b\u540e\u200b\u88ab\u200b\u8c03\u7528\u200b\"\"\"\n    print(\"You clicked on feature {}\".format(feature.id()))\n\n\ncanvas = iface.mapCanvas()\nfeature_identifier = QgsMapToolIdentifyFeature(canvas)\n\n# \u200b\u8868\u793a\u200b\u88ab\u200b\u9009\u62e9\u200b\u7684\u200b\u56fe\u5c42\u200b\nfeature_identifier.setLayer(vlayer)\n\n# \u200b\u5f53\u200b\u7528\u6237\u200b\u8bc6\u522b\u200b\u8981\u7d20\u200b\u65f6\u200b\u89e6\u53d1\u200b\u69fd\u200b\u51fd\u6570\u200b\uff0c\u200b\u4f7f\u7528\u200b\u56de\u8c03\u200b\u51fd\u6570\u200b\nfeature_identifier.featureIdentified.connect(callback)\n\n# \u200b\u6fc0\u6d3b\u200b\u8fd9\u4e2a\u200b\u5730\u56fe\u200b\u5de5\u5177\u200b\ncanvas.setMapTool(feature_identifier)\n</code></pre>"},{"location":"9-%E4%BD%BF%E7%94%A8%E5%9C%B0%E5%9B%BE%E7%94%BB%E5%B8%83/#932","title":"9.3.2 \u200b\u5c06\u200b\u9879\u76ee\u200b\u6dfb\u52a0\u200b\u5230\u200b\u5730\u56fe\u200b\u753b\u5e03\u200b\u4e0a\u4e0b\u6587\u200b\u83dc\u5355","text":"<p>\u200b\u4f7f\u7528\u200b\u5730\u56fe\u200b\u753b\u5e03\u200b\u4e5f\u200b\u53ef\u4ee5\u200b\u901a\u8fc7\u200b\u4f7f\u7528\u200b<code>contextMenuAboutToShow</code>\u200b\u4fe1\u53f7\u200b\u6dfb\u52a0\u200b\u5230\u200b\u5176\u200b\u4e0a\u4e0b\u6587\u200b\u83dc\u5355\u200b\u4e2d\u200b\u7684\u200b\u6761\u76ee\u200b\u6765\u200b\u5b8c\u6210\u200b\u3002</p> <p>\u200b\u5f53\u200b\u4f60\u200b\u53f3\u952e\u200b\u5355\u51fb\u200b\u5730\u56fe\u200b\u753b\u5e03\u200b\u65f6\u200b\uff0c\u200b\u4ee5\u4e0b\u200b\u4ee3\u7801\u200b\u4f1a\u200b\u5728\u200b\u9ed8\u8ba4\u200b\u6761\u76ee\u200b\u65c1\u8fb9\u200b\u6dfb\u52a0\u200b My Menu  \u25ba  My Action \u200b\u64cd\u4f5c\u200b\u3002</p> <pre><code># \u200b\u7528\u4e8e\u200b\u586b\u5145\u200b\u4e0a\u4e0b\u6587\u200b\u83dc\u5355\u200b\u7684\u200b\u63d2\u69fd\u200b\ndef populateContextMenu(menu: QMenu, event: QgsMapMouseEvent):\n    subMenu = menu.addMenu('My Menu')\n    action = subMenu.addAction('My Action')\n    action.triggered.connect(lambda *args:\n                             print(f'Action triggered at {event.x()},{event.y()}'))\n\ncanvas.contextMenuAboutToShow.connect(populateContextMenu)\ncanvas.show()\n</code></pre>"},{"location":"9-%E4%BD%BF%E7%94%A8%E5%9C%B0%E5%9B%BE%E7%94%BB%E5%B8%83/#94","title":"9.4 \u200b\u7f16\u5199\u200b\u81ea\u5b9a\u4e49\u200b\u5730\u56fe\u200b\u5de5\u5177","text":"<p>\u200b\u4f60\u200b\u53ef\u4ee5\u200b\u7f16\u5199\u200b\u81ea\u5b9a\u4e49\u200b\u5de5\u5177\u200b\uff0c\u200b\u6765\u200b\u5b9e\u73b0\u200b\u7528\u6237\u200b\u5728\u200b\u753b\u5e03\u200b\u4e0a\u200b\u6267\u884c\u200b\u81ea\u5b9a\u4e49\u200b\u884c\u4e3a\u200b\u7684\u200b\u64cd\u4f5c\u200b\u3002</p> <p>\u200b\u5730\u56fe\u200b\u5de5\u5177\u200b\u5e94\u200b\u7ee7\u627f\u200b\u81ea\u200b<code>QgsMapTool</code>\u200b\u7c7b\u200b\u6216\u200b\u4efb\u4f55\u200b\u6d3e\u751f\u7c7b\u200b\uff0c\u200b\u5e76\u200b\u4f7f\u7528\u200b<code>setMapTool()</code> \u200b\u5728\u200b\u753b\u5e03\u200b\u4e2d\u200b\u9009\u62e9\u200b\u4e3a\u200b\u6fc0\u6d3b\u200b\u5de5\u5177\u200b\u3002</p> <p>\u200b\u4e0b\u9762\u200b\u662f\u200b\u4e00\u4e2a\u200b\u5730\u56fe\u200b\u5de5\u5177\u200b\u793a\u4f8b\u200b\uff0c\u200b\u5b83\u200b\u5141\u8bb8\u200b\u901a\u8fc7\u200b\u5728\u200b\u753b\u5e03\u200b\u4e0a\u200b\u5355\u51fb\u200b\u5e76\u200b\u62d6\u52a8\u200b\u6765\u200b\u5b9a\u4e49\u200b\u77e9\u5f62\u200b\u8303\u56f4\u200b\u3002\u200b\u5b9a\u4e49\u200b\u77e9\u5f62\u200b\u540e\u200b\uff0c\u200b\u5b83\u4f1a\u200b\u5728\u200b\u63a7\u5236\u53f0\u200b\u4e2d\u200b\u6253\u5370\u200b\u5176\u200b\u8fb9\u754c\u200b\u5750\u6807\u200b\u3002\u200b\u5b83\u200b\u4f7f\u7528\u200b\u524d\u9762\u200b\u63cf\u8ff0\u200b\u7684\u200b\u6a61\u76ae\u200b\u6761\u200b\u5143\u7d20\u200b\u6765\u200b\u663e\u793a\u200b\u6240\u200b\u5b9a\u4e49\u200b\u7684\u200b\u77e9\u5f62\u200b\u3002</p> <pre><code>class RectangleMapTool(QgsMapToolEmitPoint):\n    def __init__(self, canvas):\n        self.canvas = canvas\n        QgsMapToolEmitPoint.__init__(self, self.canvas)\n        self.rubberBand = QgsRubberBand(self.canvas, QgsWkbTypes.PolygonGeometry)\n        self.rubberBand.setColor(Qt.red)\n        self.rubberBand.setWidth(1)\n        self.reset()\n\n    def reset(self):\n        self.startPoint = self.endPoint = None\n        self.isEmittingPoint = False\n        self.rubberBand.reset(QgsWkbTypes.PolygonGeometry)\n\n    def canvasPressEvent(self, e):\n        self.startPoint = self.toMapCoordinates(e.pos())\n        self.endPoint = self.startPoint\n        self.isEmittingPoint = True\n        self.showRect(self.startPoint, self.endPoint)\n\n    def canvasReleaseEvent(self, e):\n        self.isEmittingPoint = False\n        r = self.rectangle()\n        if r is not None:\n            print(\"Rectangle:\", r.xMinimum(),\n                  r.yMinimum(), r.xMaximum(), r.yMaximum()\n                  )\n\n    def canvasMoveEvent(self, e):\n        if not self.isEmittingPoint:\n            return\n\n        self.endPoint = self.toMapCoordinates(e.pos())\n        self.showRect(self.startPoint, self.endPoint)\n\n    def showRect(self, startPoint, endPoint):\n        self.rubberBand.reset(QgsWkbTypes.PolygonGeometry)\n        if startPoint.x() == endPoint.x() or startPoint.y() == endPoint.y():\n            return\n\n        point1 = QgsPointXY(startPoint.x(), startPoint.y())\n        point2 = QgsPointXY(startPoint.x(), endPoint.y())\n        point3 = QgsPointXY(endPoint.x(), endPoint.y())\n        point4 = QgsPointXY(endPoint.x(), startPoint.y())\n\n        self.rubberBand.addPoint(point1, False)\n        self.rubberBand.addPoint(point2, False)\n        self.rubberBand.addPoint(point3, False)\n        self.rubberBand.addPoint(point4, True)  # true to update canvas\n        self.rubberBand.show()\n\n    def rectangle(self):\n        if self.startPoint is None or self.endPoint is None:\n            return None\n        elif (self.startPoint.x() == self.endPoint.x() or \\\n              self.startPoint.y() == self.endPoint.y()):\n            return None\n\n        return QgsRectangle(self.startPoint, self.endPoint)\n\n    def deactivate(self):\n        QgsMapTool.deactivate(self)\n        self.deactivated.emit()\n</code></pre>"},{"location":"9-%E4%BD%BF%E7%94%A8%E5%9C%B0%E5%9B%BE%E7%94%BB%E5%B8%83/#95","title":"9.5 \u200b\u7f16\u5199\u200b\u81ea\u5b9a\u4e49\u200b\u5730\u56fe\u200b\u753b\u5e03\u200b\u9879","text":"<p>\u200b\u8fd9\u662f\u200b\u4e00\u4e2a\u200b\u81ea\u5b9a\u4e49\u200b\u753b\u5e03\u200b\u9879\u200b\u7684\u200b\u793a\u4f8b\u200b\uff0c\u200b\u8be5\u200b\u753b\u5e03\u200b\u9879\u200b\u7ed8\u5236\u200b\u4e86\u200b\u4e00\u4e2a\u200b\u5706\u200b\uff1a</p> <pre><code>class CircleCanvasItem(QgsMapCanvasItem):\n    def __init__(self, canvas):\n        super().__init__(canvas)\n        self.center = QgsPoint(0, 0)\n        self.size = 100\n\n    def setCenter(self, center):\n        self.center = center\n\n    def center(self):\n        return self.center\n\n    def setSize(self, size):\n        self.size = size\n\n    def size(self):\n        return self.size\n\n    def boundingRect(self):\n        return QRectF(self.center.x() - self.size / 2,\n                      self.center.y() - self.size / 2,\n                      self.center.x() + self.size / 2,\n                      self.center.y() + self.size / 2)\n\n    def paint(self, painter, option, widget):\n        path = QPainterPath()\n        path.moveTo(self.center.x(), self.center.y());\n        path.arcTo(self.boundingRect(), 0.0, 360.0)\n        painter.fillPath(path, QColor(\"red\"))\n\n\n# \u200b\u4f7f\u7528\u200b\u81ea\u5b9a\u4e49\u200b\u9879\u200b:\nitem = CircleCanvasItem(iface.mapCanvas())\nitem.setCenter(QgsPointXY(200, 200))\nitem.setSize(80)\n</code></pre>"}]}